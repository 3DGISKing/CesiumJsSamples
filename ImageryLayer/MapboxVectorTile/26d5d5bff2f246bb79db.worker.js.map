{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./node_modules/assert/assert.js","webpack:///./src/style/properties.js","webpack:///./src/util/util.js","webpack:///./src/util/web_worker_transfer.js","webpack:///./src/style-spec/expression/types.js","webpack:///./src/style-spec/error/validation_error.js","webpack:///./node_modules/@mapbox/point-geometry/index.js","webpack:///./src/style-spec/util/get_type.js","webpack:///./src/style-spec/reference/latest.js","webpack:///./src/style/style_layer.js","webpack:///./src/data/array_types.js","webpack:///./src/style-spec/expression/values.js","webpack:///./src/style-spec/util/unbundle_jsonlint.js","webpack:///./src/style-spec/util/color.js","webpack:///./src/style-spec/expression/index.js","webpack:///./src/style-spec/expression/runtime_error.js","webpack:///./src/style-spec/validate/validate.js","webpack:///./src/util/struct_array.js","webpack:///./src/data/extent.js","webpack:///./src/style-spec/util/interpolate.js","webpack:///./src/data/load_geometry.js","webpack:///./node_modules/@mapbox/vector-tile/index.js","webpack:///./src/style-spec/util/extend.js","webpack:///./src/style-spec/expression/compound_expression.js","webpack:///./src/style-spec/validate/validate_object.js","webpack:///./src/data/segment.js","webpack:///./src/data/program_configuration.js","webpack:///./src/data/index_array_type.js","webpack:///./src/util/intersection_tests.js","webpack:///./src/util/image.js","webpack:///./src/style/query_utils.js","webpack:///./src/util/script_detection.js","webpack:///./node_modules/pbf/index.js","webpack:///./src/style-spec/expression/evaluation_context.js","webpack:///./src/style-spec/expression/definitions/interpolate.js","webpack:///./src/style-spec/function/index.js","webpack:///./src/util/browser/window.js","webpack:///./src/style-spec/validate/validate_enum.js","webpack:///./src/style-spec/validate/validate_filter.js","webpack:///./src/style-spec/feature_filter/index.js","webpack:///./src/util/classify_rings.js","webpack:///./src/style/evaluation_parameters.js","webpack:///./src/data/bucket/symbol_bucket.js","webpack:///./src/source/rtl_text_plugin.js","webpack:///./src/util/ajax.js","webpack:///./src/symbol/anchor.js","webpack:///./node_modules/geojson-vt/src/feature.js","webpack:///./node_modules/@mapbox/unitbezier/index.js","webpack:///./src/geo/coordinate.js","webpack:///./node_modules/grid-index/grid-index.js","webpack:///./node_modules/csscolorparser/csscolorparser.js","webpack:///./src/style-spec/expression/parsing_error.js","webpack:///./src/style-spec/expression/parsing_context.js","webpack:///./src/style-spec/expression/scope.js","webpack:///./src/style-spec/expression/definitions/literal.js","webpack:///./src/style-spec/expression/definitions/assertion.js","webpack:///./src/style-spec/expression/definitions/array.js","webpack:///./src/style-spec/expression/definitions/coercion.js","webpack:///./src/style-spec/expression/is_constant.js","webpack:///./src/style-spec/expression/definitions/var.js","webpack:///./src/style-spec/expression/definitions/step.js","webpack:///./src/style-spec/expression/stops.js","webpack:///./src/style-spec/expression/definitions/coalesce.js","webpack:///./src/style-spec/expression/definitions/let.js","webpack:///./src/style-spec/expression/definitions/index.js","webpack:///./src/style-spec/validate/validate_constants.js","webpack:///./src/style-spec/validate/validate_function.js","webpack:///./src/style-spec/validate/validate_array.js","webpack:///./src/style-spec/validate/validate_number.js","webpack:///./src/style-spec/validate/validate_expression.js","webpack:///./src/style-spec/validate/validate_layer.js","webpack:///./src/style-spec/validate/validate_paint_property.js","webpack:///./src/style-spec/validate/validate_property.js","webpack:///./src/style-spec/validate/validate_layout_property.js","webpack:///./src/style-spec/validate/validate_source.js","webpack:///./src/style-spec/validate/validate_light.js","webpack:///./src/style-spec/validate/validate_string.js","webpack:///./src/util/evented.js","webpack:///./src/data/bucket/circle_bucket.js","webpack:///./node_modules/earcut/src/earcut.js","webpack:///./node_modules/@mapbox/vector-tile/lib/vectortilelayer.js","webpack:///./node_modules/@mapbox/vector-tile/lib/vectortilefeature.js","webpack:///./src/util/verticalize_punctuation.js","webpack:///./src/source/vector_tile_worker_source.js","webpack:///./src/util/dictionary_coder.js","webpack:///./src/source/tile_id.js","webpack:///./node_modules/@mapbox/shelf-pack/index.umd.js","webpack:///./node_modules/geojson-vt/src/clip.js","webpack:///./src/source/worker.js","webpack:///./src/util/actor.js","webpack:///./src/style-spec/util/deep_equal.js","webpack:///(webpack)/buildin/global.js","webpack:///./node_modules/node-libs-browser/node_modules/util/util.js","webpack:///./node_modules/process/browser.js","webpack:///./node_modules/node-libs-browser/node_modules/util/support/isBufferBrowser.js","webpack:///./node_modules/inherits/inherits_browser.js","webpack:///./src/style-spec/expression/definitions/at.js","webpack:///./src/style-spec/expression/definitions/match.js","webpack:///./src/style-spec/expression/definitions/case.js","webpack:///./src/style-spec/expression/definitions/equals.js","webpack:///./src/style-spec/util/result.js","webpack:///./src/style-spec/util/color_spaces.js","webpack:///./src/style/style_layer_index.js","webpack:///./src/style/validate_style.js","webpack:///./src/style-spec/validate_style.min.js","webpack:///./src/style-spec/validate/validate_boolean.js","webpack:///./src/style-spec/validate/validate_color.js","webpack:///./src/style-spec/validate/validate_glyphs_url.js","webpack:///./src/style/style_layer/circle_style_layer.js","webpack:///./src/data/bucket/circle_attributes.js","webpack:///./src/shaders/encode_attribute.js","webpack:///./src/style/style_layer/circle_style_layer_properties.js","webpack:///./src/style/style_layer/heatmap_style_layer.js","webpack:///./src/data/bucket/heatmap_bucket.js","webpack:///./src/style/style_layer/heatmap_style_layer_properties.js","webpack:///./src/style/style_layer/hillshade_style_layer.js","webpack:///./src/style/style_layer/hillshade_style_layer_properties.js","webpack:///./src/style/style_layer/fill_style_layer.js","webpack:///./src/data/bucket/fill_bucket.js","webpack:///./src/data/bucket/fill_attributes.js","webpack:///./node_modules/quickselect/index.js","webpack:///./src/style/style_layer/fill_style_layer_properties.js","webpack:///./src/style/style_layer/fill_extrusion_style_layer.js","webpack:///./src/data/bucket/fill_extrusion_bucket.js","webpack:///./src/data/bucket/fill_extrusion_attributes.js","webpack:///./src/style/style_layer/fill_extrusion_style_layer_properties.js","webpack:///./src/style/style_layer/line_style_layer.js","webpack:///./src/data/bucket/line_bucket.js","webpack:///./src/data/bucket/line_attributes.js","webpack:///./node_modules/@mapbox/vector-tile/lib/vectortile.js","webpack:///./src/style/style_layer/line_style_layer_properties.js","webpack:///./src/style/zoom_history.js","webpack:///./src/style/style_layer/symbol_style_layer.js","webpack:///./src/data/bucket/symbol_attributes.js","webpack:///./src/symbol/transform_text.js","webpack:///./src/symbol/mergelines.js","webpack:///./src/util/is_char_in_unicode_block.js","webpack:///./src/symbol/symbol_size.js","webpack:///./src/util/token.js","webpack:///./src/style/style_layer/symbol_style_layer_properties.js","webpack:///./src/style/style_layer/background_style_layer.js","webpack:///./src/style/style_layer/background_style_layer_properties.js","webpack:///./src/style/style_layer/raster_style_layer.js","webpack:///./src/style/style_layer/raster_style_layer_properties.js","webpack:///./src/style-spec/group_by_layout.js","webpack:///./src/style-spec/util/ref_properties.js","webpack:///./node_modules/ieee754/index.js","webpack:///./src/source/worker_tile.js","webpack:///./src/data/feature_index.js","webpack:///./src/util/vectortile_to_geojson.js","webpack:///./node_modules/@mapbox/whoots-js/index.umd.js","webpack:///./src/symbol/symbol_layout.js","webpack:///./src/symbol/get_anchors.js","webpack:///./src/symbol/check_max_angle.js","webpack:///./src/symbol/clip_line.js","webpack:///./src/symbol/opacity_state.js","webpack:///./src/symbol/shaping.js","webpack:///./src/symbol/quads.js","webpack:///./src/style/parse_glyph_pbf.js","webpack:///./src/symbol/collision_feature.js","webpack:///./src/util/find_pole_of_inaccessibility.js","webpack:///./node_modules/tinyqueue/index.js","webpack:///./src/render/image_atlas.js","webpack:///./src/render/glyph_atlas.js","webpack:///./src/source/raster_dem_tile_worker_source.js","webpack:///./src/data/dem_data.js","webpack:///./src/source/geojson_worker_source.js","webpack:///./node_modules/geojson-rewind/index.js","webpack:///./node_modules/@mapbox/geojson-area/index.js","webpack:///./node_modules/wgs84/index.js","webpack:///./src/source/geojson_wrapper.js","webpack:///./node_modules/vt-pbf/index.js","webpack:///./node_modules/vt-pbf/lib/geojson_wrapper.js","webpack:///./node_modules/supercluster/index.js","webpack:///./node_modules/kdbush/src/kdbush.js","webpack:///./node_modules/kdbush/src/sort.js","webpack:///./node_modules/kdbush/src/range.js","webpack:///./node_modules/kdbush/src/within.js","webpack:///./node_modules/geojson-vt/src/index.js","webpack:///./node_modules/geojson-vt/src/convert.js","webpack:///./node_modules/geojson-vt/src/simplify.js","webpack:///./node_modules/geojson-vt/src/transform.js","webpack:///./node_modules/geojson-vt/src/wrap.js","webpack:///./node_modules/geojson-vt/src/tile.js"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","compare","a","b","x","length","y","len","Math","min","isBuffer","global","Buffer","_isBuffer","util","hasOwn","pSlice","Array","slice","functionsHaveNames","pToString","obj","toString","isView","arrbuf","ArrayBuffer","DataView","buffer","assert","ok","regex","getName","func","isFunction","match","truncate","inspect","something","rawname","fail","actual","expected","message","operator","stackStartFunction","AssertionError","_deepEqual","strict","memos","isDate","getTime","isRegExp","source","multiline","lastIndex","ignoreCase","Float32Array","Float64Array","Uint8Array","actualIndex","indexOf","push","actualVisitedObjects","isPrimitive","getPrototypeOf","aIsArgs","isArguments","bIsArgs","ka","objectKeys","kb","sort","objEquiv","expectedException","test","e","Error","isPrototypeOf","_throws","shouldThrow","block","TypeError","error","_tryBlock","userProvidedMessage","isUnexpectedException","isError","options","this","generatedMessage","self","getMessage","captureStackTrace","err","stack","out","fn_name","idx","next_line","substring","inherits","equal","notEqual","deepEqual","deepStrictEqual","notDeepEqual","notDeepStrictEqual","strictEqual","notStrictEqual","throws","doesNotThrow","ifError","keys","require","clone","extend","easeCubicInOut","interpolate","normalizePropertyExpression","register","PropertyValue","expression","undefined","specification","default","kind","parameters","possiblyEvaluate","TransitionablePropertyValue","prior","TransitioningPropertyValue","transition","now","Transitionable","properties","_properties","_values","defaultTransitionablePropertyValues","result","getValue","getTransition","Transitioning","transitioned","untransitioned","begin","delay","end","duration","finalValue","isDataDriven","defaultTransitioningPropertyValues","PossiblyEvaluated","Layout","defaultPropertyValues","PossiblyEvaluatedPropertyValue","globals","feature","evaluate","defaultPossiblyEvaluatedValues","DataConstantProperty","interp","type","DataDrivenProperty","CrossFadedProperty","constant","_calculate","zoom","mid","max","z","fraction","floor","crossFadingFactor","zoomHistory","lastIntegerZoom","from","to","fromScale","toScale","HeatmapColorProperty","Properties","prop","defaultPropertyValue","defaultTransitionablePropertyValue","UnitBezier","Coordinate","t2","t3","bezier","p1x","p1y","p2x","p2y","solve","ease","clamp","wrap","w","asyncAll","array","fn","callback","remaining","results","forEach","item","values","k","keysDifference","other","difference","dest","sources","src","pick","id","uniqueId","bindAll","fns","context","getCoordinatesCenter","coords","minX","Infinity","minY","maxX","maxY","column","row","dx","dy","dMax","log","LN2","zoomTo","endsWith","string","suffix","mapObject","input","iterator","output","filterObject","isArray","map","arraysIntersect","warnOnceHistory","warnOnce","console","warn","isCounterClockwise","calculateSignedArea","ring","p1","p2","sum","j","isClosedPolygon","points","abs","sphericalToCartesian","azimuthal","polar","PI","cos","sin","parseCacheControl","cacheControl","header","replace","$0","$1","$2","$3","toLowerCase","maxAge","parseInt","isNaN","Grid","Color","StylePropertyFunction","StyleExpression","StyleExpressionWithErrorHandling","ZoomDependentExpression","ZoomConstantExpression","CompoundExpression","expressions","ImageData","registry","klass","writeable","omit","shallow","serialize","grid","transferables","ab","toArrayBuffer","deserialize","serialized","_classRegistryKey","Boolean","Number","String","Date","RegExp","view","data","constructor","_serialized","NullType","NumberType","StringType","BooleanType","ColorType","ObjectType","ValueType","itemType","N","valueMemberTypes","ErrorType","checkSubtype","__line__","line","Point","add","_add","sub","_sub","multByPoint","_multByPoint","divByPoint","_divByPoint","mult","_mult","div","_div","rotate","_rotate","rotateAround","_rotateAround","matMult","_matMult","unit","_unit","perp","_perp","round","_round","mag","sqrt","equals","dist","distSqr","angle","atan2","angleTo","angleWith","angleWithSep","convert","val","styleSpec","validateStyle","Evented","StyleLayer","layer","metadata","minzoom","maxzoom","visibility","sourceLayer","filter","_featureFilter","layout","_unevaluatedLayout","_transitionablePaint","paint","setPaintProperty","validate","setLayoutProperty","_transitioningPaint","_validate","layoutProperty","setValue","paintProperty","setTransition","hasTransition","emitErrors","layerType","objectKey","style","glyphs","sprite","subclasses","StructArray","Struct","StructArrayLayout2i4","uint8","arrayBuffer","int16","Int16Array","v0","v1","resize","o2","bytesPerElement","StructArrayLayout4i8","v2","v3","StructArrayLayout2i4i12","v4","v5","StructArrayLayout4i4ub12","v6","v7","o1","StructArrayLayout4i4ui16","uint16","Uint16Array","StructArrayLayout3f12","float32","o4","StructArrayLayout1ul4","uint32","Uint32Array","StructArrayLayout6i1ul2ui2i24","v8","v9","v10","StructArrayLayout2i2i2i12","StructArrayLayout2ub4","StructArrayLayout2i2ui3ul3ui2f2ub40","v11","v12","v13","StructArrayLayout1f4","StructArrayLayout3i6","StructArrayLayout1ul2ui8","StructArrayLayout3ui6","StructArrayLayout2ui4","StructArrayLayout2f8","StructArrayLayout4f16","CollisionBoxStruct","_structArray","_pos2","_pos4","anchorPointX","anchorPointY","size","CollisionBoxArray","index","isTransferred","PlacedSymbolStruct","_pos1","PlacedSymbolArray","GlyphOffsetStruct","GlyphOffsetArray","SymbolLineVertexStruct","SymbolLineVertexArray","FeatureIndexStruct","FeatureIndexArray","PosArray","RasterBoundsArray","CircleLayoutArray","FillLayoutArray","FillExtrusionLayoutArray","HeatmapLayoutArray","LineLayoutArray","SymbolLayoutArray","SymbolDynamicLayoutArray","SymbolOpacityArray","CollisionBoxLayoutArray","CollisionCircleLayoutArray","CollisionVertexArray","TriangleIndexArray","LineIndexArray","validateRGBA","g","join","isValue","mixed","typeOf","unbundle","valueOf","deep","deepUnbundle","parseCSSColor","rgba","rgb","concat","black","white","transparent","ParsingError","ParsingContext","EvaluationContext","Step","Interpolate","Coalesce","Let","definitions","isConstant","RuntimeError","success","_evaluator","propertySpec","spec","_warningHistory","_defaultValue","parse","_enumValues","v","JSON","stringify","isExpression","createExpression","parser","getExpectedType","parsed","handleErrors","errors","_styleExpression","zoomCurve","zoomStops","labels","_interpolationType","interpolation","lower","upper","interpolationFactor","createPropertyExpression","isFeatureConstant","isZoomConstant","isGlobalPropertyConstant","findZoomCurve","createFunction","_parameters","_specification","args","arg","eachChild","child","childResult","types","color","number","enum","boolean","validateFunction","validateExpression","validateObject","VALIDATORS","valueSpec","function","viewTypes","Int8Array","Int32Array","capacity","_trim","structArray","byteLength","_refreshViews","reserve","oldUint8Array","set","sizeOf","BYTES_PER_ELEMENT","align","offset","ceil","_pos8","createLayout","members","alignment","maxSize","layoutMembers","member","typeSize","memberOffset","components","EXTENT","bits","bounds","pow","scale","extent","geometry","loadGeometry","point","VectorTile","VectorTileFeature","VectorTileLayer","inputs","_evaluate","op","definition","availableOverloads","overloads","signature","parsedArgs","params","signatureContext","path","scope","apply","signatures","actualTypes","ctx","varargs","ValidationError","getType","validateSpec","elementSpecs","elementValidators","objectElementValidators","elementSpecKey","split","elementSpec","validateElement","required","MAX_VERTEX_ARRAY_LENGTH","SegmentVector","segments","numVertices","layoutVertexArray","indexArray","segment","vertexLength","vertexOffset","primitiveOffset","primitiveLength","vaos","destroy","packUint8ToFloat","packColor","ConstantBinder","statistics","program","currentValue","constantOr","gl","uniform4f","uniforms","uniform1f","SourceExpressionBinder","PaintVertexArray","paintVertexAttributes","paintVertexArray","paintArray","start","emplaceBack","paintVertexBuffer","createVertexBuffer","CompositeExpressionBinder","useIntegerZoom","minColor","maxColor","currentZoom","ProgramConfiguration","binders","cacheKey","_buffers","populatePaintArray","defines","setUniforms","upload","buffers","binder","filterProperties","paintAttributeName","ProgramConfigurationSet","layoutAttributes","layers","programConfigurations","createDynamic","populatePaintArrays","layerId","lineIntersectsBufferedLine","lineA","lineB","radius","lineIntersectsLine","pointIntersectsBufferedLine","a0","a1","lineSegmentIntersectsLineSegment","b0","b1","radiusSquared","distToSegmentSquared","l2","multiPolygonContainsPoint","rings","polygonContainsPoint","multiPolygonIntersectsBufferedMultiPoint","multiPolygon","polygon","multiPolygonIntersectsMultiPolygon","multiPolygonA","multiPolygonB","multiPolygonIntersectsBufferedMultiLine","multiLine","polygonIntersectsPolygon","polygonA","polygonB","createImage","image","channels","width","height","RangeError","resizeImage","newImage","copyImage","srcImg","dstImg","srcPt","dstPt","srcData","dstData","srcOffset","dstOffset","AlphaImage","RGBAImage","getMaximumPaintValue","bucket","translateDistance","translate","queryGeometry","translateAnchor","bearing","pixelsToTileUnits","pt","translated","translatedRing","isChar","allowsIdeographicBreaking","chars","char","charAllowsIdeographicBreaking","charCodeAt","allowsVerticalWritingMode","charHasUprightVerticalOrientation","allowsLetterSpacing","charAllowsLetterSpacing","charHasNeutralVerticalOrientation","charHasRotatedVerticalOrientation","Pbf","ieee754","buf","pos","Varint","Fixed64","Bytes","Fixed32","readPackedEnd","pbf","readVarint","toNum","low","high","isSigned","makeRoomForExtraLength","startPos","extraLen","realloc","writePackedVarint","arr","writeVarint","writePackedSVarint","writeSVarint","writePackedFloat","writeFloat","writePackedDouble","writeDouble","writePackedBoolean","writeBoolean","writePackedFixed32","writeFixed32","writePackedSFixed32","writeSFixed32","writePackedFixed64","writeFixed64","writePackedSFixed64","writeSFixed64","readUInt32","writeInt32","readInt32","readFields","readField","tag","skip","readMessage","readFixed32","readSFixed32","readFixed64","readSFixed64","readFloat","read","readDouble","h","readVarintRemainder","readVarint64","readSVarint","num","readBoolean","readString","str","b2","b3","bytesPerSequence","fromCharCode","readUtf8","readBytes","subarray","readPackedVarint","readPackedSVarint","readPackedBoolean","readPackedFloat","readPackedDouble","readPackedFixed32","readPackedSFixed32","readPackedFixed64","readPackedSFixed64","writeTag","finish","writeBigVarintLow","lsb","writeBigVarintHigh","writeBigVarint","writeString","lead","writeUtf8","write","writeBytes","writeRawMessage","writeMessage","writeBytesField","writeFixed32Field","writeSFixed32Field","writeFixed64Field","writeSFixed64Field","writeVarintField","writeSVarintField","writeStringField","writeFloatField","writeDoubleField","writeBooleanField","Scope","geometryTypes","_parseColorCache","bindings","parent","cached","findStopLessThanOrEqualTo","stops","outputs","label","exponentialInterpolation","base","controlPoints","rest","some","outputType","expectedType","labelKey","valueKey","stopCount","outputLower","outputUpper","possibleOutputs","lowerValue","upperValue","progress","colorSpaces","identityFunction","coalesce","evaluateCategoricalFunction","hashedStops","keyType","evaluateIntervalFunction","evaluateExponentialFunction","colorSpace","colorspace","reverse","forward","evaluatedLower","evaluatedUpper","evaluateIdentityFunction","lowerIndex","upperIndex","currentIndex","innerFun","categoricalKeyType","isColor","zoomAndFeatureDependent","featureDependent","zoomDependent","stop","featureFunctions","featureFunctionStops","_","validateEnum","isExpressionFilter","expressionContext","validateNonExpressionFilter","filter_operator","geometry_type","f","convertFilter","compiled","filterSpec","globalProperties","filters","convertComparisonOp","convertNegation","convertInOp","convertHasOp","quickselect","compareAreas","area","maxRings","ccw","polygons","ZoomHistory","EvaluationParameters","fadeDuration","lastIntegerZoomTime","symbolLayoutAttributes","collisionVertexAttributes","collisionBoxLayout","collisionCircleLayout","dynamicLayoutAttributes","transformText","mergeLines","scriptDetection","vectorTileFeatureTypes","verticalizePunctuation","getSizeData","shaderOpacityAttributes","addVertex","anchorX","anchorY","ox","oy","tx","ty","sizeVertex","addDynamicAttributes","dynamicLayoutVertexArray","SymbolBuffers","opacityVertexArray","placedSymbolArray","dynamicIndexBuffer","layoutVertexBuffer","indexBuffer","createIndexBuffer","dynamicLayoutVertexBuffer","opacityVertexBuffer","itemSize","CollisionBuffers","LayoutArray","IndexArray","collisionVertexArray","collisionVertexBuffer","SymbolBucket","collisionBoxArray","overscaling","layerIds","pixelRatio","unevaluatedLayoutValues","textSizeData","iconSizeData","sortFeaturesByY","text","icon","collisionBox","collisionCircle","glyphOffsetArray","lineVertexArray","features","textFont","textField","iconImage","hasText","hasIcon","icons","iconDependencies","stacks","glyphDependencies","sourceLayerIndex","getValueAndResolveTokens","symbolFeature","fontStack","textAlongLine","verticalChar","lookup","charAt","symbolInstances","anchor","lineStartIndex","sumForwardLength","sumBackwardLength","vertices","tileUnitDistanceFromAnchor","vertex","lineLength","arrays","quads","lineOffset","alongLine","writingMode","labelAnchor","prepareSegment","glyphOffsetArrayStart","vertexStartIndex","symbol","tl","tr","bl","br","tex","glyphOffset","extrude","x1","y1","x2","y2","boxAnchorPoint","symbolInstance","isCircle","_addCollisionDebugVertex","textCollisionFeature","boxStartIndex","textBoxStartIndex","boxEndIndex","textBoxEndIndex","iconCollisionFeature","iconBoxStartIndex","iconBoxEndIndex","box","addCollisionDebugVertices","anchorPoint","textStartIndex","textEndIndex","iconStartIndex","iconEndIndex","collisionArrays","textBox","textCircles","signedDistanceFromAnchor","iconBox","sortedAngle","symbolInstanceIndexes","aIndex","bIndex","featureIndex","clear","placedTextSymbolIndices","placedTextSymbolIndex","placedSymbol","endIndex","numGlyphs","vertexIndex","placedIcon","updateData","MAX_GLYPHS","ajax","window","pluginRequested","pluginBlobURL","evented","registerForPluginAvailability","errorCallback","once","createBlobURL","response","URL","createObjectURL","Blob","clearRTLTextPlugin","setRTLTextPlugin","pluginURL","getArrayBuffer","url","fire","applyArabicShaping","processBidirectionalText","ResourceType","Unknown","Style","Source","Tile","Glyphs","SpriteImage","SpriteJSON","Image","freeze","AJAXError","status","makeRequest","requestParameters","xhr","XMLHttpRequest","open","headers","setRequestHeader","withCredentials","credentials","getJSON","onerror","statusText","onload","send","responseType","getResponseHeader","expires","getImage","imgData","img","webkitURL","revokeObjectURL","blob","getVideo","urls","video","document","createElement","onloadstart","href","protocol","location","host","crossOrigin","appendChild","Anchor","calcLineBBox","geom","tags","calcBBox","cx","bx","ax","cy","by","ay","sampleCurveX","sampleCurveY","sampleCurveDerivativeX","solveCurveX","epsilon","t0","t1","d2","_zoomTo","GridIndex","padding","cells","keysOffset","bboxesOffset","bboxes","insert","_insertReadonly","uid","_forEachCell","_insertCell","cellIndex","query","_queryCell","seenUids","cell","u","arg1","arg2","cx1","_convertToCellCoord","cy1","cx2","cy2","metadataLength","totalCellLength","kCSSColorTable","clamp_css_byte","clamp_css_float","parse_css_int","parseFloat","parse_css_float","css_hue_to_rgb","m1","m2","css_str","iv","substr","ep","fname","alpha","pop","Literal","Assertion","ArrayAssertion","Coercion","part","expr","Expr","omitTypeAnnotations","ec","literalArgs","has","parseColor","startsWith","Var","unshift","pushScope","popScope","At","Match","Case","Equals","NotEquals","lt","gt","lteq","gteq","geometryType","heatmapDensity","E","log10","log2","tan","asin","acos","atan","binarySearch","toUpperCase","constants","validateArray","validateNumber","stopKeyType","previousStopDomainValue","previousStopDomainZoom","functionValueSpec","functionType","stopDomainValues","isZoomFunction","isPropertyFunction","isZoomAndPropertyFunction","arrayElementValidator","validateFunctionStop","$version","validateStopDomainValue","reportValue","isFinite","arraySpec","validateArrayElement","arrayElementSpec","arrayIndex","minimum","maximum","propertyKey","validateFilter","validatePaintProperty","validateLayoutProperty","ref","otherLayer","sourceType","validateProperty","propertyType","layerSpec","transitionMatch","tokenMatch","tokens","exec","source_geojson","source_video","source_image","source_canvas","light","lightSpec","rootType","_addEventListener","listener","listenerList","_removeEventListener","splice","_listeners","_oneTimeListeners","listens","target","_eventedParent","_eventedParentData","addCircleVertex","extrudeX","extrudeY","CircleBucket","addFeature","earcut","holeIndices","dim","invSize","hasHoles","outerLen","outerNode","linkedList","triangles","list","queue","next","steiner","getLeftmost","compareX","eliminateHole","filterPoints","eliminateHoles","earcutLinked","clockwise","last","signedArea","insertNode","removeNode","again","prev","ear","pass","zOrder","prevZ","nextZ","q","tail","numMerges","pSize","qSize","inSize","sortLinked","indexCurve","isEarHashed","isEar","cureLocalIntersections","splitEarcut","pointInTriangle","minTX","minTY","maxTX","maxTY","minZ","maxZ","intersects","locallyInside","isValidDiagonal","splitPolygon","hole","hx","hy","qx","mx","my","tanMin","findHoleBridge","leftmost","px","py","intersectsPolygon","inside","middleInside","q1","q2","a2","Node","an","bp","deviation","polygonArea","trianglesArea","flatten","holes","dimensions","holeIndex","version","_pbf","_keys","_features","readLayer","readValueMessage","_geometry","readFeature","readTag","cmd","lines","cmdLen","bbox","toGeoJSON","x0","y0","project","exp","classifyRings","coordinates","nextCharCode","prevCharCode","vt","Protobuf","WorkerTile","loadVectorTile","request","vectorTile","rawData","abort","VectorTileWorkerSource","actor","layerIndex","loadVectorData","loading","loaded","workerTile","rawTileData","vtSource","showCollisionBoxes","reloadCallback","done","DictionaryCoder","strings","_stringToNumber","_numberToString","WhooTS","CanonicalTileID","calculateKey","scheme","getTileBBox","quadkey","mask","getQuadkey","UnwrappedTileID","canonical","posMatrix","OverscaledTileID","overscaledZ","targetZ","zDifference","sourceMaxZoom","rhs","ShelfPack$1","autoResize","shelves","freebins","stats","bins","maxId","Shelf","free","Bin","maxw","maxh","refcount","pack","allocation","packOne","inPlace","shrink","bin","shelf","waste","h1","h2","w1","w2","best","freebin","getBin","allocFreebin","allocShelf","alloc","unref","factory","k1","k2","axis","minAll","maxAll","clipped","newGeometry","clipPoints","clipLine","clipLines","createFeature","newGeom","isPolygon","intersect","intersectX","intersectY","az","sliced","addPoint","Actor","StyleLayerIndex","RasterDEMTileWorkerSource","GeoJSONWorkerSource","globalRTLTextPlugin","layerIndexes","workerSourceTypes","vector","geojson","workerSources","demWorkerSources","registerWorkerSource","WorkerSource","registerRTLTextPlugin","rtlTextPlugin","mapId","getLayerIndex","update","removedIds","getWorkerSource","loadTile","getDEMWorkerSource","reloadTile","abortTile","removeTile","worker","removeSource","importScripts","callbacks","callbackID","addEventListener","receive","targetMapId","postMessage","sourceMapId","removeEventListener","Function","getOwnPropertyDescriptors","descriptors","getOwnPropertyDescriptor","formatRegExp","format","isString","objects","arguments","isNull","isObject","deprecate","msg","process","noDeprecation","warned","throwDeprecation","traceDeprecation","trace","debugEnviron","debugs","opts","seen","stylize","stylizeNoColor","depth","colors","isBoolean","showHidden","_extend","isUndefined","customInspect","stylizeWithColor","formatValue","styleType","styles","recurseTimes","ret","primitive","simple","isNumber","formatPrimitive","visibleKeys","hash","arrayToHash","getOwnPropertyNames","formatError","braces","toUTCString","formatProperty","formatArray","reduce","cur","numLinesEst","reduceToSingleString","desc","ar","re","objectToString","pad","debuglog","env","NODE_DEBUG","pid","isNullOrUndefined","isSymbol","months","timestamp","time","getHours","getMinutes","getSeconds","getDate","getMonth","origin","kCustomPromisifiedSymbol","callbackifyOnRejected","reason","cb","newReason","promisify","original","writable","configurable","promiseResolve","promiseReject","promise","Promise","resolve","reject","setPrototypeOf","defineProperties","custom","callbackify","callbackified","maybeCb","then","nextTick","rej","cachedSetTimeout","cachedClearTimeout","defaultSetTimout","defaultClearTimeout","runTimeout","fun","setTimeout","clearTimeout","currentQueue","draining","queueIndex","cleanUpNextTick","drainQueue","timeout","run","marker","runClearTimeout","Item","noop","title","browser","argv","versions","on","addListener","off","removeListener","removeAllListeners","emit","prependListener","prependOnceListener","listeners","binding","cwd","chdir","dir","umask","copy","fill","readUInt8","ctor","superCtor","super_","TempCtor","inputType","cases","otherwise","labelContext","MAX_SAFE_INTEGER","branches","isComparableType","makeComparison","lhs","Comparison","interpolateNumber","deg2rad","rad2deg","xyz2lab","lab2xyz","xyz2rgb","rgb2xyz","rgbToLab","rgbColor","labToRgb","labColor","interpolateHue","lab","hcl","hclColor","featureFilter","groupByLayout","layerConfigs","_layerConfigs","_layers","layerConfig","familiesBySource","sourceId","sourceGroup","sourceLayerId","sourceLayerFamilies","emitter","validateConstants","latestStyleSpec","validateGlyphsURL","validateStyleMin","$root","sortErrors","wrapCleanErrors","inner","validateString","CircleStyleLayer","circleBucket","translatedPolygon","stroke","HeatmapBucket","HeatmapStyleLayer","_updateColorRamp","colorRampData","pxColor","colorRamp","colorRampTexture","heatmapFbo","HillshadeStyleLayer","FillBucket","FillStyleLayer","indexArray2","segments2","indexBuffer2","triangleSegment","triangleIndex","flattened","lineSegment","lineIndex","indices","swap","tmp","defaultCompare","partialSort","left","right","sd","newLeft","newRight","FillExtrusionBucket","FillExtrusionStyleLayer","viewportFrame","FACTOR","vertexArray","nx","ny","nz","isEntirelyOutside","edgeDistance","isBoundaryEdge","bottomRight","every","LineBucket","lineFloorwidthProperty","LineStyleLayer","lineBucket","getLineWidth","halfWidth","newRings","zero","newRing","aToB","bToC","cosHalfAngle","offsetLine","lineWidth","lineGapWidth","COS_HALF_SHARP_CORNER","MAX_LINE_DISTANCE","LINE_DISTANCE_BUFFER_BITS","addLineVertex","up","linesofar","cap","miterLimit","roundLimit","addLine","first","sharpCornerOffset","firstVertex","distance","currentVertex","offsetA","offsetB","beginCap","endCap","startOfLine","prevVertex","nextVertex","prevNormal","nextNormal","e1","e2","e3","joinNormal","miterLength","isSharpCorner","prevSegmentLength","newPrevVertex","addCurrentVertex","middleVertex","currentJoin","direction","bevelLength","lineTurnsLeft","approxFractionalJoinNormal","addPieSliceVertex","nextSegmentLength","newCurrentVertex","normal","endLeft","endRight","readTile","floorZ","lastZoom","lastFloorZoom","resolveTokens","SymbolStyleLayer","unevaluated","symbolAttributes","placementOpacityAttributes","placement","lineVertex","transform","toLocaleUpperCase","toLocaleLowerCase","leftIndex","rightIndex","mergedFeatures","mergedIndex","mergeFromRight","leftKey","rightKey","mergeFromLeft","shift","getKey","onRight","tileZoom","layoutSize","levels","zoomRange","propertyValue","sizeRange","evaluateSizeForFeature","sizeData","partiallyEvaluatedSize","lowerSize","upperSize","uSizeT","uSize","evaluateSizeForZoom","toFixed","formatNumber","BackgroundStyleLayer","RasterStyleLayer","refProperties","groups","group","isLE","mLen","nBytes","eLen","eMax","eBias","nBits","NaN","rt","FeatureIndex","performSymbolLayout","makeImageAtlas","makeGlyphAtlas","tileID","tileSize","sourceLayerCoder","bucketLayerIDs","glyphMap","imageMap","buckets","layerFamilies","encode","family","recalculateLayers","createBucket","populate","maybePrepare","glyphAtlas","imageAtlas","positions","isEmpty","glyphAtlasImage","iconAtlasImage","recalculate","GeoJSONFeature","featureIndexArray","bucketIndex","styleLayers","vtLayers","additionalRadius","matching","topDownFeatureComparator","filterMatching","matchingSymbols","collisionIndex","queryRenderedSymbols","sourceID","bucketInstanceIds","filterLayerIDs","previousIndex","layerIDs","sourceLayerName","decode","layerID","styleLayer","queryIntersectsFeature","geojsonFeature","layerResult","Feature","vectorTileFeature","_vectorTileFeature","_z","_x","_y","json","getMercCoords","resolution","getURL","baseUrl","service","srs","getAnchors","OpacityState","shapeText","shapeIcon","WritingMode","getGlyphQuads","getIconQuads","CollisionFeature","findPoleOfInaccessibility","shapedTextOrientations","shapedIcon","glyphPositionMap","sizes","layoutTextSize","layoutIconSize","textMaxSize","textOffset","iconOffset","fontScale","textBoxScale","tilePixelRatio","textMaxBoxScale","iconBoxScale","symbolMinDistance","textPadding","iconPadding","textMaxAngle","iconAlongLine","textRepeatDistance","addSymbolAtAnchor","lineArray","addToLineVertexArray","numIconVertices","numGlyphVertices","numVerticalGlyphVertices","horizontal","addTextVertices","vertical","horizontalOnly","iconQuads","compositeIconSizes","addSymbols","textOpacityState","iconOpacityState","isDuplicate","crossTileID","addSymbol","shapedText","anchorIsTooClose","poi","glyphQuads","compositeTextSizes","repeatDistance","compareText","otherAnchors","glyphPositions","imagePositions","createArrays","iconsNeedLinear","lineHeight","keepUpright","fontstack","spacing","spacingIfAllowed","textAnchor","textJustify","maxWidth","sdfIcons","sdf","generateCollisionDebugBuffers","checkMaxAngle","maxAngle","glyphSize","boxScale","tileExtent","angleWindowSize","labelLength","isLineContinued","fixedExtraOffset","resample","placeAtMiddle","halfLabelLength","markedDistance","anchors","segmentDist","windowSize","anchorDistance","recentCorners","recentAngleDelta","current","angleDelta","clippedLines","clippedLine","p0","opacity","targetOpacity","verticalHeight","logicalInput","trim","positionedGlyphs","shaping","top","bottom","determineLineBreaks","lineBreakPoints","lineBreak","breakLines","shapeLines","iconAnchor","getAnchorAlignment","horizontalAlign","verticalAlign","displaySize","whitespace","breakable","calculateBadness","targetWidth","penalty","isLastBreak","raggedness","calculatePenalty","codePoint","nextCodePoint","evaluateBreak","breakIndex","breakX","potentialBreaks","bestPriorBreak","bestBreakBadness","potentialBreak","breakBadness","badness","priorBreak","potentialLineBreaks","totalWidth","glyph","metrics","advance","determineAverageLineWidth","currentX","leastBadBreaks","lastLineBreak","maxLineLength","justify","justifyLine","lineCount","shiftX","shiftY","lastAdvance","lineIndent","GLYPH_PBF_BORDER","iconWidth","iconHeight","textLeft","textRight","textTop","textBottom","textWidth","textHeight","padT","padR","padB","padL","offsetY","offsetX","matrix","textureRect","border","textRotate","positionedGlyph","rect","rectBuffer","halfAdvance","builtInOffset","center","verticalRotation","xOffsetCorrection","readFontstacks","readFontstack","readGlyph","bitmap","shaped","alignLine","_addLineCollisionCircles","boxSize","step","nBoxes","overscalingPaddingFactor","nPitchPaddingBoxes","firstBoxOffset","labelStartDistance","paddingStartDistance","segmentLength","boxOffset","boxDistanceToAnchor","segmentBoxDistance","paddedAnchorDistance","Queue","compareMax","Cell","minDistSq","pointToPolygonDist","SQRT2","getCentroidCell","polygonRings","precision","debug","outerRing","cellSize","cellQueue","bestCell","numProbes","TinyQueue","_down","_up","peek","halfLen","ShelfPack","imagePosition","images","stackPositions","DEMData","dem","loadFromImage","rawImageData","Level","stride","_idx","level","pixels","borderTile","_xMin","_xMax","_yMin","_yMax","xMin","xMax","yMin","yMax","rewind","GeoJSONWrapper","vtpbf","supercluster","geojsonvt","loadGeoJSONTile","_geoJSONIndexes","geoJSONTile","getTile","geojsonWrapper","byteOffset","loadGeoJSON","cluster","superclusterOptions","load","geojsonVtOptions","geojsonArea","curryOuter","correctRings","outer","wind","cw","gj","correct","wgs84","ringArea","middleIndex","coordsLength","rad","RADIUS","geometries","FLATTENING","POLAR_RADIUS","FeatureWrapper","_feature","fromVectorTileJs","tile","writeLayer","writeTile","keycache","valuecache","writeFeature","writeValue","writeProperties","writeGeometry","keyIndex","valueIndex","command","zigzag","count","fromGeojsonVt","rawGeometry","coord","kdbush","SuperCluster","trees","maxZoom","createCluster","numPoints","parentId","createPointCluster","lngX","latY","getClusterJSON","getClusterProperties","abbrev","cluster_id","point_count","point_count_abbreviated","lng","lat","getX","getY","minZoom","nodeSize","initial","props","timerId","clusters","timeEnd","_cluster","getClusters","tree","_limitZoom","ids","range","getChildren","clusterId","clusterZoom","within","children","getLeaves","limit","leaves","_appendLeaves","z2","_addTileFeatures","getClusterExpansionZoom","skipped","neighborIds","wx","wy","clusterProperties","_accumulate","numPoints2","KDBush","ArrayType","defaultGetX","defaultGetY","swapItem","sortKD","select","inc","nextAxis","sqDist","qy","r2","GeoJSONVT","clip","createTile","tolerance","tiles","tileCoords","indexMaxZoom","indexMaxPoints","total","splitTile","numFeatures","toID","cz","tileTolerance","numSimplified","k3","k4","z0","convertFeature","simplify","tol","convertPoint","convertLine","convertLines","projectX","projectY","getSqSegDist","sqTolerance","maxSqDist","transformPoint","transformed","shiftFeatureCoords","newFeatures","shiftCoords","newPolygon","newPoints","merged","noSimplify","simplified","tileFeature","isOuter"],"mappings":"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","file":"26d5d5bff2f246bb79db.worker.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 88);\n","'use strict';\n\n// compare and isBuffer taken from https://github.com/feross/buffer/blob/680e9e5e488f22aac27599a57dc844a6315928dd/index.js\n// original notice:\n\n/*!\n * The buffer module from node.js, for the browser.\n *\n * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>\n * @license  MIT\n */\nfunction compare(a, b) {\n  if (a === b) {\n    return 0;\n  }\n\n  var x = a.length;\n  var y = b.length;\n\n  for (var i = 0, len = Math.min(x, y); i < len; ++i) {\n    if (a[i] !== b[i]) {\n      x = a[i];\n      y = b[i];\n      break;\n    }\n  }\n\n  if (x < y) {\n    return -1;\n  }\n  if (y < x) {\n    return 1;\n  }\n  return 0;\n}\nfunction isBuffer(b) {\n  if (global.Buffer && typeof global.Buffer.isBuffer === 'function') {\n    return global.Buffer.isBuffer(b);\n  }\n  return !!(b != null && b._isBuffer);\n}\n\n// based on node assert, original notice:\n\n// http://wiki.commonjs.org/wiki/Unit_Testing/1.0\n//\n// THIS IS NOT TESTED NOR LIKELY TO WORK OUTSIDE V8!\n//\n// Originally from narwhal.js (http://narwhaljs.org)\n// Copyright (c) 2009 Thomas Robinson <280north.com>\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the 'Software'), to\n// deal in the Software without restriction, including without limitation the\n// rights to use, copy, modify, merge, publish, distribute, sublicense, and/or\n// sell copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED 'AS IS', WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN\n// ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION\n// WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\n\nvar util = require('util/');\nvar hasOwn = Object.prototype.hasOwnProperty;\nvar pSlice = Array.prototype.slice;\nvar functionsHaveNames = (function () {\n  return function foo() {}.name === 'foo';\n}());\nfunction pToString (obj) {\n  return Object.prototype.toString.call(obj);\n}\nfunction isView(arrbuf) {\n  if (isBuffer(arrbuf)) {\n    return false;\n  }\n  if (typeof global.ArrayBuffer !== 'function') {\n    return false;\n  }\n  if (typeof ArrayBuffer.isView === 'function') {\n    return ArrayBuffer.isView(arrbuf);\n  }\n  if (!arrbuf) {\n    return false;\n  }\n  if (arrbuf instanceof DataView) {\n    return true;\n  }\n  if (arrbuf.buffer && arrbuf.buffer instanceof ArrayBuffer) {\n    return true;\n  }\n  return false;\n}\n// 1. The assert module provides functions that throw\n// AssertionError's when particular conditions are not met. The\n// assert module must conform to the following interface.\n\nvar assert = module.exports = ok;\n\n// 2. The AssertionError is defined in assert.\n// new assert.AssertionError({ message: message,\n//                             actual: actual,\n//                             expected: expected })\n\nvar regex = /\\s*function\\s+([^\\(\\s]*)\\s*/;\n// based on https://github.com/ljharb/function.prototype.name/blob/adeeeec8bfcc6068b187d7d9fb3d5bb1d3a30899/implementation.js\nfunction getName(func) {\n  if (!util.isFunction(func)) {\n    return;\n  }\n  if (functionsHaveNames) {\n    return func.name;\n  }\n  var str = func.toString();\n  var match = str.match(regex);\n  return match && match[1];\n}\nassert.AssertionError = function AssertionError(options) {\n  this.name = 'AssertionError';\n  this.actual = options.actual;\n  this.expected = options.expected;\n  this.operator = options.operator;\n  if (options.message) {\n    this.message = options.message;\n    this.generatedMessage = false;\n  } else {\n    this.message = getMessage(this);\n    this.generatedMessage = true;\n  }\n  var stackStartFunction = options.stackStartFunction || fail;\n  if (Error.captureStackTrace) {\n    Error.captureStackTrace(this, stackStartFunction);\n  } else {\n    // non v8 browsers so we can have a stacktrace\n    var err = new Error();\n    if (err.stack) {\n      var out = err.stack;\n\n      // try to strip useless frames\n      var fn_name = getName(stackStartFunction);\n      var idx = out.indexOf('\\n' + fn_name);\n      if (idx >= 0) {\n        // once we have located the function frame\n        // we need to strip out everything before it (and its line)\n        var next_line = out.indexOf('\\n', idx + 1);\n        out = out.substring(next_line + 1);\n      }\n\n      this.stack = out;\n    }\n  }\n};\n\n// assert.AssertionError instanceof Error\nutil.inherits(assert.AssertionError, Error);\n\nfunction truncate(s, n) {\n  if (typeof s === 'string') {\n    return s.length < n ? s : s.slice(0, n);\n  } else {\n    return s;\n  }\n}\nfunction inspect(something) {\n  if (functionsHaveNames || !util.isFunction(something)) {\n    return util.inspect(something);\n  }\n  var rawname = getName(something);\n  var name = rawname ? ': ' + rawname : '';\n  return '[Function' +  name + ']';\n}\nfunction getMessage(self) {\n  return truncate(inspect(self.actual), 128) + ' ' +\n         self.operator + ' ' +\n         truncate(inspect(self.expected), 128);\n}\n\n// At present only the three keys mentioned above are used and\n// understood by the spec. Implementations or sub modules can pass\n// other keys to the AssertionError's constructor - they will be\n// ignored.\n\n// 3. All of the following functions must throw an AssertionError\n// when a corresponding condition is not met, with a message that\n// may be undefined if not provided.  All assertion methods provide\n// both the actual and expected values to the assertion error for\n// display purposes.\n\nfunction fail(actual, expected, message, operator, stackStartFunction) {\n  throw new assert.AssertionError({\n    message: message,\n    actual: actual,\n    expected: expected,\n    operator: operator,\n    stackStartFunction: stackStartFunction\n  });\n}\n\n// EXTENSION! allows for well behaved errors defined elsewhere.\nassert.fail = fail;\n\n// 4. Pure assertion tests whether a value is truthy, as determined\n// by !!guard.\n// assert.ok(guard, message_opt);\n// This statement is equivalent to assert.equal(true, !!guard,\n// message_opt);. To test strictly for the value true, use\n// assert.strictEqual(true, guard, message_opt);.\n\nfunction ok(value, message) {\n  if (!value) fail(value, true, message, '==', assert.ok);\n}\nassert.ok = ok;\n\n// 5. The equality assertion tests shallow, coercive equality with\n// ==.\n// assert.equal(actual, expected, message_opt);\n\nassert.equal = function equal(actual, expected, message) {\n  if (actual != expected) fail(actual, expected, message, '==', assert.equal);\n};\n\n// 6. The non-equality assertion tests for whether two objects are not equal\n// with != assert.notEqual(actual, expected, message_opt);\n\nassert.notEqual = function notEqual(actual, expected, message) {\n  if (actual == expected) {\n    fail(actual, expected, message, '!=', assert.notEqual);\n  }\n};\n\n// 7. The equivalence assertion tests a deep equality relation.\n// assert.deepEqual(actual, expected, message_opt);\n\nassert.deepEqual = function deepEqual(actual, expected, message) {\n  if (!_deepEqual(actual, expected, false)) {\n    fail(actual, expected, message, 'deepEqual', assert.deepEqual);\n  }\n};\n\nassert.deepStrictEqual = function deepStrictEqual(actual, expected, message) {\n  if (!_deepEqual(actual, expected, true)) {\n    fail(actual, expected, message, 'deepStrictEqual', assert.deepStrictEqual);\n  }\n};\n\nfunction _deepEqual(actual, expected, strict, memos) {\n  // 7.1. All identical values are equivalent, as determined by ===.\n  if (actual === expected) {\n    return true;\n  } else if (isBuffer(actual) && isBuffer(expected)) {\n    return compare(actual, expected) === 0;\n\n  // 7.2. If the expected value is a Date object, the actual value is\n  // equivalent if it is also a Date object that refers to the same time.\n  } else if (util.isDate(actual) && util.isDate(expected)) {\n    return actual.getTime() === expected.getTime();\n\n  // 7.3 If the expected value is a RegExp object, the actual value is\n  // equivalent if it is also a RegExp object with the same source and\n  // properties (`global`, `multiline`, `lastIndex`, `ignoreCase`).\n  } else if (util.isRegExp(actual) && util.isRegExp(expected)) {\n    return actual.source === expected.source &&\n           actual.global === expected.global &&\n           actual.multiline === expected.multiline &&\n           actual.lastIndex === expected.lastIndex &&\n           actual.ignoreCase === expected.ignoreCase;\n\n  // 7.4. Other pairs that do not both pass typeof value == 'object',\n  // equivalence is determined by ==.\n  } else if ((actual === null || typeof actual !== 'object') &&\n             (expected === null || typeof expected !== 'object')) {\n    return strict ? actual === expected : actual == expected;\n\n  // If both values are instances of typed arrays, wrap their underlying\n  // ArrayBuffers in a Buffer each to increase performance\n  // This optimization requires the arrays to have the same type as checked by\n  // Object.prototype.toString (aka pToString). Never perform binary\n  // comparisons for Float*Arrays, though, since e.g. +0 === -0 but their\n  // bit patterns are not identical.\n  } else if (isView(actual) && isView(expected) &&\n             pToString(actual) === pToString(expected) &&\n             !(actual instanceof Float32Array ||\n               actual instanceof Float64Array)) {\n    return compare(new Uint8Array(actual.buffer),\n                   new Uint8Array(expected.buffer)) === 0;\n\n  // 7.5 For all other Object pairs, including Array objects, equivalence is\n  // determined by having the same number of owned properties (as verified\n  // with Object.prototype.hasOwnProperty.call), the same set of keys\n  // (although not necessarily the same order), equivalent values for every\n  // corresponding key, and an identical 'prototype' property. Note: this\n  // accounts for both named and indexed properties on Arrays.\n  } else if (isBuffer(actual) !== isBuffer(expected)) {\n    return false;\n  } else {\n    memos = memos || {actual: [], expected: []};\n\n    var actualIndex = memos.actual.indexOf(actual);\n    if (actualIndex !== -1) {\n      if (actualIndex === memos.expected.indexOf(expected)) {\n        return true;\n      }\n    }\n\n    memos.actual.push(actual);\n    memos.expected.push(expected);\n\n    return objEquiv(actual, expected, strict, memos);\n  }\n}\n\nfunction isArguments(object) {\n  return Object.prototype.toString.call(object) == '[object Arguments]';\n}\n\nfunction objEquiv(a, b, strict, actualVisitedObjects) {\n  if (a === null || a === undefined || b === null || b === undefined)\n    return false;\n  // if one is a primitive, the other must be same\n  if (util.isPrimitive(a) || util.isPrimitive(b))\n    return a === b;\n  if (strict && Object.getPrototypeOf(a) !== Object.getPrototypeOf(b))\n    return false;\n  var aIsArgs = isArguments(a);\n  var bIsArgs = isArguments(b);\n  if ((aIsArgs && !bIsArgs) || (!aIsArgs && bIsArgs))\n    return false;\n  if (aIsArgs) {\n    a = pSlice.call(a);\n    b = pSlice.call(b);\n    return _deepEqual(a, b, strict);\n  }\n  var ka = objectKeys(a);\n  var kb = objectKeys(b);\n  var key, i;\n  // having the same number of owned properties (keys incorporates\n  // hasOwnProperty)\n  if (ka.length !== kb.length)\n    return false;\n  //the same set of keys (although not necessarily the same order),\n  ka.sort();\n  kb.sort();\n  //~~~cheap key test\n  for (i = ka.length - 1; i >= 0; i--) {\n    if (ka[i] !== kb[i])\n      return false;\n  }\n  //equivalent values for every corresponding key, and\n  //~~~possibly expensive deep test\n  for (i = ka.length - 1; i >= 0; i--) {\n    key = ka[i];\n    if (!_deepEqual(a[key], b[key], strict, actualVisitedObjects))\n      return false;\n  }\n  return true;\n}\n\n// 8. The non-equivalence assertion tests for any deep inequality.\n// assert.notDeepEqual(actual, expected, message_opt);\n\nassert.notDeepEqual = function notDeepEqual(actual, expected, message) {\n  if (_deepEqual(actual, expected, false)) {\n    fail(actual, expected, message, 'notDeepEqual', assert.notDeepEqual);\n  }\n};\n\nassert.notDeepStrictEqual = notDeepStrictEqual;\nfunction notDeepStrictEqual(actual, expected, message) {\n  if (_deepEqual(actual, expected, true)) {\n    fail(actual, expected, message, 'notDeepStrictEqual', notDeepStrictEqual);\n  }\n}\n\n\n// 9. The strict equality assertion tests strict equality, as determined by ===.\n// assert.strictEqual(actual, expected, message_opt);\n\nassert.strictEqual = function strictEqual(actual, expected, message) {\n  if (actual !== expected) {\n    fail(actual, expected, message, '===', assert.strictEqual);\n  }\n};\n\n// 10. The strict non-equality assertion tests for strict inequality, as\n// determined by !==.  assert.notStrictEqual(actual, expected, message_opt);\n\nassert.notStrictEqual = function notStrictEqual(actual, expected, message) {\n  if (actual === expected) {\n    fail(actual, expected, message, '!==', assert.notStrictEqual);\n  }\n};\n\nfunction expectedException(actual, expected) {\n  if (!actual || !expected) {\n    return false;\n  }\n\n  if (Object.prototype.toString.call(expected) == '[object RegExp]') {\n    return expected.test(actual);\n  }\n\n  try {\n    if (actual instanceof expected) {\n      return true;\n    }\n  } catch (e) {\n    // Ignore.  The instanceof check doesn't work for arrow functions.\n  }\n\n  if (Error.isPrototypeOf(expected)) {\n    return false;\n  }\n\n  return expected.call({}, actual) === true;\n}\n\nfunction _tryBlock(block) {\n  var error;\n  try {\n    block();\n  } catch (e) {\n    error = e;\n  }\n  return error;\n}\n\nfunction _throws(shouldThrow, block, expected, message) {\n  var actual;\n\n  if (typeof block !== 'function') {\n    throw new TypeError('\"block\" argument must be a function');\n  }\n\n  if (typeof expected === 'string') {\n    message = expected;\n    expected = null;\n  }\n\n  actual = _tryBlock(block);\n\n  message = (expected && expected.name ? ' (' + expected.name + ').' : '.') +\n            (message ? ' ' + message : '.');\n\n  if (shouldThrow && !actual) {\n    fail(actual, expected, 'Missing expected exception' + message);\n  }\n\n  var userProvidedMessage = typeof message === 'string';\n  var isUnwantedException = !shouldThrow && util.isError(actual);\n  var isUnexpectedException = !shouldThrow && actual && !expected;\n\n  if ((isUnwantedException &&\n      userProvidedMessage &&\n      expectedException(actual, expected)) ||\n      isUnexpectedException) {\n    fail(actual, expected, 'Got unwanted exception' + message);\n  }\n\n  if ((shouldThrow && actual && expected &&\n      !expectedException(actual, expected)) || (!shouldThrow && actual)) {\n    throw actual;\n  }\n}\n\n// 11. Expected to throw an error:\n// assert.throws(block, Error_opt, message_opt);\n\nassert.throws = function(block, /*optional*/error, /*optional*/message) {\n  _throws(true, block, error, message);\n};\n\n// EXTENSION! This is annoying to write outside this module.\nassert.doesNotThrow = function(block, /*optional*/error, /*optional*/message) {\n  _throws(false, block, error, message);\n};\n\nassert.ifError = function(err) { if (err) throw err; };\n\nvar objectKeys = Object.keys || function (obj) {\n  var keys = [];\n  for (var key in obj) {\n    if (hasOwn.call(obj, key)) keys.push(key);\n  }\n  return keys;\n};\n","// @flow\r\n\r\nconst assert = require('assert');\r\nconst {clone, extend, easeCubicInOut} = require('../util/util');\r\nconst interpolate = require('../style-spec/util/interpolate');\r\nconst {normalizePropertyExpression} = require('../style-spec/expression');\r\nconst Color = require('../style-spec/util/color');\r\nconst {register} = require('../util/web_worker_transfer');\r\n\r\nimport type {StylePropertySpecification} from '../style-spec/style-spec';\r\nimport type {CrossFaded} from './cross_faded';\r\nimport type EvaluationParameters from './evaluation_parameters';\r\n\r\nimport type {\r\n    Feature,\r\n    GlobalProperties,\r\n    StylePropertyExpression,\r\n    SourceExpression,\r\n    CompositeExpression\r\n} from '../style-spec/expression';\r\n\r\ntype TimePoint = number;\r\n\r\n/**\r\n * Implements a number of classes that define state and behavior for paint and layout properties, most\r\n * importantly their respective evaluation chains:\r\n *\r\n *       Transitionable paint property value\r\n *     → Transitioning paint property value\r\n *     → Possibly evaluated paint property value\r\n *     → Fully evaluated paint property value\r\n *\r\n *       Layout property value\r\n *     → Possibly evaluated layout property value\r\n *     → Fully evaluated layout property value\r\n *\r\n * @module\r\n * @private\r\n */\r\n\r\n/**\r\n *  Implementations of the `Property` interface:\r\n *\r\n *  * Hold metadata about a property that's independent of any specific value: stuff like the type of the value,\r\n *    the default value, etc. This comes from the style specification JSON.\r\n *  * Define behavior that needs to be polymorphic across different properties: \"possibly evaluating\"\r\n *    an input value (see below), and interpolating between two possibly-evaluted values.\r\n *\r\n *  The type `T` is the fully-evaluated value type (e.g. `number`, `string`, `Color`).\r\n *  The type `R` is the intermediate \"possibly evaluated\" value type. See below.\r\n *\r\n *  There are two main implementations of the interface -- one for properties that allow data-driven values,\r\n *  and one for properties that don't. There are a few \"special case\" implementations as well: one for properties\r\n *  which cross-fade between two values rather than interpolating, one for `heatmap-color`, and one for\r\n *  `light-position`.\r\n *\r\n * @private\r\n */\r\nexport interface Property<T, R> {\r\n    specification: StylePropertySpecification;\r\n    possiblyEvaluate(value: PropertyValue<T, R>, parameters: EvaluationParameters): R;\r\n    interpolate(a: R, b: R, t: number): R;\r\n}\r\n\r\n/**\r\n *  `PropertyValue` represents the value part of a property key-value unit. It's used to represent both\r\n *  paint and layout property values, and regardless of whether or not their property supports data-driven\r\n *  expressions.\r\n *\r\n *  `PropertyValue` stores the raw input value as seen in a style or a runtime styling API call, i.e. one of the\r\n *  following:\r\n *\r\n *    * A constant value of the type appropriate for the property\r\n *    * A function which produces a value of that type (but functions are quasi-deprecated in favor of expressions)\r\n *    * An expression which produces a value of that type\r\n *    * \"undefined\"/\"not present\", in which case the property is assumed to take on its default value.\r\n *\r\n *  In addition to storing the original input value, `PropertyValue` also stores a normalized representation,\r\n *  effectively treating functions as if they are expressions, and constant or default values as if they are\r\n *  (constant) expressions.\r\n *\r\n *  @private\r\n */\r\nclass PropertyValue<T, R> {\r\n    property: Property<T, R>;\r\n    value: PropertyValueSpecification<T> | void;\r\n    expression: StylePropertyExpression;\r\n\r\n    constructor(property: Property<T, R>, value: PropertyValueSpecification<T> | void) {\r\n        this.property = property;\r\n        this.value = value;\r\n        this.expression = normalizePropertyExpression(value === undefined ? property.specification.default : value, property.specification);\r\n    }\r\n\r\n    isDataDriven(): boolean {\r\n        return this.expression.kind === 'source' || this.expression.kind === 'composite';\r\n    }\r\n\r\n    possiblyEvaluate(parameters: EvaluationParameters): R {\r\n        return this.property.possiblyEvaluate(this, parameters);\r\n    }\r\n}\r\n\r\n// ------- Transitionable -------\r\n\r\nexport type TransitionParameters = {\r\n    now: TimePoint,\r\n    transition: TransitionSpecification\r\n};\r\n\r\n/**\r\n * Paint properties are _transitionable_: they can change in a fluid manner, interpolating or cross-fading between\r\n * old and new value. The duration of the transition, and the delay before it begins, is configurable.\r\n *\r\n * `TransitionablePropertyValue` is a compositional class that stores both the property value and that transition\r\n * configuration.\r\n *\r\n * A `TransitionablePropertyValue` can calculate the next step in the evaluation chain for paint property values:\r\n * `TransitioningPropertyValue`.\r\n *\r\n * @private\r\n */\r\nclass TransitionablePropertyValue<T, R> {\r\n    property: Property<T, R>;\r\n    value: PropertyValue<T, R>;\r\n    transition: TransitionSpecification | void;\r\n\r\n    constructor(property: Property<T, R>) {\r\n        this.property = property;\r\n        this.value = new PropertyValue(property, undefined);\r\n    }\r\n\r\n    transitioned(parameters: TransitionParameters,\r\n                 prior: TransitioningPropertyValue<T, R>): TransitioningPropertyValue<T, R> {\r\n        return new TransitioningPropertyValue(this.property, this.value, prior, // eslint-disable-line no-use-before-define\r\n            extend({}, parameters.transition, this.transition), parameters.now);\r\n    }\r\n\r\n    untransitioned(): TransitioningPropertyValue<T, R> {\r\n        return new TransitioningPropertyValue(this.property, this.value, null, {}, 0); // eslint-disable-line no-use-before-define\r\n    }\r\n}\r\n\r\n/**\r\n * A helper type: given an object type `Properties` whose values are each of type `Property<T, R>`, it calculates\r\n * an object type with the same keys and values of type `TransitionablePropertyValue<T, R>`.\r\n *\r\n * @private\r\n */\r\ntype TransitionablePropertyValues<Props: Object>\r\n    = $Exact<$ObjMap<Props, <T, R>(p: Property<T, R>) => TransitionablePropertyValue<T, R>>>\r\n\r\n/**\r\n * `Transitionable` stores a map of all (property name, `TransitionablePropertyValue`) pairs for paint properties of a\r\n * given layer type. It can calculate the `TransitioningPropertyValue`s for all of them at once, producing a\r\n * `Transitioning` instance for the same set of properties.\r\n *\r\n * @private\r\n */\r\nclass Transitionable<Props: Object> {\r\n    _properties: Properties<Props>;\r\n    _values: TransitionablePropertyValues<Props>;\r\n\r\n    constructor(properties: Properties<Props>) {\r\n        this._properties = properties;\r\n        this._values = (Object.create(properties.defaultTransitionablePropertyValues): any);\r\n    }\r\n\r\n    getValue<S: string, T>(name: S): PropertyValueSpecification<T> | void {\r\n        return clone(this._values[name].value.value);\r\n    }\r\n\r\n    setValue<S: string, T>(name: S, value: PropertyValueSpecification<T> | void) {\r\n        if (!this._values.hasOwnProperty(name)) {\r\n            this._values[name] = new TransitionablePropertyValue(this._values[name].property);\r\n        }\r\n        // Note that we do not _remove_ an own property in the case where a value is being reset\r\n        // to the default: the transition might still be non-default.\r\n        this._values[name].value = new PropertyValue(this._values[name].property, value === null ? undefined : clone(value));\r\n    }\r\n\r\n    getTransition<S: string>(name: S): TransitionSpecification | void {\r\n        return clone(this._values[name].transition);\r\n    }\r\n\r\n    setTransition<S: string>(name: S, value: TransitionSpecification | void) {\r\n        if (!this._values.hasOwnProperty(name)) {\r\n            this._values[name] = new TransitionablePropertyValue(this._values[name].property);\r\n        }\r\n        this._values[name].transition = clone(value) || undefined;\r\n    }\r\n\r\n    serialize() {\r\n        const result: any = {};\r\n        for (const property of Object.keys(this._values)) {\r\n            const value = this.getValue(property);\r\n            if (value !== undefined) {\r\n                result[property] = value;\r\n            }\r\n\r\n            const transition = this.getTransition(property);\r\n            if (transition !== undefined) {\r\n                result[`${property}-transition`] = transition;\r\n            }\r\n        }\r\n        return result;\r\n    }\r\n\r\n    transitioned(parameters: TransitionParameters, prior: Transitioning<Props>): Transitioning<Props> {\r\n        const result = new Transitioning(this._properties); // eslint-disable-line no-use-before-define\r\n        for (const property of Object.keys(this._values)) {\r\n            result._values[property] = this._values[property].transitioned(parameters, prior._values[property]);\r\n        }\r\n        return result;\r\n    }\r\n\r\n    untransitioned(): Transitioning<Props> {\r\n        const result = new Transitioning(this._properties); // eslint-disable-line no-use-before-define\r\n        for (const property of Object.keys(this._values)) {\r\n            result._values[property] = this._values[property].untransitioned();\r\n        }\r\n        return result;\r\n    }\r\n}\r\n\r\n// ------- Transitioning -------\r\n\r\n/**\r\n * `TransitioningPropertyValue` implements the first of two intermediate steps in the evaluation chain of a paint\r\n * property value. In this step, transitions between old and new values are handled: as long as the transition is in\r\n * progress, `TransitioningPropertyValue` maintains a reference to the prior value, and interpolates between it and\r\n * the new value based on the current time and the configured transition duration and delay. The product is the next\r\n * step in the evaluation chain: the \"possibly evaluated\" result type `R`. See below for more on this concept.\r\n *\r\n * @private\r\n */\r\nclass TransitioningPropertyValue<T, R> {\r\n    property: Property<T, R>;\r\n    value: PropertyValue<T, R>;\r\n    prior: ?TransitioningPropertyValue<T, R>;\r\n    begin: TimePoint;\r\n    end: TimePoint;\r\n\r\n    constructor(property: Property<T, R>,\r\n                value: PropertyValue<T, R>,\r\n                prior: ?TransitioningPropertyValue<T, R>,\r\n                transition: TransitionSpecification,\r\n                now: TimePoint) {\r\n        this.property = property;\r\n        this.value = value;\r\n        this.begin = now + transition.delay || 0;\r\n        this.end = this.begin + transition.duration || 0;\r\n        if (property.specification.transition && (transition.delay || transition.duration)) {\r\n            this.prior = prior;\r\n        }\r\n    }\r\n\r\n    possiblyEvaluate(parameters: EvaluationParameters): R {\r\n        const now = parameters.now || 0;\r\n        const finalValue = this.value.possiblyEvaluate(parameters);\r\n        const prior = this.prior;\r\n        if (!prior) {\r\n            // No prior value.\r\n            return finalValue;\r\n        } else if (now > this.end) {\r\n            // Transition from prior value is now complete.\r\n            this.prior = null;\r\n            return finalValue;\r\n        } else if (this.value.isDataDriven()) {\r\n            // Transitions to data-driven properties are not supported.\r\n            // We snap immediately to the data-driven value so that, when we perform layout,\r\n            // we see the data-driven function and can use it to populate vertex buffers.\r\n            this.prior = null;\r\n            return finalValue;\r\n        } else if (now < this.begin) {\r\n            // Transition hasn't started yet.\r\n            return prior.possiblyEvaluate(parameters);\r\n        } else {\r\n            // Interpolate between recursively-calculated prior value and final.\r\n            const t = (now - this.begin) / (this.end - this.begin);\r\n            return this.property.interpolate(prior.possiblyEvaluate(parameters), finalValue, easeCubicInOut(t));\r\n        }\r\n    }\r\n}\r\n\r\n/**\r\n * A helper type: given an object type `Properties` whose values are each of type `Property<T, R>`, it calculates\r\n * an object type with the same keys and values of type `TransitioningPropertyValue<T, R>`.\r\n *\r\n * @private\r\n */\r\ntype TransitioningPropertyValues<Props: Object>\r\n    = $Exact<$ObjMap<Props, <T, R>(p: Property<T, R>) => TransitioningPropertyValue<T, R>>>\r\n\r\n/**\r\n * `Transitioning` stores a map of all (property name, `TransitioningPropertyValue`) pairs for paint properties of a\r\n * given layer type. It can calculate the possibly-evaluated values for all of them at once, producing a\r\n * `PossiblyEvaluated` instance for the same set of properties.\r\n *\r\n * @private\r\n */\r\nclass Transitioning<Props: Object> {\r\n    _properties: Properties<Props>;\r\n    _values: TransitioningPropertyValues<Props>;\r\n\r\n    constructor(properties: Properties<Props>) {\r\n        this._properties = properties;\r\n        this._values = (Object.create(properties.defaultTransitioningPropertyValues): any);\r\n    }\r\n\r\n    possiblyEvaluate(parameters: EvaluationParameters): PossiblyEvaluated<Props> {\r\n        const result = new PossiblyEvaluated(this._properties); // eslint-disable-line no-use-before-define\r\n        for (const property of Object.keys(this._values)) {\r\n            result._values[property] = this._values[property].possiblyEvaluate(parameters);\r\n        }\r\n        return result;\r\n    }\r\n\r\n    hasTransition() {\r\n        for (const property of Object.keys(this._values)) {\r\n            if (this._values[property].prior) {\r\n                return true;\r\n            }\r\n        }\r\n        return false;\r\n    }\r\n}\r\n\r\n// ------- Layout -------\r\n\r\n/**\r\n * A helper type: given an object type `Properties` whose values are each of type `Property<T, R>`, it calculates\r\n * an object type with the same keys and values of type `PropertyValue<T, R>`.\r\n *\r\n * @private\r\n */\r\ntype PropertyValues<Props: Object>\r\n    = $Exact<$ObjMap<Props, <T, R>(p: Property<T, R>) => PropertyValue<T, R>>>\r\n\r\n/**\r\n * Because layout properties are not transitionable, they have a simpler representation and evaluation chain than\r\n * paint properties: `PropertyValue`s are possibly evaluated, producing possibly evaluated values, which are then\r\n * fully evaluated.\r\n *\r\n * `Layout` stores a map of all (property name, `PropertyValue`) pairs for layout properties of a\r\n * given layer type. It can calculate the possibly-evaluated values for all of them at once, producing a\r\n * `PossiblyEvaluated` instance for the same set of properties.\r\n *\r\n * @private\r\n */\r\nclass Layout<Props: Object> {\r\n    _properties: Properties<Props>;\r\n    _values: PropertyValues<Props>;\r\n\r\n    constructor(properties: Properties<Props>) {\r\n        this._properties = properties;\r\n        this._values = (Object.create(properties.defaultPropertyValues): any);\r\n    }\r\n\r\n    getValue<S: string>(name: S) {\r\n        return clone(this._values[name].value);\r\n    }\r\n\r\n    setValue<S: string>(name: S, value: *) {\r\n        this._values[name] = new PropertyValue(this._values[name].property, value === null ? undefined : clone(value));\r\n    }\r\n\r\n    serialize() {\r\n        const result: any = {};\r\n        for (const property of Object.keys(this._values)) {\r\n            const value = this.getValue(property);\r\n            if (value !== undefined) {\r\n                result[property] = value;\r\n            }\r\n        }\r\n        return result;\r\n    }\r\n\r\n    possiblyEvaluate(parameters: EvaluationParameters): PossiblyEvaluated<Props> {\r\n        const result = new PossiblyEvaluated(this._properties); // eslint-disable-line no-use-before-define\r\n        for (const property of Object.keys(this._values)) {\r\n            result._values[property] = this._values[property].possiblyEvaluate(parameters);\r\n        }\r\n        return result;\r\n    }\r\n}\r\n\r\n// ------- PossiblyEvaluated -------\r\n\r\n/**\r\n * \"Possibly evaluated value\" is an intermediate stage in the evaluation chain for both paint and layout property\r\n * values. The purpose of this stage is to optimize away unnecessary recalculations for data-driven properties. Code\r\n * which uses data-driven property values must assume that the value is dependent on feature data, and request that it\r\n * be evaluated for each feature. But when that property value is in fact a constant or camera function, the calculation\r\n * will not actually depend on the feature, and we can benefit from returning the prior result of having done the\r\n * evaluation once, ahead of time, in an intermediate step whose inputs are just the value and \"global\" parameters\r\n * such as current zoom level.\r\n *\r\n * `PossiblyEvaluatedValue` represents the three possible outcomes of this step: if the input value was a constant or\r\n * camera expression, then the \"possibly evaluated\" result is a constant value. Otherwise, the input value was either\r\n * a source or composite expression, and we must defer final evaluation until supplied a feature. We separate\r\n * the source and composite cases because they are handled differently when generating GL attributes, buffers, and\r\n * uniforms.\r\n *\r\n * Note that `PossiblyEvaluatedValue` (and `PossiblyEvaluatedPropertyValue`, below) are _not_ used for properties that\r\n * do not allow data-driven values. For such properties, we know that the \"possibly evaluated\" result is always a constant\r\n * scalar value. See below.\r\n *\r\n * @private\r\n */\r\ntype PossiblyEvaluatedValue<T> =\r\n    | {kind: 'constant', value: T}\r\n    | SourceExpression\r\n    | CompositeExpression;\r\n\r\n/**\r\n * `PossiblyEvaluatedPropertyValue` is used for data-driven paint and layout property values. It holds a\r\n * `PossiblyEvaluatedValue` and the `GlobalProperties` that were used to generate it. You're not allowed to supply\r\n * a different set of `GlobalProperties` when performing the final evaluation because they would be ignored in the\r\n * case where the input value was a constant or camera function.\r\n *\r\n * @private\r\n */\r\nclass PossiblyEvaluatedPropertyValue<T> {\r\n    property: DataDrivenProperty<T>;\r\n    value: PossiblyEvaluatedValue<T>;\r\n    globals: GlobalProperties;\r\n\r\n    constructor(property: DataDrivenProperty<T>, value: PossiblyEvaluatedValue<T>, globals: GlobalProperties) {\r\n        this.property = property;\r\n        this.value = value;\r\n        this.globals = globals;\r\n    }\r\n\r\n    isConstant(): boolean {\r\n        return this.value.kind === 'constant';\r\n    }\r\n\r\n    constantOr(value: T): T {\r\n        if (this.value.kind === 'constant') {\r\n            return this.value.value;\r\n        } else {\r\n            return value;\r\n        }\r\n    }\r\n\r\n    evaluate(feature: Feature): T {\r\n        return this.property.evaluate(this.value, this.globals, feature);\r\n    }\r\n}\r\n\r\n/**\r\n * A helper type: given an object type `Properties` whose values are each of type `Property<T, R>`, it calculates\r\n * an object type with the same keys, and values of type `R`.\r\n *\r\n * For properties that don't allow data-driven values, `R` is a scalar type such as `number`, `string`, or `Color`.\r\n * For data-driven properties, it is `PossiblyEvaluatedPropertyValue`. Critically, the type definitions are set up\r\n * in a way that allows flow to know which of these two cases applies for any given property name, and if you attempt\r\n * to use a `PossiblyEvaluatedPropertyValue` as if it was a scalar, or vice versa, you will get a type error. (However,\r\n * there's at least one case in which flow fails to produce a type error that you should be aware of: in a context such\r\n * as `layer.paint.get('foo-opacity') === 0`, if `foo-opacity` is data-driven, than the left-hand side is of type\r\n * `PossiblyEvaluatedPropertyValue<number>`, but flow will not complain about comparing this to a number using `===`.\r\n * See https://github.com/facebook/flow/issues/2359.)\r\n *\r\n * There's also a third, special case possiblity for `R`: for cross-faded properties, it's `?CrossFaded<T>`.\r\n *\r\n * @private\r\n */\r\ntype PossiblyEvaluatedPropertyValues<Props: Object>\r\n    = $Exact<$ObjMap<Props, <T, R>(p: Property<T, R>) => R>>\r\n\r\n/**\r\n * `PossiblyEvaluated` stores a map of all (property name, `R`) pairs for paint or layout properties of a\r\n * given layer type.\r\n */\r\nclass PossiblyEvaluated<Props: Object> {\r\n    _properties: Properties<Props>;\r\n    _values: PossiblyEvaluatedPropertyValues<Props>;\r\n\r\n    constructor(properties: Properties<Props>) {\r\n        this._properties = properties;\r\n        this._values = (Object.create(properties.defaultPossiblyEvaluatedValues): any);\r\n    }\r\n\r\n    get<S: string>(name: S): $ElementType<PossiblyEvaluatedPropertyValues<Props>, S> {\r\n        return this._values[name];\r\n    }\r\n}\r\n\r\n/**\r\n * An implementation of `Property` for properties that do not permit data-driven (source or composite) expressions.\r\n * This restriction allows us to declare statically that the result of possibly evaluating this kind of property\r\n * is in fact always the scalar type `T`, and can be used without further evaluating the value on a per-feature basis.\r\n *\r\n * @private\r\n */\r\nclass DataConstantProperty<T> implements Property<T, T> {\r\n    specification: StylePropertySpecification;\r\n\r\n    constructor(specification: StylePropertySpecification) {\r\n        this.specification = specification;\r\n    }\r\n\r\n    possiblyEvaluate(value: PropertyValue<T, T>, parameters: EvaluationParameters): T {\r\n        assert(!value.isDataDriven());\r\n        return value.expression.evaluate(parameters);\r\n    }\r\n\r\n    interpolate(a: T, b: T, t: number): T {\r\n        const interp: ?(a: T, b: T, t: number) => T = (interpolate: any)[this.specification.type];\r\n        if (interp) {\r\n            return interp(a, b, t);\r\n        } else {\r\n            return a;\r\n        }\r\n    }\r\n}\r\n\r\n/**\r\n * An implementation of `Property` for properties that permit data-driven (source or composite) expressions.\r\n * The result of possibly evaluating this kind of property is `PossiblyEvaluatedPropertyValue<T>`; obtaining\r\n * a scalar value `T` requires further evaluation on a per-feature basis.\r\n *\r\n * @private\r\n */\r\nclass DataDrivenProperty<T> implements Property<T, PossiblyEvaluatedPropertyValue<T>> {\r\n    specification: StylePropertySpecification;\r\n\r\n    constructor(specification: StylePropertySpecification) {\r\n        this.specification = specification;\r\n    }\r\n\r\n    possiblyEvaluate(value: PropertyValue<T, PossiblyEvaluatedPropertyValue<T>>, parameters: EvaluationParameters): PossiblyEvaluatedPropertyValue<T> {\r\n        if (value.expression.kind === 'constant' || value.expression.kind === 'camera') {\r\n            return new PossiblyEvaluatedPropertyValue(this, {kind: 'constant', value: value.expression.evaluate(parameters)}, parameters);\r\n        } else {\r\n            return new PossiblyEvaluatedPropertyValue(this, value.expression, parameters);\r\n        }\r\n    }\r\n\r\n    interpolate(a: PossiblyEvaluatedPropertyValue<T>,\r\n                b: PossiblyEvaluatedPropertyValue<T>,\r\n                t: number): PossiblyEvaluatedPropertyValue<T> {\r\n        // If either possibly-evaluated value is non-constant, give up: we aren't able to interpolate data-driven values.\r\n        if (a.value.kind !== 'constant' || b.value.kind !== 'constant') {\r\n            return a;\r\n        }\r\n\r\n        // Special case hack solely for fill-outline-color.\r\n        if (a.value.value === undefined || b.value.value === undefined)\r\n            return (undefined: any);\r\n\r\n        const interp: ?(a: T, b: T, t: number) => T = (interpolate: any)[this.specification.type];\r\n        if (interp) {\r\n            return new PossiblyEvaluatedPropertyValue(this, {kind: 'constant', value: interp(a.value.value, b.value.value, t)}, a.globals);\r\n        } else {\r\n            return a;\r\n        }\r\n    }\r\n\r\n    evaluate(value: PossiblyEvaluatedValue<T>, globals: GlobalProperties, feature: Feature): T {\r\n        if (value.kind === 'constant') {\r\n            return value.value;\r\n        } else {\r\n            return value.evaluate(globals, feature);\r\n        }\r\n    }\r\n}\r\n\r\n/**\r\n * An implementation of `Property` for `*-pattern` and `line-dasharray`, which are transitioned by cross-fading\r\n * rather than interpolation.\r\n *\r\n * @private\r\n */\r\nclass CrossFadedProperty<T> implements Property<T, ?CrossFaded<T>> {\r\n    specification: StylePropertySpecification;\r\n\r\n    constructor(specification: StylePropertySpecification) {\r\n        this.specification = specification;\r\n    }\r\n\r\n    possiblyEvaluate(value: PropertyValue<T, ?CrossFaded<T>>, parameters: EvaluationParameters): ?CrossFaded<T> {\r\n        if (value.value === undefined) {\r\n            return undefined;\r\n        } else if (value.expression.kind === 'constant') {\r\n            const constant = value.expression.evaluate(parameters);\r\n            return this._calculate(constant, constant, constant, parameters);\r\n        } else {\r\n            assert(!value.isDataDriven());\r\n            return this._calculate(\r\n                value.expression.evaluate({zoom: parameters.zoom - 1.0}),\r\n                value.expression.evaluate({zoom: parameters.zoom}),\r\n                value.expression.evaluate({zoom: parameters.zoom + 1.0}),\r\n                parameters);\r\n        }\r\n    }\r\n\r\n    _calculate(min: T, mid: T, max: T, parameters: EvaluationParameters): ?CrossFaded<T> {\r\n        const z = parameters.zoom;\r\n        const fraction = z - Math.floor(z);\r\n        const t = parameters.crossFadingFactor();\r\n        return z > parameters.zoomHistory.lastIntegerZoom ?\r\n            { from: min, to: mid, fromScale: 2, toScale: 1, t: fraction + (1 - fraction) * t } :\r\n            { from: max, to: mid, fromScale: 0.5, toScale: 1, t: 1 - (1 - t) * fraction };\r\n    }\r\n\r\n    interpolate(a: ?CrossFaded<T>): ?CrossFaded<T> {\r\n        return a;\r\n    }\r\n}\r\n\r\n/**\r\n * An implementation of `Property` for `heatmap-color`. Evaluation and interpolation are no-ops: the real\r\n * evaluation happens in HeatmapStyleLayer.\r\n *\r\n * @private\r\n */\r\nclass HeatmapColorProperty implements Property<Color, void> {\r\n    specification: StylePropertySpecification;\r\n\r\n    constructor(specification: StylePropertySpecification) {\r\n        this.specification = specification;\r\n    }\r\n\r\n    possiblyEvaluate() {}\r\n    interpolate() {}\r\n}\r\n\r\n/**\r\n * `Properties` holds objects containing default values for the layout or paint property set of a given\r\n * layer type. These objects are immutable, and they are used as the prototypes for the `_values` members of\r\n * `Transitionable`, `Transitioning`, `Layout`, and `PossiblyEvaluated`. This allows these classes to avoid\r\n * doing work in the common case where a property has no explicit value set and should be considered to take\r\n * on the default value: using `for (const property of Object.keys(this._values))`, they can iterate over\r\n * only the _own_ properties of `_values`, skipping repeated calculation of transitions and possible/final\r\n * evaluations for defaults, the result of which will always be the same.\r\n *\r\n * @private\r\n */\r\nclass Properties<Props: Object> {\r\n    properties: Props;\r\n    defaultPropertyValues: PropertyValues<Props>;\r\n    defaultTransitionablePropertyValues: TransitionablePropertyValues<Props>;\r\n    defaultTransitioningPropertyValues: TransitioningPropertyValues<Props>;\r\n    defaultPossiblyEvaluatedValues: PossiblyEvaluatedPropertyValues<Props>;\r\n\r\n    constructor(properties: Props) {\r\n        this.properties = properties;\r\n        this.defaultPropertyValues = ({}: any);\r\n        this.defaultTransitionablePropertyValues = ({}: any);\r\n        this.defaultTransitioningPropertyValues = ({}: any);\r\n        this.defaultPossiblyEvaluatedValues = ({}: any);\r\n\r\n        for (const property in properties) {\r\n            const prop = properties[property];\r\n            const defaultPropertyValue = this.defaultPropertyValues[property] =\r\n                new PropertyValue(prop, undefined);\r\n            const defaultTransitionablePropertyValue = this.defaultTransitionablePropertyValues[property] =\r\n                new TransitionablePropertyValue(prop);\r\n            this.defaultTransitioningPropertyValues[property] =\r\n                defaultTransitionablePropertyValue.untransitioned();\r\n            this.defaultPossiblyEvaluatedValues[property] =\r\n                defaultPropertyValue.possiblyEvaluate(({}: any));\r\n        }\r\n    }\r\n}\r\n\r\nregister('DataDrivenProperty', DataDrivenProperty);\r\nregister('DataConstantProperty', DataConstantProperty);\r\nregister('CrossFadedProperty', CrossFadedProperty);\r\nregister('HeatmapColorProperty', HeatmapColorProperty);\r\n\r\nmodule.exports = {\r\n    PropertyValue,\r\n    Transitionable,\r\n    Transitioning,\r\n    Layout,\r\n    PossiblyEvaluatedPropertyValue,\r\n    PossiblyEvaluated,\r\n    DataConstantProperty,\r\n    DataDrivenProperty,\r\n    CrossFadedProperty,\r\n    HeatmapColorProperty,\r\n    Properties\r\n};\r\n","// @flow\r\n\r\nconst UnitBezier = require('@mapbox/unitbezier');\r\nconst Coordinate = require('../geo/coordinate');\r\nconst Point = require('@mapbox/point-geometry');\r\n\r\nimport type {Callback} from '../types/callback';\r\n\r\n/**\r\n * @module util\r\n * @private\r\n */\r\n\r\n/**\r\n * Given a value `t` that varies between 0 and 1, return\r\n * an interpolation function that eases between 0 and 1 in a pleasing\r\n * cubic in-out fashion.\r\n *\r\n * @private\r\n */\r\nexports.easeCubicInOut = function(t: number): number {\r\n    if (t <= 0) return 0;\r\n    if (t >= 1) return 1;\r\n    const t2 = t * t,\r\n        t3 = t2 * t;\r\n    return 4 * (t < 0.5 ? t3 : 3 * (t - t2) + t3 - 0.75);\r\n};\r\n\r\n/**\r\n * Given given (x, y), (x1, y1) control points for a bezier curve,\r\n * return a function that interpolates along that curve.\r\n *\r\n * @param p1x control point 1 x coordinate\r\n * @param p1y control point 1 y coordinate\r\n * @param p2x control point 2 x coordinate\r\n * @param p2y control point 2 y coordinate\r\n * @private\r\n */\r\nexports.bezier = function(p1x: number, p1y: number, p2x: number, p2y: number): (t: number) => number {\r\n    const bezier = new UnitBezier(p1x, p1y, p2x, p2y);\r\n    return function(t: number) {\r\n        return bezier.solve(t);\r\n    };\r\n};\r\n\r\n/**\r\n * A default bezier-curve powered easing function with\r\n * control points (0.25, 0.1) and (0.25, 1)\r\n *\r\n * @private\r\n */\r\nexports.ease = exports.bezier(0.25, 0.1, 0.25, 1);\r\n\r\n/**\r\n * constrain n to the given range via min + max\r\n *\r\n * @param n value\r\n * @param min the minimum value to be returned\r\n * @param max the maximum value to be returned\r\n * @returns the clamped value\r\n * @private\r\n */\r\nexports.clamp = function (n: number, min: number, max: number): number {\r\n    return Math.min(max, Math.max(min, n));\r\n};\r\n\r\n/**\r\n * constrain n to the given range, excluding the minimum, via modular arithmetic\r\n *\r\n * @param n value\r\n * @param min the minimum value to be returned, exclusive\r\n * @param max the maximum value to be returned, inclusive\r\n * @returns constrained number\r\n * @private\r\n */\r\nexports.wrap = function (n: number, min: number, max: number): number {\r\n    const d = max - min;\r\n    const w = ((n - min) % d + d) % d + min;\r\n    return (w === min) ? max : w;\r\n};\r\n\r\n/*\r\n * Call an asynchronous function on an array of arguments,\r\n * calling `callback` with the completed results of all calls.\r\n *\r\n * @param array input to each call of the async function.\r\n * @param fn an async function with signature (data, callback)\r\n * @param callback a callback run after all async work is done.\r\n * called with an array, containing the results of each async call.\r\n * @private\r\n */\r\nexports.asyncAll = function<Item, Result> (\r\n    array: Array<Item>,\r\n    fn: (item: Item, fnCallback: Callback<Result>) => void,\r\n    callback: Callback<Array<Result>>\r\n) {\r\n    if (!array.length) { return callback(null, []); }\r\n    let remaining = array.length;\r\n    const results = new Array(array.length);\r\n    let error = null;\r\n    array.forEach((item, i) => {\r\n        fn(item, (err, result) => {\r\n            if (err) error = err;\r\n            results[i] = ((result: any): Result); // https://github.com/facebook/flow/issues/2123\r\n            if (--remaining === 0) callback(error, results);\r\n        });\r\n    });\r\n};\r\n\r\n/*\r\n * Polyfill for Object.values. Not fully spec compliant, but we don't\r\n * need it to be.\r\n *\r\n * @private\r\n */\r\nexports.values = function<T>(obj: {[key: string]: T}): Array<T> {\r\n    const result = [];\r\n    for (const k in obj) {\r\n        result.push(obj[k]);\r\n    }\r\n    return result;\r\n};\r\n\r\n/*\r\n * Compute the difference between the keys in one object and the keys\r\n * in another object.\r\n *\r\n * @returns keys difference\r\n * @private\r\n */\r\nexports.keysDifference = function<S, T>(obj: {[key: string]: S}, other: {[key: string]: T}): Array<string> {\r\n    const difference = [];\r\n    for (const i in obj) {\r\n        if (!(i in other)) {\r\n            difference.push(i);\r\n        }\r\n    }\r\n    return difference;\r\n};\r\n\r\n/**\r\n * Given a destination object and optionally many source objects,\r\n * copy all properties from the source objects into the destination.\r\n * The last source object given overrides properties from previous\r\n * source objects.\r\n *\r\n * @param dest destination object\r\n * @param sources sources from which properties are pulled\r\n * @private\r\n */\r\nexports.extend = function (dest: Object, ...sources: Array<?Object>): Object {\r\n    for (const src of sources) {\r\n        for (const k in src) {\r\n            dest[k] = src[k];\r\n        }\r\n    }\r\n    return dest;\r\n};\r\n\r\n/**\r\n * Given an object and a number of properties as strings, return version\r\n * of that object with only those properties.\r\n *\r\n * @param src the object\r\n * @param properties an array of property names chosen\r\n * to appear on the resulting object.\r\n * @returns object with limited properties.\r\n * @example\r\n * var foo = { name: 'Charlie', age: 10 };\r\n * var justName = pick(foo, ['name']);\r\n * // justName = { name: 'Charlie' }\r\n * @private\r\n */\r\nexports.pick = function (src: Object, properties: Array<string>): Object {\r\n    const result = {};\r\n    for (let i = 0; i < properties.length; i++) {\r\n        const k = properties[i];\r\n        if (k in src) {\r\n            result[k] = src[k];\r\n        }\r\n    }\r\n    return result;\r\n};\r\n\r\nlet id = 1;\r\n\r\n/**\r\n * Return a unique numeric id, starting at 1 and incrementing with\r\n * each call.\r\n *\r\n * @returns unique numeric id.\r\n * @private\r\n */\r\nexports.uniqueId = function (): number {\r\n    return id++;\r\n};\r\n\r\n/**\r\n * Given an array of member function names as strings, replace all of them\r\n * with bound versions that will always refer to `context` as `this`. This\r\n * is useful for classes where otherwise event bindings would reassign\r\n * `this` to the evented object or some other value: this lets you ensure\r\n * the `this` value always.\r\n *\r\n * @param fns list of member function names\r\n * @param context the context value\r\n * @example\r\n * function MyClass() {\r\n *   bindAll(['ontimer'], this);\r\n *   this.name = 'Tom';\r\n * }\r\n * MyClass.prototype.ontimer = function() {\r\n *   alert(this.name);\r\n * };\r\n * var myClass = new MyClass();\r\n * setTimeout(myClass.ontimer, 100);\r\n * @private\r\n */\r\nexports.bindAll = function(fns: Array<string>, context: Object): void {\r\n    fns.forEach((fn) => {\r\n        if (!context[fn]) { return; }\r\n        context[fn] = context[fn].bind(context);\r\n    });\r\n};\r\n\r\n/**\r\n * Given a list of coordinates, get their center as a coordinate.\r\n *\r\n * @returns centerpoint\r\n * @private\r\n */\r\nexports.getCoordinatesCenter = function(coords: Array<Coordinate>): Coordinate {\r\n    let minX = Infinity;\r\n    let minY = Infinity;\r\n    let maxX = -Infinity;\r\n    let maxY = -Infinity;\r\n\r\n    for (let i = 0; i < coords.length; i++) {\r\n        minX = Math.min(minX, coords[i].column);\r\n        minY = Math.min(minY, coords[i].row);\r\n        maxX = Math.max(maxX, coords[i].column);\r\n        maxY = Math.max(maxY, coords[i].row);\r\n    }\r\n\r\n    const dx = maxX - minX;\r\n    const dy = maxY - minY;\r\n    const dMax = Math.max(dx, dy);\r\n    const zoom = Math.max(0, Math.floor(-Math.log(dMax) / Math.LN2));\r\n    return new Coordinate((minX + maxX) / 2, (minY + maxY) / 2, 0)\r\n        .zoomTo(zoom);\r\n};\r\n\r\n/**\r\n * Determine if a string ends with a particular substring\r\n *\r\n * @private\r\n */\r\nexports.endsWith = function(string: string, suffix: string): boolean {\r\n    return string.indexOf(suffix, string.length - suffix.length) !== -1;\r\n};\r\n\r\n/**\r\n * Create an object by mapping all the values of an existing object while\r\n * preserving their keys.\r\n *\r\n * @private\r\n */\r\nexports.mapObject = function(input: Object, iterator: Function, context?: Object): Object {\r\n    const output = {};\r\n    for (const key in input) {\r\n        output[key] = iterator.call(context || this, input[key], key, input);\r\n    }\r\n    return output;\r\n};\r\n\r\n/**\r\n * Create an object by filtering out values of an existing object.\r\n *\r\n * @private\r\n */\r\nexports.filterObject = function(input: Object, iterator: Function, context?: Object): Object {\r\n    const output = {};\r\n    for (const key in input) {\r\n        if (iterator.call(context || this, input[key], key, input)) {\r\n            output[key] = input[key];\r\n        }\r\n    }\r\n    return output;\r\n};\r\n\r\nexports.deepEqual = require('../style-spec/util/deep_equal');\r\n\r\n/**\r\n * Deeply clones two objects.\r\n *\r\n * @private\r\n */\r\nexports.clone = function<T>(input: T): T {\r\n    if (Array.isArray(input)) {\r\n        return input.map(exports.clone);\r\n    } else if (typeof input === 'object' && input) {\r\n        return ((exports.mapObject(input, exports.clone): any): T);\r\n    } else {\r\n        return input;\r\n    }\r\n};\r\n\r\n/**\r\n * Check if two arrays have at least one common element.\r\n *\r\n * @private\r\n */\r\nexports.arraysIntersect = function<T>(a: Array<T>, b: Array<T>): boolean {\r\n    for (let l = 0; l < a.length; l++) {\r\n        if (b.indexOf(a[l]) >= 0) return true;\r\n    }\r\n    return false;\r\n};\r\n\r\n/**\r\n * Print a warning message to the console and ensure duplicate warning messages\r\n * are not printed.\r\n *\r\n * @private\r\n */\r\nconst warnOnceHistory: {[key: string]: boolean} = {};\r\nexports.warnOnce = function(message: string): void {\r\n    if (!warnOnceHistory[message]) {\r\n        // console isn't defined in some WebWorkers, see #2558\r\n        if (typeof console !== \"undefined\") console.warn(message);\r\n        warnOnceHistory[message] = true;\r\n    }\r\n};\r\n\r\n/**\r\n * Indicates if the provided Points are in a counter clockwise (true) or clockwise (false) order\r\n *\r\n * @returns true for a counter clockwise set of points\r\n */\r\n// http://bryceboe.com/2006/10/23/line-segment-intersection-algorithm/\r\nexports.isCounterClockwise = function(a: Point, b: Point, c: Point): boolean {\r\n    return (c.y - a.y) * (b.x - a.x) > (b.y - a.y) * (c.x - a.x);\r\n};\r\n\r\n/**\r\n * Returns the signed area for the polygon ring.  Postive areas are exterior rings and\r\n * have a clockwise winding.  Negative areas are interior rings and have a counter clockwise\r\n * ordering.\r\n *\r\n * @param ring Exterior or interior ring\r\n */\r\nexports.calculateSignedArea = function(ring: Array<Point>): number {\r\n    let sum = 0;\r\n    for (let i = 0, len = ring.length, j = len - 1, p1, p2; i < len; j = i++) {\r\n        p1 = ring[i];\r\n        p2 = ring[j];\r\n        sum += (p2.x - p1.x) * (p1.y + p2.y);\r\n    }\r\n    return sum;\r\n};\r\n\r\n/**\r\n * Detects closed polygons, first + last point are equal\r\n *\r\n * @param points array of points\r\n * @return true if the points are a closed polygon\r\n */\r\nexports.isClosedPolygon = function(points: Array<Point>): boolean {\r\n    // If it is 2 points that are the same then it is a point\r\n    // If it is 3 points with start and end the same then it is a line\r\n    if (points.length < 4)\r\n        return false;\r\n\r\n    const p1 = points[0];\r\n    const p2 = points[points.length - 1];\r\n\r\n    if (Math.abs(p1.x - p2.x) > 0 ||\r\n        Math.abs(p1.y - p2.y) > 0) {\r\n        return false;\r\n    }\r\n\r\n    // polygon simplification can produce polygons with zero area and more than 3 points\r\n    return (Math.abs(exports.calculateSignedArea(points)) > 0.01);\r\n};\r\n\r\n/**\r\n * Converts spherical coordinates to cartesian coordinates.\r\n *\r\n * @param spherical Spherical coordinates, in [radial, azimuthal, polar]\r\n * @return cartesian coordinates in [x, y, z]\r\n */\r\n\r\nexports.sphericalToCartesian = function([r, azimuthal, polar]: [number, number, number]): {x: number, y: number, z: number} {\r\n    // We abstract \"north\"/\"up\" (compass-wise) to be 0° when really this is 90° (π/2):\r\n    // correct for that here\r\n    azimuthal += 90;\r\n\r\n    // Convert azimuthal and polar angles to radians\r\n    azimuthal *= Math.PI / 180;\r\n    polar *= Math.PI / 180;\r\n\r\n    return {\r\n        x: r * Math.cos(azimuthal) * Math.sin(polar),\r\n        y: r * Math.sin(azimuthal) * Math.sin(polar),\r\n        z: r * Math.cos(polar)\r\n    };\r\n};\r\n\r\n/**\r\n * Parses data from 'Cache-Control' headers.\r\n *\r\n * @param cacheControl Value of 'Cache-Control' header\r\n * @return object containing parsed header info.\r\n */\r\n\r\nexports.parseCacheControl = function(cacheControl: string): Object {\r\n    // Taken from [Wreck](https://github.com/hapijs/wreck)\r\n    const re = /(?:^|(?:\\s*\\,\\s*))([^\\x00-\\x20\\(\\)<>@\\,;\\:\\\\\"\\/\\[\\]\\?\\=\\{\\}\\x7F]+)(?:\\=(?:([^\\x00-\\x20\\(\\)<>@\\,;\\:\\\\\"\\/\\[\\]\\?\\=\\{\\}\\x7F]+)|(?:\\\"((?:[^\"\\\\]|\\\\.)*)\\\")))?/g;\r\n\r\n    const header = {};\r\n    cacheControl.replace(re, ($0, $1, $2, $3) => {\r\n        const value = $2 || $3;\r\n        header[$1] = value ? value.toLowerCase() : true;\r\n        return '';\r\n    });\r\n\r\n    if (header['max-age']) {\r\n        const maxAge = parseInt(header['max-age'], 10);\r\n        if (isNaN(maxAge)) delete header['max-age'];\r\n        else header['max-age'] = maxAge;\r\n    }\r\n\r\n    return header;\r\n};\r\n","// @flow\r\n\r\nconst assert = require('assert');\r\n\r\nconst Grid = require('grid-index');\r\nconst Color = require('../style-spec/util/color');\r\nconst {\r\n    StylePropertyFunction,\r\n    StyleExpression,\r\n    StyleExpressionWithErrorHandling,\r\n    ZoomDependentExpression,\r\n    ZoomConstantExpression\r\n} = require('../style-spec/expression');\r\nconst {CompoundExpression} = require('../style-spec/expression/compound_expression');\r\nconst expressions = require('../style-spec/expression/definitions');\r\nconst {ImageData} = require('./window');\r\n\r\nimport type {Transferable} from '../types/transferable';\r\n\r\nexport type Serialized =\r\n    | null\r\n    | void\r\n    | boolean\r\n    | number\r\n    | string\r\n    | Boolean\r\n    | Number\r\n    | String\r\n    | Date\r\n    | RegExp\r\n    | ArrayBuffer\r\n    | $ArrayBufferView\r\n    | ImageData\r\n    | Array<Serialized>\r\n    | {| name: string, properties: {+[string]: Serialized} |};\r\n\r\ntype Registry = {\r\n    [string]: {\r\n        klass: Class<any>,\r\n        omit: $ReadOnlyArray<string>,\r\n        shallow: $ReadOnlyArray<string>\r\n    }\r\n};\r\n\r\ntype RegisterOptions<T> = {\r\n    omit?: $ReadOnlyArray<$Keys<T>>,\r\n    shallow?: $ReadOnlyArray<$Keys<T>>\r\n}\r\n\r\nconst registry: Registry = {};\r\n\r\n/**\r\n * Register the given class as serializable.\r\n *\r\n * @param options\r\n * @param options.omit List of properties to omit from serialization (e.g., cached/computed properties)\r\n * @param options.shallow List of properties that should be serialized by a simple shallow copy, rather than by a recursive call to serialize().\r\n *\r\n * @private\r\n */\r\nfunction register<T: any>(name: string, klass: Class<T>, options: RegisterOptions<T> = {}) {\r\n    assert(!registry[name], `${name} is already registered.`);\r\n    (Object.defineProperty: any)(klass, '_classRegistryKey', {\r\n        value: name,\r\n        writeable: false\r\n    });\r\n    registry[name] = {\r\n        klass,\r\n        omit: options.omit || [],\r\n        shallow: options.shallow || []\r\n    };\r\n}\r\n\r\nregister('Object', Object);\r\n\r\nGrid.serialize = function serializeGrid(grid: Grid, transferables?: Array<Transferable>): Serialized {\r\n    const ab = grid.toArrayBuffer();\r\n    if (transferables) {\r\n        transferables.push(ab);\r\n    }\r\n    return ab;\r\n};\r\n\r\nGrid.deserialize = function deserializeGrid(serialized: ArrayBuffer): Grid {\r\n    return new Grid(serialized);\r\n};\r\nregister('Grid', Grid);\r\n\r\nregister('Color', Color);\r\n\r\nregister('StylePropertyFunction', StylePropertyFunction);\r\nregister('StyleExpression', StyleExpression, {omit: ['_evaluator']});\r\nregister(\r\n    'StyleExpressionWithErrorHandling',\r\n    StyleExpressionWithErrorHandling,\r\n    {omit: ['_evaluator']}\r\n);\r\nregister('ZoomDependentExpression', ZoomDependentExpression);\r\nregister('ZoomConstantExpression', ZoomConstantExpression);\r\nregister('CompoundExpression', CompoundExpression, {omit: ['_evaluate']});\r\nfor (const name in expressions) {\r\n    if ((expressions[name]: any)._classRegistryKey) continue;\r\n    register(`Expression_${name}`, expressions[name]);\r\n}\r\n\r\n/**\r\n * Serialize the given object for transfer to or from a web worker.\r\n *\r\n * For non-builtin types, recursively serialize each property (possibly\r\n * omitting certain properties - see register()), and package the result along\r\n * with the constructor's `name` so that the appropriate constructor can be\r\n * looked up in `deserialize()`.\r\n *\r\n * If a `transferables` array is provided, add any transferable objects (i.e.,\r\n * any ArrayBuffers or ArrayBuffer views) to the list. (If a copy is needed,\r\n * this should happen in the client code, before using serialize().)\r\n */\r\nfunction serialize(input: mixed, transferables?: Array<Transferable>): Serialized {\r\n    if (input === null ||\r\n        input === undefined ||\r\n        typeof input === 'boolean' ||\r\n        typeof input === 'number' ||\r\n        typeof input === 'string' ||\r\n        input instanceof Boolean ||\r\n        input instanceof Number ||\r\n        input instanceof String ||\r\n        input instanceof Date ||\r\n        input instanceof RegExp) {\r\n        return input;\r\n    }\r\n\r\n    if (input instanceof ArrayBuffer) {\r\n        if (transferables) {\r\n            transferables.push(input);\r\n        }\r\n        return input;\r\n    }\r\n\r\n    if (ArrayBuffer.isView(input)) {\r\n        const view: $ArrayBufferView = (input: any);\r\n        if (transferables) {\r\n            transferables.push(view.buffer);\r\n        }\r\n        return view;\r\n    }\r\n\r\n    if (input instanceof ImageData) {\r\n        if (transferables) {\r\n            transferables.push(input.data.buffer);\r\n        }\r\n        return input;\r\n    }\r\n\r\n    if (Array.isArray(input)) {\r\n        const serialized = [];\r\n        for (const item of input) {\r\n            serialized.push(serialize(item, transferables));\r\n        }\r\n        return serialized;\r\n    }\r\n\r\n    if (typeof input === 'object') {\r\n        const klass = (input.constructor: any);\r\n        const name = klass._classRegistryKey;\r\n        if (!name) {\r\n            throw new Error(`can't serialize object of unregistered class`);\r\n        }\r\n        assert(registry[name]);\r\n\r\n        const properties: {[string]: Serialized} = {};\r\n\r\n        if (klass.serialize) {\r\n            // (Temporary workaround) allow a class to provide static\r\n            // `serialize()` and `deserialize()` methods to bypass the generic\r\n            // approach.\r\n            // This temporary workaround lets us use the generic serialization\r\n            // approach for objects whose members include instances of dynamic\r\n            // StructArray types. Once we refactor StructArray to be static,\r\n            // we can remove this complexity.\r\n            properties._serialized = (klass.serialize: typeof serialize)(input, transferables);\r\n        } else {\r\n            for (const key in input) {\r\n                // any cast due to https://github.com/facebook/flow/issues/5393\r\n                if (!(input: any).hasOwnProperty(key)) continue;\r\n                if (registry[name].omit.indexOf(key) >= 0) continue;\r\n                const property = (input: any)[key];\r\n                properties[key] = registry[name].shallow.indexOf(key) >= 0 ?\r\n                    property :\r\n                    serialize(property, transferables);\r\n            }\r\n        }\r\n\r\n        return {name, properties};\r\n    }\r\n\r\n    throw new Error(`can't serialize object of type ${typeof input}`);\r\n}\r\n\r\nfunction deserialize(input: Serialized): mixed {\r\n    if (input === null ||\r\n        input === undefined ||\r\n        typeof input === 'boolean' ||\r\n        typeof input === 'number' ||\r\n        typeof input === 'string' ||\r\n        input instanceof Boolean ||\r\n        input instanceof Number ||\r\n        input instanceof String ||\r\n        input instanceof Date ||\r\n        input instanceof RegExp ||\r\n        input instanceof ArrayBuffer ||\r\n        ArrayBuffer.isView(input) ||\r\n        input instanceof ImageData) {\r\n        return input;\r\n    }\r\n\r\n    if (Array.isArray(input)) {\r\n        return input.map((i) => deserialize(i));\r\n    }\r\n\r\n    if (typeof input === 'object') {\r\n        const {name, properties} = (input: any);\r\n        if (!name) {\r\n            throw new Error(`can't deserialize object of anonymous class`);\r\n        }\r\n\r\n        const {klass} = registry[name];\r\n        if (!klass) {\r\n            throw new Error(`can't deserialize unregistered class ${name}`);\r\n        }\r\n\r\n        if (klass.deserialize) {\r\n            return (klass.deserialize: typeof deserialize)(properties._serialized);\r\n        }\r\n\r\n        const result = Object.create(klass.prototype);\r\n\r\n        for (const key of Object.keys(properties)) {\r\n            result[key] = registry[name].shallow.indexOf(key) >= 0 ?\r\n                properties[key] : deserialize(properties[key]);\r\n        }\r\n\r\n        return result;\r\n    }\r\n\r\n    throw new Error(`can't deserialize object of type ${typeof input}`);\r\n}\r\n\r\nmodule.exports = {\r\n    register,\r\n    serialize,\r\n    deserialize\r\n};\r\n","// @flow\r\n\r\nexport type NullTypeT = { kind: 'null' };\r\nexport type NumberTypeT = { kind: 'number' };\r\nexport type StringTypeT = { kind: 'string' };\r\nexport type BooleanTypeT = { kind: 'boolean' };\r\nexport type ColorTypeT = { kind: 'color' };\r\nexport type ObjectTypeT = { kind: 'object' };\r\nexport type ValueTypeT = { kind: 'value' };\r\nexport type ErrorTypeT = { kind: 'error' };\r\n\r\nexport type Type =\r\n    NullTypeT |\r\n    NumberTypeT |\r\n    StringTypeT |\r\n    BooleanTypeT |\r\n    ColorTypeT |\r\n    ObjectTypeT |\r\n    ValueTypeT |\r\n    ArrayType | // eslint-disable-line no-use-before-define\r\n    ErrorTypeT\r\n\r\nexport type ArrayType = {\r\n    kind: 'array',\r\n    itemType: Type,\r\n    N: ?number\r\n}\r\n\r\nconst NullType = { kind: 'null' };\r\nconst NumberType = { kind: 'number' };\r\nconst StringType = { kind: 'string' };\r\nconst BooleanType = { kind: 'boolean' };\r\nconst ColorType = { kind: 'color' };\r\nconst ObjectType = { kind: 'object' };\r\nconst ValueType = { kind: 'value' };\r\nconst ErrorType = { kind: 'error' };\r\n\r\nfunction array(itemType: Type, N: ?number): ArrayType {\r\n    return {\r\n        kind: 'array',\r\n        itemType,\r\n        N\r\n    };\r\n}\r\n\r\nfunction toString(type: Type): string {\r\n    if (type.kind === 'array') {\r\n        const itemType = toString(type.itemType);\r\n        return typeof type.N === 'number' ?\r\n            `array<${itemType}, ${type.N}>` :\r\n            type.itemType.kind === 'value' ? 'array' : `array<${itemType}>`;\r\n    } else {\r\n        return type.kind;\r\n    }\r\n}\r\n\r\nconst valueMemberTypes = [\r\n    NullType,\r\n    NumberType,\r\n    StringType,\r\n    BooleanType,\r\n    ColorType,\r\n    ObjectType,\r\n    array(ValueType)\r\n];\r\n\r\n/**\r\n * Returns null if `t` is a subtype of `expected`; otherwise returns an\r\n * error message.\r\n * @private\r\n */\r\nfunction checkSubtype(expected: Type, t: Type): ?string {\r\n    if (t.kind === 'error') {\r\n        // Error is a subtype of every type\r\n        return null;\r\n    } else if (expected.kind === 'array') {\r\n        if (t.kind === 'array' &&\r\n            !checkSubtype(expected.itemType, t.itemType) &&\r\n            (typeof expected.N !== 'number' || expected.N === t.N)) {\r\n            return null;\r\n        }\r\n    } else if (expected.kind === t.kind) {\r\n        return null;\r\n    } else if (expected.kind === 'value') {\r\n        for (const memberType of valueMemberTypes) {\r\n            if (!checkSubtype(memberType, t)) {\r\n                return null;\r\n            }\r\n        }\r\n    }\r\n\r\n    return `Expected ${toString(expected)} but found ${toString(t)} instead.`;\r\n}\r\n\r\nmodule.exports = {\r\n    NullType,\r\n    NumberType,\r\n    StringType,\r\n    BooleanType,\r\n    ColorType,\r\n    ObjectType,\r\n    ValueType,\r\n    array,\r\n    ErrorType,\r\n    toString,\r\n    checkSubtype\r\n};\r\n","\r\nfunction ValidationError(key, value, message) {\r\n    this.message = (key ? `${key}: ` : '') + message;\r\n\r\n    if (value !== null && value !== undefined && value.__line__) {\r\n        this.line = value.__line__;\r\n    }\r\n}\r\n\r\nmodule.exports = ValidationError;\r\n","'use strict';\n\nmodule.exports = Point;\n\n/**\n * A standalone point geometry with useful accessor, comparison, and\n * modification methods.\n *\n * @class Point\n * @param {Number} x the x-coordinate. this could be longitude or screen\n * pixels, or any other sort of unit.\n * @param {Number} y the y-coordinate. this could be latitude or screen\n * pixels, or any other sort of unit.\n * @example\n * var point = new Point(-77, 38);\n */\nfunction Point(x, y) {\n    this.x = x;\n    this.y = y;\n}\n\nPoint.prototype = {\n\n    /**\n     * Clone this point, returning a new point that can be modified\n     * without affecting the old one.\n     * @return {Point} the clone\n     */\n    clone: function() { return new Point(this.x, this.y); },\n\n    /**\n     * Add this point's x & y coordinates to another point,\n     * yielding a new point.\n     * @param {Point} p the other point\n     * @return {Point} output point\n     */\n    add:     function(p) { return this.clone()._add(p); },\n\n    /**\n     * Subtract this point's x & y coordinates to from point,\n     * yielding a new point.\n     * @param {Point} p the other point\n     * @return {Point} output point\n     */\n    sub:     function(p) { return this.clone()._sub(p); },\n\n    /**\n     * Multiply this point's x & y coordinates by point,\n     * yielding a new point.\n     * @param {Point} p the other point\n     * @return {Point} output point\n     */\n    multByPoint:    function(p) { return this.clone()._multByPoint(p); },\n\n    /**\n     * Divide this point's x & y coordinates by point,\n     * yielding a new point.\n     * @param {Point} p the other point\n     * @return {Point} output point\n     */\n    divByPoint:     function(p) { return this.clone()._divByPoint(p); },\n\n    /**\n     * Multiply this point's x & y coordinates by a factor,\n     * yielding a new point.\n     * @param {Point} k factor\n     * @return {Point} output point\n     */\n    mult:    function(k) { return this.clone()._mult(k); },\n\n    /**\n     * Divide this point's x & y coordinates by a factor,\n     * yielding a new point.\n     * @param {Point} k factor\n     * @return {Point} output point\n     */\n    div:     function(k) { return this.clone()._div(k); },\n\n    /**\n     * Rotate this point around the 0, 0 origin by an angle a,\n     * given in radians\n     * @param {Number} a angle to rotate around, in radians\n     * @return {Point} output point\n     */\n    rotate:  function(a) { return this.clone()._rotate(a); },\n\n    /**\n     * Rotate this point around p point by an angle a,\n     * given in radians\n     * @param {Number} a angle to rotate around, in radians\n     * @param {Point} p Point to rotate around\n     * @return {Point} output point\n     */\n    rotateAround:  function(a,p) { return this.clone()._rotateAround(a,p); },\n\n    /**\n     * Multiply this point by a 4x1 transformation matrix\n     * @param {Array<Number>} m transformation matrix\n     * @return {Point} output point\n     */\n    matMult: function(m) { return this.clone()._matMult(m); },\n\n    /**\n     * Calculate this point but as a unit vector from 0, 0, meaning\n     * that the distance from the resulting point to the 0, 0\n     * coordinate will be equal to 1 and the angle from the resulting\n     * point to the 0, 0 coordinate will be the same as before.\n     * @return {Point} unit vector point\n     */\n    unit:    function() { return this.clone()._unit(); },\n\n    /**\n     * Compute a perpendicular point, where the new y coordinate\n     * is the old x coordinate and the new x coordinate is the old y\n     * coordinate multiplied by -1\n     * @return {Point} perpendicular point\n     */\n    perp:    function() { return this.clone()._perp(); },\n\n    /**\n     * Return a version of this point with the x & y coordinates\n     * rounded to integers.\n     * @return {Point} rounded point\n     */\n    round:   function() { return this.clone()._round(); },\n\n    /**\n     * Return the magitude of this point: this is the Euclidean\n     * distance from the 0, 0 coordinate to this point's x and y\n     * coordinates.\n     * @return {Number} magnitude\n     */\n    mag: function() {\n        return Math.sqrt(this.x * this.x + this.y * this.y);\n    },\n\n    /**\n     * Judge whether this point is equal to another point, returning\n     * true or false.\n     * @param {Point} other the other point\n     * @return {boolean} whether the points are equal\n     */\n    equals: function(other) {\n        return this.x === other.x &&\n               this.y === other.y;\n    },\n\n    /**\n     * Calculate the distance from this point to another point\n     * @param {Point} p the other point\n     * @return {Number} distance\n     */\n    dist: function(p) {\n        return Math.sqrt(this.distSqr(p));\n    },\n\n    /**\n     * Calculate the distance from this point to another point,\n     * without the square root step. Useful if you're comparing\n     * relative distances.\n     * @param {Point} p the other point\n     * @return {Number} distance\n     */\n    distSqr: function(p) {\n        var dx = p.x - this.x,\n            dy = p.y - this.y;\n        return dx * dx + dy * dy;\n    },\n\n    /**\n     * Get the angle from the 0, 0 coordinate to this point, in radians\n     * coordinates.\n     * @return {Number} angle\n     */\n    angle: function() {\n        return Math.atan2(this.y, this.x);\n    },\n\n    /**\n     * Get the angle from this point to another point, in radians\n     * @param {Point} b the other point\n     * @return {Number} angle\n     */\n    angleTo: function(b) {\n        return Math.atan2(this.y - b.y, this.x - b.x);\n    },\n\n    /**\n     * Get the angle between this point and another point, in radians\n     * @param {Point} b the other point\n     * @return {Number} angle\n     */\n    angleWith: function(b) {\n        return this.angleWithSep(b.x, b.y);\n    },\n\n    /*\n     * Find the angle of the two vectors, solving the formula for\n     * the cross product a x b = |a||b|sin(θ) for θ.\n     * @param {Number} x the x-coordinate\n     * @param {Number} y the y-coordinate\n     * @return {Number} the angle in radians\n     */\n    angleWithSep: function(x, y) {\n        return Math.atan2(\n            this.x * y - this.y * x,\n            this.x * x + this.y * y);\n    },\n\n    _matMult: function(m) {\n        var x = m[0] * this.x + m[1] * this.y,\n            y = m[2] * this.x + m[3] * this.y;\n        this.x = x;\n        this.y = y;\n        return this;\n    },\n\n    _add: function(p) {\n        this.x += p.x;\n        this.y += p.y;\n        return this;\n    },\n\n    _sub: function(p) {\n        this.x -= p.x;\n        this.y -= p.y;\n        return this;\n    },\n\n    _mult: function(k) {\n        this.x *= k;\n        this.y *= k;\n        return this;\n    },\n\n    _div: function(k) {\n        this.x /= k;\n        this.y /= k;\n        return this;\n    },\n\n    _multByPoint: function(p) {\n        this.x *= p.x;\n        this.y *= p.y;\n        return this;\n    },\n\n    _divByPoint: function(p) {\n        this.x /= p.x;\n        this.y /= p.y;\n        return this;\n    },\n\n    _unit: function() {\n        this._div(this.mag());\n        return this;\n    },\n\n    _perp: function() {\n        var y = this.y;\n        this.y = this.x;\n        this.x = -y;\n        return this;\n    },\n\n    _rotate: function(angle) {\n        var cos = Math.cos(angle),\n            sin = Math.sin(angle),\n            x = cos * this.x - sin * this.y,\n            y = sin * this.x + cos * this.y;\n        this.x = x;\n        this.y = y;\n        return this;\n    },\n\n    _rotateAround: function(angle, p) {\n        var cos = Math.cos(angle),\n            sin = Math.sin(angle),\n            x = p.x + cos * (this.x - p.x) - sin * (this.y - p.y),\n            y = p.y + sin * (this.x - p.x) + cos * (this.y - p.y);\n        this.x = x;\n        this.y = y;\n        return this;\n    },\n\n    _round: function() {\n        this.x = Math.round(this.x);\n        this.y = Math.round(this.y);\n        return this;\n    }\n};\n\n/**\n * Construct a point from an array if necessary, otherwise if the input\n * is already a Point, or an unknown type, return it unchanged\n * @param {Array<Number>|Point|*} a any kind of input value\n * @return {Point} constructed point, or passed-through value.\n * @example\n * // this\n * var point = Point.convert([0, 1]);\n * // is equivalent to\n * var point = new Point(0, 1);\n */\nPoint.convert = function (a) {\n    if (a instanceof Point) {\n        return a;\n    }\n    if (Array.isArray(a)) {\n        return new Point(a[0], a[1]);\n    }\n    return a;\n};\n","\r\nmodule.exports = function getType(val) {\r\n    if (val instanceof Number) {\r\n        return 'number';\r\n    } else if (val instanceof String) {\r\n        return 'string';\r\n    } else if (val instanceof Boolean) {\r\n        return 'boolean';\r\n    } else if (Array.isArray(val)) {\r\n        return 'array';\r\n    } else if (val === null) {\r\n        return 'null';\r\n    } else {\r\n        return typeof val;\r\n    }\r\n};\r\n","\r\nmodule.exports = require('./v8.json');\r\n","// @flow\r\n\r\n\r\nconst util = require('../util/util');\r\nconst styleSpec = require('../style-spec/reference/latest');\r\nconst validateStyle = require('./validate_style');\r\nconst Evented = require('../util/evented');\r\n\r\nconst {\r\n    Layout,\r\n    Transitionable,\r\n    Transitioning,\r\n    Properties\r\n} = require('./properties');\r\n\r\nimport type {Bucket} from '../data/bucket';\r\nimport type Point from '@mapbox/point-geometry';\r\nimport type {FeatureFilter} from '../style-spec/feature_filter';\r\nimport type {TransitionParameters} from './properties';\r\nimport type EvaluationParameters from './evaluation_parameters';\r\n\r\nconst TRANSITION_SUFFIX = '-transition';\r\n\r\nclass StyleLayer extends Evented {\r\n    static create: (layer: LayerSpecification) => StyleLayer;\r\n\r\n    id: string;\r\n    metadata: mixed;\r\n    type: string;\r\n    source: string;\r\n    sourceLayer: ?string;\r\n    minzoom: ?number;\r\n    maxzoom: ?number;\r\n    filter: FilterSpecification | void;\r\n    visibility: 'visible' | 'none';\r\n\r\n    _unevaluatedLayout: Layout<any>;\r\n    +layout: mixed;\r\n\r\n    _transitionablePaint: Transitionable<any>;\r\n    _transitioningPaint: Transitioning<any>;\r\n    +paint: mixed;\r\n\r\n    _featureFilter: FeatureFilter;\r\n\r\n    +queryRadius: (bucket: Bucket) => number;\r\n    +queryIntersectsFeature: (queryGeometry: Array<Array<Point>>,\r\n                              feature: VectorTileFeature,\r\n                              geometry: Array<Array<Point>>,\r\n                              zoom: number,\r\n                              bearing: number,\r\n                              pixelsToTileUnits: number) => boolean;\r\n\r\n    constructor(layer: LayerSpecification, properties: {layout?: Properties<*>, paint: Properties<*>}) {\r\n        super();\r\n\r\n        this.id = layer.id;\r\n        this.metadata = layer.metadata;\r\n        this.type = layer.type;\r\n        this.minzoom = layer.minzoom;\r\n        this.maxzoom = layer.maxzoom;\r\n        this.visibility = 'visible';\r\n\r\n        if (layer.type !== 'background') {\r\n            this.source = layer.source;\r\n            this.sourceLayer = layer['source-layer'];\r\n            this.filter = layer.filter;\r\n        }\r\n\r\n        this._featureFilter = () => true;\r\n\r\n        if (properties.layout) {\r\n            this._unevaluatedLayout = new Layout(properties.layout);\r\n        }\r\n\r\n        this._transitionablePaint = new Transitionable(properties.paint);\r\n\r\n        for (const property in layer.paint) {\r\n            this.setPaintProperty(property, layer.paint[property], {validate: false});\r\n        }\r\n        for (const property in layer.layout) {\r\n            this.setLayoutProperty(property, layer.layout[property], {validate: false});\r\n        }\r\n\r\n        this._transitioningPaint = this._transitionablePaint.untransitioned();\r\n    }\r\n\r\n    getLayoutProperty(name: string) {\r\n        if (name === 'visibility') {\r\n            return this.visibility;\r\n        }\r\n\r\n        return this._unevaluatedLayout.getValue(name);\r\n    }\r\n\r\n    setLayoutProperty(name: string, value: mixed, options: {validate: boolean}) {\r\n        if (value !== null && value !== undefined) {\r\n            const key = `layers.${this.id}.layout.${name}`;\r\n            if (this._validate(validateStyle.layoutProperty, key, name, value, options)) {\r\n                return;\r\n            }\r\n        }\r\n\r\n        if (name === 'visibility') {\r\n            this.visibility = value === 'none' ? value : 'visible';\r\n            return;\r\n        }\r\n\r\n        this._unevaluatedLayout.setValue(name, value);\r\n    }\r\n\r\n    getPaintProperty(name: string) {\r\n        if (util.endsWith(name, TRANSITION_SUFFIX)) {\r\n            return this._transitionablePaint.getTransition(name.slice(0, -TRANSITION_SUFFIX.length));\r\n        } else {\r\n            return this._transitionablePaint.getValue(name);\r\n        }\r\n    }\r\n\r\n    setPaintProperty(name: string, value: mixed, options: {validate: boolean}) {\r\n        if (value !== null && value !== undefined) {\r\n            const key = `layers.${this.id}.paint.${name}`;\r\n            if (this._validate(validateStyle.paintProperty, key, name, value, options)) {\r\n                return;\r\n            }\r\n        }\r\n\r\n        if (util.endsWith(name, TRANSITION_SUFFIX)) {\r\n            this._transitionablePaint.setTransition(name.slice(0, -TRANSITION_SUFFIX.length), (value: any) || undefined);\r\n        } else {\r\n            this._transitionablePaint.setValue(name, value);\r\n        }\r\n    }\r\n\r\n    isHidden(zoom: number) {\r\n        if (this.minzoom && zoom < this.minzoom) return true;\r\n        if (this.maxzoom && zoom >= this.maxzoom) return true;\r\n        return this.visibility === 'none';\r\n    }\r\n\r\n    updateTransitions(parameters: TransitionParameters) {\r\n        this._transitioningPaint = this._transitionablePaint.transitioned(parameters, this._transitioningPaint);\r\n    }\r\n\r\n    hasTransition() {\r\n        return this._transitioningPaint.hasTransition();\r\n    }\r\n\r\n    recalculate(parameters: EvaluationParameters) {\r\n        if (this._unevaluatedLayout) {\r\n            (this: any).layout = this._unevaluatedLayout.possiblyEvaluate(parameters);\r\n        }\r\n\r\n        (this: any).paint = this._transitioningPaint.possiblyEvaluate(parameters);\r\n    }\r\n\r\n    serialize() {\r\n        const output : any = {\r\n            'id': this.id,\r\n            'type': this.type,\r\n            'source': this.source,\r\n            'source-layer': this.sourceLayer,\r\n            'metadata': this.metadata,\r\n            'minzoom': this.minzoom,\r\n            'maxzoom': this.maxzoom,\r\n            'filter': this.filter,\r\n            'layout': this._unevaluatedLayout && this._unevaluatedLayout.serialize(),\r\n            'paint': this._transitionablePaint && this._transitionablePaint.serialize()\r\n        };\r\n\r\n        if (this.visibility === 'none') {\r\n            output.layout = output.layout || {};\r\n            output.layout.visibility = 'none';\r\n        }\r\n\r\n        return util.filterObject(output, (value, key) => {\r\n            return value !== undefined &&\r\n                !(key === 'layout' && !Object.keys(value).length) &&\r\n                !(key === 'paint' && !Object.keys(value).length);\r\n        });\r\n    }\r\n\r\n    _validate(validate: Function, key: string, name: string, value: mixed, options: {validate: boolean}) {\r\n        if (options && options.validate === false) {\r\n            return false;\r\n        }\r\n        return validateStyle.emitErrors(this, validate.call(validateStyle, {\r\n            key: key,\r\n            layerType: this.type,\r\n            objectKey: name,\r\n            value: value,\r\n            styleSpec: styleSpec,\r\n            // Workaround for https://github.com/mapbox/mapbox-gl-js/issues/2407\r\n            style: {glyphs: true, sprite: true}\r\n        }));\r\n    }\r\n\r\n    hasOffscreenPass() {\r\n        return false;\r\n    }\r\n\r\n    resize() {\r\n        // noop\r\n    }\r\n}\r\n\r\nmodule.exports = StyleLayer;\r\n\r\nconst subclasses = {\r\n    'circle': require('./style_layer/circle_style_layer'),\r\n    'heatmap': require('./style_layer/heatmap_style_layer'),\r\n    'hillshade': require('./style_layer/hillshade_style_layer'),\r\n    'fill': require('./style_layer/fill_style_layer'),\r\n    'fill-extrusion': require('./style_layer/fill_extrusion_style_layer'),\r\n    'line': require('./style_layer/line_style_layer'),\r\n    'symbol': require('./style_layer/symbol_style_layer'),\r\n    'background': require('./style_layer/background_style_layer'),\r\n    'raster': require('./style_layer/raster_style_layer')\r\n};\r\n\r\nStyleLayer.create = function(layer: LayerSpecification) {\r\n    return new subclasses[layer.type](layer);\r\n};\r\n","// This file is generated. Edit build/generate-struct-arrays.js, then run `yarn run codegen`.\r\n// @flow\r\n\r\nconst assert = require('assert');\r\nconst {StructArray} = require('../util/struct_array');\r\nconst {Struct} = require('../util/struct_array');\r\nconst {register} = require('../util/web_worker_transfer');\r\nconst Point = require('@mapbox/point-geometry');\r\n\r\n\r\n/**\r\n * Implementation of the StructArray layout:\r\n * [0]: Int16[2]\r\n *\r\n * @private\r\n */\r\nclass StructArrayLayout2i4 extends StructArray {\r\n    uint8: Uint8Array;\r\n    int16: Int16Array;\r\n\r\n    _refreshViews() {\r\n        this.uint8 = new Uint8Array(this.arrayBuffer);\r\n        this.int16 = new Int16Array(this.arrayBuffer);\r\n    }\r\n\r\n    emplaceBack(v0: number, v1: number) {\r\n        const i = this.length;\r\n        this.resize(i + 1);\r\n        const o2 = i * 2;\r\n        this.int16[o2 + 0] = v0;\r\n        this.int16[o2 + 1] = v1;\r\n        return i;\r\n    }\r\n\r\n}\r\n\r\nStructArrayLayout2i4.prototype.bytesPerElement = 4;\r\nregister('StructArrayLayout2i4', StructArrayLayout2i4);\r\n\r\n\r\n/**\r\n * Implementation of the StructArray layout:\r\n * [0]: Int16[4]\r\n *\r\n * @private\r\n */\r\nclass StructArrayLayout4i8 extends StructArray {\r\n    uint8: Uint8Array;\r\n    int16: Int16Array;\r\n\r\n    _refreshViews() {\r\n        this.uint8 = new Uint8Array(this.arrayBuffer);\r\n        this.int16 = new Int16Array(this.arrayBuffer);\r\n    }\r\n\r\n    emplaceBack(v0: number, v1: number, v2: number, v3: number) {\r\n        const i = this.length;\r\n        this.resize(i + 1);\r\n        const o2 = i * 4;\r\n        this.int16[o2 + 0] = v0;\r\n        this.int16[o2 + 1] = v1;\r\n        this.int16[o2 + 2] = v2;\r\n        this.int16[o2 + 3] = v3;\r\n        return i;\r\n    }\r\n\r\n}\r\n\r\nStructArrayLayout4i8.prototype.bytesPerElement = 8;\r\nregister('StructArrayLayout4i8', StructArrayLayout4i8);\r\n\r\n\r\n/**\r\n * Implementation of the StructArray layout:\r\n * [0]: Int16[2]\r\n * [4]: Int16[4]\r\n *\r\n * @private\r\n */\r\nclass StructArrayLayout2i4i12 extends StructArray {\r\n    uint8: Uint8Array;\r\n    int16: Int16Array;\r\n\r\n    _refreshViews() {\r\n        this.uint8 = new Uint8Array(this.arrayBuffer);\r\n        this.int16 = new Int16Array(this.arrayBuffer);\r\n    }\r\n\r\n    emplaceBack(v0: number, v1: number, v2: number, v3: number, v4: number, v5: number) {\r\n        const i = this.length;\r\n        this.resize(i + 1);\r\n        const o2 = i * 6;\r\n        this.int16[o2 + 0] = v0;\r\n        this.int16[o2 + 1] = v1;\r\n        this.int16[o2 + 2] = v2;\r\n        this.int16[o2 + 3] = v3;\r\n        this.int16[o2 + 4] = v4;\r\n        this.int16[o2 + 5] = v5;\r\n        return i;\r\n    }\r\n\r\n}\r\n\r\nStructArrayLayout2i4i12.prototype.bytesPerElement = 12;\r\nregister('StructArrayLayout2i4i12', StructArrayLayout2i4i12);\r\n\r\n\r\n/**\r\n * Implementation of the StructArray layout:\r\n * [0]: Int16[4]\r\n * [8]: Uint8[4]\r\n *\r\n * @private\r\n */\r\nclass StructArrayLayout4i4ub12 extends StructArray {\r\n    uint8: Uint8Array;\r\n    int16: Int16Array;\r\n\r\n    _refreshViews() {\r\n        this.uint8 = new Uint8Array(this.arrayBuffer);\r\n        this.int16 = new Int16Array(this.arrayBuffer);\r\n    }\r\n\r\n    emplaceBack(v0: number, v1: number, v2: number, v3: number, v4: number, v5: number, v6: number, v7: number) {\r\n        const i = this.length;\r\n        this.resize(i + 1);\r\n        const o2 = i * 6;\r\n        const o1 = i * 12;\r\n        this.int16[o2 + 0] = v0;\r\n        this.int16[o2 + 1] = v1;\r\n        this.int16[o2 + 2] = v2;\r\n        this.int16[o2 + 3] = v3;\r\n        this.uint8[o1 + 8] = v4;\r\n        this.uint8[o1 + 9] = v5;\r\n        this.uint8[o1 + 10] = v6;\r\n        this.uint8[o1 + 11] = v7;\r\n        return i;\r\n    }\r\n\r\n}\r\n\r\nStructArrayLayout4i4ub12.prototype.bytesPerElement = 12;\r\nregister('StructArrayLayout4i4ub12', StructArrayLayout4i4ub12);\r\n\r\n\r\n/**\r\n * Implementation of the StructArray layout:\r\n * [0]: Int16[4]\r\n * [8]: Uint16[4]\r\n *\r\n * @private\r\n */\r\nclass StructArrayLayout4i4ui16 extends StructArray {\r\n    uint8: Uint8Array;\r\n    int16: Int16Array;\r\n    uint16: Uint16Array;\r\n\r\n    _refreshViews() {\r\n        this.uint8 = new Uint8Array(this.arrayBuffer);\r\n        this.int16 = new Int16Array(this.arrayBuffer);\r\n        this.uint16 = new Uint16Array(this.arrayBuffer);\r\n    }\r\n\r\n    emplaceBack(v0: number, v1: number, v2: number, v3: number, v4: number, v5: number, v6: number, v7: number) {\r\n        const i = this.length;\r\n        this.resize(i + 1);\r\n        const o2 = i * 8;\r\n        this.int16[o2 + 0] = v0;\r\n        this.int16[o2 + 1] = v1;\r\n        this.int16[o2 + 2] = v2;\r\n        this.int16[o2 + 3] = v3;\r\n        this.uint16[o2 + 4] = v4;\r\n        this.uint16[o2 + 5] = v5;\r\n        this.uint16[o2 + 6] = v6;\r\n        this.uint16[o2 + 7] = v7;\r\n        return i;\r\n    }\r\n\r\n}\r\n\r\nStructArrayLayout4i4ui16.prototype.bytesPerElement = 16;\r\nregister('StructArrayLayout4i4ui16', StructArrayLayout4i4ui16);\r\n\r\n\r\n/**\r\n * Implementation of the StructArray layout:\r\n * [0]: Float32[3]\r\n *\r\n * @private\r\n */\r\nclass StructArrayLayout3f12 extends StructArray {\r\n    uint8: Uint8Array;\r\n    float32: Float32Array;\r\n\r\n    _refreshViews() {\r\n        this.uint8 = new Uint8Array(this.arrayBuffer);\r\n        this.float32 = new Float32Array(this.arrayBuffer);\r\n    }\r\n\r\n    emplaceBack(v0: number, v1: number, v2: number) {\r\n        const i = this.length;\r\n        this.resize(i + 1);\r\n        const o4 = i * 3;\r\n        this.float32[o4 + 0] = v0;\r\n        this.float32[o4 + 1] = v1;\r\n        this.float32[o4 + 2] = v2;\r\n        return i;\r\n    }\r\n\r\n}\r\n\r\nStructArrayLayout3f12.prototype.bytesPerElement = 12;\r\nregister('StructArrayLayout3f12', StructArrayLayout3f12);\r\n\r\n\r\n/**\r\n * Implementation of the StructArray layout:\r\n * [0]: Uint32[1]\r\n *\r\n * @private\r\n */\r\nclass StructArrayLayout1ul4 extends StructArray {\r\n    uint8: Uint8Array;\r\n    uint32: Uint32Array;\r\n\r\n    _refreshViews() {\r\n        this.uint8 = new Uint8Array(this.arrayBuffer);\r\n        this.uint32 = new Uint32Array(this.arrayBuffer);\r\n    }\r\n\r\n    emplaceBack(v0: number) {\r\n        const i = this.length;\r\n        this.resize(i + 1);\r\n        const o4 = i * 1;\r\n        this.uint32[o4 + 0] = v0;\r\n        return i;\r\n    }\r\n\r\n}\r\n\r\nStructArrayLayout1ul4.prototype.bytesPerElement = 4;\r\nregister('StructArrayLayout1ul4', StructArrayLayout1ul4);\r\n\r\n\r\n/**\r\n * Implementation of the StructArray layout:\r\n * [0]: Int16[6]\r\n * [12]: Uint32[1]\r\n * [16]: Uint16[2]\r\n * [20]: Int16[2]\r\n *\r\n * @private\r\n */\r\nclass StructArrayLayout6i1ul2ui2i24 extends StructArray {\r\n    uint8: Uint8Array;\r\n    int16: Int16Array;\r\n    uint32: Uint32Array;\r\n    uint16: Uint16Array;\r\n\r\n    _refreshViews() {\r\n        this.uint8 = new Uint8Array(this.arrayBuffer);\r\n        this.int16 = new Int16Array(this.arrayBuffer);\r\n        this.uint32 = new Uint32Array(this.arrayBuffer);\r\n        this.uint16 = new Uint16Array(this.arrayBuffer);\r\n    }\r\n\r\n    emplaceBack(v0: number, v1: number, v2: number, v3: number, v4: number, v5: number, v6: number, v7: number, v8: number, v9: number, v10: number) {\r\n        const i = this.length;\r\n        this.resize(i + 1);\r\n        const o2 = i * 12;\r\n        const o4 = i * 6;\r\n        this.int16[o2 + 0] = v0;\r\n        this.int16[o2 + 1] = v1;\r\n        this.int16[o2 + 2] = v2;\r\n        this.int16[o2 + 3] = v3;\r\n        this.int16[o2 + 4] = v4;\r\n        this.int16[o2 + 5] = v5;\r\n        this.uint32[o4 + 3] = v6;\r\n        this.uint16[o2 + 8] = v7;\r\n        this.uint16[o2 + 9] = v8;\r\n        this.int16[o2 + 10] = v9;\r\n        this.int16[o2 + 11] = v10;\r\n        return i;\r\n    }\r\n\r\n}\r\n\r\nStructArrayLayout6i1ul2ui2i24.prototype.bytesPerElement = 24;\r\nregister('StructArrayLayout6i1ul2ui2i24', StructArrayLayout6i1ul2ui2i24);\r\n\r\n\r\n/**\r\n * Implementation of the StructArray layout:\r\n * [0]: Int16[2]\r\n * [4]: Int16[2]\r\n * [8]: Int16[2]\r\n *\r\n * @private\r\n */\r\nclass StructArrayLayout2i2i2i12 extends StructArray {\r\n    uint8: Uint8Array;\r\n    int16: Int16Array;\r\n\r\n    _refreshViews() {\r\n        this.uint8 = new Uint8Array(this.arrayBuffer);\r\n        this.int16 = new Int16Array(this.arrayBuffer);\r\n    }\r\n\r\n    emplaceBack(v0: number, v1: number, v2: number, v3: number, v4: number, v5: number) {\r\n        const i = this.length;\r\n        this.resize(i + 1);\r\n        const o2 = i * 6;\r\n        this.int16[o2 + 0] = v0;\r\n        this.int16[o2 + 1] = v1;\r\n        this.int16[o2 + 2] = v2;\r\n        this.int16[o2 + 3] = v3;\r\n        this.int16[o2 + 4] = v4;\r\n        this.int16[o2 + 5] = v5;\r\n        return i;\r\n    }\r\n\r\n}\r\n\r\nStructArrayLayout2i2i2i12.prototype.bytesPerElement = 12;\r\nregister('StructArrayLayout2i2i2i12', StructArrayLayout2i2i2i12);\r\n\r\n\r\n/**\r\n * Implementation of the StructArray layout:\r\n * [0]: Uint8[2]\r\n *\r\n * @private\r\n */\r\nclass StructArrayLayout2ub4 extends StructArray {\r\n    uint8: Uint8Array;\r\n\r\n    _refreshViews() {\r\n        this.uint8 = new Uint8Array(this.arrayBuffer);\r\n    }\r\n\r\n    emplaceBack(v0: number, v1: number) {\r\n        const i = this.length;\r\n        this.resize(i + 1);\r\n        const o1 = i * 4;\r\n        this.uint8[o1 + 0] = v0;\r\n        this.uint8[o1 + 1] = v1;\r\n        return i;\r\n    }\r\n\r\n}\r\n\r\nStructArrayLayout2ub4.prototype.bytesPerElement = 4;\r\nregister('StructArrayLayout2ub4', StructArrayLayout2ub4);\r\n\r\n\r\n/**\r\n * Implementation of the StructArray layout:\r\n * [0]: Int16[2]\r\n * [4]: Uint16[2]\r\n * [8]: Uint32[3]\r\n * [20]: Uint16[3]\r\n * [28]: Float32[2]\r\n * [36]: Uint8[2]\r\n *\r\n * @private\r\n */\r\nclass StructArrayLayout2i2ui3ul3ui2f2ub40 extends StructArray {\r\n    uint8: Uint8Array;\r\n    int16: Int16Array;\r\n    uint16: Uint16Array;\r\n    uint32: Uint32Array;\r\n    float32: Float32Array;\r\n\r\n    _refreshViews() {\r\n        this.uint8 = new Uint8Array(this.arrayBuffer);\r\n        this.int16 = new Int16Array(this.arrayBuffer);\r\n        this.uint16 = new Uint16Array(this.arrayBuffer);\r\n        this.uint32 = new Uint32Array(this.arrayBuffer);\r\n        this.float32 = new Float32Array(this.arrayBuffer);\r\n    }\r\n\r\n    emplaceBack(v0: number, v1: number, v2: number, v3: number, v4: number, v5: number, v6: number, v7: number, v8: number, v9: number, v10: number, v11: number, v12: number, v13: number) {\r\n        const i = this.length;\r\n        this.resize(i + 1);\r\n        const o2 = i * 20;\r\n        const o4 = i * 10;\r\n        const o1 = i * 40;\r\n        this.int16[o2 + 0] = v0;\r\n        this.int16[o2 + 1] = v1;\r\n        this.uint16[o2 + 2] = v2;\r\n        this.uint16[o2 + 3] = v3;\r\n        this.uint32[o4 + 2] = v4;\r\n        this.uint32[o4 + 3] = v5;\r\n        this.uint32[o4 + 4] = v6;\r\n        this.uint16[o2 + 10] = v7;\r\n        this.uint16[o2 + 11] = v8;\r\n        this.uint16[o2 + 12] = v9;\r\n        this.float32[o4 + 7] = v10;\r\n        this.float32[o4 + 8] = v11;\r\n        this.uint8[o1 + 36] = v12;\r\n        this.uint8[o1 + 37] = v13;\r\n        return i;\r\n    }\r\n\r\n}\r\n\r\nStructArrayLayout2i2ui3ul3ui2f2ub40.prototype.bytesPerElement = 40;\r\nregister('StructArrayLayout2i2ui3ul3ui2f2ub40', StructArrayLayout2i2ui3ul3ui2f2ub40);\r\n\r\n\r\n/**\r\n * Implementation of the StructArray layout:\r\n * [0]: Float32[1]\r\n *\r\n * @private\r\n */\r\nclass StructArrayLayout1f4 extends StructArray {\r\n    uint8: Uint8Array;\r\n    float32: Float32Array;\r\n\r\n    _refreshViews() {\r\n        this.uint8 = new Uint8Array(this.arrayBuffer);\r\n        this.float32 = new Float32Array(this.arrayBuffer);\r\n    }\r\n\r\n    emplaceBack(v0: number) {\r\n        const i = this.length;\r\n        this.resize(i + 1);\r\n        const o4 = i * 1;\r\n        this.float32[o4 + 0] = v0;\r\n        return i;\r\n    }\r\n\r\n}\r\n\r\nStructArrayLayout1f4.prototype.bytesPerElement = 4;\r\nregister('StructArrayLayout1f4', StructArrayLayout1f4);\r\n\r\n\r\n/**\r\n * Implementation of the StructArray layout:\r\n * [0]: Int16[3]\r\n *\r\n * @private\r\n */\r\nclass StructArrayLayout3i6 extends StructArray {\r\n    uint8: Uint8Array;\r\n    int16: Int16Array;\r\n\r\n    _refreshViews() {\r\n        this.uint8 = new Uint8Array(this.arrayBuffer);\r\n        this.int16 = new Int16Array(this.arrayBuffer);\r\n    }\r\n\r\n    emplaceBack(v0: number, v1: number, v2: number) {\r\n        const i = this.length;\r\n        this.resize(i + 1);\r\n        const o2 = i * 3;\r\n        this.int16[o2 + 0] = v0;\r\n        this.int16[o2 + 1] = v1;\r\n        this.int16[o2 + 2] = v2;\r\n        return i;\r\n    }\r\n\r\n}\r\n\r\nStructArrayLayout3i6.prototype.bytesPerElement = 6;\r\nregister('StructArrayLayout3i6', StructArrayLayout3i6);\r\n\r\n\r\n/**\r\n * Implementation of the StructArray layout:\r\n * [0]: Uint32[1]\r\n * [4]: Uint16[2]\r\n *\r\n * @private\r\n */\r\nclass StructArrayLayout1ul2ui8 extends StructArray {\r\n    uint8: Uint8Array;\r\n    uint32: Uint32Array;\r\n    uint16: Uint16Array;\r\n\r\n    _refreshViews() {\r\n        this.uint8 = new Uint8Array(this.arrayBuffer);\r\n        this.uint32 = new Uint32Array(this.arrayBuffer);\r\n        this.uint16 = new Uint16Array(this.arrayBuffer);\r\n    }\r\n\r\n    emplaceBack(v0: number, v1: number, v2: number) {\r\n        const i = this.length;\r\n        this.resize(i + 1);\r\n        const o4 = i * 2;\r\n        const o2 = i * 4;\r\n        this.uint32[o4 + 0] = v0;\r\n        this.uint16[o2 + 2] = v1;\r\n        this.uint16[o2 + 3] = v2;\r\n        return i;\r\n    }\r\n\r\n}\r\n\r\nStructArrayLayout1ul2ui8.prototype.bytesPerElement = 8;\r\nregister('StructArrayLayout1ul2ui8', StructArrayLayout1ul2ui8);\r\n\r\n\r\n/**\r\n * Implementation of the StructArray layout:\r\n * [0]: Uint16[3]\r\n *\r\n * @private\r\n */\r\nclass StructArrayLayout3ui6 extends StructArray {\r\n    uint8: Uint8Array;\r\n    uint16: Uint16Array;\r\n\r\n    _refreshViews() {\r\n        this.uint8 = new Uint8Array(this.arrayBuffer);\r\n        this.uint16 = new Uint16Array(this.arrayBuffer);\r\n    }\r\n\r\n    emplaceBack(v0: number, v1: number, v2: number) {\r\n        const i = this.length;\r\n        this.resize(i + 1);\r\n        const o2 = i * 3;\r\n        this.uint16[o2 + 0] = v0;\r\n        this.uint16[o2 + 1] = v1;\r\n        this.uint16[o2 + 2] = v2;\r\n        return i;\r\n    }\r\n\r\n}\r\n\r\nStructArrayLayout3ui6.prototype.bytesPerElement = 6;\r\nregister('StructArrayLayout3ui6', StructArrayLayout3ui6);\r\n\r\n\r\n/**\r\n * Implementation of the StructArray layout:\r\n * [0]: Uint16[2]\r\n *\r\n * @private\r\n */\r\nclass StructArrayLayout2ui4 extends StructArray {\r\n    uint8: Uint8Array;\r\n    uint16: Uint16Array;\r\n\r\n    _refreshViews() {\r\n        this.uint8 = new Uint8Array(this.arrayBuffer);\r\n        this.uint16 = new Uint16Array(this.arrayBuffer);\r\n    }\r\n\r\n    emplaceBack(v0: number, v1: number) {\r\n        const i = this.length;\r\n        this.resize(i + 1);\r\n        const o2 = i * 2;\r\n        this.uint16[o2 + 0] = v0;\r\n        this.uint16[o2 + 1] = v1;\r\n        return i;\r\n    }\r\n\r\n}\r\n\r\nStructArrayLayout2ui4.prototype.bytesPerElement = 4;\r\nregister('StructArrayLayout2ui4', StructArrayLayout2ui4);\r\n\r\n\r\n/**\r\n * Implementation of the StructArray layout:\r\n * [0]: Float32[2]\r\n *\r\n * @private\r\n */\r\nclass StructArrayLayout2f8 extends StructArray {\r\n    uint8: Uint8Array;\r\n    float32: Float32Array;\r\n\r\n    _refreshViews() {\r\n        this.uint8 = new Uint8Array(this.arrayBuffer);\r\n        this.float32 = new Float32Array(this.arrayBuffer);\r\n    }\r\n\r\n    emplaceBack(v0: number, v1: number) {\r\n        const i = this.length;\r\n        this.resize(i + 1);\r\n        const o4 = i * 2;\r\n        this.float32[o4 + 0] = v0;\r\n        this.float32[o4 + 1] = v1;\r\n        return i;\r\n    }\r\n\r\n}\r\n\r\nStructArrayLayout2f8.prototype.bytesPerElement = 8;\r\nregister('StructArrayLayout2f8', StructArrayLayout2f8);\r\n\r\n\r\n/**\r\n * Implementation of the StructArray layout:\r\n * [0]: Float32[4]\r\n *\r\n * @private\r\n */\r\nclass StructArrayLayout4f16 extends StructArray {\r\n    uint8: Uint8Array;\r\n    float32: Float32Array;\r\n\r\n    _refreshViews() {\r\n        this.uint8 = new Uint8Array(this.arrayBuffer);\r\n        this.float32 = new Float32Array(this.arrayBuffer);\r\n    }\r\n\r\n    emplaceBack(v0: number, v1: number, v2: number, v3: number) {\r\n        const i = this.length;\r\n        this.resize(i + 1);\r\n        const o4 = i * 4;\r\n        this.float32[o4 + 0] = v0;\r\n        this.float32[o4 + 1] = v1;\r\n        this.float32[o4 + 2] = v2;\r\n        this.float32[o4 + 3] = v3;\r\n        return i;\r\n    }\r\n\r\n}\r\n\r\nStructArrayLayout4f16.prototype.bytesPerElement = 16;\r\nregister('StructArrayLayout4f16', StructArrayLayout4f16);\r\n\r\n\r\nclass CollisionBoxStruct extends Struct {\r\n    _structArray: CollisionBoxArray;\r\n    anchorPointX: number;\r\n    anchorPointY: number;\r\n    x1: number;\r\n    y1: number;\r\n    x2: number;\r\n    y2: number;\r\n    featureIndex: number;\r\n    sourceLayerIndex: number;\r\n    bucketIndex: number;\r\n    radius: number;\r\n    signedDistanceFromAnchor: number;\r\n    anchorPoint: Point;\r\n    get anchorPointX() { return this._structArray.int16[this._pos2 + 0]; }\r\n    set anchorPointX(x) { this._structArray.int16[this._pos2 + 0] = x; }\r\n    get anchorPointY() { return this._structArray.int16[this._pos2 + 1]; }\r\n    set anchorPointY(x) { this._structArray.int16[this._pos2 + 1] = x; }\r\n    get x1() { return this._structArray.int16[this._pos2 + 2]; }\r\n    set x1(x) { this._structArray.int16[this._pos2 + 2] = x; }\r\n    get y1() { return this._structArray.int16[this._pos2 + 3]; }\r\n    set y1(x) { this._structArray.int16[this._pos2 + 3] = x; }\r\n    get x2() { return this._structArray.int16[this._pos2 + 4]; }\r\n    set x2(x) { this._structArray.int16[this._pos2 + 4] = x; }\r\n    get y2() { return this._structArray.int16[this._pos2 + 5]; }\r\n    set y2(x) { this._structArray.int16[this._pos2 + 5] = x; }\r\n    get featureIndex() { return this._structArray.uint32[this._pos4 + 3]; }\r\n    set featureIndex(x) { this._structArray.uint32[this._pos4 + 3] = x; }\r\n    get sourceLayerIndex() { return this._structArray.uint16[this._pos2 + 8]; }\r\n    set sourceLayerIndex(x) { this._structArray.uint16[this._pos2 + 8] = x; }\r\n    get bucketIndex() { return this._structArray.uint16[this._pos2 + 9]; }\r\n    set bucketIndex(x) { this._structArray.uint16[this._pos2 + 9] = x; }\r\n    get radius() { return this._structArray.int16[this._pos2 + 10]; }\r\n    set radius(x) { this._structArray.int16[this._pos2 + 10] = x; }\r\n    get signedDistanceFromAnchor() { return this._structArray.int16[this._pos2 + 11]; }\r\n    set signedDistanceFromAnchor(x) { this._structArray.int16[this._pos2 + 11] = x; }\r\n    get anchorPoint() { return new Point(this.anchorPointX, this.anchorPointY); }\r\n}\r\n\r\nCollisionBoxStruct.prototype.size = 24;\r\n\r\nexport type CollisionBox = CollisionBoxStruct;\r\n\r\n\r\n/**\r\n * @private\r\n */\r\nclass CollisionBoxArray extends StructArrayLayout6i1ul2ui2i24 {\r\n    /**\r\n     * Return the CollisionBoxStruct at the given location in the array.\r\n     * @param {number} index The index of the element.\r\n     */\r\n    get(index: number): CollisionBoxStruct {\r\n        assert(!this.isTransferred);\r\n        return new CollisionBoxStruct(this, index);\r\n    }\r\n}\r\n\r\nregister('CollisionBoxArray', CollisionBoxArray);\r\n\r\nclass PlacedSymbolStruct extends Struct {\r\n    _structArray: PlacedSymbolArray;\r\n    anchorX: number;\r\n    anchorY: number;\r\n    glyphStartIndex: number;\r\n    numGlyphs: number;\r\n    vertexStartIndex: number;\r\n    lineStartIndex: number;\r\n    lineLength: number;\r\n    segment: number;\r\n    lowerSize: number;\r\n    upperSize: number;\r\n    lineOffsetX: number;\r\n    lineOffsetY: number;\r\n    writingMode: number;\r\n    hidden: number;\r\n    get anchorX() { return this._structArray.int16[this._pos2 + 0]; }\r\n    set anchorX(x) { this._structArray.int16[this._pos2 + 0] = x; }\r\n    get anchorY() { return this._structArray.int16[this._pos2 + 1]; }\r\n    set anchorY(x) { this._structArray.int16[this._pos2 + 1] = x; }\r\n    get glyphStartIndex() { return this._structArray.uint16[this._pos2 + 2]; }\r\n    set glyphStartIndex(x) { this._structArray.uint16[this._pos2 + 2] = x; }\r\n    get numGlyphs() { return this._structArray.uint16[this._pos2 + 3]; }\r\n    set numGlyphs(x) { this._structArray.uint16[this._pos2 + 3] = x; }\r\n    get vertexStartIndex() { return this._structArray.uint32[this._pos4 + 2]; }\r\n    set vertexStartIndex(x) { this._structArray.uint32[this._pos4 + 2] = x; }\r\n    get lineStartIndex() { return this._structArray.uint32[this._pos4 + 3]; }\r\n    set lineStartIndex(x) { this._structArray.uint32[this._pos4 + 3] = x; }\r\n    get lineLength() { return this._structArray.uint32[this._pos4 + 4]; }\r\n    set lineLength(x) { this._structArray.uint32[this._pos4 + 4] = x; }\r\n    get segment() { return this._structArray.uint16[this._pos2 + 10]; }\r\n    set segment(x) { this._structArray.uint16[this._pos2 + 10] = x; }\r\n    get lowerSize() { return this._structArray.uint16[this._pos2 + 11]; }\r\n    set lowerSize(x) { this._structArray.uint16[this._pos2 + 11] = x; }\r\n    get upperSize() { return this._structArray.uint16[this._pos2 + 12]; }\r\n    set upperSize(x) { this._structArray.uint16[this._pos2 + 12] = x; }\r\n    get lineOffsetX() { return this._structArray.float32[this._pos4 + 7]; }\r\n    set lineOffsetX(x) { this._structArray.float32[this._pos4 + 7] = x; }\r\n    get lineOffsetY() { return this._structArray.float32[this._pos4 + 8]; }\r\n    set lineOffsetY(x) { this._structArray.float32[this._pos4 + 8] = x; }\r\n    get writingMode() { return this._structArray.uint8[this._pos1 + 36]; }\r\n    set writingMode(x) { this._structArray.uint8[this._pos1 + 36] = x; }\r\n    get hidden() { return this._structArray.uint8[this._pos1 + 37]; }\r\n    set hidden(x) { this._structArray.uint8[this._pos1 + 37] = x; }\r\n}\r\n\r\nPlacedSymbolStruct.prototype.size = 40;\r\n\r\nexport type PlacedSymbol = PlacedSymbolStruct;\r\n\r\n\r\n/**\r\n * @private\r\n */\r\nclass PlacedSymbolArray extends StructArrayLayout2i2ui3ul3ui2f2ub40 {\r\n    /**\r\n     * Return the PlacedSymbolStruct at the given location in the array.\r\n     * @param {number} index The index of the element.\r\n     */\r\n    get(index: number): PlacedSymbolStruct {\r\n        assert(!this.isTransferred);\r\n        return new PlacedSymbolStruct(this, index);\r\n    }\r\n}\r\n\r\nregister('PlacedSymbolArray', PlacedSymbolArray);\r\n\r\nclass GlyphOffsetStruct extends Struct {\r\n    _structArray: GlyphOffsetArray;\r\n    offsetX: number;\r\n    get offsetX() { return this._structArray.float32[this._pos4 + 0]; }\r\n    set offsetX(x) { this._structArray.float32[this._pos4 + 0] = x; }\r\n}\r\n\r\nGlyphOffsetStruct.prototype.size = 4;\r\n\r\nexport type GlyphOffset = GlyphOffsetStruct;\r\n\r\n\r\n/**\r\n * @private\r\n */\r\nclass GlyphOffsetArray extends StructArrayLayout1f4 {\r\n    getoffsetX(index: number) { return this.float32[index * 1 + 0]; }\r\n    /**\r\n     * Return the GlyphOffsetStruct at the given location in the array.\r\n     * @param {number} index The index of the element.\r\n     */\r\n    get(index: number): GlyphOffsetStruct {\r\n        assert(!this.isTransferred);\r\n        return new GlyphOffsetStruct(this, index);\r\n    }\r\n}\r\n\r\nregister('GlyphOffsetArray', GlyphOffsetArray);\r\n\r\nclass SymbolLineVertexStruct extends Struct {\r\n    _structArray: SymbolLineVertexArray;\r\n    x: number;\r\n    y: number;\r\n    tileUnitDistanceFromAnchor: number;\r\n    get x() { return this._structArray.int16[this._pos2 + 0]; }\r\n    set x(x) { this._structArray.int16[this._pos2 + 0] = x; }\r\n    get y() { return this._structArray.int16[this._pos2 + 1]; }\r\n    set y(x) { this._structArray.int16[this._pos2 + 1] = x; }\r\n    get tileUnitDistanceFromAnchor() { return this._structArray.int16[this._pos2 + 2]; }\r\n    set tileUnitDistanceFromAnchor(x) { this._structArray.int16[this._pos2 + 2] = x; }\r\n}\r\n\r\nSymbolLineVertexStruct.prototype.size = 6;\r\n\r\nexport type SymbolLineVertex = SymbolLineVertexStruct;\r\n\r\n\r\n/**\r\n * @private\r\n */\r\nclass SymbolLineVertexArray extends StructArrayLayout3i6 {\r\n    getx(index: number) { return this.int16[index * 3 + 0]; }\r\n    gety(index: number) { return this.int16[index * 3 + 1]; }\r\n    gettileUnitDistanceFromAnchor(index: number) { return this.int16[index * 3 + 2]; }\r\n    /**\r\n     * Return the SymbolLineVertexStruct at the given location in the array.\r\n     * @param {number} index The index of the element.\r\n     */\r\n    get(index: number): SymbolLineVertexStruct {\r\n        assert(!this.isTransferred);\r\n        return new SymbolLineVertexStruct(this, index);\r\n    }\r\n}\r\n\r\nregister('SymbolLineVertexArray', SymbolLineVertexArray);\r\n\r\nclass FeatureIndexStruct extends Struct {\r\n    _structArray: FeatureIndexArray;\r\n    featureIndex: number;\r\n    sourceLayerIndex: number;\r\n    bucketIndex: number;\r\n    get featureIndex() { return this._structArray.uint32[this._pos4 + 0]; }\r\n    set featureIndex(x) { this._structArray.uint32[this._pos4 + 0] = x; }\r\n    get sourceLayerIndex() { return this._structArray.uint16[this._pos2 + 2]; }\r\n    set sourceLayerIndex(x) { this._structArray.uint16[this._pos2 + 2] = x; }\r\n    get bucketIndex() { return this._structArray.uint16[this._pos2 + 3]; }\r\n    set bucketIndex(x) { this._structArray.uint16[this._pos2 + 3] = x; }\r\n}\r\n\r\nFeatureIndexStruct.prototype.size = 8;\r\n\r\nexport type FeatureIndex = FeatureIndexStruct;\r\n\r\n\r\n/**\r\n * @private\r\n */\r\nclass FeatureIndexArray extends StructArrayLayout1ul2ui8 {\r\n    /**\r\n     * Return the FeatureIndexStruct at the given location in the array.\r\n     * @param {number} index The index of the element.\r\n     */\r\n    get(index: number): FeatureIndexStruct {\r\n        assert(!this.isTransferred);\r\n        return new FeatureIndexStruct(this, index);\r\n    }\r\n}\r\n\r\nregister('FeatureIndexArray', FeatureIndexArray);\r\n\r\n\r\nmodule.exports = {\r\n    StructArrayLayout2i4,\r\n    StructArrayLayout4i8,\r\n    StructArrayLayout2i4i12,\r\n    StructArrayLayout4i4ub12,\r\n    StructArrayLayout4i4ui16,\r\n    StructArrayLayout3f12,\r\n    StructArrayLayout1ul4,\r\n    StructArrayLayout6i1ul2ui2i24,\r\n    StructArrayLayout2i2i2i12,\r\n    StructArrayLayout2ub4,\r\n    StructArrayLayout2i2ui3ul3ui2f2ub40,\r\n    StructArrayLayout1f4,\r\n    StructArrayLayout3i6,\r\n    StructArrayLayout1ul2ui8,\r\n    StructArrayLayout3ui6,\r\n    StructArrayLayout2ui4,\r\n    StructArrayLayout2f8,\r\n    StructArrayLayout4f16,\r\n    PosArray: StructArrayLayout2i4,\r\n    RasterBoundsArray: StructArrayLayout4i8,\r\n    CircleLayoutArray: StructArrayLayout2i4,\r\n    FillLayoutArray: StructArrayLayout2i4,\r\n    FillExtrusionLayoutArray: StructArrayLayout2i4i12,\r\n    HeatmapLayoutArray: StructArrayLayout2i4,\r\n    LineLayoutArray: StructArrayLayout4i4ub12,\r\n    SymbolLayoutArray: StructArrayLayout4i4ui16,\r\n    SymbolDynamicLayoutArray: StructArrayLayout3f12,\r\n    SymbolOpacityArray: StructArrayLayout1ul4,\r\n    CollisionBoxLayoutArray: StructArrayLayout2i2i2i12,\r\n    CollisionCircleLayoutArray: StructArrayLayout2i2i2i12,\r\n    CollisionVertexArray: StructArrayLayout2ub4,\r\n    TriangleIndexArray: StructArrayLayout3ui6,\r\n    LineIndexArray: StructArrayLayout2ui4,\r\n    CollisionBoxArray,\r\n    PlacedSymbolArray,\r\n    GlyphOffsetArray,\r\n    SymbolLineVertexArray,\r\n    FeatureIndexArray\r\n};\r\n","// @flow\r\n\r\nconst assert = require('assert');\r\nconst Color = require('../util/color');\r\n\r\nconst {\r\n    NullType,\r\n    NumberType,\r\n    StringType,\r\n    BooleanType,\r\n    ColorType,\r\n    ObjectType,\r\n    ValueType,\r\n    array\r\n} = require('./types');\r\n\r\nimport type { Type } from './types';\r\n\r\nfunction validateRGBA(r: mixed, g: mixed, b: mixed, a?: mixed): ?string {\r\n    if (!(\r\n        typeof r === 'number' && r >= 0 && r <= 255 &&\r\n        typeof g === 'number' && g >= 0 && g <= 255 &&\r\n        typeof b === 'number' && b >= 0 && b <= 255\r\n    )) {\r\n        const value = typeof a === 'number' ? [r, g, b, a] : [r, g, b];\r\n        return `Invalid rgba value [${value.join(', ')}]: 'r', 'g', and 'b' must be between 0 and 255.`;\r\n    }\r\n\r\n    if (!(\r\n        typeof a === 'undefined' || (typeof a === 'number' && a >= 0 && a <= 1)\r\n    )) {\r\n        return `Invalid rgba value [${[r, g, b, a].join(', ')}]: 'a' must be between 0 and 1.`;\r\n    }\r\n\r\n    return null;\r\n}\r\n\r\nexport type Value = null | string | boolean | number | Color | $ReadOnlyArray<Value> | { +[string]: Value }\r\n\r\nfunction isValue(mixed: mixed): boolean {\r\n    if (mixed === null) {\r\n        return true;\r\n    } else if (typeof mixed === 'string') {\r\n        return true;\r\n    } else if (typeof mixed === 'boolean') {\r\n        return true;\r\n    } else if (typeof mixed === 'number') {\r\n        return true;\r\n    } else if (mixed instanceof Color) {\r\n        return true;\r\n    } else if (Array.isArray(mixed)) {\r\n        for (const item of mixed) {\r\n            if (!isValue(item)) {\r\n                return false;\r\n            }\r\n        }\r\n        return true;\r\n    } else if (typeof mixed === 'object') {\r\n        for (const key in mixed) {\r\n            if (!isValue(mixed[key])) {\r\n                return false;\r\n            }\r\n        }\r\n        return true;\r\n    } else {\r\n        return false;\r\n    }\r\n}\r\n\r\nfunction typeOf(value: Value): Type {\r\n    if (value === null) {\r\n        return NullType;\r\n    } else if (typeof value === 'string') {\r\n        return StringType;\r\n    } else if (typeof value === 'boolean') {\r\n        return BooleanType;\r\n    } else if (typeof value === 'number') {\r\n        return NumberType;\r\n    } else if (value instanceof Color) {\r\n        return ColorType;\r\n    } else if (Array.isArray(value)) {\r\n        const length = value.length;\r\n        let itemType: ?Type;\r\n\r\n        for (const item of value) {\r\n            const t = typeOf(item);\r\n            if (!itemType) {\r\n                itemType = t;\r\n            } else if (itemType === t) {\r\n                continue;\r\n            } else {\r\n                itemType = ValueType;\r\n                break;\r\n            }\r\n        }\r\n\r\n        return array(itemType || ValueType, length);\r\n    } else {\r\n        assert(typeof value === 'object');\r\n        return ObjectType;\r\n    }\r\n}\r\n\r\nmodule.exports = {\r\n    Color,\r\n    validateRGBA,\r\n    isValue,\r\n    typeOf\r\n};\r\n","\r\n// Turn jsonlint-lines-primitives objects into primitive objects\r\nfunction unbundle(value) {\r\n    if (value instanceof Number || value instanceof String || value instanceof Boolean) {\r\n        return value.valueOf();\r\n    } else {\r\n        return value;\r\n    }\r\n}\r\n\r\nfunction deepUnbundle(value) {\r\n    if (Array.isArray(value)) {\r\n        return value.map(deepUnbundle);\r\n    }\r\n    return unbundle(value);\r\n}\r\n\r\nmodule.exports = unbundle;\r\nmodule.exports.deep = deepUnbundle;\r\n","// @flow\r\n\r\nconst {parseCSSColor} = require('csscolorparser');\r\n\r\n/**\r\n * An RGBA color value. Create instances from color strings using the static\r\n * method `Color.parse`. The constructor accepts RGB channel values in the range\r\n * `[0, 1]`, premultiplied by A.\r\n *\r\n * @param {number} r The red channel.\r\n * @param {number} g The green channel.\r\n * @param {number} b The blue channel.\r\n * @param {number} a The alpha channel.\r\n */\r\nclass Color {\r\n    r: number;\r\n    g: number;\r\n    b: number;\r\n    a: number;\r\n\r\n    constructor(r: number, g: number, b: number, a: number = 1) {\r\n        this.r = r;\r\n        this.g = g;\r\n        this.b = b;\r\n        this.a = a;\r\n    }\r\n\r\n    static black: Color;\r\n    static white: Color;\r\n    static transparent: Color;\r\n\r\n    /**\r\n     * Parses valid CSS color strings and returns a `Color` instance.\r\n     * @returns A `Color` instance, or `undefined` if the input is not a valid color string.\r\n     */\r\n    static parse(input: ?string): Color | void {\r\n        if (!input) {\r\n            return undefined;\r\n        }\r\n\r\n        if (input instanceof Color) {\r\n            return input;\r\n        }\r\n\r\n        if (typeof input !== 'string') {\r\n            return undefined;\r\n        }\r\n\r\n        const rgba = parseCSSColor(input);\r\n        if (!rgba) {\r\n            return undefined;\r\n        }\r\n\r\n        return new Color(\r\n            rgba[0] / 255 * rgba[3],\r\n            rgba[1] / 255 * rgba[3],\r\n            rgba[2] / 255 * rgba[3],\r\n            rgba[3]\r\n        );\r\n    }\r\n\r\n    /**\r\n     * Returns an RGBA string representing the color value.\r\n     *\r\n     * @returns An RGBA string.\r\n     * @example\r\n     * var purple = new Color.parse('purple');\r\n     * purple.toString; // = \"rgba(128,0,128,1)\"\r\n     * var translucentGreen = new Color.parse('rgba(26, 207, 26, .73)');\r\n     * translucentGreen.toString(); // = \"rgba(26,207,26,0.73)\"\r\n     */\r\n    toString(): string {\r\n        const transformRgb = (value: number) => Math.round(value * 255 / this.a);\r\n        const rgb = [this.r, this.g, this.b].map(transformRgb);\r\n        return `rgba(${rgb.concat(this.a).join(',')})`;\r\n    }\r\n}\r\n\r\nColor.black = new Color(0, 0, 0, 1);\r\nColor.white = new Color(1, 1, 1, 1);\r\nColor.transparent = new Color(0, 0, 0, 0);\r\n\r\nmodule.exports = Color;\r\n","// @flow\r\n\r\nconst assert = require('assert');\r\nconst extend = require('../util/extend');\r\nconst ParsingError = require('./parsing_error');\r\nconst ParsingContext = require('./parsing_context');\r\nconst EvaluationContext = require('./evaluation_context');\r\nconst {CompoundExpression} = require('./compound_expression');\r\nconst Step = require('./definitions/step');\r\nconst Interpolate = require('./definitions/interpolate');\r\nconst Coalesce = require('./definitions/coalesce');\r\nconst Let = require('./definitions/let');\r\nconst definitions = require('./definitions');\r\nconst isConstant = require('./is_constant');\r\nconst RuntimeError = require('./runtime_error');\r\nconst {success, error} = require('../util/result');\r\n\r\nimport type {Type} from './types';\r\nimport type {Value} from './values';\r\nimport type {Expression} from './expression';\r\nimport type {StylePropertySpecification} from '../style-spec';\r\nimport type {Result} from '../util/result';\r\nimport type {InterpolationType} from './definitions/interpolate';\r\n\r\nexport type Feature = {\r\n    +type: 1 | 2 | 3 | 'Unknown' | 'Point' | 'MultiPoint' | 'LineString' | 'MultiLineString' | 'Polygon' | 'MultiPolygon',\r\n    +id?: any,\r\n    +properties: {[string]: any}\r\n};\r\n\r\nexport type GlobalProperties = {\r\n    zoom: number,\r\n    heatmapDensity?: number\r\n};\r\n\r\nclass StyleExpression {\r\n    expression: Expression;\r\n\r\n    _evaluator: EvaluationContext;\r\n\r\n    constructor(expression: Expression) {\r\n        this.expression = expression;\r\n    }\r\n\r\n    evaluate(globals: GlobalProperties, feature?: Feature): any {\r\n        if (!this._evaluator) {\r\n            this._evaluator = new EvaluationContext();\r\n        }\r\n\r\n        this._evaluator.globals = globals;\r\n        this._evaluator.feature = feature;\r\n        return this.expression.evaluate(this._evaluator);\r\n    }\r\n}\r\n\r\nclass StyleExpressionWithErrorHandling extends StyleExpression {\r\n    _defaultValue: Value;\r\n    _warningHistory: {[key: string]: boolean};\r\n    _enumValues: {[string]: any};\r\n\r\n    _evaluator: EvaluationContext;\r\n\r\n    constructor(expression: Expression, propertySpec: StylePropertySpecification) {\r\n        super(expression);\r\n        this._warningHistory = {};\r\n        this._defaultValue = getDefaultValue(propertySpec);\r\n        if (propertySpec.type === 'enum') {\r\n            this._enumValues = propertySpec.values;\r\n        }\r\n    }\r\n\r\n    evaluate(globals: GlobalProperties, feature?: Feature) {\r\n        if (!this._evaluator) {\r\n            this._evaluator = new EvaluationContext();\r\n        }\r\n\r\n        this._evaluator.globals = globals;\r\n        this._evaluator.feature = feature;\r\n\r\n        try {\r\n            const val = this.expression.evaluate(this._evaluator);\r\n            if (val === null || val === undefined) {\r\n                return this._defaultValue;\r\n            }\r\n            if (this._enumValues && !(val in this._enumValues)) {\r\n                throw new RuntimeError(`Expected value to be one of ${Object.keys(this._enumValues).map(v => JSON.stringify(v)).join(', ')}, but found ${JSON.stringify(val)} instead.`);\r\n            }\r\n            return val;\r\n        } catch (e) {\r\n            if (!this._warningHistory[e.message]) {\r\n                this._warningHistory[e.message] = true;\r\n                if (typeof console !== 'undefined') {\r\n                    console.warn(e.message);\r\n                }\r\n            }\r\n            return this._defaultValue;\r\n        }\r\n    }\r\n}\r\n\r\nfunction isExpression(expression: mixed) {\r\n    return Array.isArray(expression) && expression.length > 0 &&\r\n        typeof expression[0] === 'string' && expression[0] in definitions;\r\n}\r\n\r\n/**\r\n * Parse and typecheck the given style spec JSON expression.  If\r\n * options.defaultValue is provided, then the resulting StyleExpression's\r\n * `evaluate()` method will handle errors by logging a warning (once per\r\n * message) and returning the default value.  Otherwise, it will throw\r\n * evaluation errors.\r\n *\r\n * @private\r\n */\r\nfunction createExpression(expression: mixed,\r\n                          propertySpec: StylePropertySpecification,\r\n                          options: {handleErrors?: boolean} = {}): Result<StyleExpression, Array<ParsingError>> {\r\n    const parser = new ParsingContext(definitions, [], getExpectedType(propertySpec));\r\n    const parsed = parser.parse(expression);\r\n    if (!parsed) {\r\n        assert(parser.errors.length > 0);\r\n        return error(parser.errors);\r\n    }\r\n\r\n    if (options.handleErrors === false) {\r\n        return success(new StyleExpression(parsed));\r\n    } else {\r\n        return success(new StyleExpressionWithErrorHandling(parsed, propertySpec));\r\n    }\r\n}\r\n\r\nclass ZoomConstantExpression<Kind> {\r\n    kind: Kind;\r\n    _styleExpression: StyleExpression;\r\n    constructor(kind: Kind, expression: StyleExpression) {\r\n        this.kind = kind;\r\n        this._styleExpression = expression;\r\n    }\r\n    evaluate(globals: GlobalProperties, feature?: Feature): any {\r\n        return this._styleExpression.evaluate(globals, feature);\r\n    }\r\n}\r\n\r\nclass ZoomDependentExpression<Kind> {\r\n    kind: Kind;\r\n    zoomStops: Array<number>;\r\n\r\n    _styleExpression: StyleExpression;\r\n    _interpolationType: ?InterpolationType;\r\n\r\n    constructor(kind: Kind, expression: StyleExpression, zoomCurve: Step | Interpolate) {\r\n        this.kind = kind;\r\n        this.zoomStops = zoomCurve.labels;\r\n        this._styleExpression = expression;\r\n        if (zoomCurve instanceof Interpolate) {\r\n            this._interpolationType = zoomCurve.interpolation;\r\n        }\r\n    }\r\n\r\n    evaluate(globals: GlobalProperties, feature?: Feature): any {\r\n        return this._styleExpression.evaluate(globals, feature);\r\n    }\r\n\r\n    interpolationFactor(input: number, lower: number, upper: number): number {\r\n        if (this._interpolationType) {\r\n            return Interpolate.interpolationFactor(this._interpolationType, input, lower, upper);\r\n        } else {\r\n            return 0;\r\n        }\r\n    }\r\n}\r\n\r\nexport type ConstantExpression = {\r\n    kind: 'constant',\r\n    +evaluate: (globals: GlobalProperties, feature?: Feature) => any,\r\n}\r\n\r\nexport type SourceExpression = {\r\n    kind: 'source',\r\n    +evaluate: (globals: GlobalProperties, feature?: Feature) => any,\r\n};\r\n\r\nexport type CameraExpression = {\r\n    kind: 'camera',\r\n    +evaluate: (globals: GlobalProperties, feature?: Feature) => any,\r\n    +interpolationFactor: (input: number, lower: number, upper: number) => number,\r\n    zoomStops: Array<number>\r\n};\r\n\r\nexport type CompositeExpression = {\r\n    kind: 'composite',\r\n    +evaluate: (globals: GlobalProperties, feature?: Feature) => any,\r\n    +interpolationFactor: (input: number, lower: number, upper: number) => number,\r\n    zoomStops: Array<number>\r\n};\r\n\r\nexport type StylePropertyExpression =\r\n    | ConstantExpression\r\n    | SourceExpression\r\n    | CameraExpression\r\n    | CompositeExpression;\r\n\r\nfunction createPropertyExpression(expression: mixed,\r\n                                  propertySpec: StylePropertySpecification,\r\n                                  options: {handleErrors?: boolean} = {}): Result<StylePropertyExpression, Array<ParsingError>> {\r\n    expression = createExpression(expression, propertySpec, options);\r\n    if (expression.result === 'error') {\r\n        return expression;\r\n    }\r\n\r\n    const parsed = expression.value.expression;\r\n\r\n    const isFeatureConstant = isConstant.isFeatureConstant(parsed);\r\n    if (!isFeatureConstant && !propertySpec['property-function']) {\r\n        return error([new ParsingError('', 'property expressions not supported')]);\r\n    }\r\n\r\n    const isZoomConstant = isConstant.isGlobalPropertyConstant(parsed, ['zoom']);\r\n    if (!isZoomConstant && propertySpec['zoom-function'] === false) {\r\n        return error([new ParsingError('', 'zoom expressions not supported')]);\r\n    }\r\n\r\n    const zoomCurve = findZoomCurve(parsed);\r\n    if (!zoomCurve && !isZoomConstant) {\r\n        return error([new ParsingError('', '\"zoom\" expression may only be used as input to a top-level \"step\" or \"interpolate\" expression.')]);\r\n    } else if (zoomCurve instanceof ParsingError) {\r\n        return error([zoomCurve]);\r\n    } else if (zoomCurve instanceof Interpolate && propertySpec['function'] === 'piecewise-constant') {\r\n        return error([new ParsingError('', '\"interpolate\" expressions cannot be used with this property')]);\r\n    }\r\n\r\n    if (!zoomCurve) {\r\n        return success(isFeatureConstant ?\r\n            (new ZoomConstantExpression('constant', expression.value): ConstantExpression) :\r\n            (new ZoomConstantExpression('source', expression.value): SourceExpression));\r\n    }\r\n\r\n    return success(isFeatureConstant ?\r\n        (new ZoomDependentExpression('camera', expression.value, zoomCurve): CameraExpression) :\r\n        (new ZoomDependentExpression('composite', expression.value, zoomCurve): CompositeExpression));\r\n}\r\n\r\nconst {isFunction, createFunction} = require('../function');\r\nconst {Color} = require('./values');\r\n\r\n// serialization wrapper for old-style stop functions normalized to the\r\n// expression interface\r\nclass StylePropertyFunction<T> {\r\n    _parameters: PropertyValueSpecification<T>;\r\n    _specification: StylePropertySpecification;\r\n\r\n    kind: 'constant' | 'source' | 'camera' | 'composite';\r\n    evaluate: (globals: GlobalProperties, feature?: Feature) => any;\r\n    interpolationFactor: ?(input: number, lower: number, upper: number) => number;\r\n    zoomStops: ?Array<number>;\r\n\r\n    constructor(parameters: PropertyValueSpecification<T>, specification: StylePropertySpecification) {\r\n        this._parameters = parameters;\r\n        this._specification = specification;\r\n        extend(this, createFunction(this._parameters, this._specification));\r\n    }\r\n\r\n    static deserialize(serialized: {_parameters: PropertyValueSpecification<T>, _specification: StylePropertySpecification}) {\r\n        return ((new StylePropertyFunction(serialized._parameters, serialized._specification)): StylePropertyFunction<T>);\r\n    }\r\n\r\n    static serialize(input: StylePropertyFunction<T>) {\r\n        return {\r\n            _parameters: input._parameters,\r\n            _specification: input._specification\r\n        };\r\n    }\r\n}\r\n\r\nfunction normalizePropertyExpression<T>(value: PropertyValueSpecification<T>, specification: StylePropertySpecification): StylePropertyExpression {\r\n    if (isFunction(value)) {\r\n        return (new StylePropertyFunction(value, specification): any);\r\n\r\n    } else if (isExpression(value)) {\r\n        const expression = createPropertyExpression(value, specification);\r\n        if (expression.result === 'error') {\r\n            // this should have been caught in validation\r\n            throw new Error(expression.value.map(err => `${err.key}: ${err.message}`).join(', '));\r\n        }\r\n        return expression.value;\r\n\r\n    } else {\r\n        let constant: any = value;\r\n        if (typeof value === 'string' && specification.type === 'color') {\r\n            constant = Color.parse(value);\r\n        }\r\n        return {\r\n            kind: 'constant',\r\n            evaluate: () => constant\r\n        };\r\n    }\r\n}\r\n\r\nmodule.exports = {\r\n    StyleExpression,\r\n    StyleExpressionWithErrorHandling,\r\n    isExpression,\r\n    createExpression,\r\n    createPropertyExpression,\r\n    normalizePropertyExpression,\r\n    ZoomConstantExpression,\r\n    ZoomDependentExpression,\r\n    StylePropertyFunction\r\n};\r\n\r\n// Zoom-dependent expressions may only use [\"zoom\"] as the input to a top-level \"step\" or \"interpolate\"\r\n// expression (collectively referred to as a \"curve\"). The curve may be wrapped in one or more \"let\" or\r\n// \"coalesce\" expressions.\r\nfunction findZoomCurve(expression: Expression): Step | Interpolate | ParsingError | null {\r\n    let result = null;\r\n    if (expression instanceof Let) {\r\n        result = findZoomCurve(expression.result);\r\n\r\n    } else if (expression instanceof Coalesce) {\r\n        for (const arg of expression.args) {\r\n            result = findZoomCurve(arg);\r\n            if (result) {\r\n                break;\r\n            }\r\n        }\r\n\r\n    } else if ((expression instanceof Step || expression instanceof Interpolate) &&\r\n        expression.input instanceof CompoundExpression &&\r\n        expression.input.name === 'zoom') {\r\n\r\n        result = expression;\r\n    }\r\n\r\n    if (result instanceof ParsingError) {\r\n        return result;\r\n    }\r\n\r\n    expression.eachChild((child) => {\r\n        const childResult = findZoomCurve(child);\r\n        if (childResult instanceof ParsingError) {\r\n            result = childResult;\r\n        } else if (!result && childResult) {\r\n            result = new ParsingError('', '\"zoom\" expression may only be used as input to a top-level \"step\" or \"interpolate\" expression.');\r\n        } else if (result && childResult && result !== childResult) {\r\n            result = new ParsingError('', 'Only one zoom-based \"step\" or \"interpolate\" subexpression may be used in an expression.');\r\n        }\r\n    });\r\n\r\n    return result;\r\n}\r\n\r\nconst {\r\n    ColorType,\r\n    StringType,\r\n    NumberType,\r\n    BooleanType,\r\n    ValueType,\r\n    array\r\n} = require('./types');\r\n\r\nfunction getExpectedType(spec: StylePropertySpecification): Type | null {\r\n    const types = {\r\n        color: ColorType,\r\n        string: StringType,\r\n        number: NumberType,\r\n        enum: StringType,\r\n        boolean: BooleanType\r\n    };\r\n\r\n    if (spec.type === 'array') {\r\n        return array(types[spec.value] || ValueType, spec.length);\r\n    }\r\n\r\n    return types[spec.type] || null;\r\n}\r\n\r\nfunction getDefaultValue(spec: StylePropertySpecification): Value {\r\n    if (spec.type === 'color' && isFunction(spec.default)) {\r\n        // Special case for heatmap-color: it uses the 'default:' to define a\r\n        // default color ramp, but createExpression expects a simple value to fall\r\n        // back to in case of runtime errors\r\n        return new Color(0, 0, 0, 0);\r\n    } else if (spec.type === 'color') {\r\n        return Color.parse(spec.default) || null;\r\n    } else if (spec.default === undefined) {\r\n        return null;\r\n    } else {\r\n        return spec.default;\r\n    }\r\n}\r\n","// @flow\r\n\r\nclass RuntimeError {\r\n    name: string;\r\n    message: string;\r\n\r\n    constructor(message: string) {\r\n        this.name = 'ExpressionEvaluationError';\r\n        this.message = message;\r\n    }\r\n\r\n    toJSON() {\r\n        return this.message;\r\n    }\r\n}\r\n\r\nmodule.exports = RuntimeError;\r\n","\r\nconst extend = require('../util/extend');\r\nconst unbundle = require('../util/unbundle_jsonlint');\r\nconst {isExpression} = require('../expression');\r\nconst {isFunction} = require('../function');\r\n\r\n// Main recursive validation function. Tracks:\r\n//\r\n// - key: string representing location of validation in style tree. Used only\r\n//   for more informative error reporting.\r\n// - value: current value from style being evaluated. May be anything from a\r\n//   high level object that needs to be descended into deeper or a simple\r\n//   scalar value.\r\n// - valueSpec: current spec being evaluated. Tracks value.\r\n// - styleSpec: current full spec being evaluated.\r\n\r\nmodule.exports = function validate(options) {\r\n\r\n    const validateFunction = require('./validate_function');\r\n    const validateExpression = require('./validate_expression');\r\n    const validateObject = require('./validate_object');\r\n    const VALIDATORS = {\r\n        '*': function() {\r\n            return [];\r\n        },\r\n        'array': require('./validate_array'),\r\n        'boolean': require('./validate_boolean'),\r\n        'number': require('./validate_number'),\r\n        'color': require('./validate_color'),\r\n        'constants': require('./validate_constants'),\r\n        'enum': require('./validate_enum'),\r\n        'filter': require('./validate_filter'),\r\n        'function': require('./validate_function'),\r\n        'layer': require('./validate_layer'),\r\n        'object': require('./validate_object'),\r\n        'source': require('./validate_source'),\r\n        'light': require('./validate_light'),\r\n        'string': require('./validate_string')\r\n    };\r\n\r\n    const value = options.value;\r\n    const valueSpec = options.valueSpec;\r\n    const styleSpec = options.styleSpec;\r\n\r\n    if (valueSpec.function && isFunction(unbundle(value))) {\r\n        return validateFunction(options);\r\n\r\n    } else if (valueSpec.function && isExpression(unbundle.deep(value))) {\r\n        return validateExpression(options);\r\n\r\n    } else if (valueSpec.type && VALIDATORS[valueSpec.type]) {\r\n        return VALIDATORS[valueSpec.type](options);\r\n\r\n    } else {\r\n        return validateObject(extend({}, options, {\r\n            valueSpec: valueSpec.type ? styleSpec[valueSpec.type] : valueSpec\r\n        }));\r\n    }\r\n};\r\n","// @flow\r\n\r\n// Note: all \"sizes\" are measured in bytes\r\n\r\nconst assert = require('assert');\r\n\r\nimport type {Transferable} from '../types/transferable';\r\n\r\nconst viewTypes = {\r\n    'Int8': Int8Array,\r\n    'Uint8': Uint8Array,\r\n    'Int16': Int16Array,\r\n    'Uint16': Uint16Array,\r\n    'Int32': Int32Array,\r\n    'Uint32': Uint32Array,\r\n    'Float32': Float32Array\r\n};\r\n\r\nexport type ViewType = $Keys<typeof viewTypes>;\r\n\r\n/**\r\n * @private\r\n */\r\nclass Struct {\r\n    _pos1: number;\r\n    _pos2: number;\r\n    _pos4: number;\r\n    _pos8: number;\r\n    +_structArray: StructArray;\r\n\r\n    // The following properties are defined on the prototype of sub classes.\r\n    size: number;\r\n\r\n    /**\r\n     * @param {StructArray} structArray The StructArray the struct is stored in\r\n     * @param {number} index The index of the struct in the StructArray.\r\n     * @private\r\n     */\r\n    constructor(structArray: StructArray, index: number) {\r\n        (this: any)._structArray = structArray;\r\n        this._pos1 = index * this.size;\r\n        this._pos2 = this._pos1 / 2;\r\n        this._pos4 = this._pos1 / 4;\r\n        this._pos8 = this._pos1 / 8;\r\n    }\r\n}\r\n\r\nconst DEFAULT_CAPACITY = 128;\r\nconst RESIZE_MULTIPLIER = 5;\r\n\r\nexport type StructArrayMember = {\r\n    name: string,\r\n    type: ViewType,\r\n    components: number,\r\n    offset: number\r\n};\r\n\r\nexport type StructArrayLayout = {\r\n    members: Array<StructArrayMember>,\r\n    size: number,\r\n    alignment: ?number\r\n}\r\n\r\nexport type SerializedStructArray = {\r\n    length: number,\r\n    arrayBuffer: ArrayBuffer\r\n};\r\n\r\n/**\r\n * `StructArray` provides an abstraction over `ArrayBuffer` and `TypedArray`\r\n * making it behave like an array of typed structs.\r\n *\r\n * Conceptually, a StructArray is comprised of elements, i.e., instances of its\r\n * associated struct type. Each particular struct type, together with an\r\n * alignment size, determines the memory layout of a StructArray whose elements\r\n * are of that type.  Thus, for each such layout that we need, we have\r\n * a corrseponding StructArrayLayout class, inheriting from StructArray and\r\n * implementing `emplaceBack()` and `_refreshViews()`.\r\n *\r\n * In some cases, where we need to access particular elements of a StructArray,\r\n * we implement a more specific subclass that inherits from one of the\r\n * StructArrayLayouts and adds a `get(i): T` accessor that returns a structured\r\n * object whose properties are proxies into the underlying memory space for the\r\n * i-th element.  This affords the convience of working with (seemingly) plain\r\n * Javascript objects without the overhead of serializing/deserializing them\r\n * into ArrayBuffers for efficient web worker transfer.\r\n *\r\n * @private\r\n */\r\nclass StructArray {\r\n    capacity: number;\r\n    length: number;\r\n    isTransferred: boolean;\r\n    arrayBuffer: ArrayBuffer;\r\n    uint8: Uint8Array;\r\n\r\n    // The following properties are defined on the prototype.\r\n    members: Array<StructArrayMember>;\r\n    bytesPerElement: number;\r\n    +emplaceBack: Function;\r\n\r\n    constructor() {\r\n        this.isTransferred = false;\r\n        this.capacity = -1;\r\n        this.resize(0);\r\n    }\r\n\r\n    /**\r\n     * Serialize a StructArray instance.  Serializes both the raw data and the\r\n     * metadata needed to reconstruct the StructArray base class during\r\n     * deserialization.\r\n     */\r\n    static serialize(array: StructArray, transferables?: Array<Transferable>): SerializedStructArray {\r\n        assert(!array.isTransferred);\r\n\r\n        array._trim();\r\n\r\n        if (transferables) {\r\n            array.isTransferred = true;\r\n            transferables.push(array.arrayBuffer);\r\n        }\r\n\r\n        return {\r\n            length: array.length,\r\n            arrayBuffer: array.arrayBuffer,\r\n        };\r\n    }\r\n\r\n    static deserialize(input: SerializedStructArray) {\r\n        const structArray = Object.create(this.prototype);\r\n        structArray.arrayBuffer = input.arrayBuffer;\r\n        structArray.length = input.length;\r\n        structArray.capacity = input.arrayBuffer.byteLength / structArray.bytesPerElement;\r\n        structArray._refreshViews();\r\n        return structArray;\r\n    }\r\n\r\n    /**\r\n     * Resize the array to discard unused capacity.\r\n     */\r\n    _trim() {\r\n        if (this.length !== this.capacity) {\r\n            this.capacity = this.length;\r\n            this.arrayBuffer = this.arrayBuffer.slice(0, this.length * this.bytesPerElement);\r\n            this._refreshViews();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Resets the the length of the array to 0 without de-allocating capcacity.\r\n     */\r\n    clear() {\r\n        this.length = 0;\r\n    }\r\n\r\n    /**\r\n     * Resize the array.\r\n     * If `n` is greater than the current length then additional elements with undefined values are added.\r\n     * If `n` is less than the current length then the array will be reduced to the first `n` elements.\r\n     * @param {number} n The new size of the array.\r\n     */\r\n    resize(n: number) {\r\n        assert(!this.isTransferred);\r\n        this.reserve(n);\r\n        this.length = n;\r\n    }\r\n\r\n    /**\r\n     * Indicate a planned increase in size, so that any necessary allocation may\r\n     * be done once, ahead of time.\r\n     * @param {number} n The expected size of the array.\r\n     */\r\n    reserve(n: number) {\r\n        if (n > this.capacity) {\r\n            this.capacity = Math.max(n, Math.floor(this.capacity * RESIZE_MULTIPLIER), DEFAULT_CAPACITY);\r\n            this.arrayBuffer = new ArrayBuffer(this.capacity * this.bytesPerElement);\r\n\r\n            const oldUint8Array = this.uint8;\r\n            this._refreshViews();\r\n            if (oldUint8Array) this.uint8.set(oldUint8Array);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Create TypedArray views for the current ArrayBuffer.\r\n     */\r\n    _refreshViews() {\r\n        throw new Error('_refreshViews() must be implemented by each concrete StructArray layout');\r\n    }\r\n}\r\n\r\n/**\r\n * Given a list of member fields, create a full StructArrayLayout, in\r\n * particular calculating the correct byte offset for each field.  This data\r\n * is used at build time to generate StructArrayLayout_*#emplaceBack() and\r\n * other accessors, and at runtime for binding vertex buffer attributes.\r\n *\r\n * @private\r\n */\r\nfunction createLayout(\r\n    members: Array<{ name: string, type: ViewType, +components?: number, }>,\r\n    alignment: number = 1\r\n): StructArrayLayout {\r\n\r\n    let offset = 0;\r\n    let maxSize = 0;\r\n    const layoutMembers = members.map((member) => {\r\n        assert(member.name.length);\r\n        const typeSize = sizeOf(member.type);\r\n        const memberOffset = offset = align(offset, Math.max(alignment, typeSize));\r\n        const components = member.components || 1;\r\n\r\n        maxSize = Math.max(maxSize, typeSize);\r\n        offset += typeSize * components;\r\n\r\n        return {\r\n            name: member.name,\r\n            type: member.type,\r\n            components: components,\r\n            offset: memberOffset,\r\n        };\r\n    });\r\n\r\n    const size = align(offset, Math.max(maxSize, alignment));\r\n\r\n    return {\r\n        members: layoutMembers,\r\n        size,\r\n        alignment\r\n    };\r\n}\r\n\r\nfunction sizeOf(type: ViewType): number {\r\n    return viewTypes[type].BYTES_PER_ELEMENT;\r\n}\r\n\r\nfunction align(offset: number, size: number): number {\r\n    return Math.ceil(offset / size) * size;\r\n}\r\n\r\nmodule.exports.StructArray = StructArray;\r\nmodule.exports.Struct = Struct;\r\nmodule.exports.viewTypes = viewTypes;\r\nmodule.exports.createLayout = createLayout;\r\n","// @flow\r\n\r\n/**\r\n * The maximum value of a coordinate in the internal tile coordinate system. Coordinates of\r\n * all source features normalized to this extent upon load.\r\n *\r\n * The value is a consequence of the following:\r\n *\r\n * * Vertex buffer store positions as signed 16 bit integers.\r\n * * One bit is lost for signedness to support tile buffers.\r\n * * One bit is lost because the line vertex buffer used to pack 1 bit of other data into the int.\r\n *   This is no longer the case but we're reserving this bit anyway.\r\n * * One bit is lost to support features extending past the extent on the right edge of the tile.\r\n * * This leaves us with 2^13 = 8192\r\n *\r\n * @private\r\n * @readonly\r\n */\r\nmodule.exports = 8192;\r\n","// @flow\r\n\r\nconst Color = require('./color');\r\n\r\nmodule.exports = {\r\n    number,\r\n    color,\r\n    array\r\n};\r\n\r\nfunction number(a: number, b: number, t: number) {\r\n    return (a * (1 - t)) + (b * t);\r\n}\r\n\r\nfunction color(from: Color, to: Color, t: number) {\r\n    return new Color(\r\n        number(from.r, to.r, t),\r\n        number(from.g, to.g, t),\r\n        number(from.b, to.b, t),\r\n        number(from.a, to.a, t)\r\n    );\r\n}\r\n\r\nfunction array(from: Array<number>, to: Array<number>, t: number) {\r\n    return from.map((d, i) => {\r\n        return number(d, to[i], t);\r\n    });\r\n}\r\n","// @flow\r\n\r\nconst util = require('../util/util');\r\nconst EXTENT = require('./extent');\r\n\r\nimport type Point from '@mapbox/point-geometry';\r\n\r\n// These bounds define the minimum and maximum supported coordinate values.\r\n// While visible coordinates are within [0, EXTENT], tiles may theoretically\r\n// contain cordinates within [-Infinity, Infinity]. Our range is limited by the\r\n// number of bits used to represent the coordinate.\r\nfunction createBounds(bits) {\r\n    return {\r\n        min: -1 * Math.pow(2, bits - 1),\r\n        max: Math.pow(2, bits - 1) - 1\r\n    };\r\n}\r\n\r\nconst bounds = createBounds(16);\r\n\r\n/**\r\n * Loads a geometry from a VectorTileFeature and scales it to the common extent\r\n * used internally.\r\n * @param {VectorTileFeature} feature\r\n * @private\r\n */\r\nmodule.exports = function loadGeometry(feature: VectorTileFeature): Array<Array<Point>> {\r\n    const scale = EXTENT / feature.extent;\r\n    const geometry = feature.loadGeometry();\r\n    for (let r = 0; r < geometry.length; r++) {\r\n        const ring = geometry[r];\r\n        for (let p = 0; p < ring.length; p++) {\r\n            const point = ring[p];\r\n            // round here because mapbox-gl-native uses integers to represent\r\n            // points and we need to do the same to avoid renering differences.\r\n            point.x = Math.round(point.x * scale);\r\n            point.y = Math.round(point.y * scale);\r\n\r\n            if (point.x < bounds.min || point.x > bounds.max || point.y < bounds.min || point.y > bounds.max) {\r\n                util.warnOnce('Geometry exceeds allowed extent, reduce your vector tile buffer size');\r\n            }\r\n        }\r\n    }\r\n    return geometry;\r\n};\r\n","module.exports.VectorTile = require('./lib/vectortile.js');\nmodule.exports.VectorTileFeature = require('./lib/vectortilefeature.js');\nmodule.exports.VectorTileLayer = require('./lib/vectortilelayer.js');\n","\r\nmodule.exports = function (output, ...inputs) {\r\n    for (const input of inputs) {\r\n        for (const k in input) {\r\n            output[k] = input[k];\r\n        }\r\n    }\r\n    return output;\r\n};\r\n","// @flow\r\n\r\nconst { toString } = require('./types');\r\nconst ParsingContext = require('./parsing_context');\r\nconst EvaluationContext = require('./evaluation_context');\r\nconst assert = require('assert');\r\n\r\nimport type { Expression, ExpressionRegistry } from './expression';\r\nimport type { Type } from './types';\r\nimport type { Value } from './values';\r\n\r\ntype Varargs = {| type: Type |};\r\ntype Signature = Array<Type> | Varargs;\r\ntype Evaluate = (EvaluationContext, Array<Expression>) => Value;\r\ntype Definition = [Type, Signature, Evaluate] |\r\n    {|type: Type, overloads: Array<[Signature, Evaluate]>|};\r\n\r\nclass CompoundExpression implements Expression {\r\n    name: string;\r\n    type: Type;\r\n    _evaluate: Evaluate;\r\n    args: Array<Expression>;\r\n\r\n    static definitions: { [string]: Definition };\r\n\r\n    constructor(name: string, type: Type, evaluate: Evaluate, args: Array<Expression>) {\r\n        this.name = name;\r\n        this.type = type;\r\n        this._evaluate = evaluate;\r\n        this.args = args;\r\n    }\r\n\r\n    evaluate(ctx: EvaluationContext) {\r\n        return this._evaluate(ctx, this.args);\r\n    }\r\n\r\n    eachChild(fn: (Expression) => void) {\r\n        this.args.forEach(fn);\r\n    }\r\n\r\n    possibleOutputs() {\r\n        return [undefined];\r\n    }\r\n\r\n    static parse(args: Array<mixed>, context: ParsingContext): ?Expression {\r\n        const op: string = (args[0]: any);\r\n        const definition = CompoundExpression.definitions[op];\r\n        if (!definition) {\r\n            return context.error(`Unknown expression \"${op}\". If you wanted a literal array, use [\"literal\", [...]].`, 0);\r\n        }\r\n\r\n        // Now check argument types against each signature\r\n        const type = Array.isArray(definition) ?\r\n            definition[0] : definition.type;\r\n\r\n        const availableOverloads = Array.isArray(definition) ?\r\n            [[definition[1], definition[2]]] :\r\n            definition.overloads;\r\n\r\n        const overloads = availableOverloads.filter(([signature]) => (\r\n            !Array.isArray(signature) || // varags\r\n            signature.length === args.length - 1 // correct param count\r\n        ));\r\n\r\n        // First parse all the args\r\n        const parsedArgs: Array<Expression> = [];\r\n        for (let i = 1; i < args.length; i++) {\r\n            const arg = args[i];\r\n            let expected;\r\n            if (overloads.length === 1) {\r\n                const params = overloads[0][0];\r\n                expected = Array.isArray(params) ?\r\n                    params[i - 1] :\r\n                    params.type;\r\n            }\r\n            const parsed = context.parse(arg, 1 + parsedArgs.length, expected);\r\n            if (!parsed) return null;\r\n            parsedArgs.push(parsed);\r\n        }\r\n\r\n        let signatureContext: ParsingContext = (null: any);\r\n\r\n        for (const [params, evaluate] of overloads) {\r\n            // Use a fresh context for each attempted signature so that, if\r\n            // we eventually succeed, we haven't polluted `context.errors`.\r\n            signatureContext = new ParsingContext(context.registry, context.path, null, context.scope);\r\n\r\n            if (Array.isArray(params)) {\r\n                if (params.length !== parsedArgs.length) {\r\n                    signatureContext.error(`Expected ${params.length} arguments, but found ${parsedArgs.length} instead.`);\r\n                    continue;\r\n                }\r\n            }\r\n\r\n            for (let i = 0; i < parsedArgs.length; i++) {\r\n                const expected = Array.isArray(params) ? params[i] : params.type;\r\n                const arg = parsedArgs[i];\r\n                signatureContext.concat(i + 1).checkSubtype(expected, arg.type);\r\n            }\r\n\r\n            if (signatureContext.errors.length === 0) {\r\n                return new CompoundExpression(op, type, evaluate, parsedArgs);\r\n            }\r\n        }\r\n\r\n        assert(!signatureContext || signatureContext.errors.length > 0);\r\n\r\n        if (overloads.length === 1) {\r\n            context.errors.push.apply(context.errors, signatureContext.errors);\r\n        } else {\r\n            const expected = overloads.length ? overloads : availableOverloads;\r\n            const signatures = expected\r\n                .map(([params]) => stringifySignature(params))\r\n                .join(' | ');\r\n            const actualTypes = parsedArgs\r\n                .map(arg => toString(arg.type))\r\n                .join(', ');\r\n            context.error(`Expected arguments of type ${signatures}, but found (${actualTypes}) instead.`);\r\n        }\r\n\r\n        return null;\r\n    }\r\n\r\n    static register(\r\n        registry: ExpressionRegistry,\r\n        definitions: { [string]: Definition }\r\n    ) {\r\n        assert(!CompoundExpression.definitions);\r\n        CompoundExpression.definitions = definitions;\r\n        for (const name in definitions) {\r\n            registry[name] = CompoundExpression;\r\n        }\r\n    }\r\n}\r\n\r\nfunction varargs(type: Type): Varargs {\r\n    return { type };\r\n}\r\n\r\nfunction stringifySignature(signature: Signature): string {\r\n    if (Array.isArray(signature)) {\r\n        return `(${signature.map(toString).join(', ')})`;\r\n    } else {\r\n        return `(${toString(signature.type)}...)`;\r\n    }\r\n}\r\n\r\nmodule.exports = {\r\n    CompoundExpression,\r\n    varargs\r\n};\r\n\r\n","\r\nconst ValidationError = require('../error/validation_error');\r\nconst getType = require('../util/get_type');\r\nconst validateSpec = require('./validate');\r\n\r\nmodule.exports = function validateObject(options) {\r\n    const key = options.key;\r\n    const object = options.value;\r\n    const elementSpecs = options.valueSpec || {};\r\n    const elementValidators = options.objectElementValidators || {};\r\n    const style = options.style;\r\n    const styleSpec = options.styleSpec;\r\n    let errors = [];\r\n\r\n    const type = getType(object);\r\n    if (type !== 'object') {\r\n        return [new ValidationError(key, object, `object expected, ${type} found`)];\r\n    }\r\n\r\n    for (const objectKey in object) {\r\n        const elementSpecKey = objectKey.split('.')[0]; // treat 'paint.*' as 'paint'\r\n        const elementSpec = elementSpecs[elementSpecKey] || elementSpecs['*'];\r\n\r\n        let validateElement;\r\n        if (elementValidators[elementSpecKey]) {\r\n            validateElement = elementValidators[elementSpecKey];\r\n        } else if (elementSpecs[elementSpecKey]) {\r\n            validateElement = validateSpec;\r\n        } else if (elementValidators['*']) {\r\n            validateElement = elementValidators['*'];\r\n        } else if (elementSpecs['*']) {\r\n            validateElement = validateSpec;\r\n        } else {\r\n            errors.push(new ValidationError(key, object[objectKey], `unknown property \"${objectKey}\"`));\r\n            continue;\r\n        }\r\n\r\n        errors = errors.concat(validateElement({\r\n            key: (key ? `${key}.` : key) + objectKey,\r\n            value: object[objectKey],\r\n            valueSpec: elementSpec,\r\n            style: style,\r\n            styleSpec: styleSpec,\r\n            object: object,\r\n            objectKey: objectKey\r\n        }, object));\r\n    }\r\n\r\n    for (const elementSpecKey in elementSpecs) {\r\n        // Don't check `required` when there's a custom validator for that property.\r\n        if (elementValidators[elementSpecKey]) {\r\n            continue;\r\n        }\r\n\r\n        if (elementSpecs[elementSpecKey].required && elementSpecs[elementSpecKey]['default'] === undefined && object[elementSpecKey] === undefined) {\r\n            errors.push(new ValidationError(key, object, `missing required property \"${elementSpecKey}\"`));\r\n        }\r\n    }\r\n\r\n    return errors;\r\n};\r\n","// @flow\r\n\r\nconst {warnOnce} = require('../util/util');\r\nconst {register} = require('../util/web_worker_transfer');\r\n\r\nimport type VertexArrayObject from '../render/vertex_array_object';\r\nimport type {StructArray} from '../util/struct_array';\r\n\r\nconst MAX_VERTEX_ARRAY_LENGTH = Math.pow(2, 16) - 1;\r\n\r\nexport type Segment = {\r\n    vertexOffset: number,\r\n    primitiveOffset: number,\r\n    vertexLength: number,\r\n    primitiveLength: number,\r\n    vaos: {[string]: VertexArrayObject}\r\n}\r\n\r\nclass SegmentVector {\r\n    segments: Array<Segment>;\r\n\r\n    constructor(segments?: Array<Segment> = []) {\r\n        this.segments = segments;\r\n    }\r\n\r\n    prepareSegment(numVertices: number, layoutVertexArray: StructArray, indexArray: StructArray): Segment {\r\n        let segment: Segment = this.segments[this.segments.length - 1];\r\n        if (numVertices > MAX_VERTEX_ARRAY_LENGTH) warnOnce(`Max vertices per segment is ${MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${numVertices}`);\r\n        if (!segment || segment.vertexLength + numVertices > module.exports.MAX_VERTEX_ARRAY_LENGTH) {\r\n            segment = ({\r\n                vertexOffset: layoutVertexArray.length,\r\n                primitiveOffset: indexArray.length,\r\n                vertexLength: 0,\r\n                primitiveLength: 0\r\n            }: any);\r\n            this.segments.push(segment);\r\n        }\r\n        return segment;\r\n    }\r\n\r\n    get() {\r\n        return this.segments;\r\n    }\r\n\r\n    destroy() {\r\n        for (const segment of this.segments) {\r\n            for (const k in segment.vaos) {\r\n                segment.vaos[k].destroy();\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nregister('SegmentVector', SegmentVector);\r\n\r\nmodule.exports = {\r\n    SegmentVector,\r\n\r\n    /**\r\n     * The maximum size of a vertex array. This limit is imposed by WebGL's 16 bit\r\n     * addressing of vertex buffers.\r\n     * @private\r\n     * @readonly\r\n     */\r\n    MAX_VERTEX_ARRAY_LENGTH: MAX_VERTEX_ARRAY_LENGTH\r\n};\r\n","// @flow\r\n\r\nimport type {GlobalProperties} from \"../style-spec/expression/index\";\r\n\r\nconst packUint8ToFloat = require('../shaders/encode_attribute').packUint8ToFloat;\r\nconst Color = require('../style-spec/util/color');\r\nconst {register} = require('../util/web_worker_transfer');\r\nconst {PossiblyEvaluatedPropertyValue} = require('../style/properties');\r\nconst {\r\n    StructArrayLayout1f4,\r\n    StructArrayLayout2f8,\r\n    StructArrayLayout4f16\r\n} = require('./array_types');\r\n\r\nimport type Context from '../gl/context';\r\nimport type {TypedStyleLayer} from '../style/style_layer/typed_style_layer';\r\nimport type {StructArray, StructArrayMember} from '../util/struct_array';\r\nimport type VertexBuffer from '../gl/vertex_buffer';\r\nimport type Program from '../render/program';\r\nimport type {Feature, SourceExpression, CompositeExpression} from '../style-spec/expression';\r\nimport type {PossiblyEvaluated} from '../style/properties';\r\n\r\nfunction packColor(color: Color): [number, number] {\r\n    return [\r\n        packUint8ToFloat(255 * color.r, 255 * color.g),\r\n        packUint8ToFloat(255 * color.b, 255 * color.a)\r\n    ];\r\n}\r\n\r\n/**\r\n *  `Binder` is the interface definition for the strategies for constructing,\r\n *  uploading, and binding paint property data as GLSL attributes.\r\n *\r\n *  It has three implementations, one for each of the three strategies we use:\r\n *\r\n *  * For _constant_ properties -- those whose value is a constant, or the constant\r\n *    result of evaluating a camera expression at a particular camera position -- we\r\n *    don't need a vertex buffer, and instead use a uniform.\r\n *  * For data expressions, we use a vertex buffer with a single attribute value,\r\n *    the evaluated result of the source function for the given feature.\r\n *  * For composite expressions, we use a vertex buffer with two attributes: min and\r\n *    max values covering the range of zooms at which we expect the tile to be\r\n *    displayed. These values are calculated by evaluating the composite expression for\r\n *    the given feature at strategically chosen zoom levels. In addition to this\r\n *    attribute data, we also use a uniform value which the shader uses to interpolate\r\n *    between the min and max value at the final displayed zoom level. The use of a\r\n *    uniform allows us to cheaply update the value on every frame.\r\n *\r\n *  Note that the shader source varies depending on whether we're using a uniform or\r\n *  attribute. We dynamically compile shaders at runtime to accomodate this.\r\n *\r\n * @private\r\n */\r\ninterface Binder<T> {\r\n    statistics: { max: number };\r\n\r\n    populatePaintArray(length: number, feature: Feature): void;\r\n    upload(Context): void;\r\n    destroy(): void;\r\n\r\n    defines(): Array<string>;\r\n\r\n    setUniforms(context: Context,\r\n                program: Program,\r\n                globals: GlobalProperties,\r\n                currentValue: PossiblyEvaluatedPropertyValue<T>): void;\r\n}\r\n\r\nclass ConstantBinder<T> implements Binder<T> {\r\n    value: T;\r\n    name: string;\r\n    type: string;\r\n    statistics: { max: number };\r\n\r\n    constructor(value: T, name: string, type: string) {\r\n        this.value = value;\r\n        this.name = name;\r\n        this.type = type;\r\n        this.statistics = { max: -Infinity };\r\n    }\r\n\r\n    defines() {\r\n        return [`#define HAS_UNIFORM_u_${this.name}`];\r\n    }\r\n\r\n    populatePaintArray() {}\r\n    upload() {}\r\n    destroy() {}\r\n\r\n    setUniforms(context: Context,\r\n                program: Program,\r\n                globals: GlobalProperties,\r\n                currentValue: PossiblyEvaluatedPropertyValue<T>) {\r\n        const value: any = currentValue.constantOr(this.value);\r\n        const gl = context.gl;\r\n        if (this.type === 'color') {\r\n            gl.uniform4f(program.uniforms[`u_${this.name}`], value.r, value.g, value.b, value.a);\r\n        } else {\r\n            gl.uniform1f(program.uniforms[`u_${this.name}`], value);\r\n        }\r\n    }\r\n}\r\n\r\nclass SourceExpressionBinder<T> implements Binder<T> {\r\n    expression: SourceExpression;\r\n    name: string;\r\n    type: string;\r\n    statistics: { max: number };\r\n\r\n    paintVertexArray: StructArray;\r\n    paintVertexAttributes: Array<StructArrayMember>;\r\n    paintVertexBuffer: ?VertexBuffer;\r\n\r\n    constructor(expression: SourceExpression, name: string, type: string) {\r\n        this.expression = expression;\r\n        this.name = name;\r\n        this.type = type;\r\n        this.statistics = { max: -Infinity };\r\n        const PaintVertexArray = type === 'color' ? StructArrayLayout2f8 : StructArrayLayout1f4;\r\n        this.paintVertexAttributes = [{\r\n            name: `a_${name}`,\r\n            type: 'Float32',\r\n            components: type === 'color' ? 2 : 1,\r\n            offset: 0\r\n        }];\r\n        this.paintVertexArray = new PaintVertexArray();\r\n    }\r\n\r\n    defines() {\r\n        return [];\r\n    }\r\n\r\n    populatePaintArray(length: number, feature: Feature) {\r\n        const paintArray = this.paintVertexArray;\r\n\r\n        const start = paintArray.length;\r\n        paintArray.reserve(length);\r\n\r\n        const value = this.expression.evaluate({zoom: 0}, feature);\r\n\r\n        if (this.type === 'color') {\r\n            const color = packColor(value);\r\n            for (let i = start; i < length; i++) {\r\n                paintArray.emplaceBack(color[0], color[1]);\r\n            }\r\n        } else {\r\n            for (let i = start; i < length; i++) {\r\n                paintArray.emplaceBack(value);\r\n            }\r\n\r\n            this.statistics.max = Math.max(this.statistics.max, value);\r\n        }\r\n    }\r\n\r\n    upload(context: Context) {\r\n        if (this.paintVertexArray) {\r\n            this.paintVertexBuffer = context.createVertexBuffer(this.paintVertexArray, this.paintVertexAttributes);\r\n        }\r\n    }\r\n\r\n    destroy() {\r\n        if (this.paintVertexBuffer) {\r\n            this.paintVertexBuffer.destroy();\r\n        }\r\n    }\r\n\r\n    setUniforms(context: Context, program: Program) {\r\n        context.gl.uniform1f(program.uniforms[`a_${this.name}_t`], 0);\r\n    }\r\n}\r\n\r\nclass CompositeExpressionBinder<T> implements Binder<T> {\r\n    expression: CompositeExpression;\r\n    name: string;\r\n    type: string;\r\n    useIntegerZoom: boolean;\r\n    zoom: number;\r\n    statistics: { max: number };\r\n\r\n    paintVertexArray: StructArray;\r\n    paintVertexAttributes: Array<StructArrayMember>;\r\n    paintVertexBuffer: ?VertexBuffer;\r\n\r\n    constructor(expression: CompositeExpression, name: string, type: string, useIntegerZoom: boolean, zoom: number) {\r\n        this.expression = expression;\r\n        this.name = name;\r\n        this.type = type;\r\n        this.useIntegerZoom = useIntegerZoom;\r\n        this.zoom = zoom;\r\n        this.statistics = { max: -Infinity };\r\n        const PaintVertexArray = type === 'color' ? StructArrayLayout4f16 : StructArrayLayout2f8;\r\n        this.paintVertexAttributes = [{\r\n            name: `a_${name}`,\r\n            type: 'Float32',\r\n            components: type === 'color' ? 4 : 2,\r\n            offset: 0\r\n        }];\r\n        this.paintVertexArray = new PaintVertexArray();\r\n    }\r\n\r\n    defines() {\r\n        return [];\r\n    }\r\n\r\n    populatePaintArray(length: number, feature: Feature) {\r\n        const paintArray = this.paintVertexArray;\r\n\r\n        const start = paintArray.length;\r\n        paintArray.reserve(length);\r\n\r\n        const min = this.expression.evaluate({zoom: this.zoom    }, feature);\r\n        const max = this.expression.evaluate({zoom: this.zoom + 1}, feature);\r\n\r\n        if (this.type === 'color') {\r\n            const minColor = packColor(min);\r\n            const maxColor = packColor(max);\r\n            for (let i = start; i < length; i++) {\r\n                paintArray.emplaceBack(minColor[0], minColor[1], maxColor[0], maxColor[1]);\r\n            }\r\n        } else {\r\n            for (let i = start; i < length; i++) {\r\n                paintArray.emplaceBack(min, max);\r\n            }\r\n\r\n            this.statistics.max = Math.max(this.statistics.max, min, max);\r\n        }\r\n    }\r\n\r\n    upload(context: Context) {\r\n        if (this.paintVertexArray) {\r\n            this.paintVertexBuffer = context.createVertexBuffer(this.paintVertexArray, this.paintVertexAttributes);\r\n        }\r\n    }\r\n\r\n    destroy() {\r\n        if (this.paintVertexBuffer) {\r\n            this.paintVertexBuffer.destroy();\r\n        }\r\n    }\r\n\r\n    interpolationFactor(currentZoom: number) {\r\n        if (this.useIntegerZoom) {\r\n            return this.expression.interpolationFactor(Math.floor(currentZoom), this.zoom, this.zoom + 1);\r\n        } else {\r\n            return this.expression.interpolationFactor(currentZoom, this.zoom, this.zoom + 1);\r\n        }\r\n    }\r\n\r\n    setUniforms(context: Context, program: Program, globals: GlobalProperties) {\r\n        context.gl.uniform1f(program.uniforms[`a_${this.name}_t`], this.interpolationFactor(globals.zoom));\r\n    }\r\n}\r\n\r\n/**\r\n * ProgramConfiguration contains the logic for binding style layer properties and tile\r\n * layer feature data into GL program uniforms and vertex attributes.\r\n *\r\n * Non-data-driven property values are bound to shader uniforms. Data-driven property\r\n * values are bound to vertex attributes. In order to support a uniform GLSL syntax over\r\n * both, [Mapbox GL Shaders](https://github.com/mapbox/mapbox-gl-shaders) defines a `#pragma`\r\n * abstraction, which ProgramConfiguration is responsible for implementing. At runtime,\r\n * it examines the attributes of a particular layer, combines this with fixed knowledge\r\n * about how layers of the particular type are implemented, and determines which uniforms\r\n * and vertex attributes will be required. It can then substitute the appropriate text\r\n * into the shader source code, create and link a program, and bind the uniforms and\r\n * vertex attributes in preparation for drawing.\r\n *\r\n * When a vector tile is parsed, this same configuration information is used to\r\n * populate the attribute buffers needed for data-driven styling using the zoom\r\n * level and feature property data.\r\n *\r\n * @private\r\n */\r\nclass ProgramConfiguration {\r\n    binders: { [string]: Binder<any> };\r\n    cacheKey: string;\r\n    layoutAttributes: Array<StructArrayMember>;\r\n\r\n    _buffers: Array<VertexBuffer>;\r\n\r\n    constructor() {\r\n        this.binders = {};\r\n        this.cacheKey = '';\r\n\r\n        this._buffers = [];\r\n    }\r\n\r\n    static createDynamic<Layer: TypedStyleLayer>(layer: Layer, zoom: number, filterProperties: (string) => boolean) {\r\n        const self = new ProgramConfiguration();\r\n        const keys = [];\r\n\r\n        for (const property in layer.paint._values) {\r\n            if (!filterProperties(property)) continue;\r\n            const value = layer.paint.get(property);\r\n            if (!(value instanceof PossiblyEvaluatedPropertyValue) || !value.property.specification['property-function']) {\r\n                continue;\r\n            }\r\n            const name = paintAttributeName(property, layer.type);\r\n            const type = value.property.specification.type;\r\n            const useIntegerZoom = value.property.useIntegerZoom;\r\n\r\n            if (value.value.kind === 'constant') {\r\n                self.binders[property] = new ConstantBinder(value.value, name, type);\r\n                keys.push(`/u_${name}`);\r\n            } else if (value.value.kind === 'source') {\r\n                self.binders[property] = new SourceExpressionBinder(value.value, name, type);\r\n                keys.push(`/a_${name}`);\r\n            } else {\r\n                self.binders[property] = new CompositeExpressionBinder(value.value, name, type, useIntegerZoom, zoom);\r\n                keys.push(`/z_${name}`);\r\n            }\r\n        }\r\n\r\n        self.cacheKey = keys.sort().join('');\r\n\r\n        return self;\r\n    }\r\n\r\n    populatePaintArrays(length: number, feature: Feature) {\r\n        for (const property in this.binders) {\r\n            this.binders[property].populatePaintArray(length, feature);\r\n        }\r\n    }\r\n\r\n    defines(): Array<string> {\r\n        const result = [];\r\n        for (const property in this.binders) {\r\n            result.push.apply(result, this.binders[property].defines());\r\n        }\r\n        return result;\r\n    }\r\n\r\n    setUniforms<Properties: Object>(context: Context, program: Program, properties: PossiblyEvaluated<Properties>, globals: GlobalProperties) {\r\n        for (const property in this.binders) {\r\n            const binder = this.binders[property];\r\n            binder.setUniforms(context, program, globals, properties.get(property));\r\n        }\r\n    }\r\n\r\n    getPaintVertexBuffers(): Array<VertexBuffer> {\r\n        return this._buffers;\r\n    }\r\n\r\n    upload(context: Context) {\r\n        for (const property in this.binders) {\r\n            this.binders[property].upload(context);\r\n        }\r\n\r\n        const buffers = [];\r\n        for (const property in this.binders) {\r\n            const binder = this.binders[property];\r\n            if ((binder instanceof SourceExpressionBinder ||\r\n                binder instanceof CompositeExpressionBinder) &&\r\n                binder.paintVertexBuffer\r\n            ) {\r\n                buffers.push(binder.paintVertexBuffer);\r\n            }\r\n        }\r\n        this._buffers = buffers;\r\n    }\r\n\r\n    destroy() {\r\n        for (const property in this.binders) {\r\n            this.binders[property].destroy();\r\n        }\r\n    }\r\n}\r\n\r\nclass ProgramConfigurationSet<Layer: TypedStyleLayer> {\r\n    programConfigurations: {[string]: ProgramConfiguration};\r\n\r\n    constructor(layoutAttributes: Array<StructArrayMember>, layers: $ReadOnlyArray<Layer>, zoom: number, filterProperties: (string) => boolean = () => true) {\r\n        this.programConfigurations = {};\r\n        for (const layer of layers) {\r\n            this.programConfigurations[layer.id] = ProgramConfiguration.createDynamic(layer, zoom, filterProperties);\r\n            this.programConfigurations[layer.id].layoutAttributes = layoutAttributes;\r\n        }\r\n    }\r\n\r\n    populatePaintArrays(length: number, feature: Feature) {\r\n        for (const key in this.programConfigurations) {\r\n            this.programConfigurations[key].populatePaintArrays(length, feature);\r\n        }\r\n    }\r\n\r\n    get(layerId: string) {\r\n        return this.programConfigurations[layerId];\r\n    }\r\n\r\n    upload(context: Context) {\r\n        for (const layerId in this.programConfigurations) {\r\n            this.programConfigurations[layerId].upload(context);\r\n        }\r\n    }\r\n\r\n    destroy() {\r\n        for (const layerId in this.programConfigurations) {\r\n            this.programConfigurations[layerId].destroy();\r\n        }\r\n    }\r\n}\r\n\r\n// paint property arrays\r\nfunction paintAttributeName(property, type) {\r\n    const attributeNameExceptions = {\r\n        'text-opacity': 'opacity',\r\n        'icon-opacity': 'opacity',\r\n        'text-color': 'fill_color',\r\n        'icon-color': 'fill_color',\r\n        'text-halo-color': 'halo_color',\r\n        'icon-halo-color': 'halo_color',\r\n        'text-halo-blur': 'halo_blur',\r\n        'icon-halo-blur': 'halo_blur',\r\n        'text-halo-width': 'halo_width',\r\n        'icon-halo-width': 'halo_width',\r\n        'line-gap-width': 'gapwidth'\r\n    };\r\n    return attributeNameExceptions[property] ||\r\n        property.replace(`${type}-`, '').replace(/-/g, '_');\r\n}\r\n\r\nregister('ConstantBinder', ConstantBinder);\r\nregister('SourceExpressionBinder', SourceExpressionBinder);\r\nregister('CompositeExpressionBinder', CompositeExpressionBinder);\r\nregister('ProgramConfiguration', ProgramConfiguration, {omit: ['_buffers']});\r\nregister('ProgramConfigurationSet', ProgramConfigurationSet);\r\n\r\nmodule.exports = {\r\n    ProgramConfiguration,\r\n    ProgramConfigurationSet\r\n};\r\n","// @flow\r\n\r\n/**\r\n * An index array stores Uint16 indicies of vertexes in a corresponding vertex array. We use\r\n * two kinds of index arrays: arrays storing groups of three indicies, forming triangles; and\r\n * arrays storing pairs of indicies, forming line segments.\r\n * @private\r\n */\r\nmodule.exports = {\r\n    LineIndexArray: require('./array_types').LineIndexArray,\r\n    TriangleIndexArray: require('./array_types').TriangleIndexArray\r\n};\r\n","// @flow\r\n\r\nconst {isCounterClockwise} = require('./util');\r\n\r\nimport type Point from '@mapbox/point-geometry';\r\n\r\nmodule.exports = {\r\n    multiPolygonIntersectsBufferedMultiPoint,\r\n    multiPolygonIntersectsMultiPolygon,\r\n    multiPolygonIntersectsBufferedMultiLine,\r\n    polygonIntersectsPolygon,\r\n    distToSegmentSquared\r\n};\r\n\r\ntype Line = Array<Point>;\r\ntype MultiLine = Array<Line>;\r\ntype Ring = Array<Point>;\r\ntype Polygon = Array<Point>;\r\ntype MultiPolygon = Array<Polygon>;\r\n\r\nfunction polygonIntersectsPolygon(polygonA: Polygon, polygonB: Polygon) {\r\n    for (let i = 0; i < polygonA.length; i++) {\r\n        if (polygonContainsPoint(polygonB, polygonA[i])) return true;\r\n    }\r\n\r\n    for (let i = 0; i < polygonB.length; i++) {\r\n        if (polygonContainsPoint(polygonA, polygonB[i])) return true;\r\n    }\r\n\r\n    if (lineIntersectsLine(polygonA, polygonB)) return true;\r\n\r\n    return false;\r\n}\r\n\r\nfunction multiPolygonIntersectsBufferedMultiPoint(multiPolygon: MultiPolygon, rings: Array<Ring>, radius: number) {\r\n    for (let j = 0; j < multiPolygon.length; j++) {\r\n        const polygon = multiPolygon[j];\r\n        for (let i = 0; i < rings.length; i++) {\r\n            const ring = rings[i];\r\n            for (let k = 0; k < ring.length; k++) {\r\n                const point = ring[k];\r\n                if (polygonContainsPoint(polygon, point)) return true;\r\n                if (pointIntersectsBufferedLine(point, polygon, radius)) return true;\r\n            }\r\n        }\r\n    }\r\n    return false;\r\n}\r\n\r\nfunction multiPolygonIntersectsMultiPolygon(multiPolygonA: MultiPolygon, multiPolygonB: MultiPolygon) {\r\n\r\n    if (multiPolygonA.length === 1 && multiPolygonA[0].length === 1) {\r\n        return multiPolygonContainsPoint(multiPolygonB, multiPolygonA[0][0]);\r\n    }\r\n\r\n    for (let m = 0; m < multiPolygonB.length; m++) {\r\n        const ring = multiPolygonB[m];\r\n        for (let n = 0; n < ring.length; n++) {\r\n            if (multiPolygonContainsPoint(multiPolygonA, ring[n])) return true;\r\n        }\r\n    }\r\n\r\n    for (let j = 0; j < multiPolygonA.length; j++) {\r\n        const polygon = multiPolygonA[j];\r\n        for (let i = 0; i < polygon.length; i++) {\r\n            if (multiPolygonContainsPoint(multiPolygonB, polygon[i])) return true;\r\n        }\r\n\r\n        for (let k = 0; k < multiPolygonB.length; k++) {\r\n            if (lineIntersectsLine(polygon, multiPolygonB[k])) return true;\r\n        }\r\n    }\r\n\r\n    return false;\r\n}\r\n\r\nfunction multiPolygonIntersectsBufferedMultiLine(multiPolygon: MultiPolygon, multiLine: MultiLine, radius: number) {\r\n    for (let i = 0; i < multiLine.length; i++) {\r\n        const line = multiLine[i];\r\n\r\n        for (let j = 0; j < multiPolygon.length; j++) {\r\n            const polygon = multiPolygon[j];\r\n\r\n            if (polygon.length >= 3) {\r\n                for (let k = 0; k < line.length; k++) {\r\n                    if (polygonContainsPoint(polygon, line[k])) return true;\r\n                }\r\n            }\r\n\r\n            if (lineIntersectsBufferedLine(polygon, line, radius)) return true;\r\n        }\r\n    }\r\n    return false;\r\n}\r\n\r\nfunction lineIntersectsBufferedLine(lineA: Line, lineB: Line, radius: number) {\r\n\r\n    if (lineA.length > 1) {\r\n        if (lineIntersectsLine(lineA, lineB)) return true;\r\n\r\n        // Check whether any point in either line is within radius of the other line\r\n        for (let j = 0; j < lineB.length; j++) {\r\n            if (pointIntersectsBufferedLine(lineB[j], lineA, radius)) return true;\r\n        }\r\n    }\r\n\r\n    for (let k = 0; k < lineA.length; k++) {\r\n        if (pointIntersectsBufferedLine(lineA[k], lineB, radius)) return true;\r\n    }\r\n\r\n    return false;\r\n}\r\n\r\nfunction lineIntersectsLine(lineA: Line, lineB: Line) {\r\n    if (lineA.length === 0 || lineB.length === 0) return false;\r\n    for (let i = 0; i < lineA.length - 1; i++) {\r\n        const a0 = lineA[i];\r\n        const a1 = lineA[i + 1];\r\n        for (let j = 0; j < lineB.length - 1; j++) {\r\n            const b0 = lineB[j];\r\n            const b1 = lineB[j + 1];\r\n            if (lineSegmentIntersectsLineSegment(a0, a1, b0, b1)) return true;\r\n        }\r\n    }\r\n    return false;\r\n}\r\n\r\nfunction lineSegmentIntersectsLineSegment(a0: Point, a1: Point, b0: Point, b1: Point) {\r\n    return isCounterClockwise(a0, b0, b1) !== isCounterClockwise(a1, b0, b1) &&\r\n        isCounterClockwise(a0, a1, b0) !== isCounterClockwise(a0, a1, b1);\r\n}\r\n\r\nfunction pointIntersectsBufferedLine(p: Point, line: Line, radius: number) {\r\n    const radiusSquared = radius * radius;\r\n\r\n    if (line.length === 1) return p.distSqr(line[0]) < radiusSquared;\r\n\r\n    for (let i = 1; i < line.length; i++) {\r\n        // Find line segments that have a distance <= radius^2 to p\r\n        // In that case, we treat the line as \"containing point p\".\r\n        const v = line[i - 1], w = line[i];\r\n        if (distToSegmentSquared(p, v, w) < radiusSquared) return true;\r\n    }\r\n    return false;\r\n}\r\n\r\n// Code from http://stackoverflow.com/a/1501725/331379.\r\nfunction distToSegmentSquared(p: Point, v: Point, w: Point) {\r\n    const l2 = v.distSqr(w);\r\n    if (l2 === 0) return p.distSqr(v);\r\n    const t = ((p.x - v.x) * (w.x - v.x) + (p.y - v.y) * (w.y - v.y)) / l2;\r\n    if (t < 0) return p.distSqr(v);\r\n    if (t > 1) return p.distSqr(w);\r\n    return p.distSqr(w.sub(v)._mult(t)._add(v));\r\n}\r\n\r\n// point in polygon ray casting algorithm\r\nfunction multiPolygonContainsPoint(rings: Array<Ring>, p: Point) {\r\n    let c = false,\r\n        ring, p1, p2;\r\n\r\n    for (let k = 0; k < rings.length; k++) {\r\n        ring = rings[k];\r\n        for (let i = 0, j = ring.length - 1; i < ring.length; j = i++) {\r\n            p1 = ring[i];\r\n            p2 = ring[j];\r\n            if (((p1.y > p.y) !== (p2.y > p.y)) && (p.x < (p2.x - p1.x) * (p.y - p1.y) / (p2.y - p1.y) + p1.x)) {\r\n                c = !c;\r\n            }\r\n        }\r\n    }\r\n    return c;\r\n}\r\n\r\nfunction polygonContainsPoint(ring: Ring, p: Point) {\r\n    let c = false;\r\n    for (let i = 0, j = ring.length - 1; i < ring.length; j = i++) {\r\n        const p1 = ring[i];\r\n        const p2 = ring[j];\r\n        if (((p1.y > p.y) !== (p2.y > p.y)) && (p.x < (p2.x - p1.x) * (p.y - p1.y) / (p2.y - p1.y) + p1.x)) {\r\n            c = !c;\r\n        }\r\n    }\r\n    return c;\r\n}\r\n","// @flow\r\n\r\nconst assert = require('assert');\r\nconst {register} = require('./web_worker_transfer');\r\n\r\nexport type Size = {\r\n    width: number,\r\n    height: number\r\n};\r\n\r\ntype Point = {\r\n    x: number,\r\n    y: number\r\n};\r\n\r\nfunction createImage(image: *, {width, height}: Size, channels: number, data?: Uint8Array | Uint8ClampedArray) {\r\n    if (!data) {\r\n        data = new Uint8Array(width * height * channels);\r\n    } else if (data.length !== width * height * channels) {\r\n        throw new RangeError('mismatched image size');\r\n    }\r\n    image.width = width;\r\n    image.height = height;\r\n    image.data = data;\r\n    return image;\r\n}\r\n\r\nfunction resizeImage(image: *, {width, height}: Size, channels: number) {\r\n    if (width === image.width && height === image.height) {\r\n        return;\r\n    }\r\n\r\n    const newImage = createImage({}, {width, height}, channels);\r\n\r\n    copyImage(image, newImage, {x: 0, y: 0}, {x: 0, y: 0}, {\r\n        width: Math.min(image.width, width),\r\n        height: Math.min(image.height, height)\r\n    }, channels);\r\n\r\n    image.width = width;\r\n    image.height = height;\r\n    image.data = newImage.data;\r\n}\r\n\r\nfunction copyImage(srcImg: *, dstImg: *, srcPt: Point, dstPt: Point, size: Size, channels: number) {\r\n    if (size.width === 0 || size.height === 0) {\r\n        return dstImg;\r\n    }\r\n\r\n    if (size.width > srcImg.width ||\r\n        size.height > srcImg.height ||\r\n        srcPt.x > srcImg.width - size.width ||\r\n        srcPt.y > srcImg.height - size.height) {\r\n        throw new RangeError('out of range source coordinates for image copy');\r\n    }\r\n\r\n    if (size.width > dstImg.width ||\r\n        size.height > dstImg.height ||\r\n        dstPt.x > dstImg.width - size.width ||\r\n        dstPt.y > dstImg.height - size.height) {\r\n        throw new RangeError('out of range destination coordinates for image copy');\r\n    }\r\n\r\n    const srcData = srcImg.data;\r\n    const dstData = dstImg.data;\r\n\r\n    assert(srcData !== dstData);\r\n\r\n    for (let y = 0; y < size.height; y++) {\r\n        const srcOffset = ((srcPt.y + y) * srcImg.width + srcPt.x) * channels;\r\n        const dstOffset = ((dstPt.y + y) * dstImg.width + dstPt.x) * channels;\r\n        for (let i = 0; i < size.width * channels; i++) {\r\n            dstData[dstOffset + i] = srcData[srcOffset + i];\r\n        }\r\n    }\r\n\r\n    return dstImg;\r\n}\r\n\r\nclass AlphaImage {\r\n    width: number;\r\n    height: number;\r\n    data: Uint8Array | Uint8ClampedArray;\r\n\r\n    constructor(size: Size, data?: Uint8Array | Uint8ClampedArray) {\r\n        createImage(this, size, 1, data);\r\n    }\r\n\r\n    resize(size: Size) {\r\n        resizeImage(this, size, 1);\r\n    }\r\n\r\n    clone() {\r\n        return new AlphaImage({width: this.width, height: this.height}, new Uint8Array(this.data));\r\n    }\r\n\r\n    static copy(srcImg: AlphaImage, dstImg: AlphaImage, srcPt: Point, dstPt: Point, size: Size) {\r\n        copyImage(srcImg, dstImg, srcPt, dstPt, size, 1);\r\n    }\r\n}\r\n\r\n// Not premultiplied, because ImageData is not premultiplied.\r\n// UNPACK_PREMULTIPLY_ALPHA_WEBGL must be used when uploading to a texture.\r\nclass RGBAImage {\r\n    width: number;\r\n    height: number;\r\n    data: Uint8Array | Uint8ClampedArray;\r\n\r\n    constructor(size: Size, data?: Uint8Array | Uint8ClampedArray) {\r\n        createImage(this, size, 4, data);\r\n    }\r\n\r\n    resize(size: Size) {\r\n        resizeImage(this, size, 4);\r\n    }\r\n\r\n    clone() {\r\n        return new RGBAImage({width: this.width, height: this.height}, new Uint8Array(this.data));\r\n    }\r\n\r\n    static copy(srcImg: RGBAImage | ImageData, dstImg: RGBAImage, srcPt: Point, dstPt: Point, size: Size) {\r\n        copyImage(srcImg, dstImg, srcPt, dstPt, size, 4);\r\n    }\r\n}\r\n\r\nregister('AlphaImage', AlphaImage);\r\nregister('RGBAImage', RGBAImage);\r\n\r\nmodule.exports = {\r\n    AlphaImage,\r\n    RGBAImage\r\n};\r\n","// @flow\r\n\r\nconst Point = require('@mapbox/point-geometry');\r\n\r\nimport type {PossiblyEvaluatedPropertyValue} from \"./properties\";\r\nimport type StyleLayer from '../style/style_layer';\r\nimport type CircleBucket from '../data/bucket/circle_bucket';\r\nimport type LineBucket from '../data/bucket/line_bucket';\r\n\r\nfunction getMaximumPaintValue(property: string, layer: StyleLayer, bucket: CircleBucket<*> | LineBucket): number {\r\n    const value = ((layer.paint: any).get(property): PossiblyEvaluatedPropertyValue<any>).value;\r\n    if (value.kind === 'constant') {\r\n        return value.value;\r\n    } else {\r\n        const binders = bucket.programConfigurations.get(layer.id).binders;\r\n        return binders[property].statistics.max;\r\n    }\r\n}\r\n\r\nfunction translateDistance(translate: [number, number]) {\r\n    return Math.sqrt(translate[0] * translate[0] + translate[1] * translate[1]);\r\n}\r\n\r\nfunction translate(queryGeometry: Array<Array<Point>>,\r\n                   translate: [number, number],\r\n                   translateAnchor: 'viewport' | 'map',\r\n                   bearing: number,\r\n                   pixelsToTileUnits: number) {\r\n    if (!translate[0] && !translate[1]) {\r\n        return queryGeometry;\r\n    }\r\n\r\n    const pt = Point.convert(translate);\r\n\r\n    if (translateAnchor === \"viewport\") {\r\n        pt._rotate(-bearing);\r\n    }\r\n\r\n    const translated = [];\r\n    for (let i = 0; i < queryGeometry.length; i++) {\r\n        const ring = queryGeometry[i];\r\n        const translatedRing = [];\r\n        for (let k = 0; k < ring.length; k++) {\r\n            translatedRing.push(ring[k].sub(pt._mult(pixelsToTileUnits)));\r\n        }\r\n        translated.push(translatedRing);\r\n    }\r\n    return translated;\r\n}\r\n\r\nmodule.exports = {\r\n    getMaximumPaintValue,\r\n    translateDistance,\r\n    translate\r\n};\r\n","// @flow\r\n\r\n/* eslint-disable new-cap */\r\n\r\nconst isChar = require('./is_char_in_unicode_block');\r\n\r\nmodule.exports.allowsIdeographicBreaking = function(chars: string) {\r\n    for (const char of chars) {\r\n        if (!exports.charAllowsIdeographicBreaking(char.charCodeAt(0))) return false;\r\n    }\r\n    return true;\r\n};\r\n\r\nmodule.exports.allowsVerticalWritingMode = function(chars: string) {\r\n    for (const char of chars) {\r\n        if (exports.charHasUprightVerticalOrientation(char.charCodeAt(0))) return true;\r\n    }\r\n    return false;\r\n};\r\n\r\nmodule.exports.allowsLetterSpacing = function(chars: string) {\r\n    for (const char of chars) {\r\n        if (!exports.charAllowsLetterSpacing(char.charCodeAt(0))) return false;\r\n    }\r\n    return true;\r\n};\r\n\r\nmodule.exports.charAllowsLetterSpacing = function(char: number) {\r\n    if (isChar['Arabic'](char)) return false;\r\n    if (isChar['Arabic Supplement'](char)) return false;\r\n    if (isChar['Arabic Extended-A'](char)) return false;\r\n    if (isChar['Arabic Presentation Forms-A'](char)) return false;\r\n    if (isChar['Arabic Presentation Forms-B'](char)) return false;\r\n\r\n    return true;\r\n};\r\n\r\nmodule.exports.charAllowsIdeographicBreaking = function(char: number) {\r\n    // Return early for characters outside all ideographic ranges.\r\n    if (char < 0x2E80) return false;\r\n\r\n    if (isChar['Bopomofo Extended'](char)) return true;\r\n    if (isChar['Bopomofo'](char)) return true;\r\n    if (isChar['CJK Compatibility Forms'](char)) return true;\r\n    if (isChar['CJK Compatibility Ideographs'](char)) return true;\r\n    if (isChar['CJK Compatibility'](char)) return true;\r\n    if (isChar['CJK Radicals Supplement'](char)) return true;\r\n    if (isChar['CJK Strokes'](char)) return true;\r\n    if (isChar['CJK Symbols and Punctuation'](char)) return true;\r\n    if (isChar['CJK Unified Ideographs Extension A'](char)) return true;\r\n    if (isChar['CJK Unified Ideographs'](char)) return true;\r\n    if (isChar['Enclosed CJK Letters and Months'](char)) return true;\r\n    if (isChar['Halfwidth and Fullwidth Forms'](char)) return true;\r\n    if (isChar['Hiragana'](char)) return true;\r\n    if (isChar['Ideographic Description Characters'](char)) return true;\r\n    if (isChar['Kangxi Radicals'](char)) return true;\r\n    if (isChar['Katakana Phonetic Extensions'](char)) return true;\r\n    if (isChar['Katakana'](char)) return true;\r\n    if (isChar['Vertical Forms'](char)) return true;\r\n    if (isChar['Yi Radicals'](char)) return true;\r\n    if (isChar['Yi Syllables'](char)) return true;\r\n\r\n    return false;\r\n};\r\n\r\n// The following logic comes from\r\n// <http://www.unicode.org/Public/vertical/revision-17/VerticalOrientation-17.txt>.\r\n// The data file denotes with “U” or “Tu” any codepoint that may be drawn\r\n// upright in vertical text but does not distinguish between upright and\r\n// “neutral” characters.\r\n\r\n// Blocks in the Unicode supplementary planes are excluded from this module due\r\n// to <https://github.com/mapbox/mapbox-gl/issues/29>.\r\n\r\n/**\r\n * Returns true if the given Unicode codepoint identifies a character with\r\n * upright orientation.\r\n *\r\n * A character has upright orientation if it is drawn upright (unrotated)\r\n * whether the line is oriented horizontally or vertically, even if both\r\n * adjacent characters can be rotated. For example, a Chinese character is\r\n * always drawn upright. An uprightly oriented character causes an adjacent\r\n * “neutral” character to be drawn upright as well.\r\n */\r\nexports.charHasUprightVerticalOrientation = function(char: number) {\r\n    if (char === 0x02EA /* modifier letter yin departing tone mark */ ||\r\n        char === 0x02EB /* modifier letter yang departing tone mark */) {\r\n        return true;\r\n    }\r\n\r\n    // Return early for characters outside all ranges whose characters remain\r\n    // upright in vertical writing mode.\r\n    if (char < 0x1100) return false;\r\n\r\n    if (isChar['Bopomofo Extended'](char)) return true;\r\n    if (isChar['Bopomofo'](char)) return true;\r\n    if (isChar['CJK Compatibility Forms'](char)) {\r\n        if (!(char >= 0xFE49 /* dashed overline */ && char <= 0xFE4F /* wavy low line */)) {\r\n            return true;\r\n        }\r\n    }\r\n    if (isChar['CJK Compatibility Ideographs'](char)) return true;\r\n    if (isChar['CJK Compatibility'](char)) return true;\r\n    if (isChar['CJK Radicals Supplement'](char)) return true;\r\n    if (isChar['CJK Strokes'](char)) return true;\r\n    if (isChar['CJK Symbols and Punctuation'](char)) {\r\n        if (!(char >= 0x3008 /* left angle bracket */ && char <= 0x3011 /* right black lenticular bracket */) &&\r\n            !(char >= 0x3014 /* left tortoise shell bracket */ && char <= 0x301F /* low double prime quotation mark */) &&\r\n            char !== 0x3030 /* wavy dash */) {\r\n            return true;\r\n        }\r\n    }\r\n    if (isChar['CJK Unified Ideographs Extension A'](char)) return true;\r\n    if (isChar['CJK Unified Ideographs'](char)) return true;\r\n    if (isChar['Enclosed CJK Letters and Months'](char)) return true;\r\n    if (isChar['Hangul Compatibility Jamo'](char)) return true;\r\n    if (isChar['Hangul Jamo Extended-A'](char)) return true;\r\n    if (isChar['Hangul Jamo Extended-B'](char)) return true;\r\n    if (isChar['Hangul Jamo'](char)) return true;\r\n    if (isChar['Hangul Syllables'](char)) return true;\r\n    if (isChar['Hiragana'](char)) return true;\r\n    if (isChar['Ideographic Description Characters'](char)) return true;\r\n    if (isChar['Kanbun'](char)) return true;\r\n    if (isChar['Kangxi Radicals'](char)) return true;\r\n    if (isChar['Katakana Phonetic Extensions'](char)) return true;\r\n    if (isChar['Katakana'](char)) {\r\n        if (char !== 0x30FC /* katakana-hiragana prolonged sound mark */) {\r\n            return true;\r\n        }\r\n    }\r\n    if (isChar['Halfwidth and Fullwidth Forms'](char)) {\r\n        if (char !== 0xFF08 /* fullwidth left parenthesis */ &&\r\n            char !== 0xFF09 /* fullwidth right parenthesis */ &&\r\n            char !== 0xFF0D /* fullwidth hyphen-minus */ &&\r\n            !(char >= 0xFF1A /* fullwidth colon */ && char <= 0xFF1E /* fullwidth greater-than sign */) &&\r\n            char !== 0xFF3B /* fullwidth left square bracket */ &&\r\n            char !== 0xFF3D /* fullwidth right square bracket */ &&\r\n            char !== 0xFF3F /* fullwidth low line */ &&\r\n            !(char >= 0xFF5B /* fullwidth left curly bracket */ && char <= 0xFFDF) &&\r\n            char !== 0xFFE3 /* fullwidth macron */ &&\r\n            !(char >= 0xFFE8 /* halfwidth forms light vertical */ && char <= 0xFFEF)) {\r\n            return true;\r\n        }\r\n    }\r\n    if (isChar['Small Form Variants'](char)) {\r\n        if (!(char >= 0xFE58 /* small em dash */ && char <= 0xFE5E /* small right tortoise shell bracket */) &&\r\n            !(char >= 0xFE63 /* small hyphen-minus */ && char <= 0xFE66 /* small equals sign */)) {\r\n            return true;\r\n        }\r\n    }\r\n    if (isChar['Unified Canadian Aboriginal Syllabics'](char)) return true;\r\n    if (isChar['Unified Canadian Aboriginal Syllabics Extended'](char)) return true;\r\n    if (isChar['Vertical Forms'](char)) return true;\r\n    if (isChar['Yijing Hexagram Symbols'](char)) return true;\r\n    if (isChar['Yi Syllables'](char)) return true;\r\n    if (isChar['Yi Radicals'](char)) return true;\r\n\r\n    return false;\r\n};\r\n\r\n/**\r\n * Returns true if the given Unicode codepoint identifies a character with\r\n * neutral orientation.\r\n *\r\n * A character has neutral orientation if it may be drawn rotated or unrotated\r\n * when the line is oriented vertically, depending on the orientation of the\r\n * adjacent characters. For example, along a verticlly oriented line, the vulgar\r\n * fraction ½ is drawn upright among Chinese characters but rotated among Latin\r\n * letters. A neutrally oriented character does not influence whether an\r\n * adjacent character is drawn upright or rotated.\r\n */\r\nexports.charHasNeutralVerticalOrientation = function(char: number) {\r\n    if (isChar['Latin-1 Supplement'](char)) {\r\n        if (char === 0x00A7 /* section sign */ ||\r\n            char === 0x00A9 /* copyright sign */ ||\r\n            char === 0x00AE /* registered sign */ ||\r\n            char === 0x00B1 /* plus-minus sign */ ||\r\n            char === 0x00BC /* vulgar fraction one quarter */ ||\r\n            char === 0x00BD /* vulgar fraction one half */ ||\r\n            char === 0x00BE /* vulgar fraction three quarters */ ||\r\n            char === 0x00D7 /* multiplication sign */ ||\r\n            char === 0x00F7 /* division sign */) {\r\n            return true;\r\n        }\r\n    }\r\n    if (isChar['General Punctuation'](char)) {\r\n        if (char === 0x2016 /* double vertical line */ ||\r\n            char === 0x2020 /* dagger */ ||\r\n            char === 0x2021 /* double dagger */ ||\r\n            char === 0x2030 /* per mille sign */ ||\r\n            char === 0x2031 /* per ten thousand sign */ ||\r\n            char === 0x203B /* reference mark */ ||\r\n            char === 0x203C /* double exclamation mark */ ||\r\n            char === 0x2042 /* asterism */ ||\r\n            char === 0x2047 /* double question mark */ ||\r\n            char === 0x2048 /* question exclamation mark */ ||\r\n            char === 0x2049 /* exclamation question mark */ ||\r\n            char === 0x2051 /* two asterisks aligned vertically */) {\r\n            return true;\r\n        }\r\n    }\r\n    if (isChar['Letterlike Symbols'](char)) return true;\r\n    if (isChar['Number Forms'](char)) return true;\r\n    if (isChar['Miscellaneous Technical'](char)) {\r\n        if ((char >= 0x2300 /* diameter sign */ && char <= 0x2307 /* wavy line */) ||\r\n            (char >= 0x230C /* bottom right crop */ && char <= 0x231F /* bottom right corner */) ||\r\n            (char >= 0x2324 /* up arrowhead between two horizontal bars */ && char <= 0x2328 /* keyboard */) ||\r\n            char === 0x232B /* erase to the left */ ||\r\n            (char >= 0x237D /* shouldered open box */ && char <= 0x239A /* clear screen symbol */) ||\r\n            (char >= 0x23BE /* dentistry symbol light vertical and top right */ && char <= 0x23CD /* square foot */) ||\r\n            char === 0x23CF /* eject symbol */ ||\r\n            (char >= 0x23D1 /* metrical breve */ && char <= 0x23DB /* fuse */) ||\r\n            (char >= 0x23E2 /* white trapezium */ && char <= 0x23FF)) {\r\n            return true;\r\n        }\r\n    }\r\n    if (isChar['Control Pictures'](char) && char !== 0x2423 /* open box */) return true;\r\n    if (isChar['Optical Character Recognition'](char)) return true;\r\n    if (isChar['Enclosed Alphanumerics'](char)) return true;\r\n    if (isChar['Geometric Shapes'](char)) return true;\r\n    if (isChar['Miscellaneous Symbols'](char)) {\r\n        if (!(char >= 0x261A /* black left pointing index */ && char <= 0x261F /* white down pointing index */)) {\r\n            return true;\r\n        }\r\n    }\r\n    if (isChar['Miscellaneous Symbols and Arrows'](char)) {\r\n        if ((char >= 0x2B12 /* square with top half black */ && char <= 0x2B2F /* white vertical ellipse */) ||\r\n            (char >= 0x2B50 /* white medium star */ && char <= 0x2B59 /* heavy circled saltire */) ||\r\n            (char >= 0x2BB8 /* upwards white arrow from bar with horizontal bar */ && char <= 0x2BEB)) {\r\n            return true;\r\n        }\r\n    }\r\n    if (isChar['CJK Symbols and Punctuation'](char)) return true;\r\n    if (isChar['Katakana'](char)) return true;\r\n    if (isChar['Private Use Area'](char)) return true;\r\n    if (isChar['CJK Compatibility Forms'](char)) return true;\r\n    if (isChar['Small Form Variants'](char)) return true;\r\n    if (isChar['Halfwidth and Fullwidth Forms'](char)) return true;\r\n\r\n    if (char === 0x221E /* infinity */ ||\r\n        char === 0x2234 /* therefore */ ||\r\n        char === 0x2235 /* because */ ||\r\n        (char >= 0x2700 /* black safety scissors */ && char <= 0x2767 /* rotated floral heart bullet */) ||\r\n        (char >= 0x2776 /* dingbat negative circled digit one */ && char <= 0x2793 /* dingbat negative circled sans-serif number ten */) ||\r\n        char === 0xFFFC /* object replacement character */ ||\r\n        char === 0xFFFD /* replacement character */) {\r\n        return true;\r\n    }\r\n\r\n    return false;\r\n};\r\n\r\n/**\r\n * Returns true if the given Unicode codepoint identifies a character with\r\n * rotated orientation.\r\n *\r\n * A character has rotated orientation if it is drawn rotated when the line is\r\n * oriented vertically, even if both adjacent characters are upright. For\r\n * example, a Latin letter is drawn rotated along a vertical line. A rotated\r\n * character causes an adjacent “neutral” character to be drawn rotated as well.\r\n */\r\nexports.charHasRotatedVerticalOrientation = function(char: number) {\r\n    return !(exports.charHasUprightVerticalOrientation(char) ||\r\n             exports.charHasNeutralVerticalOrientation(char));\r\n};\r\n","'use strict';\n\nmodule.exports = Pbf;\n\nvar ieee754 = require('ieee754');\n\nfunction Pbf(buf) {\n    this.buf = ArrayBuffer.isView && ArrayBuffer.isView(buf) ? buf : new Uint8Array(buf || 0);\n    this.pos = 0;\n    this.type = 0;\n    this.length = this.buf.length;\n}\n\nPbf.Varint  = 0; // varint: int32, int64, uint32, uint64, sint32, sint64, bool, enum\nPbf.Fixed64 = 1; // 64-bit: double, fixed64, sfixed64\nPbf.Bytes   = 2; // length-delimited: string, bytes, embedded messages, packed repeated fields\nPbf.Fixed32 = 5; // 32-bit: float, fixed32, sfixed32\n\nvar SHIFT_LEFT_32 = (1 << 16) * (1 << 16),\n    SHIFT_RIGHT_32 = 1 / SHIFT_LEFT_32;\n\nPbf.prototype = {\n\n    destroy: function() {\n        this.buf = null;\n    },\n\n    // === READING =================================================================\n\n    readFields: function(readField, result, end) {\n        end = end || this.length;\n\n        while (this.pos < end) {\n            var val = this.readVarint(),\n                tag = val >> 3,\n                startPos = this.pos;\n\n            this.type = val & 0x7;\n            readField(tag, result, this);\n\n            if (this.pos === startPos) this.skip(val);\n        }\n        return result;\n    },\n\n    readMessage: function(readField, result) {\n        return this.readFields(readField, result, this.readVarint() + this.pos);\n    },\n\n    readFixed32: function() {\n        var val = readUInt32(this.buf, this.pos);\n        this.pos += 4;\n        return val;\n    },\n\n    readSFixed32: function() {\n        var val = readInt32(this.buf, this.pos);\n        this.pos += 4;\n        return val;\n    },\n\n    // 64-bit int handling is based on github.com/dpw/node-buffer-more-ints (MIT-licensed)\n\n    readFixed64: function() {\n        var val = readUInt32(this.buf, this.pos) + readUInt32(this.buf, this.pos + 4) * SHIFT_LEFT_32;\n        this.pos += 8;\n        return val;\n    },\n\n    readSFixed64: function() {\n        var val = readUInt32(this.buf, this.pos) + readInt32(this.buf, this.pos + 4) * SHIFT_LEFT_32;\n        this.pos += 8;\n        return val;\n    },\n\n    readFloat: function() {\n        var val = ieee754.read(this.buf, this.pos, true, 23, 4);\n        this.pos += 4;\n        return val;\n    },\n\n    readDouble: function() {\n        var val = ieee754.read(this.buf, this.pos, true, 52, 8);\n        this.pos += 8;\n        return val;\n    },\n\n    readVarint: function(isSigned) {\n        var buf = this.buf,\n            val, b;\n\n        b = buf[this.pos++]; val  =  b & 0x7f;        if (b < 0x80) return val;\n        b = buf[this.pos++]; val |= (b & 0x7f) << 7;  if (b < 0x80) return val;\n        b = buf[this.pos++]; val |= (b & 0x7f) << 14; if (b < 0x80) return val;\n        b = buf[this.pos++]; val |= (b & 0x7f) << 21; if (b < 0x80) return val;\n        b = buf[this.pos];   val |= (b & 0x0f) << 28;\n\n        return readVarintRemainder(val, isSigned, this);\n    },\n\n    readVarint64: function() { // for compatibility with v2.0.1\n        return this.readVarint(true);\n    },\n\n    readSVarint: function() {\n        var num = this.readVarint();\n        return num % 2 === 1 ? (num + 1) / -2 : num / 2; // zigzag encoding\n    },\n\n    readBoolean: function() {\n        return Boolean(this.readVarint());\n    },\n\n    readString: function() {\n        var end = this.readVarint() + this.pos,\n            str = readUtf8(this.buf, this.pos, end);\n        this.pos = end;\n        return str;\n    },\n\n    readBytes: function() {\n        var end = this.readVarint() + this.pos,\n            buffer = this.buf.subarray(this.pos, end);\n        this.pos = end;\n        return buffer;\n    },\n\n    // verbose for performance reasons; doesn't affect gzipped size\n\n    readPackedVarint: function(arr, isSigned) {\n        var end = readPackedEnd(this);\n        arr = arr || [];\n        while (this.pos < end) arr.push(this.readVarint(isSigned));\n        return arr;\n    },\n    readPackedSVarint: function(arr) {\n        var end = readPackedEnd(this);\n        arr = arr || [];\n        while (this.pos < end) arr.push(this.readSVarint());\n        return arr;\n    },\n    readPackedBoolean: function(arr) {\n        var end = readPackedEnd(this);\n        arr = arr || [];\n        while (this.pos < end) arr.push(this.readBoolean());\n        return arr;\n    },\n    readPackedFloat: function(arr) {\n        var end = readPackedEnd(this);\n        arr = arr || [];\n        while (this.pos < end) arr.push(this.readFloat());\n        return arr;\n    },\n    readPackedDouble: function(arr) {\n        var end = readPackedEnd(this);\n        arr = arr || [];\n        while (this.pos < end) arr.push(this.readDouble());\n        return arr;\n    },\n    readPackedFixed32: function(arr) {\n        var end = readPackedEnd(this);\n        arr = arr || [];\n        while (this.pos < end) arr.push(this.readFixed32());\n        return arr;\n    },\n    readPackedSFixed32: function(arr) {\n        var end = readPackedEnd(this);\n        arr = arr || [];\n        while (this.pos < end) arr.push(this.readSFixed32());\n        return arr;\n    },\n    readPackedFixed64: function(arr) {\n        var end = readPackedEnd(this);\n        arr = arr || [];\n        while (this.pos < end) arr.push(this.readFixed64());\n        return arr;\n    },\n    readPackedSFixed64: function(arr) {\n        var end = readPackedEnd(this);\n        arr = arr || [];\n        while (this.pos < end) arr.push(this.readSFixed64());\n        return arr;\n    },\n\n    skip: function(val) {\n        var type = val & 0x7;\n        if (type === Pbf.Varint) while (this.buf[this.pos++] > 0x7f) {}\n        else if (type === Pbf.Bytes) this.pos = this.readVarint() + this.pos;\n        else if (type === Pbf.Fixed32) this.pos += 4;\n        else if (type === Pbf.Fixed64) this.pos += 8;\n        else throw new Error('Unimplemented type: ' + type);\n    },\n\n    // === WRITING =================================================================\n\n    writeTag: function(tag, type) {\n        this.writeVarint((tag << 3) | type);\n    },\n\n    realloc: function(min) {\n        var length = this.length || 16;\n\n        while (length < this.pos + min) length *= 2;\n\n        if (length !== this.length) {\n            var buf = new Uint8Array(length);\n            buf.set(this.buf);\n            this.buf = buf;\n            this.length = length;\n        }\n    },\n\n    finish: function() {\n        this.length = this.pos;\n        this.pos = 0;\n        return this.buf.subarray(0, this.length);\n    },\n\n    writeFixed32: function(val) {\n        this.realloc(4);\n        writeInt32(this.buf, val, this.pos);\n        this.pos += 4;\n    },\n\n    writeSFixed32: function(val) {\n        this.realloc(4);\n        writeInt32(this.buf, val, this.pos);\n        this.pos += 4;\n    },\n\n    writeFixed64: function(val) {\n        this.realloc(8);\n        writeInt32(this.buf, val & -1, this.pos);\n        writeInt32(this.buf, Math.floor(val * SHIFT_RIGHT_32), this.pos + 4);\n        this.pos += 8;\n    },\n\n    writeSFixed64: function(val) {\n        this.realloc(8);\n        writeInt32(this.buf, val & -1, this.pos);\n        writeInt32(this.buf, Math.floor(val * SHIFT_RIGHT_32), this.pos + 4);\n        this.pos += 8;\n    },\n\n    writeVarint: function(val) {\n        val = +val || 0;\n\n        if (val > 0xfffffff || val < 0) {\n            writeBigVarint(val, this);\n            return;\n        }\n\n        this.realloc(4);\n\n        this.buf[this.pos++] =           val & 0x7f  | (val > 0x7f ? 0x80 : 0); if (val <= 0x7f) return;\n        this.buf[this.pos++] = ((val >>>= 7) & 0x7f) | (val > 0x7f ? 0x80 : 0); if (val <= 0x7f) return;\n        this.buf[this.pos++] = ((val >>>= 7) & 0x7f) | (val > 0x7f ? 0x80 : 0); if (val <= 0x7f) return;\n        this.buf[this.pos++] =   (val >>> 7) & 0x7f;\n    },\n\n    writeSVarint: function(val) {\n        this.writeVarint(val < 0 ? -val * 2 - 1 : val * 2);\n    },\n\n    writeBoolean: function(val) {\n        this.writeVarint(Boolean(val));\n    },\n\n    writeString: function(str) {\n        str = String(str);\n        this.realloc(str.length * 4);\n\n        this.pos++; // reserve 1 byte for short string length\n\n        var startPos = this.pos;\n        // write the string directly to the buffer and see how much was written\n        this.pos = writeUtf8(this.buf, str, this.pos);\n        var len = this.pos - startPos;\n\n        if (len >= 0x80) makeRoomForExtraLength(startPos, len, this);\n\n        // finally, write the message length in the reserved place and restore the position\n        this.pos = startPos - 1;\n        this.writeVarint(len);\n        this.pos += len;\n    },\n\n    writeFloat: function(val) {\n        this.realloc(4);\n        ieee754.write(this.buf, val, this.pos, true, 23, 4);\n        this.pos += 4;\n    },\n\n    writeDouble: function(val) {\n        this.realloc(8);\n        ieee754.write(this.buf, val, this.pos, true, 52, 8);\n        this.pos += 8;\n    },\n\n    writeBytes: function(buffer) {\n        var len = buffer.length;\n        this.writeVarint(len);\n        this.realloc(len);\n        for (var i = 0; i < len; i++) this.buf[this.pos++] = buffer[i];\n    },\n\n    writeRawMessage: function(fn, obj) {\n        this.pos++; // reserve 1 byte for short message length\n\n        // write the message directly to the buffer and see how much was written\n        var startPos = this.pos;\n        fn(obj, this);\n        var len = this.pos - startPos;\n\n        if (len >= 0x80) makeRoomForExtraLength(startPos, len, this);\n\n        // finally, write the message length in the reserved place and restore the position\n        this.pos = startPos - 1;\n        this.writeVarint(len);\n        this.pos += len;\n    },\n\n    writeMessage: function(tag, fn, obj) {\n        this.writeTag(tag, Pbf.Bytes);\n        this.writeRawMessage(fn, obj);\n    },\n\n    writePackedVarint:   function(tag, arr) { this.writeMessage(tag, writePackedVarint, arr);   },\n    writePackedSVarint:  function(tag, arr) { this.writeMessage(tag, writePackedSVarint, arr);  },\n    writePackedBoolean:  function(tag, arr) { this.writeMessage(tag, writePackedBoolean, arr);  },\n    writePackedFloat:    function(tag, arr) { this.writeMessage(tag, writePackedFloat, arr);    },\n    writePackedDouble:   function(tag, arr) { this.writeMessage(tag, writePackedDouble, arr);   },\n    writePackedFixed32:  function(tag, arr) { this.writeMessage(tag, writePackedFixed32, arr);  },\n    writePackedSFixed32: function(tag, arr) { this.writeMessage(tag, writePackedSFixed32, arr); },\n    writePackedFixed64:  function(tag, arr) { this.writeMessage(tag, writePackedFixed64, arr);  },\n    writePackedSFixed64: function(tag, arr) { this.writeMessage(tag, writePackedSFixed64, arr); },\n\n    writeBytesField: function(tag, buffer) {\n        this.writeTag(tag, Pbf.Bytes);\n        this.writeBytes(buffer);\n    },\n    writeFixed32Field: function(tag, val) {\n        this.writeTag(tag, Pbf.Fixed32);\n        this.writeFixed32(val);\n    },\n    writeSFixed32Field: function(tag, val) {\n        this.writeTag(tag, Pbf.Fixed32);\n        this.writeSFixed32(val);\n    },\n    writeFixed64Field: function(tag, val) {\n        this.writeTag(tag, Pbf.Fixed64);\n        this.writeFixed64(val);\n    },\n    writeSFixed64Field: function(tag, val) {\n        this.writeTag(tag, Pbf.Fixed64);\n        this.writeSFixed64(val);\n    },\n    writeVarintField: function(tag, val) {\n        this.writeTag(tag, Pbf.Varint);\n        this.writeVarint(val);\n    },\n    writeSVarintField: function(tag, val) {\n        this.writeTag(tag, Pbf.Varint);\n        this.writeSVarint(val);\n    },\n    writeStringField: function(tag, str) {\n        this.writeTag(tag, Pbf.Bytes);\n        this.writeString(str);\n    },\n    writeFloatField: function(tag, val) {\n        this.writeTag(tag, Pbf.Fixed32);\n        this.writeFloat(val);\n    },\n    writeDoubleField: function(tag, val) {\n        this.writeTag(tag, Pbf.Fixed64);\n        this.writeDouble(val);\n    },\n    writeBooleanField: function(tag, val) {\n        this.writeVarintField(tag, Boolean(val));\n    }\n};\n\nfunction readVarintRemainder(l, s, p) {\n    var buf = p.buf,\n        h, b;\n\n    b = buf[p.pos++]; h  = (b & 0x70) >> 4;  if (b < 0x80) return toNum(l, h, s);\n    b = buf[p.pos++]; h |= (b & 0x7f) << 3;  if (b < 0x80) return toNum(l, h, s);\n    b = buf[p.pos++]; h |= (b & 0x7f) << 10; if (b < 0x80) return toNum(l, h, s);\n    b = buf[p.pos++]; h |= (b & 0x7f) << 17; if (b < 0x80) return toNum(l, h, s);\n    b = buf[p.pos++]; h |= (b & 0x7f) << 24; if (b < 0x80) return toNum(l, h, s);\n    b = buf[p.pos++]; h |= (b & 0x01) << 31; if (b < 0x80) return toNum(l, h, s);\n\n    throw new Error('Expected varint not more than 10 bytes');\n}\n\nfunction readPackedEnd(pbf) {\n    return pbf.type === Pbf.Bytes ?\n        pbf.readVarint() + pbf.pos : pbf.pos + 1;\n}\n\nfunction toNum(low, high, isSigned) {\n    if (isSigned) {\n        return high * 0x100000000 + (low >>> 0);\n    }\n\n    return ((high >>> 0) * 0x100000000) + (low >>> 0);\n}\n\nfunction writeBigVarint(val, pbf) {\n    var low, high;\n\n    if (val >= 0) {\n        low  = (val % 0x100000000) | 0;\n        high = (val / 0x100000000) | 0;\n    } else {\n        low  = ~(-val % 0x100000000);\n        high = ~(-val / 0x100000000);\n\n        if (low ^ 0xffffffff) {\n            low = (low + 1) | 0;\n        } else {\n            low = 0;\n            high = (high + 1) | 0;\n        }\n    }\n\n    if (val >= 0x10000000000000000 || val < -0x10000000000000000) {\n        throw new Error('Given varint doesn\\'t fit into 10 bytes');\n    }\n\n    pbf.realloc(10);\n\n    writeBigVarintLow(low, high, pbf);\n    writeBigVarintHigh(high, pbf);\n}\n\nfunction writeBigVarintLow(low, high, pbf) {\n    pbf.buf[pbf.pos++] = low & 0x7f | 0x80; low >>>= 7;\n    pbf.buf[pbf.pos++] = low & 0x7f | 0x80; low >>>= 7;\n    pbf.buf[pbf.pos++] = low & 0x7f | 0x80; low >>>= 7;\n    pbf.buf[pbf.pos++] = low & 0x7f | 0x80; low >>>= 7;\n    pbf.buf[pbf.pos]   = low & 0x7f;\n}\n\nfunction writeBigVarintHigh(high, pbf) {\n    var lsb = (high & 0x07) << 4;\n\n    pbf.buf[pbf.pos++] |= lsb         | ((high >>>= 3) ? 0x80 : 0); if (!high) return;\n    pbf.buf[pbf.pos++]  = high & 0x7f | ((high >>>= 7) ? 0x80 : 0); if (!high) return;\n    pbf.buf[pbf.pos++]  = high & 0x7f | ((high >>>= 7) ? 0x80 : 0); if (!high) return;\n    pbf.buf[pbf.pos++]  = high & 0x7f | ((high >>>= 7) ? 0x80 : 0); if (!high) return;\n    pbf.buf[pbf.pos++]  = high & 0x7f | ((high >>>= 7) ? 0x80 : 0); if (!high) return;\n    pbf.buf[pbf.pos++]  = high & 0x7f;\n}\n\nfunction makeRoomForExtraLength(startPos, len, pbf) {\n    var extraLen =\n        len <= 0x3fff ? 1 :\n        len <= 0x1fffff ? 2 :\n        len <= 0xfffffff ? 3 : Math.ceil(Math.log(len) / (Math.LN2 * 7));\n\n    // if 1 byte isn't enough for encoding message length, shift the data to the right\n    pbf.realloc(extraLen);\n    for (var i = pbf.pos - 1; i >= startPos; i--) pbf.buf[i + extraLen] = pbf.buf[i];\n}\n\nfunction writePackedVarint(arr, pbf)   { for (var i = 0; i < arr.length; i++) pbf.writeVarint(arr[i]);   }\nfunction writePackedSVarint(arr, pbf)  { for (var i = 0; i < arr.length; i++) pbf.writeSVarint(arr[i]);  }\nfunction writePackedFloat(arr, pbf)    { for (var i = 0; i < arr.length; i++) pbf.writeFloat(arr[i]);    }\nfunction writePackedDouble(arr, pbf)   { for (var i = 0; i < arr.length; i++) pbf.writeDouble(arr[i]);   }\nfunction writePackedBoolean(arr, pbf)  { for (var i = 0; i < arr.length; i++) pbf.writeBoolean(arr[i]);  }\nfunction writePackedFixed32(arr, pbf)  { for (var i = 0; i < arr.length; i++) pbf.writeFixed32(arr[i]);  }\nfunction writePackedSFixed32(arr, pbf) { for (var i = 0; i < arr.length; i++) pbf.writeSFixed32(arr[i]); }\nfunction writePackedFixed64(arr, pbf)  { for (var i = 0; i < arr.length; i++) pbf.writeFixed64(arr[i]);  }\nfunction writePackedSFixed64(arr, pbf) { for (var i = 0; i < arr.length; i++) pbf.writeSFixed64(arr[i]); }\n\n// Buffer code below from https://github.com/feross/buffer, MIT-licensed\n\nfunction readUInt32(buf, pos) {\n    return ((buf[pos]) |\n        (buf[pos + 1] << 8) |\n        (buf[pos + 2] << 16)) +\n        (buf[pos + 3] * 0x1000000);\n}\n\nfunction writeInt32(buf, val, pos) {\n    buf[pos] = val;\n    buf[pos + 1] = (val >>> 8);\n    buf[pos + 2] = (val >>> 16);\n    buf[pos + 3] = (val >>> 24);\n}\n\nfunction readInt32(buf, pos) {\n    return ((buf[pos]) |\n        (buf[pos + 1] << 8) |\n        (buf[pos + 2] << 16)) +\n        (buf[pos + 3] << 24);\n}\n\nfunction readUtf8(buf, pos, end) {\n    var str = '';\n    var i = pos;\n\n    while (i < end) {\n        var b0 = buf[i];\n        var c = null; // codepoint\n        var bytesPerSequence =\n            b0 > 0xEF ? 4 :\n            b0 > 0xDF ? 3 :\n            b0 > 0xBF ? 2 : 1;\n\n        if (i + bytesPerSequence > end) break;\n\n        var b1, b2, b3;\n\n        if (bytesPerSequence === 1) {\n            if (b0 < 0x80) {\n                c = b0;\n            }\n        } else if (bytesPerSequence === 2) {\n            b1 = buf[i + 1];\n            if ((b1 & 0xC0) === 0x80) {\n                c = (b0 & 0x1F) << 0x6 | (b1 & 0x3F);\n                if (c <= 0x7F) {\n                    c = null;\n                }\n            }\n        } else if (bytesPerSequence === 3) {\n            b1 = buf[i + 1];\n            b2 = buf[i + 2];\n            if ((b1 & 0xC0) === 0x80 && (b2 & 0xC0) === 0x80) {\n                c = (b0 & 0xF) << 0xC | (b1 & 0x3F) << 0x6 | (b2 & 0x3F);\n                if (c <= 0x7FF || (c >= 0xD800 && c <= 0xDFFF)) {\n                    c = null;\n                }\n            }\n        } else if (bytesPerSequence === 4) {\n            b1 = buf[i + 1];\n            b2 = buf[i + 2];\n            b3 = buf[i + 3];\n            if ((b1 & 0xC0) === 0x80 && (b2 & 0xC0) === 0x80 && (b3 & 0xC0) === 0x80) {\n                c = (b0 & 0xF) << 0x12 | (b1 & 0x3F) << 0xC | (b2 & 0x3F) << 0x6 | (b3 & 0x3F);\n                if (c <= 0xFFFF || c >= 0x110000) {\n                    c = null;\n                }\n            }\n        }\n\n        if (c === null) {\n            c = 0xFFFD;\n            bytesPerSequence = 1;\n\n        } else if (c > 0xFFFF) {\n            c -= 0x10000;\n            str += String.fromCharCode(c >>> 10 & 0x3FF | 0xD800);\n            c = 0xDC00 | c & 0x3FF;\n        }\n\n        str += String.fromCharCode(c);\n        i += bytesPerSequence;\n    }\n\n    return str;\n}\n\nfunction writeUtf8(buf, str, pos) {\n    for (var i = 0, c, lead; i < str.length; i++) {\n        c = str.charCodeAt(i); // code point\n\n        if (c > 0xD7FF && c < 0xE000) {\n            if (lead) {\n                if (c < 0xDC00) {\n                    buf[pos++] = 0xEF;\n                    buf[pos++] = 0xBF;\n                    buf[pos++] = 0xBD;\n                    lead = c;\n                    continue;\n                } else {\n                    c = lead - 0xD800 << 10 | c - 0xDC00 | 0x10000;\n                    lead = null;\n                }\n            } else {\n                if (c > 0xDBFF || (i + 1 === str.length)) {\n                    buf[pos++] = 0xEF;\n                    buf[pos++] = 0xBF;\n                    buf[pos++] = 0xBD;\n                } else {\n                    lead = c;\n                }\n                continue;\n            }\n        } else if (lead) {\n            buf[pos++] = 0xEF;\n            buf[pos++] = 0xBF;\n            buf[pos++] = 0xBD;\n            lead = null;\n        }\n\n        if (c < 0x80) {\n            buf[pos++] = c;\n        } else {\n            if (c < 0x800) {\n                buf[pos++] = c >> 0x6 | 0xC0;\n            } else {\n                if (c < 0x10000) {\n                    buf[pos++] = c >> 0xC | 0xE0;\n                } else {\n                    buf[pos++] = c >> 0x12 | 0xF0;\n                    buf[pos++] = c >> 0xC & 0x3F | 0x80;\n                }\n                buf[pos++] = c >> 0x6 & 0x3F | 0x80;\n            }\n            buf[pos++] = c & 0x3F | 0x80;\n        }\n    }\n    return pos;\n}\n","// @flow\r\n\r\nconst assert = require('assert');\r\nconst Scope = require('./scope');\r\nconst {Color} = require('./values');\r\n\r\nimport type { Feature, GlobalProperties } from './index';\r\nimport type { Expression } from './expression';\r\n\r\nconst geometryTypes = ['Unknown', 'Point', 'LineString', 'Polygon'];\r\n\r\nclass EvaluationContext {\r\n    globals: GlobalProperties;\r\n    feature: ?Feature;\r\n\r\n    scope: Scope;\r\n    _parseColorCache: {[string]: ?Color};\r\n\r\n    constructor() {\r\n        this.scope = new Scope();\r\n        this._parseColorCache = {};\r\n    }\r\n\r\n    id() {\r\n        return this.feature && 'id' in this.feature ? this.feature.id : null;\r\n    }\r\n\r\n    geometryType() {\r\n        return this.feature ? typeof this.feature.type === 'number' ? geometryTypes[this.feature.type] : this.feature.type : null;\r\n    }\r\n\r\n    properties() {\r\n        return this.feature && this.feature.properties || {};\r\n    }\r\n\r\n    pushScope(bindings: Array<[string, Expression]>) {\r\n        this.scope = this.scope.concat(bindings);\r\n    }\r\n\r\n    popScope() {\r\n        assert(this.scope.parent);\r\n        this.scope = (this.scope.parent: any);\r\n    }\r\n\r\n    parseColor(input: string): ?Color {\r\n        let cached = this._parseColorCache[input];\r\n        if (!cached) {\r\n            cached = this._parseColorCache[input] = Color.parse(input);\r\n        }\r\n        return cached;\r\n    }\r\n}\r\n\r\nmodule.exports = EvaluationContext;\r\n","// @flow\r\n\r\nconst UnitBezier = require('@mapbox/unitbezier');\r\nconst interpolate = require('../../util/interpolate');\r\nconst { toString, NumberType } = require('../types');\r\nconst { findStopLessThanOrEqualTo } = require(\"../stops\");\r\n\r\nimport type { Stops } from '../stops';\r\nimport type { Expression } from '../expression';\r\nimport type ParsingContext from '../parsing_context';\r\nimport type EvaluationContext from '../evaluation_context';\r\nimport type { Type } from '../types';\r\n\r\nexport type InterpolationType =\r\n    { name: 'linear' } |\r\n    { name: 'exponential', base: number } |\r\n    { name: 'cubic-bezier', controlPoints: [number, number, number, number] };\r\n\r\nclass Interpolate implements Expression {\r\n    type: Type;\r\n\r\n    interpolation: InterpolationType;\r\n    input: Expression;\r\n    labels: Array<number>;\r\n    outputs: Array<Expression>;\r\n\r\n    constructor(type: Type, interpolation: InterpolationType, input: Expression, stops: Stops) {\r\n        this.type = type;\r\n        this.interpolation = interpolation;\r\n        this.input = input;\r\n\r\n        this.labels = [];\r\n        this.outputs = [];\r\n        for (const [label, expression] of stops) {\r\n            this.labels.push(label);\r\n            this.outputs.push(expression);\r\n        }\r\n    }\r\n\r\n    static interpolationFactor(interpolation: InterpolationType, input: number, lower: number, upper: number) {\r\n        let t = 0;\r\n        if (interpolation.name === 'exponential') {\r\n            t = exponentialInterpolation(input, interpolation.base, lower, upper);\r\n        } else if (interpolation.name === 'linear') {\r\n            t = exponentialInterpolation(input, 1, lower, upper);\r\n        } else if (interpolation.name === 'cubic-bezier') {\r\n            const c = interpolation.controlPoints;\r\n            const ub = new UnitBezier(c[0], c[1], c[2], c[3]);\r\n            t = ub.solve(exponentialInterpolation(input, 1, lower, upper));\r\n        }\r\n        return t;\r\n    }\r\n\r\n    static parse(args: Array<mixed>, context: ParsingContext) {\r\n        let [ , interpolation, input, ...rest] = args;\r\n\r\n        if (!Array.isArray(interpolation) || interpolation.length === 0) {\r\n            return context.error(`Expected an interpolation type expression.`, 1);\r\n        }\r\n\r\n        if (interpolation[0] === 'linear') {\r\n            interpolation = { name: 'linear' };\r\n        } else if (interpolation[0] === 'exponential') {\r\n            const base = interpolation[1];\r\n            if (typeof base !== 'number')\r\n                return context.error(`Exponential interpolation requires a numeric base.`, 1, 1);\r\n            interpolation = {\r\n                name: 'exponential',\r\n                base\r\n            };\r\n        } else if (interpolation[0] === 'cubic-bezier') {\r\n            const controlPoints = interpolation.slice(1);\r\n            if (\r\n                controlPoints.length !== 4 ||\r\n                controlPoints.some(t => typeof t !== 'number' || t < 0 || t > 1)\r\n            ) {\r\n                return context.error('Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.', 1);\r\n            }\r\n\r\n            interpolation = {\r\n                name: 'cubic-bezier',\r\n                controlPoints: (controlPoints: any)\r\n            };\r\n        } else {\r\n            return context.error(`Unknown interpolation type ${String(interpolation[0])}`, 1, 0);\r\n        }\r\n\r\n        if (args.length - 1 < 4) {\r\n            return context.error(`Expected at least 4 arguments, but found only ${args.length - 1}.`);\r\n        }\r\n\r\n        if ((args.length - 1) % 2 !== 0) {\r\n            return context.error(`Expected an even number of arguments.`);\r\n        }\r\n\r\n        input = context.parse(input, 2, NumberType);\r\n        if (!input) return null;\r\n\r\n        const stops: Stops = [];\r\n\r\n        let outputType: Type = (null: any);\r\n        if (context.expectedType && context.expectedType.kind !== 'value') {\r\n            outputType = context.expectedType;\r\n        }\r\n\r\n        for (let i = 0; i < rest.length; i += 2) {\r\n            const label = rest[i];\r\n            const value = rest[i + 1];\r\n\r\n            const labelKey = i + 3;\r\n            const valueKey = i + 4;\r\n\r\n            if (typeof label !== 'number') {\r\n                return context.error('Input/output pairs for \"interpolate\" expressions must be defined using literal numeric values (not computed expressions) for the input values.', labelKey);\r\n            }\r\n\r\n            if (stops.length && stops[stops.length - 1][0] >= label) {\r\n                return context.error('Input/output pairs for \"interpolate\" expressions must be arranged with input values in strictly ascending order.', labelKey);\r\n            }\r\n\r\n            const parsed = context.parse(value, valueKey, outputType);\r\n            if (!parsed) return null;\r\n            outputType = outputType || parsed.type;\r\n            stops.push([label, parsed]);\r\n        }\r\n\r\n        if (outputType.kind !== 'number' &&\r\n            outputType.kind !== 'color' &&\r\n            !(\r\n                outputType.kind === 'array' &&\r\n                outputType.itemType.kind === 'number' &&\r\n                typeof outputType.N === 'number'\r\n            )\r\n        ) {\r\n            return context.error(`Type ${toString(outputType)} is not interpolatable.`);\r\n        }\r\n\r\n        return new Interpolate(outputType, interpolation, input, stops);\r\n    }\r\n\r\n    evaluate(ctx: EvaluationContext) {\r\n        const labels = this.labels;\r\n        const outputs = this.outputs;\r\n\r\n        if (labels.length === 1) {\r\n            return outputs[0].evaluate(ctx);\r\n        }\r\n\r\n        const value = ((this.input.evaluate(ctx): any): number);\r\n        if (value <= labels[0]) {\r\n            return outputs[0].evaluate(ctx);\r\n        }\r\n\r\n        const stopCount = labels.length;\r\n        if (value >= labels[stopCount - 1]) {\r\n            return outputs[stopCount - 1].evaluate(ctx);\r\n        }\r\n\r\n        const index = findStopLessThanOrEqualTo(labels, value);\r\n        const lower = labels[index];\r\n        const upper = labels[index + 1];\r\n        const t = Interpolate.interpolationFactor(this.interpolation, value, lower, upper);\r\n\r\n        const outputLower = outputs[index].evaluate(ctx);\r\n        const outputUpper = outputs[index + 1].evaluate(ctx);\r\n\r\n        return (interpolate[this.type.kind.toLowerCase()]: any)(outputLower, outputUpper, t);\r\n    }\r\n\r\n    eachChild(fn: (Expression) => void) {\r\n        fn(this.input);\r\n        for (const expression of this.outputs) {\r\n            fn(expression);\r\n        }\r\n    }\r\n\r\n    possibleOutputs() {\r\n        return [].concat(...this.outputs.map((output) => output.possibleOutputs()));\r\n    }\r\n}\r\n\r\n/**\r\n * Returns a ratio that can be used to interpolate between exponential function\r\n * stops.\r\n * How it works: Two consecutive stop values define a (scaled and shifted) exponential function `f(x) = a * base^x + b`, where `base` is the user-specified base,\r\n * and `a` and `b` are constants affording sufficient degrees of freedom to fit\r\n * the function to the given stops.\r\n *\r\n * Here's a bit of algebra that lets us compute `f(x)` directly from the stop\r\n * values without explicitly solving for `a` and `b`:\r\n *\r\n * First stop value: `f(x0) = y0 = a * base^x0 + b`\r\n * Second stop value: `f(x1) = y1 = a * base^x1 + b`\r\n * => `y1 - y0 = a(base^x1 - base^x0)`\r\n * => `a = (y1 - y0)/(base^x1 - base^x0)`\r\n *\r\n * Desired value: `f(x) = y = a * base^x + b`\r\n * => `f(x) = y0 + a * (base^x - base^x0)`\r\n *\r\n * From the above, we can replace the `a` in `a * (base^x - base^x0)` and do a\r\n * little algebra:\r\n * ```\r\n * a * (base^x - base^x0) = (y1 - y0)/(base^x1 - base^x0) * (base^x - base^x0)\r\n *                     = (y1 - y0) * (base^x - base^x0) / (base^x1 - base^x0)\r\n * ```\r\n *\r\n * If we let `(base^x - base^x0) / (base^x1 base^x0)`, then we have\r\n * `f(x) = y0 + (y1 - y0) * ratio`.  In other words, `ratio` may be treated as\r\n * an interpolation factor between the two stops' output values.\r\n *\r\n * (Note: a slightly different form for `ratio`,\r\n * `(base^(x-x0) - 1) / (base^(x1-x0) - 1) `, is equivalent, but requires fewer\r\n * expensive `Math.pow()` operations.)\r\n *\r\n * @private\r\n*/\r\nfunction exponentialInterpolation(input, base, lowerValue, upperValue) {\r\n    const difference = upperValue - lowerValue;\r\n    const progress = input - lowerValue;\r\n\r\n    if (difference === 0) {\r\n        return 0;\r\n    } else if (base === 1) {\r\n        return progress / difference;\r\n    } else {\r\n        return (Math.pow(base, progress) - 1) / (Math.pow(base, difference) - 1);\r\n    }\r\n}\r\n\r\nmodule.exports = Interpolate;\r\n","\r\nconst colorSpaces = require('../util/color_spaces');\r\nconst Color = require('../util/color');\r\nconst extend = require('../util/extend');\r\nconst getType = require('../util/get_type');\r\nconst interpolate = require('../util/interpolate');\r\nconst Interpolate = require('../expression/definitions/interpolate');\r\n\r\nfunction isFunction(value) {\r\n    return typeof value === 'object' && value !== null && !Array.isArray(value);\r\n}\r\n\r\nfunction identityFunction(x) {\r\n    return x;\r\n}\r\n\r\nfunction createFunction(parameters, propertySpec) {\r\n    const isColor = propertySpec.type === 'color';\r\n    const zoomAndFeatureDependent = parameters.stops && typeof parameters.stops[0][0] === 'object';\r\n    const featureDependent = zoomAndFeatureDependent || parameters.property !== undefined;\r\n    const zoomDependent = zoomAndFeatureDependent || !featureDependent;\r\n    const type = parameters.type || (propertySpec.function === 'interpolated' ? 'exponential' : 'interval');\r\n\r\n    if (isColor) {\r\n        parameters = extend({}, parameters);\r\n\r\n        if (parameters.stops) {\r\n            parameters.stops = parameters.stops.map((stop) => {\r\n                return [stop[0], Color.parse(stop[1])];\r\n            });\r\n        }\r\n\r\n        if (parameters.default) {\r\n            parameters.default = Color.parse(parameters.default);\r\n        } else {\r\n            parameters.default = Color.parse(propertySpec.default);\r\n        }\r\n    }\r\n\r\n    if (parameters.colorSpace && parameters.colorSpace !== 'rgb' && !colorSpaces[parameters.colorSpace]) {\r\n        throw new Error(`Unknown color space: ${parameters.colorSpace}`);\r\n    }\r\n\r\n    let innerFun;\r\n    let hashedStops;\r\n    let categoricalKeyType;\r\n    if (type === 'exponential') {\r\n        innerFun = evaluateExponentialFunction;\r\n    } else if (type === 'interval') {\r\n        innerFun = evaluateIntervalFunction;\r\n    } else if (type === 'categorical') {\r\n        innerFun = evaluateCategoricalFunction;\r\n\r\n        // For categorical functions, generate an Object as a hashmap of the stops for fast searching\r\n        hashedStops = Object.create(null);\r\n        for (const stop of parameters.stops) {\r\n            hashedStops[stop[0]] = stop[1];\r\n        }\r\n\r\n        // Infer key type based on first stop key-- used to encforce strict type checking later\r\n        categoricalKeyType = typeof parameters.stops[0][0];\r\n\r\n    } else if (type === 'identity') {\r\n        innerFun = evaluateIdentityFunction;\r\n    } else {\r\n        throw new Error(`Unknown function type \"${type}\"`);\r\n    }\r\n\r\n    if (zoomAndFeatureDependent) {\r\n        const featureFunctions = {};\r\n        const zoomStops = [];\r\n        for (let s = 0; s < parameters.stops.length; s++) {\r\n            const stop = parameters.stops[s];\r\n            const zoom = stop[0].zoom;\r\n            if (featureFunctions[zoom] === undefined) {\r\n                featureFunctions[zoom] = {\r\n                    zoom: zoom,\r\n                    type: parameters.type,\r\n                    property: parameters.property,\r\n                    default: parameters.default,\r\n                    stops: []\r\n                };\r\n                zoomStops.push(zoom);\r\n            }\r\n            featureFunctions[zoom].stops.push([stop[0].value, stop[1]]);\r\n        }\r\n\r\n        const featureFunctionStops = [];\r\n        for (const z of zoomStops) {\r\n            featureFunctionStops.push([featureFunctions[z].zoom, createFunction(featureFunctions[z], propertySpec)]);\r\n        }\r\n\r\n        return {\r\n            kind: 'composite',\r\n            interpolationFactor: Interpolate.interpolationFactor.bind(undefined, {name: 'linear'}),\r\n            zoomStops: featureFunctionStops.map(s => s[0]),\r\n            evaluate({zoom}, properties) {\r\n                return evaluateExponentialFunction({\r\n                    stops: featureFunctionStops,\r\n                    base: parameters.base\r\n                }, propertySpec, zoom).evaluate(zoom, properties);\r\n            }\r\n        };\r\n    } else if (zoomDependent) {\r\n        return {\r\n            kind: 'camera',\r\n            interpolationFactor: type === 'exponential' ?\r\n                Interpolate.interpolationFactor.bind(undefined, {name: 'exponential', base: parameters.base !== undefined ? parameters.base : 1}) :\r\n                () => 0,\r\n            zoomStops: parameters.stops.map(s => s[0]),\r\n            evaluate: ({zoom}) => innerFun(parameters, propertySpec, zoom, hashedStops, categoricalKeyType)\r\n        };\r\n    } else {\r\n        return {\r\n            kind: 'source',\r\n            evaluate(_, feature) {\r\n                const value = feature && feature.properties ? feature.properties[parameters.property] : undefined;\r\n                if (value === undefined) {\r\n                    return coalesce(parameters.default, propertySpec.default);\r\n                }\r\n                return innerFun(parameters, propertySpec, value, hashedStops, categoricalKeyType);\r\n            }\r\n        };\r\n    }\r\n}\r\n\r\nfunction coalesce(a, b, c) {\r\n    if (a !== undefined) return a;\r\n    if (b !== undefined) return b;\r\n    if (c !== undefined) return c;\r\n}\r\n\r\nfunction evaluateCategoricalFunction(parameters, propertySpec, input, hashedStops, keyType) {\r\n    const evaluated = typeof input === keyType ? hashedStops[input] : undefined; // Enforce strict typing on input\r\n    return coalesce(evaluated, parameters.default, propertySpec.default);\r\n}\r\n\r\nfunction evaluateIntervalFunction(parameters, propertySpec, input) {\r\n    // Edge cases\r\n    if (getType(input) !== 'number') return coalesce(parameters.default, propertySpec.default);\r\n    const n = parameters.stops.length;\r\n    if (n === 1) return parameters.stops[0][1];\r\n    if (input <= parameters.stops[0][0]) return parameters.stops[0][1];\r\n    if (input >= parameters.stops[n - 1][0]) return parameters.stops[n - 1][1];\r\n\r\n    const index = findStopLessThanOrEqualTo(parameters.stops, input);\r\n\r\n    return parameters.stops[index][1];\r\n}\r\n\r\nfunction evaluateExponentialFunction(parameters, propertySpec, input) {\r\n    const base = parameters.base !== undefined ? parameters.base : 1;\r\n\r\n    // Edge cases\r\n    if (getType(input) !== 'number') return coalesce(parameters.default, propertySpec.default);\r\n    const n = parameters.stops.length;\r\n    if (n === 1) return parameters.stops[0][1];\r\n    if (input <= parameters.stops[0][0]) return parameters.stops[0][1];\r\n    if (input >= parameters.stops[n - 1][0]) return parameters.stops[n - 1][1];\r\n\r\n    const index = findStopLessThanOrEqualTo(parameters.stops, input);\r\n    const t = interpolationFactor(\r\n        input, base,\r\n        parameters.stops[index][0],\r\n        parameters.stops[index + 1][0]);\r\n\r\n    const outputLower = parameters.stops[index][1];\r\n    const outputUpper = parameters.stops[index + 1][1];\r\n    let interp = interpolate[propertySpec.type] || identityFunction;\r\n\r\n    if (parameters.colorSpace && parameters.colorSpace !== 'rgb') {\r\n        const colorspace = colorSpaces[parameters.colorSpace];\r\n        interp = (a, b) => colorspace.reverse(colorspace.interpolate(colorspace.forward(a), colorspace.forward(b), t));\r\n    }\r\n\r\n    if (typeof outputLower.evaluate === 'function') {\r\n        return {\r\n            evaluate(...args) {\r\n                const evaluatedLower = outputLower.evaluate.apply(undefined, args);\r\n                const evaluatedUpper = outputUpper.evaluate.apply(undefined, args);\r\n                // Special case for fill-outline-color, which has no spec default.\r\n                if (evaluatedLower === undefined || evaluatedUpper === undefined) {\r\n                    return undefined;\r\n                }\r\n                return interp(evaluatedLower, evaluatedUpper, t);\r\n            }\r\n        };\r\n    }\r\n\r\n    return interp(outputLower, outputUpper, t);\r\n}\r\n\r\nfunction evaluateIdentityFunction(parameters, propertySpec, input) {\r\n    if (propertySpec.type === 'color') {\r\n        input = Color.parse(input);\r\n    } else if (getType(input) !== propertySpec.type && (propertySpec.type !== 'enum' || !propertySpec.values[input])) {\r\n        input = undefined;\r\n    }\r\n    return coalesce(input, parameters.default, propertySpec.default);\r\n}\r\n\r\n/**\r\n * Returns the index of the last stop <= input, or 0 if it doesn't exist.\r\n *\r\n * @private\r\n */\r\nfunction findStopLessThanOrEqualTo(stops, input) {\r\n    const n = stops.length;\r\n    let lowerIndex = 0;\r\n    let upperIndex = n - 1;\r\n    let currentIndex = 0;\r\n    let currentValue, upperValue;\r\n\r\n    while (lowerIndex <= upperIndex) {\r\n        currentIndex = Math.floor((lowerIndex + upperIndex) / 2);\r\n        currentValue = stops[currentIndex][0];\r\n        upperValue = stops[currentIndex + 1][0];\r\n        if (input === currentValue || input > currentValue && input < upperValue) { // Search complete\r\n            return currentIndex;\r\n        } else if (currentValue < input) {\r\n            lowerIndex = currentIndex + 1;\r\n        } else if (currentValue > input) {\r\n            upperIndex = currentIndex - 1;\r\n        }\r\n    }\r\n\r\n    return Math.max(currentIndex - 1, 0);\r\n}\r\n\r\n/**\r\n * Returns a ratio that can be used to interpolate between exponential function\r\n * stops.\r\n *\r\n * How it works:\r\n * Two consecutive stop values define a (scaled and shifted) exponential\r\n * function `f(x) = a * base^x + b`, where `base` is the user-specified base,\r\n * and `a` and `b` are constants affording sufficient degrees of freedom to fit\r\n * the function to the given stops.\r\n *\r\n * Here's a bit of algebra that lets us compute `f(x)` directly from the stop\r\n * values without explicitly solving for `a` and `b`:\r\n *\r\n * First stop value: `f(x0) = y0 = a * base^x0 + b`\r\n * Second stop value: `f(x1) = y1 = a * base^x1 + b`\r\n * => `y1 - y0 = a(base^x1 - base^x0)`\r\n * => `a = (y1 - y0)/(base^x1 - base^x0)`\r\n *\r\n * Desired value: `f(x) = y = a * base^x + b`\r\n * => `f(x) = y0 + a * (base^x - base^x0)`\r\n *\r\n * From the above, we can replace the `a` in `a * (base^x - base^x0)` and do a\r\n * little algebra:\r\n * ```\r\n * a * (base^x - base^x0) = (y1 - y0)/(base^x1 - base^x0) * (base^x - base^x0)\r\n *                     = (y1 - y0) * (base^x - base^x0) / (base^x1 - base^x0)\r\n * ```\r\n *\r\n * If we let `(base^x - base^x0) / (base^x1 base^x0)`, then we have\r\n * `f(x) = y0 + (y1 - y0) * ratio`.  In other words, `ratio` may be treated as\r\n * an interpolation factor between the two stops' output values.\r\n *\r\n * (Note: a slightly different form for `ratio`,\r\n * `(base^(x-x0) - 1) / (base^(x1-x0) - 1) `, is equivalent, but requires fewer\r\n * expensive `Math.pow()` operations.)\r\n *\r\n * @private\r\n */\r\nfunction interpolationFactor(input, base, lowerValue, upperValue) {\r\n    const difference = upperValue - lowerValue;\r\n    const progress = input - lowerValue;\r\n\r\n    if (difference === 0) {\r\n        return 0;\r\n    } else if (base === 1) {\r\n        return progress / difference;\r\n    } else {\r\n        return (Math.pow(base, progress) - 1) / (Math.pow(base, difference) - 1);\r\n    }\r\n}\r\n\r\nmodule.exports = {\r\n    createFunction,\r\n    isFunction\r\n};\r\n","// @flow\r\n\r\n/* eslint-env browser */\r\nmodule.exports = (self: Window);\r\n","\r\nconst ValidationError = require('../error/validation_error');\r\nconst unbundle = require('../util/unbundle_jsonlint');\r\n\r\nmodule.exports = function validateEnum(options) {\r\n    const key = options.key;\r\n    const value = options.value;\r\n    const valueSpec = options.valueSpec;\r\n    const errors = [];\r\n\r\n    if (Array.isArray(valueSpec.values)) { // <=v7\r\n        if (valueSpec.values.indexOf(unbundle(value)) === -1) {\r\n            errors.push(new ValidationError(key, value, `expected one of [${valueSpec.values.join(', ')}], ${JSON.stringify(value)} found`));\r\n        }\r\n    } else { // >=v8\r\n        if (Object.keys(valueSpec.values).indexOf(unbundle(value)) === -1) {\r\n            errors.push(new ValidationError(key, value, `expected one of [${Object.keys(valueSpec.values).join(', ')}], ${JSON.stringify(value)} found`));\r\n        }\r\n    }\r\n    return errors;\r\n};\r\n","\r\nconst ValidationError = require('../error/validation_error');\r\nconst validateExpression = require('./validate_expression');\r\nconst validateEnum = require('./validate_enum');\r\nconst getType = require('../util/get_type');\r\nconst unbundle = require('../util/unbundle_jsonlint');\r\nconst extend = require('../util/extend');\r\nconst {isExpressionFilter} = require('../feature_filter');\r\n\r\nmodule.exports = function validateFilter(options) {\r\n    if (isExpressionFilter(unbundle.deep(options.value))) {\r\n        return validateExpression(extend({}, options, {\r\n            expressionContext: 'filter',\r\n            valueSpec: { value: 'boolean' }\r\n        }));\r\n    } else {\r\n        return validateNonExpressionFilter(options);\r\n    }\r\n};\r\n\r\nfunction validateNonExpressionFilter(options) {\r\n    const value = options.value;\r\n    const key = options.key;\r\n\r\n    if (getType(value) !== 'array') {\r\n        return [new ValidationError(key, value, `array expected, ${getType(value)} found`)];\r\n    }\r\n\r\n    const styleSpec = options.styleSpec;\r\n    let type;\r\n\r\n    let errors = [];\r\n\r\n    if (value.length < 1) {\r\n        return [new ValidationError(key, value, 'filter array must have at least 1 element')];\r\n    }\r\n\r\n    errors = errors.concat(validateEnum({\r\n        key: `${key}[0]`,\r\n        value: value[0],\r\n        valueSpec: styleSpec.filter_operator,\r\n        style: options.style,\r\n        styleSpec: options.styleSpec\r\n    }));\r\n\r\n    switch (unbundle(value[0])) {\r\n    case '<':\r\n    case '<=':\r\n    case '>':\r\n    case '>=':\r\n        if (value.length >= 2 && unbundle(value[1]) === '$type') {\r\n            errors.push(new ValidationError(key, value, `\"$type\" cannot be use with operator \"${value[0]}\"`));\r\n        }\r\n        /* falls through */\r\n    case '==':\r\n    case '!=':\r\n        if (value.length !== 3) {\r\n            errors.push(new ValidationError(key, value, `filter array for operator \"${value[0]}\" must have 3 elements`));\r\n        }\r\n        /* falls through */\r\n    case 'in':\r\n    case '!in':\r\n        if (value.length >= 2) {\r\n            type = getType(value[1]);\r\n            if (type !== 'string') {\r\n                errors.push(new ValidationError(`${key}[1]`, value[1], `string expected, ${type} found`));\r\n            }\r\n        }\r\n        for (let i = 2; i < value.length; i++) {\r\n            type = getType(value[i]);\r\n            if (unbundle(value[1]) === '$type') {\r\n                errors = errors.concat(validateEnum({\r\n                    key: `${key}[${i}]`,\r\n                    value: value[i],\r\n                    valueSpec: styleSpec.geometry_type,\r\n                    style: options.style,\r\n                    styleSpec: options.styleSpec\r\n                }));\r\n            } else if (type !== 'string' && type !== 'number' && type !== 'boolean') {\r\n                errors.push(new ValidationError(`${key}[${i}]`, value[i], `string, number, or boolean expected, ${type} found`));\r\n            }\r\n        }\r\n        break;\r\n\r\n    case 'any':\r\n    case 'all':\r\n    case 'none':\r\n        for (let i = 1; i < value.length; i++) {\r\n            errors = errors.concat(validateNonExpressionFilter({\r\n                key: `${key}[${i}]`,\r\n                value: value[i],\r\n                style: options.style,\r\n                styleSpec: options.styleSpec\r\n            }));\r\n        }\r\n        break;\r\n\r\n    case 'has':\r\n    case '!has':\r\n        type = getType(value[1]);\r\n        if (value.length !== 2) {\r\n            errors.push(new ValidationError(key, value, `filter array for \"${value[0]}\" operator must have 2 elements`));\r\n        } else if (type !== 'string') {\r\n            errors.push(new ValidationError(`${key}[1]`, value[1], `string expected, ${type} found`));\r\n        }\r\n        break;\r\n\r\n    }\r\n\r\n    return errors;\r\n}\r\n","// @flow\r\n\r\nconst {createExpression} = require('../expression');\r\n\r\nimport type {GlobalProperties} from '../expression';\r\nexport type FeatureFilter = (globalProperties: GlobalProperties, feature: VectorTileFeature) => boolean;\r\n\r\nmodule.exports = createFilter;\r\nmodule.exports.isExpressionFilter = isExpressionFilter;\r\n\r\nfunction isExpressionFilter(filter) {\r\n    if (!Array.isArray(filter) || filter.length === 0) {\r\n        return false;\r\n    }\r\n    switch (filter[0]) {\r\n    case 'has':\r\n        return filter.length >= 2 && filter[1] !== '$id' && filter[1] !== '$type';\r\n\r\n    case 'in':\r\n    case '!in':\r\n    case '!has':\r\n    case 'none':\r\n        return false;\r\n\r\n    case '==':\r\n    case '!=':\r\n    case '>':\r\n    case '>=':\r\n    case '<':\r\n    case '<=':\r\n        return filter.length === 3 && (Array.isArray(filter[1]) || Array.isArray(filter[2]));\r\n\r\n    case 'any':\r\n    case 'all':\r\n        for (const f of filter.slice(1)) {\r\n            if (!isExpressionFilter(f) && typeof f !== 'boolean') {\r\n                return false;\r\n            }\r\n        }\r\n        return true;\r\n\r\n    default:\r\n        return true;\r\n    }\r\n}\r\n\r\nconst filterSpec = {\r\n    'type': 'boolean',\r\n    'default': false,\r\n    'function': true,\r\n    'property-function': true,\r\n    'zoom-function': true\r\n};\r\n\r\n/**\r\n * Given a filter expressed as nested arrays, return a new function\r\n * that evaluates whether a given feature (with a .properties or .tags property)\r\n * passes its test.\r\n *\r\n * @private\r\n * @param {Array} filter mapbox gl filter\r\n * @returns {Function} filter-evaluating function\r\n */\r\nfunction createFilter(filter: any): FeatureFilter {\r\n    if (!filter) {\r\n        return () => true;\r\n    }\r\n\r\n    if (!isExpressionFilter(filter)) {\r\n        filter = convertFilter(filter);\r\n    }\r\n\r\n    const compiled = createExpression(filter, filterSpec);\r\n    if (compiled.result === 'error') {\r\n        throw new Error(compiled.value.map(err => `${err.key}: ${err.message}`).join(', '));\r\n    } else {\r\n        return (globalProperties: GlobalProperties, feature: VectorTileFeature) => compiled.value.evaluate(globalProperties, feature);\r\n    }\r\n}\r\n\r\n// Comparison function to sort numbers and strings\r\nfunction compare(a, b) {\r\n    return a < b ? -1 : a > b ? 1 : 0;\r\n}\r\n\r\nfunction convertFilter(filter: ?Array<any>): mixed {\r\n    if (!filter) return true;\r\n    const op = filter[0];\r\n    if (filter.length <= 1) return (op !== 'any');\r\n    const converted =\r\n        op === '==' ? convertComparisonOp(filter[1], filter[2], '==') :\r\n        op === '!=' ? convertNegation(convertComparisonOp(filter[1], filter[2], '==')) :\r\n        op === '<' ||\r\n        op === '>' ||\r\n        op === '<=' ||\r\n        op === '>=' ? convertComparisonOp(filter[1], filter[2], op) :\r\n        op === 'any' ? convertDisjunctionOp(filter.slice(1)) :\r\n        op === 'all' ? ['all'].concat(filter.slice(1).map(convertFilter)) :\r\n        op === 'none' ? ['all'].concat(filter.slice(1).map(convertFilter).map(convertNegation)) :\r\n        op === 'in' ? convertInOp(filter[1], filter.slice(2)) :\r\n        op === '!in' ? convertNegation(convertInOp(filter[1], filter.slice(2))) :\r\n        op === 'has' ? convertHasOp(filter[1]) :\r\n        op === '!has' ? convertNegation(convertHasOp(filter[1])) :\r\n        true;\r\n    return converted;\r\n}\r\n\r\nfunction convertComparisonOp(property: string, value: any, op: string) {\r\n    switch (property) {\r\n    case '$type':\r\n        return [`filter-type-${op}`, value];\r\n    case '$id':\r\n        return [`filter-id-${op}`, value];\r\n    default:\r\n        return [`filter-${op}`, property, value];\r\n    }\r\n}\r\n\r\nfunction convertDisjunctionOp(filters: Array<Array<any>>) {\r\n    return ['any'].concat(filters.map(convertFilter));\r\n}\r\n\r\nfunction convertInOp(property: string, values: Array<any>) {\r\n    if (values.length === 0) { return false; }\r\n    switch (property) {\r\n    case '$type':\r\n        return [`filter-type-in`, ['literal', values]];\r\n    case '$id':\r\n        return [`filter-id-in`, ['literal', values]];\r\n    default:\r\n        if (values.length > 200 && !values.some(v => typeof v !== typeof values[0])) {\r\n            return ['filter-in-large', property, ['literal', values.sort(compare)]];\r\n        } else {\r\n            return ['filter-in-small', property, ['literal', values]];\r\n        }\r\n    }\r\n}\r\n\r\nfunction convertHasOp(property: string) {\r\n    switch (property) {\r\n    case '$type':\r\n        return true;\r\n    case '$id':\r\n        return [`filter-has-id`];\r\n    default:\r\n        return [`filter-has`, property];\r\n    }\r\n}\r\n\r\nfunction convertNegation(filter: mixed) {\r\n    return ['!', filter];\r\n}\r\n\r\n","// @flow\r\n\r\nconst quickselect = require('quickselect');\r\nconst calculateSignedArea = require('./util').calculateSignedArea;\r\n\r\nimport type Point from '@mapbox/point-geometry';\r\n\r\n// classifies an array of rings into polygons with outer rings and holes\r\nmodule.exports = function classifyRings(rings: Array<Array<Point>>, maxRings: number) {\r\n    const len = rings.length;\r\n\r\n    if (len <= 1) return [rings];\r\n\r\n    const polygons = [];\r\n    let polygon,\r\n        ccw;\r\n\r\n    for (let i = 0; i < len; i++) {\r\n        const area = calculateSignedArea(rings[i]);\r\n        if (area === 0) continue;\r\n\r\n        (rings[i]: any).area = Math.abs(area);\r\n\r\n        if (ccw === undefined) ccw = area < 0;\r\n\r\n        if (ccw === area < 0) {\r\n            if (polygon) polygons.push(polygon);\r\n            polygon = [rings[i]];\r\n\r\n        } else {\r\n            (polygon: any).push(rings[i]);\r\n        }\r\n    }\r\n    if (polygon) polygons.push(polygon);\r\n\r\n    // Earcut performance degrages with the # of rings in a polygon. For this\r\n    // reason, we limit strip out all but the `maxRings` largest rings.\r\n    if (maxRings > 1) {\r\n        for (let j = 0; j < polygons.length; j++) {\r\n            if (polygons[j].length <= maxRings) continue;\r\n            quickselect(polygons[j], maxRings, 1, polygons[j].length - 1, compareAreas);\r\n            polygons[j] = polygons[j].slice(0, maxRings);\r\n        }\r\n    }\r\n\r\n    return polygons;\r\n};\r\n\r\nfunction compareAreas(a, b) {\r\n    return b.area - a.area;\r\n}\r\n","// @flow\r\n\r\nconst ZoomHistory = require('./zoom_history');\r\n\r\nclass EvaluationParameters {\r\n    zoom: number;\r\n    now: number;\r\n    fadeDuration: number;\r\n    zoomHistory: ZoomHistory;\r\n    transition: TransitionSpecification;\r\n\r\n    constructor(zoom: number, options?: *) {\r\n        this.zoom = zoom;\r\n\r\n        if (options) {\r\n            this.now = options.now;\r\n            this.fadeDuration = options.fadeDuration;\r\n            this.zoomHistory = options.zoomHistory;\r\n            this.transition = options.transition;\r\n        } else {\r\n            this.now = 0;\r\n            this.fadeDuration = 0;\r\n            this.zoomHistory = new ZoomHistory();\r\n            this.transition = {};\r\n        }\r\n    }\r\n\r\n    crossFadingFactor() {\r\n        if (this.fadeDuration === 0) {\r\n            return 1;\r\n        } else {\r\n            return Math.min((this.now - this.zoomHistory.lastIntegerZoomTime) / this.fadeDuration, 1);\r\n        }\r\n    }\r\n}\r\n\r\nmodule.exports = EvaluationParameters;\r\n","// @flow\r\n\r\nconst {\r\n    symbolLayoutAttributes,\r\n    collisionVertexAttributes,\r\n    collisionBoxLayout,\r\n    collisionCircleLayout,\r\n    dynamicLayoutAttributes\r\n} = require('./symbol_attributes');\r\n\r\nconst {\r\n    SymbolLayoutArray,\r\n    SymbolDynamicLayoutArray,\r\n    SymbolOpacityArray,\r\n    CollisionBoxLayoutArray,\r\n    CollisionCircleLayoutArray,\r\n    CollisionVertexArray,\r\n    PlacedSymbolArray,\r\n    GlyphOffsetArray,\r\n    SymbolLineVertexArray\r\n} = require('../array_types');\r\n\r\nconst Point = require('@mapbox/point-geometry');\r\nconst {SegmentVector} = require('../segment');\r\nconst {ProgramConfigurationSet} = require('../program_configuration');\r\nconst {TriangleIndexArray, LineIndexArray} = require('../index_array_type');\r\nconst transformText = require('../../symbol/transform_text');\r\nconst mergeLines = require('../../symbol/mergelines');\r\nconst scriptDetection = require('../../util/script_detection');\r\nconst loadGeometry = require('../load_geometry');\r\nconst vectorTileFeatureTypes = require('@mapbox/vector-tile').VectorTileFeature.types;\r\nconst verticalizePunctuation = require('../../util/verticalize_punctuation');\r\nconst Anchor = require('../../symbol/anchor');\r\nconst {getSizeData} = require('../../symbol/symbol_size');\r\nconst {register} = require('../../util/web_worker_transfer');\r\n\r\nimport type {Feature as ExpressionFeature} from '../../style-spec/expression';\r\nimport type {\r\n    Bucket,\r\n    BucketParameters,\r\n    IndexedFeature,\r\n    PopulateParameters\r\n} from '../bucket';\r\nimport type {CollisionBoxArray, CollisionBox} from '../array_types';\r\nimport type { StructArray, StructArrayMember } from '../../util/struct_array';\r\nimport type SymbolStyleLayer from '../../style/style_layer/symbol_style_layer';\r\nimport type Context from '../../gl/context';\r\nimport type IndexBuffer from '../../gl/index_buffer';\r\nimport type VertexBuffer from '../../gl/vertex_buffer';\r\nimport type {SymbolQuad} from '../../symbol/quads';\r\nimport type {SizeData} from '../../symbol/symbol_size';\r\n\r\nexport type SingleCollisionBox = {\r\n    x1: number;\r\n    y1: number;\r\n    x2: number;\r\n    y2: number;\r\n    anchorPointX: number;\r\n    anchorPointY: number;\r\n};\r\n\r\nexport type CollisionArrays = {\r\n    textBox?: SingleCollisionBox;\r\n    iconBox?: SingleCollisionBox;\r\n    textCircles?: Array<number>;\r\n};\r\n\r\nexport type SymbolInstance = {\r\n    key: string,\r\n    textBoxStartIndex: number,\r\n    textBoxEndIndex: number,\r\n    iconBoxStartIndex: number,\r\n    iconBoxEndIndex: number,\r\n    textOffset: [number, number],\r\n    iconOffset: [number, number],\r\n    anchor: Anchor,\r\n    line: Array<Point>,\r\n    featureIndex: number,\r\n    feature: ExpressionFeature,\r\n    textCollisionFeature?: {boxStartIndex: number, boxEndIndex: number},\r\n    iconCollisionFeature?: {boxStartIndex: number, boxEndIndex: number},\r\n    placedTextSymbolIndices: Array<number>;\r\n    numGlyphVertices: number;\r\n    numVerticalGlyphVertices: number;\r\n    numIconVertices: number;\r\n    // Populated/modified on foreground during placement\r\n    isDuplicate: boolean;\r\n    crossTileID: number;\r\n    collisionArrays?: CollisionArrays;\r\n    placedText?: boolean;\r\n    placedIcon?: boolean;\r\n    hidden?: boolean;\r\n};\r\n\r\nexport type SymbolFeature = {|\r\n    text: string | void,\r\n    icon: string | void,\r\n    index: number,\r\n    sourceLayerIndex: number,\r\n    geometry: Array<Array<Point>>,\r\n    properties: Object,\r\n    type: 'Point' | 'LineString' | 'Polygon',\r\n    id?: any\r\n|};\r\n\r\n// Opacity arrays are frequently updated but don't contain a lot of information, so we pack them\r\n// tight. Each Uint32 is actually four duplicate Uint8s for the four corners of a glyph\r\n// 7 bits are for the current opacity, and the lowest bit is the target opacity\r\n\r\n// actually defined in symbol_attributes.js\r\n// const placementOpacityAttributes = [\r\n//     { name: 'a_fade_opacity', components: 1, type: 'Uint32' }\r\n// ];\r\nconst shaderOpacityAttributes = [\r\n    { name: 'a_fade_opacity', components: 1, type: 'Uint8', offset: 0 }\r\n];\r\n\r\nfunction addVertex(array, anchorX, anchorY, ox, oy, tx, ty, sizeVertex) {\r\n    array.emplaceBack(\r\n        // a_pos_offset\r\n        anchorX,\r\n        anchorY,\r\n        Math.round(ox * 64),\r\n        Math.round(oy * 64),\r\n\r\n        // a_data\r\n        tx, // x coordinate of symbol on glyph atlas texture\r\n        ty, // y coordinate of symbol on glyph atlas texture\r\n        sizeVertex ? sizeVertex[0] : 0,\r\n        sizeVertex ? sizeVertex[1] : 0\r\n    );\r\n}\r\n\r\nfunction addDynamicAttributes(dynamicLayoutVertexArray: StructArray, p: Point, angle: number) {\r\n    dynamicLayoutVertexArray.emplaceBack(p.x, p.y, angle);\r\n    dynamicLayoutVertexArray.emplaceBack(p.x, p.y, angle);\r\n    dynamicLayoutVertexArray.emplaceBack(p.x, p.y, angle);\r\n    dynamicLayoutVertexArray.emplaceBack(p.x, p.y, angle);\r\n}\r\n\r\nclass SymbolBuffers {\r\n    layoutVertexArray: SymbolLayoutArray;\r\n    layoutVertexBuffer: VertexBuffer;\r\n\r\n    indexArray: TriangleIndexArray;\r\n    indexBuffer: IndexBuffer;\r\n\r\n    programConfigurations: ProgramConfigurationSet<SymbolStyleLayer>;\r\n    segments: SegmentVector;\r\n\r\n    dynamicLayoutVertexArray: SymbolDynamicLayoutArray;\r\n    dynamicLayoutVertexBuffer: VertexBuffer;\r\n\r\n    opacityVertexArray: SymbolOpacityArray;\r\n    opacityVertexBuffer: VertexBuffer;\r\n\r\n    collisionVertexArray: CollisionVertexArray;\r\n    collisionVertexBuffer: VertexBuffer;\r\n\r\n    placedSymbolArray: PlacedSymbolArray;\r\n\r\n    constructor(programConfigurations: ProgramConfigurationSet<SymbolStyleLayer>) {\r\n        this.layoutVertexArray = new SymbolLayoutArray();\r\n        this.indexArray = new TriangleIndexArray();\r\n        this.programConfigurations = programConfigurations;\r\n        this.segments = new SegmentVector();\r\n        this.dynamicLayoutVertexArray = new SymbolDynamicLayoutArray();\r\n        this.opacityVertexArray = new SymbolOpacityArray();\r\n        this.placedSymbolArray = new PlacedSymbolArray();\r\n    }\r\n\r\n    upload(context: Context, dynamicIndexBuffer: boolean) {\r\n        this.layoutVertexBuffer = context.createVertexBuffer(this.layoutVertexArray, symbolLayoutAttributes.members);\r\n        this.indexBuffer = context.createIndexBuffer(this.indexArray, dynamicIndexBuffer);\r\n        this.programConfigurations.upload(context);\r\n        this.dynamicLayoutVertexBuffer = context.createVertexBuffer(this.dynamicLayoutVertexArray, dynamicLayoutAttributes.members, true);\r\n        this.opacityVertexBuffer = context.createVertexBuffer(this.opacityVertexArray, shaderOpacityAttributes, true);\r\n        // This is a performance hack so that we can write to opacityVertexArray with uint32s\r\n        // even though the shaders read uint8s\r\n        this.opacityVertexBuffer.itemSize = 1;\r\n    }\r\n\r\n    destroy() {\r\n        if (!this.layoutVertexBuffer) return;\r\n        this.layoutVertexBuffer.destroy();\r\n        this.indexBuffer.destroy();\r\n        this.programConfigurations.destroy();\r\n        this.segments.destroy();\r\n        this.dynamicLayoutVertexBuffer.destroy();\r\n        this.opacityVertexBuffer.destroy();\r\n    }\r\n}\r\n\r\nregister('SymbolBuffers', SymbolBuffers);\r\n\r\nclass CollisionBuffers {\r\n    layoutVertexArray: StructArray;\r\n    layoutAttributes: Array<StructArrayMember>;\r\n    layoutVertexBuffer: VertexBuffer;\r\n\r\n    indexArray: TriangleIndexArray | LineIndexArray;\r\n    indexBuffer: IndexBuffer;\r\n\r\n    segments: SegmentVector;\r\n\r\n    collisionVertexArray: CollisionVertexArray;\r\n    collisionVertexBuffer: VertexBuffer;\r\n\r\n    constructor(LayoutArray: Class<StructArray>,\r\n                layoutAttributes: Array<StructArrayMember>,\r\n                IndexArray: Class<TriangleIndexArray | LineIndexArray>) {\r\n        this.layoutVertexArray = new LayoutArray();\r\n        this.layoutAttributes = layoutAttributes;\r\n        this.indexArray = new IndexArray();\r\n        this.segments = new SegmentVector();\r\n        this.collisionVertexArray = new CollisionVertexArray();\r\n    }\r\n\r\n    upload(context: Context) {\r\n        this.layoutVertexBuffer = context.createVertexBuffer(this.layoutVertexArray, this.layoutAttributes);\r\n        this.indexBuffer = context.createIndexBuffer(this.indexArray);\r\n        this.collisionVertexBuffer = context.createVertexBuffer(this.collisionVertexArray, collisionVertexAttributes.members, true);\r\n    }\r\n\r\n    destroy() {\r\n        if (!this.layoutVertexBuffer) return;\r\n        this.layoutVertexBuffer.destroy();\r\n        this.indexBuffer.destroy();\r\n        this.segments.destroy();\r\n        this.collisionVertexBuffer.destroy();\r\n    }\r\n}\r\n\r\nregister('CollisionBuffers', CollisionBuffers);\r\n\r\n/**\r\n * Unlike other buckets, which simply implement #addFeature with type-specific\r\n * logic for (essentially) triangulating feature geometries, SymbolBucket\r\n * requires specialized behavior:\r\n *\r\n * 1. WorkerTile#parse(), the logical owner of the bucket creation process,\r\n *    calls SymbolBucket#populate(), which resolves text and icon tokens on\r\n *    each feature, adds each glyphs and symbols needed to the passed-in\r\n *    collections options.glyphDependencies and options.iconDependencies, and\r\n *    stores the feature data for use in subsequent step (this.features).\r\n *\r\n * 2. WorkerTile asynchronously requests from the main thread all of the glyphs\r\n *    and icons needed (by this bucket and any others). When glyphs and icons\r\n *    have been received, the WorkerTile creates a CollisionIndex and invokes:\r\n *\r\n * 3. performSymbolLayout(bucket, stacks, icons) perform texts shaping and\r\n *    layout on a Symbol Bucket. This step populates:\r\n *      `this.symbolInstances`: metadata on generated symbols\r\n *      `this.collisionBoxArray`: collision data for use by foreground\r\n *      `this.text`: SymbolBuffers for text symbols\r\n *      `this.icons`: SymbolBuffers for icons\r\n *      `this.collisionBox`: Debug SymbolBuffers for collision boxes\r\n *      `this.collisionCircle`: Debug SymbolBuffers for collision circles\r\n *    The results are sent to the foreground for rendering\r\n *\r\n * 4. performSymbolPlacement(bucket, collisionIndex) is run on the foreground,\r\n *    and uses the CollisionIndex along with current camera settings to determine\r\n *    which symbols can actually show on the map. Collided symbols are hidden\r\n *    using a dynamic \"OpacityVertexArray\".\r\n *\r\n * @private\r\n */\r\nclass SymbolBucket implements Bucket {\r\n    static MAX_GLYPHS: number;\r\n    static addDynamicAttributes: typeof addDynamicAttributes;\r\n\r\n    collisionBoxArray: CollisionBoxArray;\r\n    zoom: number;\r\n    overscaling: number;\r\n    layers: Array<SymbolStyleLayer>;\r\n    layerIds: Array<string>;\r\n    index: number;\r\n    sdfIcons: boolean;\r\n    iconsNeedLinear: boolean;\r\n    bucketInstanceId: number;\r\n    justReloaded: boolean;\r\n\r\n    textSizeData: SizeData;\r\n    iconSizeData: SizeData;\r\n\r\n    glyphOffsetArray: GlyphOffsetArray;\r\n    lineVertexArray: SymbolLineVertexArray;\r\n    features: Array<SymbolFeature>;\r\n    symbolInstances: Array<SymbolInstance>;\r\n    pixelRatio: number;\r\n    tilePixelRatio: number;\r\n    compareText: {[string]: Array<Point>};\r\n    fadeStartTime: number;\r\n    sortFeaturesByY: boolean;\r\n    sortedAngle: number;\r\n\r\n    text: SymbolBuffers;\r\n    icon: SymbolBuffers;\r\n    collisionBox: CollisionBuffers;\r\n    collisionCircle: CollisionBuffers;\r\n    uploaded: boolean;\r\n\r\n    constructor(options: BucketParameters<SymbolStyleLayer>) {\r\n        this.collisionBoxArray = options.collisionBoxArray;\r\n        this.zoom = options.zoom;\r\n        this.overscaling = options.overscaling;\r\n        this.layers = options.layers;\r\n        this.layerIds = this.layers.map(layer => layer.id);\r\n        this.index = options.index;\r\n        this.pixelRatio = options.pixelRatio;\r\n\r\n        const layer = this.layers[0];\r\n        const unevaluatedLayoutValues = layer._unevaluatedLayout._values;\r\n\r\n        this.textSizeData = getSizeData(this.zoom, unevaluatedLayoutValues['text-size']);\r\n        this.iconSizeData = getSizeData(this.zoom, unevaluatedLayoutValues['icon-size']);\r\n\r\n        const layout = this.layers[0].layout;\r\n        this.sortFeaturesByY = layout.get('text-allow-overlap') || layout.get('icon-allow-overlap') ||\r\n            layout.get('text-ignore-placement') || layout.get('icon-ignore-placement');\r\n    }\r\n\r\n    createArrays() {\r\n        this.text = new SymbolBuffers(new ProgramConfigurationSet(symbolLayoutAttributes.members, this.layers, this.zoom, property => /^text/.test(property)));\r\n        this.icon = new SymbolBuffers(new ProgramConfigurationSet(symbolLayoutAttributes.members, this.layers, this.zoom, property => /^icon/.test(property)));\r\n        this.collisionBox = new CollisionBuffers(CollisionBoxLayoutArray, collisionBoxLayout.members, LineIndexArray);\r\n        this.collisionCircle = new CollisionBuffers(CollisionCircleLayoutArray, collisionCircleLayout.members, TriangleIndexArray);\r\n\r\n        this.glyphOffsetArray = new GlyphOffsetArray();\r\n        this.lineVertexArray = new SymbolLineVertexArray();\r\n    }\r\n\r\n    populate(features: Array<IndexedFeature>, options: PopulateParameters) {\r\n        const layer = this.layers[0];\r\n        const layout = layer.layout;\r\n\r\n        const textFont = layout.get('text-font');\r\n        const textField = layout.get('text-field');\r\n        const iconImage = layout.get('icon-image');\r\n        const hasText =\r\n            (textField.value.kind !== 'constant' || textField.value.value.length > 0) &&\r\n            (textFont.value.kind !== 'constant' || textFont.value.value.length > 0);\r\n        const hasIcon = iconImage.value.kind !== 'constant' || iconImage.value.value && iconImage.value.value.length > 0;\r\n\r\n        this.features = [];\r\n\r\n        if (!hasText && !hasIcon) {\r\n            return;\r\n        }\r\n\r\n        const icons = options.iconDependencies;\r\n        const stacks = options.glyphDependencies;\r\n        const globalProperties =  {zoom: this.zoom};\r\n\r\n        for (const {feature, index, sourceLayerIndex} of features) {\r\n            if (!layer._featureFilter(globalProperties, feature)) {\r\n                continue;\r\n            }\r\n\r\n            let text;\r\n            if (hasText) {\r\n                text = layer.getValueAndResolveTokens('text-field', feature);\r\n                text = transformText(text, layer, feature);\r\n            }\r\n\r\n            let icon;\r\n            if (hasIcon) {\r\n                icon = layer.getValueAndResolveTokens('icon-image', feature);\r\n            }\r\n\r\n            if (!text && !icon) {\r\n                continue;\r\n            }\r\n\r\n            const symbolFeature: SymbolFeature = {\r\n                text,\r\n                icon,\r\n                index,\r\n                sourceLayerIndex,\r\n                geometry: loadGeometry(feature),\r\n                properties: feature.properties,\r\n                type: vectorTileFeatureTypes[feature.type]\r\n            };\r\n            if (typeof feature.id !== 'undefined') {\r\n                symbolFeature.id = feature.id;\r\n            }\r\n            this.features.push(symbolFeature);\r\n\r\n            if (icon) {\r\n                icons[icon] = true;\r\n            }\r\n\r\n            if (text) {\r\n                const fontStack = textFont.evaluate(feature).join(',');\r\n                const stack = stacks[fontStack] = stacks[fontStack] || {};\r\n                const textAlongLine = layout.get('text-rotation-alignment') === 'map' && layout.get('symbol-placement') === 'line';\r\n                const allowsVerticalWritingMode = scriptDetection.allowsVerticalWritingMode(text);\r\n                for (let i = 0; i < text.length; i++) {\r\n                    stack[text.charCodeAt(i)] = true;\r\n                    if (textAlongLine && allowsVerticalWritingMode) {\r\n                        const verticalChar = verticalizePunctuation.lookup[text.charAt(i)];\r\n                        if (verticalChar) {\r\n                            stack[verticalChar.charCodeAt(0)] = true;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        if (layout.get('symbol-placement') === 'line') {\r\n            // Merge adjacent lines with the same text to improve labelling.\r\n            // It's better to place labels on one long line than on many short segments.\r\n            this.features = mergeLines(this.features);\r\n        }\r\n    }\r\n\r\n\r\n    isEmpty() {\r\n        return this.symbolInstances.length === 0;\r\n    }\r\n\r\n    upload(context: Context) {\r\n        this.text.upload(context, this.sortFeaturesByY);\r\n        this.icon.upload(context, this.sortFeaturesByY);\r\n        this.collisionBox.upload(context);\r\n        this.collisionCircle.upload(context);\r\n    }\r\n\r\n    destroy() {\r\n        this.text.destroy();\r\n        this.icon.destroy();\r\n        this.collisionBox.destroy();\r\n        this.collisionCircle.destroy();\r\n    }\r\n\r\n    addToLineVertexArray(anchor: Anchor, line: any) {\r\n        const lineStartIndex = this.lineVertexArray.length;\r\n        if (anchor.segment !== undefined) {\r\n            let sumForwardLength = anchor.dist(line[anchor.segment + 1]);\r\n            let sumBackwardLength = anchor.dist(line[anchor.segment]);\r\n            const vertices = {};\r\n            for (let i = anchor.segment + 1; i < line.length; i++) {\r\n                vertices[i] = { x: line[i].x, y: line[i].y, tileUnitDistanceFromAnchor: sumForwardLength };\r\n                if (i < line.length - 1) {\r\n                    sumForwardLength += line[i + 1].dist(line[i]);\r\n                }\r\n            }\r\n            for (let i = anchor.segment || 0; i >= 0; i--) {\r\n                vertices[i] = { x: line[i].x, y: line[i].y, tileUnitDistanceFromAnchor: sumBackwardLength };\r\n                if (i > 0) {\r\n                    sumBackwardLength += line[i - 1].dist(line[i]);\r\n                }\r\n            }\r\n            for (let i = 0; i < line.length; i++) {\r\n                const vertex = vertices[i];\r\n                this.lineVertexArray.emplaceBack(vertex.x, vertex.y, vertex.tileUnitDistanceFromAnchor);\r\n            }\r\n        }\r\n        return {\r\n            lineStartIndex: lineStartIndex,\r\n            lineLength: this.lineVertexArray.length - lineStartIndex\r\n        };\r\n    }\r\n\r\n    addSymbols(arrays: SymbolBuffers,\r\n               quads: Array<SymbolQuad>,\r\n               sizeVertex: any,\r\n               lineOffset: [number, number],\r\n               alongLine: boolean,\r\n               feature: ExpressionFeature,\r\n               writingMode: any,\r\n               labelAnchor: Anchor,\r\n               lineStartIndex: number,\r\n               lineLength: number) {\r\n        const indexArray = arrays.indexArray;\r\n        const layoutVertexArray = arrays.layoutVertexArray;\r\n        const dynamicLayoutVertexArray = arrays.dynamicLayoutVertexArray;\r\n\r\n        const segment = arrays.segments.prepareSegment(4 * quads.length, arrays.layoutVertexArray, arrays.indexArray);\r\n        const glyphOffsetArrayStart = this.glyphOffsetArray.length;\r\n        const vertexStartIndex = segment.vertexLength;\r\n\r\n        for (const symbol of quads) {\r\n\r\n            const tl = symbol.tl,\r\n                tr = symbol.tr,\r\n                bl = symbol.bl,\r\n                br = symbol.br,\r\n                tex = symbol.tex;\r\n\r\n            const index = segment.vertexLength;\r\n\r\n            const y = symbol.glyphOffset[1];\r\n            addVertex(layoutVertexArray, labelAnchor.x, labelAnchor.y, tl.x, y + tl.y, tex.x, tex.y, sizeVertex);\r\n            addVertex(layoutVertexArray, labelAnchor.x, labelAnchor.y, tr.x, y + tr.y, tex.x + tex.w, tex.y, sizeVertex);\r\n            addVertex(layoutVertexArray, labelAnchor.x, labelAnchor.y, bl.x, y + bl.y, tex.x, tex.y + tex.h, sizeVertex);\r\n            addVertex(layoutVertexArray, labelAnchor.x, labelAnchor.y, br.x, y + br.y, tex.x + tex.w, tex.y + tex.h, sizeVertex);\r\n\r\n            addDynamicAttributes(dynamicLayoutVertexArray, labelAnchor, 0);\r\n\r\n            indexArray.emplaceBack(index, index + 1, index + 2);\r\n            indexArray.emplaceBack(index + 1, index + 2, index + 3);\r\n\r\n            segment.vertexLength += 4;\r\n            segment.primitiveLength += 2;\r\n\r\n            this.glyphOffsetArray.emplaceBack(symbol.glyphOffset[0]);\r\n        }\r\n\r\n        arrays.placedSymbolArray.emplaceBack(labelAnchor.x, labelAnchor.y,\r\n            glyphOffsetArrayStart, this.glyphOffsetArray.length - glyphOffsetArrayStart, vertexStartIndex,\r\n            lineStartIndex, lineLength, (labelAnchor.segment: any),\r\n            sizeVertex ? sizeVertex[0] : 0, sizeVertex ? sizeVertex[1] : 0,\r\n            lineOffset[0], lineOffset[1],\r\n            writingMode, (false: any));\r\n\r\n        arrays.programConfigurations.populatePaintArrays(arrays.layoutVertexArray.length, feature);\r\n    }\r\n\r\n    _addCollisionDebugVertex(layoutVertexArray: StructArray, collisionVertexArray: StructArray, point: Point, anchor: Point, extrude: Point) {\r\n        collisionVertexArray.emplaceBack(0, 0);\r\n        return layoutVertexArray.emplaceBack(\r\n            // pos\r\n            point.x,\r\n            point.y,\r\n            // a_anchor_pos\r\n            anchor.x,\r\n            anchor.y,\r\n            // extrude\r\n            Math.round(extrude.x),\r\n            Math.round(extrude.y));\r\n    }\r\n\r\n\r\n    addCollisionDebugVertices(x1: number, y1: number, x2: number, y2: number, arrays: CollisionBuffers, boxAnchorPoint: Point, symbolInstance: SymbolInstance, isCircle: boolean) {\r\n        const segment = arrays.segments.prepareSegment(4, arrays.layoutVertexArray, arrays.indexArray);\r\n        const index = segment.vertexLength;\r\n\r\n        const layoutVertexArray = arrays.layoutVertexArray;\r\n        const collisionVertexArray = arrays.collisionVertexArray;\r\n\r\n        this._addCollisionDebugVertex(layoutVertexArray, collisionVertexArray, boxAnchorPoint, symbolInstance.anchor, new Point(x1, y1));\r\n        this._addCollisionDebugVertex(layoutVertexArray, collisionVertexArray, boxAnchorPoint, symbolInstance.anchor, new Point(x2, y1));\r\n        this._addCollisionDebugVertex(layoutVertexArray, collisionVertexArray, boxAnchorPoint, symbolInstance.anchor, new Point(x2, y2));\r\n        this._addCollisionDebugVertex(layoutVertexArray, collisionVertexArray, boxAnchorPoint, symbolInstance.anchor, new Point(x1, y2));\r\n\r\n        segment.vertexLength += 4;\r\n        if (isCircle) {\r\n            const indexArray: TriangleIndexArray = (arrays.indexArray: any);\r\n            indexArray.emplaceBack(index, index + 1, index + 2);\r\n            indexArray.emplaceBack(index, index + 2, index + 3);\r\n\r\n            segment.primitiveLength += 2;\r\n        } else {\r\n            const indexArray: LineIndexArray = (arrays.indexArray: any);\r\n            indexArray.emplaceBack(index, index + 1);\r\n            indexArray.emplaceBack(index + 1, index + 2);\r\n            indexArray.emplaceBack(index + 2, index + 3);\r\n            indexArray.emplaceBack(index + 3, index);\r\n\r\n            segment.primitiveLength += 4;\r\n        }\r\n    }\r\n\r\n    generateCollisionDebugBuffers() {\r\n        for (const symbolInstance of this.symbolInstances) {\r\n            symbolInstance.textCollisionFeature = {boxStartIndex: symbolInstance.textBoxStartIndex, boxEndIndex: symbolInstance.textBoxEndIndex};\r\n            symbolInstance.iconCollisionFeature = {boxStartIndex: symbolInstance.iconBoxStartIndex, boxEndIndex: symbolInstance.iconBoxEndIndex};\r\n\r\n            for (let i = 0; i < 2; i++) {\r\n                const feature = symbolInstance[i === 0 ? 'textCollisionFeature' : 'iconCollisionFeature'];\r\n                if (!feature) continue;\r\n\r\n                for (let b = feature.boxStartIndex; b < feature.boxEndIndex; b++) {\r\n                    const box: CollisionBox = (this.collisionBoxArray.get(b): any);\r\n                    const x1 = box.x1;\r\n                    const y1 = box.y1;\r\n                    const x2 = box.x2;\r\n                    const y2 = box.y2;\r\n\r\n                    // If the radius > 0, this collision box is actually a circle\r\n                    // The data we add to the buffers is exactly the same, but we'll render with a different shader.\r\n                    const isCircle = box.radius > 0;\r\n                    this.addCollisionDebugVertices(x1, y1, x2, y2, isCircle ? this.collisionCircle : this.collisionBox, box.anchorPoint, symbolInstance, isCircle);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    // These flat arrays are meant to be quicker to iterate over than the source\r\n    // CollisionBoxArray\r\n    deserializeCollisionBoxes(collisionBoxArray: CollisionBoxArray, textStartIndex: number, textEndIndex: number, iconStartIndex: number, iconEndIndex: number): CollisionArrays {\r\n        const collisionArrays = {};\r\n        for (let k = textStartIndex; k < textEndIndex; k++) {\r\n            const box: CollisionBox = (collisionBoxArray.get(k): any);\r\n            if (box.radius === 0) {\r\n                collisionArrays.textBox = { x1: box.x1, y1: box.y1, x2: box.x2, y2: box.y2, anchorPointX: box.anchorPointX, anchorPointY: box.anchorPointY };\r\n\r\n                break; // Only one box allowed per instance\r\n            } else {\r\n                if (!collisionArrays.textCircles) {\r\n                    collisionArrays.textCircles = [];\r\n                }\r\n                const used = 1; // May be updated at collision detection time\r\n                collisionArrays.textCircles.push(box.anchorPointX, box.anchorPointY, box.radius, box.signedDistanceFromAnchor, used);\r\n            }\r\n        }\r\n        for (let k = iconStartIndex; k < iconEndIndex; k++) {\r\n            // An icon can only have one box now, so this indexing is a bit vestigial...\r\n            const box: CollisionBox = (collisionBoxArray.get(k): any);\r\n            if (box.radius === 0) {\r\n                collisionArrays.iconBox = { x1: box.x1, y1: box.y1, x2: box.x2, y2: box.y2, anchorPointX: box.anchorPointX, anchorPointY: box.anchorPointY };\r\n                break; // Only one box allowed per instance\r\n            }\r\n        }\r\n        return collisionArrays;\r\n    }\r\n\r\n    hasTextData() {\r\n        return this.text.segments.get().length > 0;\r\n    }\r\n\r\n    hasIconData() {\r\n        return this.icon.segments.get().length > 0;\r\n    }\r\n\r\n    hasCollisionBoxData() {\r\n        return this.collisionBox.segments.get().length > 0;\r\n    }\r\n\r\n    hasCollisionCircleData() {\r\n        return this.collisionCircle.segments.get().length > 0;\r\n    }\r\n\r\n    sortFeatures(angle: number) {\r\n        if (!this.sortFeaturesByY) return;\r\n\r\n        if (this.sortedAngle === angle) return;\r\n        this.sortedAngle = angle;\r\n\r\n        // The current approach to sorting doesn't sort across segments so don't try.\r\n        // Sorting within segments separately seemed not to be worth the complexity.\r\n        if (this.text.segments.get().length > 1 || this.icon.segments.get().length > 1) return;\r\n\r\n        // If the symbols are allowed to overlap sort them by their vertical screen position.\r\n        // The index array buffer is rewritten to reference the (unchanged) vertices in the\r\n        // sorted order.\r\n\r\n        // To avoid sorting the actual symbolInstance array we sort an array of indexes.\r\n        const symbolInstanceIndexes = [];\r\n        for (let i = 0; i < this.symbolInstances.length; i++) {\r\n            symbolInstanceIndexes.push(i);\r\n        }\r\n\r\n        const sin = Math.sin(angle),\r\n            cos = Math.cos(angle);\r\n\r\n        symbolInstanceIndexes.sort((aIndex, bIndex) => {\r\n            const a = this.symbolInstances[aIndex];\r\n            const b = this.symbolInstances[bIndex];\r\n            const aRotated = (sin * a.anchor.x + cos * a.anchor.y) | 0;\r\n            const bRotated = (sin * b.anchor.x + cos * b.anchor.y) | 0;\r\n            return (aRotated - bRotated) || (b.featureIndex - a.featureIndex);\r\n        });\r\n\r\n        this.text.indexArray.clear();\r\n        this.icon.indexArray.clear();\r\n\r\n        for (const i of symbolInstanceIndexes) {\r\n            const symbolInstance = this.symbolInstances[i];\r\n\r\n            for (const placedTextSymbolIndex of symbolInstance.placedTextSymbolIndices) {\r\n                const placedSymbol = this.text.placedSymbolArray.get(placedTextSymbolIndex);\r\n\r\n                const endIndex = placedSymbol.vertexStartIndex + placedSymbol.numGlyphs * 4;\r\n                for (let vertexIndex = placedSymbol.vertexStartIndex; vertexIndex < endIndex; vertexIndex += 4) {\r\n                    this.text.indexArray.emplaceBack(vertexIndex, vertexIndex + 1, vertexIndex + 2);\r\n                    this.text.indexArray.emplaceBack(vertexIndex + 1, vertexIndex + 2, vertexIndex + 3);\r\n                }\r\n            }\r\n\r\n            const placedIcon = this.icon.placedSymbolArray.get(i);\r\n            if (placedIcon.numGlyphs) {\r\n                const vertexIndex = placedIcon.vertexStartIndex;\r\n                this.icon.indexArray.emplaceBack(vertexIndex, vertexIndex + 1, vertexIndex + 2);\r\n                this.icon.indexArray.emplaceBack(vertexIndex + 1, vertexIndex + 2, vertexIndex + 3);\r\n            }\r\n        }\r\n\r\n        if (this.text.indexBuffer) this.text.indexBuffer.updateData(this.text.indexArray);\r\n        if (this.icon.indexBuffer) this.icon.indexBuffer.updateData(this.icon.indexArray);\r\n    }\r\n}\r\n\r\nregister('SymbolBucket', SymbolBucket, {\r\n    omit: ['layers', 'collisionBoxArray', 'features', 'compareText'],\r\n    shallow: ['symbolInstances']\r\n});\r\n\r\n// this constant is based on the size of StructArray indexes used in a symbol\r\n// bucket--namely, glyphOffsetArrayStart\r\n// eg the max valid UInt16 is 65,535\r\n// See https://github.com/mapbox/mapbox-gl-js/issues/2907 for motivation\r\n// lineStartIndex and textBoxStartIndex could potentially be concerns\r\n// but we expect there to be many fewer boxes/lines than glyphs\r\nSymbolBucket.MAX_GLYPHS = 65535;\r\n\r\nSymbolBucket.addDynamicAttributes = addDynamicAttributes;\r\n\r\nmodule.exports = SymbolBucket;\r\n","// @flow\r\n\r\nconst ajax = require('../util/ajax');\r\nconst Evented = require('../util/evented');\r\nconst window = require('../util/window');\r\n\r\nlet pluginRequested = false;\r\nlet pluginBlobURL = null;\r\n\r\nmodule.exports.evented = new Evented();\r\n\r\ntype ErrorCallback = (error: Error) => void;\r\n\r\nmodule.exports.registerForPluginAvailability = function(\r\n    callback: (args: {pluginBlobURL: string, errorCallback: ErrorCallback}) => void\r\n) {\r\n    if (pluginBlobURL) {\r\n        callback({ pluginBlobURL: pluginBlobURL, errorCallback: module.exports.errorCallback});\r\n    } else {\r\n        module.exports.evented.once('pluginAvailable', callback);\r\n    }\r\n    return callback;\r\n};\r\n\r\n// Exposed so it can be stubbed out by tests\r\nmodule.exports.createBlobURL = function(response: Object) {\r\n    return window.URL.createObjectURL(new window.Blob([response.data], {type: \"text/javascript\"}));\r\n};\r\n// Only exposed for tests\r\nmodule.exports.clearRTLTextPlugin = function() {\r\n    pluginRequested = false;\r\n    pluginBlobURL = null;\r\n};\r\n\r\nmodule.exports.setRTLTextPlugin = function(pluginURL: string, callback: ErrorCallback) {\r\n    if (pluginRequested) {\r\n        throw new Error('setRTLTextPlugin cannot be called multiple times.');\r\n    }\r\n    pluginRequested = true;\r\n    module.exports.errorCallback = callback;\r\n    ajax.getArrayBuffer({ url: pluginURL }, (err, response) => {\r\n        if (err) {\r\n            callback(err);\r\n        } else if (response) {\r\n            pluginBlobURL = module.exports.createBlobURL(response);\r\n            module.exports.evented.fire('pluginAvailable', { pluginBlobURL: pluginBlobURL, errorCallback: callback });\r\n        }\r\n    });\r\n};\r\n\r\nmodule.exports.applyArabicShaping = (null: ?Function);\r\nmodule.exports.processBidirectionalText = (null: ?(string, Array<number>) => Array<string>);\r\n","// @flow\r\n\r\nconst window = require('./window');\r\n\r\nimport type { Callback } from '../types/callback';\r\n\r\n/**\r\n * The type of a resource.\r\n * @private\r\n * @readonly\r\n * @enum {string}\r\n */\r\nconst ResourceType = {\r\n    Unknown: 'Unknown',\r\n    Style: 'Style',\r\n    Source: 'Source',\r\n    Tile: 'Tile',\r\n    Glyphs: 'Glyphs',\r\n    SpriteImage: 'SpriteImage',\r\n    SpriteJSON: 'SpriteJSON',\r\n    Image: 'Image'\r\n};\r\nexports.ResourceType = ResourceType;\r\n\r\nif (typeof Object.freeze == 'function') {\r\n    Object.freeze(ResourceType);\r\n}\r\n\r\n/**\r\n * A `RequestParameters` object to be returned from Map.options.transformRequest callbacks.\r\n * @typedef {Object} RequestParameters\r\n * @property {string} url The URL to be requested.\r\n * @property {Object} headers The headers to be sent with the request.\r\n * @property {string} credentials `'same-origin'|'include'` Use 'include' to send cookies with cross-origin requests.\r\n */\r\nexport type RequestParameters = {\r\n    url: string,\r\n    headers?: Object,\r\n    credentials?: 'same-origin' | 'include'\r\n};\r\n\r\nclass AJAXError extends Error {\r\n    status: number;\r\n    constructor(message: string, status: number) {\r\n        super(message);\r\n        this.status = status;\r\n    }\r\n}\r\n\r\nfunction makeRequest(requestParameters: RequestParameters): XMLHttpRequest {\r\n    const xhr: XMLHttpRequest = new window.XMLHttpRequest();\r\n\r\n    xhr.open('GET', requestParameters.url, true);\r\n    for (const k in requestParameters.headers) {\r\n        xhr.setRequestHeader(k, requestParameters.headers[k]);\r\n    }\r\n    xhr.withCredentials = requestParameters.credentials === 'include';\r\n    return xhr;\r\n}\r\n\r\nexports.getJSON = function(requestParameters: RequestParameters, callback: Callback<mixed>) {\r\n    const xhr = makeRequest(requestParameters);\r\n    xhr.setRequestHeader('Accept', 'application/json');\r\n    xhr.onerror = function() {\r\n        callback(new Error(xhr.statusText));\r\n    };\r\n    xhr.onload = function() {\r\n        if (xhr.status >= 200 && xhr.status < 300 && xhr.response) {\r\n            let data;\r\n            try {\r\n                data = JSON.parse(xhr.response);\r\n            } catch (err) {\r\n                return callback(err);\r\n            }\r\n            callback(null, data);\r\n        } else {\r\n            callback(new AJAXError(xhr.statusText, xhr.status));\r\n        }\r\n    };\r\n    xhr.send();\r\n    return xhr;\r\n};\r\n\r\nexports.getArrayBuffer = function(requestParameters: RequestParameters, callback: Callback<{data: ArrayBuffer, cacheControl: ?string, expires: ?string}>) {\r\n    const xhr = makeRequest(requestParameters);\r\n    xhr.responseType = 'arraybuffer';\r\n    xhr.onerror = function() {\r\n        console.log(\"qq getArrayBuffer\", xhr);\r\n        callback(new Error(xhr.statusText));\r\n    };\r\n    xhr.onload = function() {\r\n        const response: ArrayBuffer = xhr.response;\r\n        if (response.byteLength === 0 && xhr.status === 200) {\r\n            return callback(new Error('http status 200 returned without content.'));\r\n        }\r\n        if (xhr.status >= 200 && xhr.status < 300 && xhr.response) {\r\n            callback(null, {\r\n                data: response,\r\n                cacheControl: xhr.getResponseHeader('Cache-Control'),\r\n                expires: xhr.getResponseHeader('Expires')\r\n            });\r\n        } else {\r\n            callback(new AJAXError(xhr.statusText, xhr.status));\r\n        }\r\n    };\r\n    xhr.send();\r\n    return xhr;\r\n};\r\n\r\nfunction sameOrigin(url) {\r\n    const a: HTMLAnchorElement = window.document.createElement('a');\r\n    a.href = url;\r\n    return a.protocol === window.document.location.protocol && a.host === window.document.location.host;\r\n}\r\n\r\nconst transparentPngUrl = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=';\r\n\r\nexports.getImage = function(requestParameters: RequestParameters, callback: Callback<HTMLImageElement>) {\r\n    // request the image with XHR to work around caching issues\r\n    // see https://github.com/mapbox/mapbox-gl-js/issues/1470\r\n    return exports.getArrayBuffer(requestParameters, (err, imgData) => {\r\n        if (err) {\r\n            callback(err);\r\n        } else if (imgData) {\r\n            const img: HTMLImageElement = new window.Image();\r\n            const URL = window.URL || window.webkitURL;\r\n            img.onload = () => {\r\n                callback(null, img);\r\n                URL.revokeObjectURL(img.src);\r\n            };\r\n            const blob: Blob = new window.Blob([new Uint8Array(imgData.data)], { type: 'image/png' });\r\n            (img: any).cacheControl = imgData.cacheControl;\r\n            (img: any).expires = imgData.expires;\r\n            img.src = imgData.data.byteLength ? URL.createObjectURL(blob) : transparentPngUrl;\r\n        }\r\n    });\r\n};\r\n\r\nexports.getVideo = function(urls: Array<string>, callback: Callback<HTMLVideoElement>) {\r\n    const video: HTMLVideoElement = window.document.createElement('video');\r\n    video.onloadstart = function() {\r\n        callback(null, video);\r\n    };\r\n    for (let i = 0; i < urls.length; i++) {\r\n        const s: HTMLSourceElement = window.document.createElement('source');\r\n        if (!sameOrigin(urls[i])) {\r\n            video.crossOrigin = 'Anonymous';\r\n        }\r\n        s.src = urls[i];\r\n        video.appendChild(s);\r\n    }\r\n    return video;\r\n};\r\n","// @flow\r\n\r\nconst Point = require('@mapbox/point-geometry');\r\nconst {register} = require('../util/web_worker_transfer');\r\n\r\nclass Anchor extends Point {\r\n    angle: any;\r\n    segment: number | void;\r\n\r\n    constructor(x: number, y: number, angle: number, segment?: number) {\r\n        super(x, y);\r\n        this.angle = angle;\r\n        if (segment !== undefined) {\r\n            this.segment = segment;\r\n        }\r\n    }\r\n\r\n    clone() {\r\n        return new Anchor(this.x, this.y, this.angle, this.segment);\r\n    }\r\n}\r\n\r\nregister('Anchor', Anchor);\r\n\r\nmodule.exports = Anchor;\r\n","'use strict';\n\nmodule.exports = createFeature;\n\nfunction createFeature(id, type, geom, tags) {\n    var feature = {\n        id: id || null,\n        type: type,\n        geometry: geom,\n        tags: tags,\n        minX: Infinity,\n        minY: Infinity,\n        maxX: -Infinity,\n        maxY: -Infinity\n    };\n    calcBBox(feature);\n    return feature;\n}\n\nfunction calcBBox(feature) {\n    var geom = feature.geometry;\n    var type = feature.type;\n\n    if (type === 'Point' || type === 'MultiPoint' || type === 'LineString') {\n        calcLineBBox(feature, geom);\n\n    } else if (type === 'Polygon' || type === 'MultiLineString') {\n        for (var i = 0; i < geom.length; i++) {\n            calcLineBBox(feature, geom[i]);\n        }\n\n    } else if (type === 'MultiPolygon') {\n        for (i = 0; i < geom.length; i++) {\n            for (var j = 0; j < geom[i].length; j++) {\n                calcLineBBox(feature, geom[i][j]);\n            }\n        }\n    }\n}\n\nfunction calcLineBBox(feature, geom) {\n    for (var i = 0; i < geom.length; i += 3) {\n        feature.minX = Math.min(feature.minX, geom[i]);\n        feature.minY = Math.min(feature.minY, geom[i + 1]);\n        feature.maxX = Math.max(feature.maxX, geom[i]);\n        feature.maxY = Math.max(feature.maxY, geom[i + 1]);\n    }\n}\n","/*\n * Copyright (C) 2008 Apple Inc. All Rights Reserved.\n *\n * Redistribution and use in source and binary forms, with or without\n * modification, are permitted provided that the following conditions\n * are met:\n * 1. Redistributions of source code must retain the above copyright\n *    notice, this list of conditions and the following disclaimer.\n * 2. Redistributions in binary form must reproduce the above copyright\n *    notice, this list of conditions and the following disclaimer in the\n *    documentation and/or other materials provided with the distribution.\n *\n * THIS SOFTWARE IS PROVIDED BY APPLE INC. ``AS IS'' AND ANY\n * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\n * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR\n * PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL APPLE INC. OR\n * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,\n * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,\n * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR\n * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY\n * OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n *\n * Ported from Webkit\n * http://svn.webkit.org/repository/webkit/trunk/Source/WebCore/platform/graphics/UnitBezier.h\n */\n\nmodule.exports = UnitBezier;\n\nfunction UnitBezier(p1x, p1y, p2x, p2y) {\n    // Calculate the polynomial coefficients, implicit first and last control points are (0,0) and (1,1).\n    this.cx = 3.0 * p1x;\n    this.bx = 3.0 * (p2x - p1x) - this.cx;\n    this.ax = 1.0 - this.cx - this.bx;\n\n    this.cy = 3.0 * p1y;\n    this.by = 3.0 * (p2y - p1y) - this.cy;\n    this.ay = 1.0 - this.cy - this.by;\n\n    this.p1x = p1x;\n    this.p1y = p2y;\n    this.p2x = p2x;\n    this.p2y = p2y;\n}\n\nUnitBezier.prototype.sampleCurveX = function(t) {\n    // `ax t^3 + bx t^2 + cx t' expanded using Horner's rule.\n    return ((this.ax * t + this.bx) * t + this.cx) * t;\n};\n\nUnitBezier.prototype.sampleCurveY = function(t) {\n    return ((this.ay * t + this.by) * t + this.cy) * t;\n};\n\nUnitBezier.prototype.sampleCurveDerivativeX = function(t) {\n    return (3.0 * this.ax * t + 2.0 * this.bx) * t + this.cx;\n};\n\nUnitBezier.prototype.solveCurveX = function(x, epsilon) {\n    if (typeof epsilon === 'undefined') epsilon = 1e-6;\n\n    var t0, t1, t2, x2, i;\n\n    // First try a few iterations of Newton's method -- normally very fast.\n    for (t2 = x, i = 0; i < 8; i++) {\n\n        x2 = this.sampleCurveX(t2) - x;\n        if (Math.abs(x2) < epsilon) return t2;\n\n        var d2 = this.sampleCurveDerivativeX(t2);\n        if (Math.abs(d2) < 1e-6) break;\n\n        t2 = t2 - x2 / d2;\n    }\n\n    // Fall back to the bisection method for reliability.\n    t0 = 0.0;\n    t1 = 1.0;\n    t2 = x;\n\n    if (t2 < t0) return t0;\n    if (t2 > t1) return t1;\n\n    while (t0 < t1) {\n\n        x2 = this.sampleCurveX(t2);\n        if (Math.abs(x2 - x) < epsilon) return t2;\n\n        if (x > x2) {\n            t0 = t2;\n        } else {\n            t1 = t2;\n        }\n\n        t2 = (t1 - t0) * 0.5 + t0;\n    }\n\n    // Failure.\n    return t2;\n};\n\nUnitBezier.prototype.solve = function(x, epsilon) {\n    return this.sampleCurveY(this.solveCurveX(x, epsilon));\n};\n","// @flow\r\n\r\n/**\r\n * A coordinate is a column, row, zoom combination, often used\r\n * as the data component of a tile.\r\n *\r\n * @param {number} column\r\n * @param {number} row\r\n * @param {number} zoom\r\n * @private\r\n */\r\nclass Coordinate {\r\n    column: number;\r\n    row: number;\r\n    zoom: number;\r\n    constructor(column: number, row: number, zoom: number) {\r\n        this.column = column;\r\n        this.row = row;\r\n        this.zoom = zoom;\r\n    }\r\n\r\n    /**\r\n     * Create a clone of this coordinate that can be mutated without\r\n     * changing the original coordinate\r\n     *\r\n     * @returns {Coordinate} clone\r\n     * @private\r\n     * var coord = new Coordinate(0, 0, 0);\r\n     * var c2 = coord.clone();\r\n     * // since coord is cloned, modifying a property of c2 does\r\n     * // not modify it.\r\n     * c2.zoom = 2;\r\n     */\r\n    clone() {\r\n        return new Coordinate(this.column, this.row, this.zoom);\r\n    }\r\n\r\n    /**\r\n     * Zoom this coordinate to a given zoom level. This returns a new\r\n     * coordinate object, not mutating the old one.\r\n     *\r\n     * @param {number} zoom\r\n     * @returns {Coordinate} zoomed coordinate\r\n     * @private\r\n     * @example\r\n     * var coord = new Coordinate(0, 0, 0);\r\n     * var c2 = coord.zoomTo(1);\r\n     * c2 // equals new Coordinate(0, 0, 1);\r\n     */\r\n    zoomTo(zoom: number) { return this.clone()._zoomTo(zoom); }\r\n\r\n    /**\r\n     * Subtract the column and row values of this coordinate from those\r\n     * of another coordinate. The other coordinat will be zoomed to the\r\n     * same level as `this` before the subtraction occurs\r\n     *\r\n     * @param {Coordinate} c other coordinate\r\n     * @returns {Coordinate} result\r\n     * @private\r\n     */\r\n    sub(c: Coordinate) { return this.clone()._sub(c); }\r\n\r\n    _zoomTo(zoom: number) {\r\n        const scale = Math.pow(2, zoom - this.zoom);\r\n        this.column *= scale;\r\n        this.row *= scale;\r\n        this.zoom = zoom;\r\n        return this;\r\n    }\r\n\r\n    _sub(c: Coordinate) {\r\n        c = c.zoomTo(this.zoom);\r\n        this.column -= c.column;\r\n        this.row -= c.row;\r\n        return this;\r\n    }\r\n}\r\n\r\nmodule.exports = Coordinate;\r\n","'use strict';\n\nmodule.exports = GridIndex;\n\nvar NUM_PARAMS = 3;\n\nfunction GridIndex(extent, n, padding) {\n    var cells = this.cells = [];\n\n    if (extent instanceof ArrayBuffer) {\n        this.arrayBuffer = extent;\n        var array = new Int32Array(this.arrayBuffer);\n        extent = array[0];\n        n = array[1];\n        padding = array[2];\n\n        this.d = n + 2 * padding;\n        for (var k = 0; k < this.d * this.d; k++) {\n            var start = array[NUM_PARAMS + k];\n            var end = array[NUM_PARAMS + k + 1];\n            cells.push(start === end ?\n                    null :\n                    array.subarray(start, end));\n        }\n        var keysOffset = array[NUM_PARAMS + cells.length];\n        var bboxesOffset = array[NUM_PARAMS + cells.length + 1];\n        this.keys = array.subarray(keysOffset, bboxesOffset);\n        this.bboxes = array.subarray(bboxesOffset);\n\n        this.insert = this._insertReadonly;\n\n    } else {\n        this.d = n + 2 * padding;\n        for (var i = 0; i < this.d * this.d; i++) {\n            cells.push([]);\n        }\n        this.keys = [];\n        this.bboxes = [];\n    }\n\n    this.n = n;\n    this.extent = extent;\n    this.padding = padding;\n    this.scale = n / extent;\n    this.uid = 0;\n\n    var p = (padding / n) * extent;\n    this.min = -p;\n    this.max = extent + p;\n}\n\n\nGridIndex.prototype.insert = function(key, x1, y1, x2, y2) {\n    this._forEachCell(x1, y1, x2, y2, this._insertCell, this.uid++);\n    this.keys.push(key);\n    this.bboxes.push(x1);\n    this.bboxes.push(y1);\n    this.bboxes.push(x2);\n    this.bboxes.push(y2);\n};\n\nGridIndex.prototype._insertReadonly = function() {\n    throw 'Cannot insert into a GridIndex created from an ArrayBuffer.';\n};\n\nGridIndex.prototype._insertCell = function(x1, y1, x2, y2, cellIndex, uid) {\n    this.cells[cellIndex].push(uid);\n};\n\nGridIndex.prototype.query = function(x1, y1, x2, y2) {\n    var min = this.min;\n    var max = this.max;\n    if (x1 <= min && y1 <= min && max <= x2 && max <= y2) {\n        // We use `Array#slice` because `this.keys` may be a `Int32Array` and\n        // some browsers (Safari and IE) do not support `TypedArray#slice`\n        // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/TypedArray/slice#Browser_compatibility\n        return Array.prototype.slice.call(this.keys);\n\n    } else {\n        var result = [];\n        var seenUids = {};\n        this._forEachCell(x1, y1, x2, y2, this._queryCell, result, seenUids);\n        return result;\n    }\n};\n\nGridIndex.prototype._queryCell = function(x1, y1, x2, y2, cellIndex, result, seenUids) {\n    var cell = this.cells[cellIndex];\n    if (cell !== null) {\n        var keys = this.keys;\n        var bboxes = this.bboxes;\n        for (var u = 0; u < cell.length; u++) {\n            var uid = cell[u];\n            if (seenUids[uid] === undefined) {\n                var offset = uid * 4;\n                if ((x1 <= bboxes[offset + 2]) &&\n                    (y1 <= bboxes[offset + 3]) &&\n                    (x2 >= bboxes[offset + 0]) &&\n                    (y2 >= bboxes[offset + 1])) {\n                    seenUids[uid] = true;\n                    result.push(keys[uid]);\n                } else {\n                    seenUids[uid] = false;\n                }\n            }\n        }\n    }\n};\n\nGridIndex.prototype._forEachCell = function(x1, y1, x2, y2, fn, arg1, arg2) {\n    var cx1 = this._convertToCellCoord(x1);\n    var cy1 = this._convertToCellCoord(y1);\n    var cx2 = this._convertToCellCoord(x2);\n    var cy2 = this._convertToCellCoord(y2);\n    for (var x = cx1; x <= cx2; x++) {\n        for (var y = cy1; y <= cy2; y++) {\n            var cellIndex = this.d * y + x;\n            if (fn.call(this, x1, y1, x2, y2, cellIndex, arg1, arg2)) return;\n        }\n    }\n};\n\nGridIndex.prototype._convertToCellCoord = function(x) {\n    return Math.max(0, Math.min(this.d - 1, Math.floor(x * this.scale) + this.padding));\n};\n\nGridIndex.prototype.toArrayBuffer = function() {\n    if (this.arrayBuffer) return this.arrayBuffer;\n\n    var cells = this.cells;\n\n    var metadataLength = NUM_PARAMS + this.cells.length + 1 + 1;\n    var totalCellLength = 0;\n    for (var i = 0; i < this.cells.length; i++) {\n        totalCellLength += this.cells[i].length;\n    }\n\n    var array = new Int32Array(metadataLength + totalCellLength + this.keys.length + this.bboxes.length);\n    array[0] = this.extent;\n    array[1] = this.n;\n    array[2] = this.padding;\n\n    var offset = metadataLength;\n    for (var k = 0; k < cells.length; k++) {\n        var cell = cells[k];\n        array[NUM_PARAMS + k] = offset;\n        array.set(cell, offset);\n        offset += cell.length;\n    }\n\n    array[NUM_PARAMS + cells.length] = offset;\n    array.set(this.keys, offset);\n    offset += this.keys.length;\n\n    array[NUM_PARAMS + cells.length + 1] = offset;\n    array.set(this.bboxes, offset);\n    offset += this.bboxes.length;\n\n    return array.buffer;\n};\n","// (c) Dean McNamee <dean@gmail.com>, 2012.\n//\n// https://github.com/deanm/css-color-parser-js\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to\n// deal in the Software without restriction, including without limitation the\n// rights to use, copy, modify, merge, publish, distribute, sublicense, and/or\n// sell copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n// FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS\n// IN THE SOFTWARE.\n\n// http://www.w3.org/TR/css3-color/\nvar kCSSColorTable = {\n  \"transparent\": [0,0,0,0], \"aliceblue\": [240,248,255,1],\n  \"antiquewhite\": [250,235,215,1], \"aqua\": [0,255,255,1],\n  \"aquamarine\": [127,255,212,1], \"azure\": [240,255,255,1],\n  \"beige\": [245,245,220,1], \"bisque\": [255,228,196,1],\n  \"black\": [0,0,0,1], \"blanchedalmond\": [255,235,205,1],\n  \"blue\": [0,0,255,1], \"blueviolet\": [138,43,226,1],\n  \"brown\": [165,42,42,1], \"burlywood\": [222,184,135,1],\n  \"cadetblue\": [95,158,160,1], \"chartreuse\": [127,255,0,1],\n  \"chocolate\": [210,105,30,1], \"coral\": [255,127,80,1],\n  \"cornflowerblue\": [100,149,237,1], \"cornsilk\": [255,248,220,1],\n  \"crimson\": [220,20,60,1], \"cyan\": [0,255,255,1],\n  \"darkblue\": [0,0,139,1], \"darkcyan\": [0,139,139,1],\n  \"darkgoldenrod\": [184,134,11,1], \"darkgray\": [169,169,169,1],\n  \"darkgreen\": [0,100,0,1], \"darkgrey\": [169,169,169,1],\n  \"darkkhaki\": [189,183,107,1], \"darkmagenta\": [139,0,139,1],\n  \"darkolivegreen\": [85,107,47,1], \"darkorange\": [255,140,0,1],\n  \"darkorchid\": [153,50,204,1], \"darkred\": [139,0,0,1],\n  \"darksalmon\": [233,150,122,1], \"darkseagreen\": [143,188,143,1],\n  \"darkslateblue\": [72,61,139,1], \"darkslategray\": [47,79,79,1],\n  \"darkslategrey\": [47,79,79,1], \"darkturquoise\": [0,206,209,1],\n  \"darkviolet\": [148,0,211,1], \"deeppink\": [255,20,147,1],\n  \"deepskyblue\": [0,191,255,1], \"dimgray\": [105,105,105,1],\n  \"dimgrey\": [105,105,105,1], \"dodgerblue\": [30,144,255,1],\n  \"firebrick\": [178,34,34,1], \"floralwhite\": [255,250,240,1],\n  \"forestgreen\": [34,139,34,1], \"fuchsia\": [255,0,255,1],\n  \"gainsboro\": [220,220,220,1], \"ghostwhite\": [248,248,255,1],\n  \"gold\": [255,215,0,1], \"goldenrod\": [218,165,32,1],\n  \"gray\": [128,128,128,1], \"green\": [0,128,0,1],\n  \"greenyellow\": [173,255,47,1], \"grey\": [128,128,128,1],\n  \"honeydew\": [240,255,240,1], \"hotpink\": [255,105,180,1],\n  \"indianred\": [205,92,92,1], \"indigo\": [75,0,130,1],\n  \"ivory\": [255,255,240,1], \"khaki\": [240,230,140,1],\n  \"lavender\": [230,230,250,1], \"lavenderblush\": [255,240,245,1],\n  \"lawngreen\": [124,252,0,1], \"lemonchiffon\": [255,250,205,1],\n  \"lightblue\": [173,216,230,1], \"lightcoral\": [240,128,128,1],\n  \"lightcyan\": [224,255,255,1], \"lightgoldenrodyellow\": [250,250,210,1],\n  \"lightgray\": [211,211,211,1], \"lightgreen\": [144,238,144,1],\n  \"lightgrey\": [211,211,211,1], \"lightpink\": [255,182,193,1],\n  \"lightsalmon\": [255,160,122,1], \"lightseagreen\": [32,178,170,1],\n  \"lightskyblue\": [135,206,250,1], \"lightslategray\": [119,136,153,1],\n  \"lightslategrey\": [119,136,153,1], \"lightsteelblue\": [176,196,222,1],\n  \"lightyellow\": [255,255,224,1], \"lime\": [0,255,0,1],\n  \"limegreen\": [50,205,50,1], \"linen\": [250,240,230,1],\n  \"magenta\": [255,0,255,1], \"maroon\": [128,0,0,1],\n  \"mediumaquamarine\": [102,205,170,1], \"mediumblue\": [0,0,205,1],\n  \"mediumorchid\": [186,85,211,1], \"mediumpurple\": [147,112,219,1],\n  \"mediumseagreen\": [60,179,113,1], \"mediumslateblue\": [123,104,238,1],\n  \"mediumspringgreen\": [0,250,154,1], \"mediumturquoise\": [72,209,204,1],\n  \"mediumvioletred\": [199,21,133,1], \"midnightblue\": [25,25,112,1],\n  \"mintcream\": [245,255,250,1], \"mistyrose\": [255,228,225,1],\n  \"moccasin\": [255,228,181,1], \"navajowhite\": [255,222,173,1],\n  \"navy\": [0,0,128,1], \"oldlace\": [253,245,230,1],\n  \"olive\": [128,128,0,1], \"olivedrab\": [107,142,35,1],\n  \"orange\": [255,165,0,1], \"orangered\": [255,69,0,1],\n  \"orchid\": [218,112,214,1], \"palegoldenrod\": [238,232,170,1],\n  \"palegreen\": [152,251,152,1], \"paleturquoise\": [175,238,238,1],\n  \"palevioletred\": [219,112,147,1], \"papayawhip\": [255,239,213,1],\n  \"peachpuff\": [255,218,185,1], \"peru\": [205,133,63,1],\n  \"pink\": [255,192,203,1], \"plum\": [221,160,221,1],\n  \"powderblue\": [176,224,230,1], \"purple\": [128,0,128,1],\n  \"rebeccapurple\": [102,51,153,1],\n  \"red\": [255,0,0,1], \"rosybrown\": [188,143,143,1],\n  \"royalblue\": [65,105,225,1], \"saddlebrown\": [139,69,19,1],\n  \"salmon\": [250,128,114,1], \"sandybrown\": [244,164,96,1],\n  \"seagreen\": [46,139,87,1], \"seashell\": [255,245,238,1],\n  \"sienna\": [160,82,45,1], \"silver\": [192,192,192,1],\n  \"skyblue\": [135,206,235,1], \"slateblue\": [106,90,205,1],\n  \"slategray\": [112,128,144,1], \"slategrey\": [112,128,144,1],\n  \"snow\": [255,250,250,1], \"springgreen\": [0,255,127,1],\n  \"steelblue\": [70,130,180,1], \"tan\": [210,180,140,1],\n  \"teal\": [0,128,128,1], \"thistle\": [216,191,216,1],\n  \"tomato\": [255,99,71,1], \"turquoise\": [64,224,208,1],\n  \"violet\": [238,130,238,1], \"wheat\": [245,222,179,1],\n  \"white\": [255,255,255,1], \"whitesmoke\": [245,245,245,1],\n  \"yellow\": [255,255,0,1], \"yellowgreen\": [154,205,50,1]}\n\nfunction clamp_css_byte(i) {  // Clamp to integer 0 .. 255.\n  i = Math.round(i);  // Seems to be what Chrome does (vs truncation).\n  return i < 0 ? 0 : i > 255 ? 255 : i;\n}\n\nfunction clamp_css_float(f) {  // Clamp to float 0.0 .. 1.0.\n  return f < 0 ? 0 : f > 1 ? 1 : f;\n}\n\nfunction parse_css_int(str) {  // int or percentage.\n  if (str[str.length - 1] === '%')\n    return clamp_css_byte(parseFloat(str) / 100 * 255);\n  return clamp_css_byte(parseInt(str));\n}\n\nfunction parse_css_float(str) {  // float or percentage.\n  if (str[str.length - 1] === '%')\n    return clamp_css_float(parseFloat(str) / 100);\n  return clamp_css_float(parseFloat(str));\n}\n\nfunction css_hue_to_rgb(m1, m2, h) {\n  if (h < 0) h += 1;\n  else if (h > 1) h -= 1;\n\n  if (h * 6 < 1) return m1 + (m2 - m1) * h * 6;\n  if (h * 2 < 1) return m2;\n  if (h * 3 < 2) return m1 + (m2 - m1) * (2/3 - h) * 6;\n  return m1;\n}\n\nfunction parseCSSColor(css_str) {\n  // Remove all whitespace, not compliant, but should just be more accepting.\n  var str = css_str.replace(/ /g, '').toLowerCase();\n\n  // Color keywords (and transparent) lookup.\n  if (str in kCSSColorTable) return kCSSColorTable[str].slice();  // dup.\n\n  // #abc and #abc123 syntax.\n  if (str[0] === '#') {\n    if (str.length === 4) {\n      var iv = parseInt(str.substr(1), 16);  // TODO(deanm): Stricter parsing.\n      if (!(iv >= 0 && iv <= 0xfff)) return null;  // Covers NaN.\n      return [((iv & 0xf00) >> 4) | ((iv & 0xf00) >> 8),\n              (iv & 0xf0) | ((iv & 0xf0) >> 4),\n              (iv & 0xf) | ((iv & 0xf) << 4),\n              1];\n    } else if (str.length === 7) {\n      var iv = parseInt(str.substr(1), 16);  // TODO(deanm): Stricter parsing.\n      if (!(iv >= 0 && iv <= 0xffffff)) return null;  // Covers NaN.\n      return [(iv & 0xff0000) >> 16,\n              (iv & 0xff00) >> 8,\n              iv & 0xff,\n              1];\n    }\n\n    return null;\n  }\n\n  var op = str.indexOf('('), ep = str.indexOf(')');\n  if (op !== -1 && ep + 1 === str.length) {\n    var fname = str.substr(0, op);\n    var params = str.substr(op+1, ep-(op+1)).split(',');\n    var alpha = 1;  // To allow case fallthrough.\n    switch (fname) {\n      case 'rgba':\n        if (params.length !== 4) return null;\n        alpha = parse_css_float(params.pop());\n        // Fall through.\n      case 'rgb':\n        if (params.length !== 3) return null;\n        return [parse_css_int(params[0]),\n                parse_css_int(params[1]),\n                parse_css_int(params[2]),\n                alpha];\n      case 'hsla':\n        if (params.length !== 4) return null;\n        alpha = parse_css_float(params.pop());\n        // Fall through.\n      case 'hsl':\n        if (params.length !== 3) return null;\n        var h = (((parseFloat(params[0]) % 360) + 360) % 360) / 360;  // 0 .. 1\n        // NOTE(deanm): According to the CSS spec s/l should only be\n        // percentages, but we don't bother and let float or percentage.\n        var s = parse_css_float(params[1]);\n        var l = parse_css_float(params[2]);\n        var m2 = l <= 0.5 ? l * (s + 1) : l + s - l * s;\n        var m1 = l * 2 - m2;\n        return [clamp_css_byte(css_hue_to_rgb(m1, m2, h+1/3) * 255),\n                clamp_css_byte(css_hue_to_rgb(m1, m2, h) * 255),\n                clamp_css_byte(css_hue_to_rgb(m1, m2, h-1/3) * 255),\n                alpha];\n      default:\n        return null;\n    }\n  }\n\n  return null;\n}\n\ntry { exports.parseCSSColor = parseCSSColor } catch(e) { }\n","// @flow\r\n\r\nclass ParsingError extends Error {\r\n    key: string;\r\n    message: string;\r\n    constructor(key: string, message: string) {\r\n        super(message);\r\n        this.message = message;\r\n        this.key = key;\r\n    }\r\n}\r\n\r\nmodule.exports = ParsingError;\r\n","// @flow\r\n\r\nconst Scope = require('./scope');\r\nconst {checkSubtype} = require('./types');\r\nconst ParsingError = require('./parsing_error');\r\nconst Literal = require('./definitions/literal');\r\nconst Assertion = require('./definitions/assertion');\r\nconst ArrayAssertion = require('./definitions/array');\r\nconst Coercion = require('./definitions/coercion');\r\n\r\nimport type {Expression, ExpressionRegistry} from './expression';\r\nimport type {Type} from './types';\r\n\r\n/**\r\n * State associated parsing at a given point in an expression tree.\r\n * @private\r\n */\r\nclass ParsingContext {\r\n    registry: ExpressionRegistry;\r\n    path: Array<number>;\r\n    key: string;\r\n    scope: Scope;\r\n    errors: Array<ParsingError>;\r\n\r\n    // The expected type of this expression. Provided only to allow Expression\r\n    // implementations to infer argument types: Expression#parse() need not\r\n    // check that the output type of the parsed expression matches\r\n    // `expectedType`.\r\n    expectedType: ?Type;\r\n\r\n    constructor(\r\n        registry: ExpressionRegistry,\r\n        path: Array<number> = [],\r\n        expectedType: ?Type,\r\n        scope: Scope = new Scope(),\r\n        errors: Array<ParsingError> = []\r\n    ) {\r\n        this.registry = registry;\r\n        this.path = path;\r\n        this.key = path.map(part => `[${part}]`).join('');\r\n        this.scope = scope;\r\n        this.errors = errors;\r\n        this.expectedType = expectedType;\r\n    }\r\n\r\n    /**\r\n     * @param expr the JSON expression to parse\r\n     * @param index the optional argument index if this expression is an argument of a parent expression that's being parsed\r\n     * @param options\r\n     * @param options.omitTypeAnnotations set true to omit inferred type annotations.  Caller beware: with this option set, the parsed expression's type will NOT satisfy `expectedType` if it would normally be wrapped in an inferred annotation.\r\n     * @private\r\n     */\r\n    parse(\r\n        expr: mixed,\r\n        index?: number,\r\n        expectedType?: ?Type,\r\n        bindings?: Array<[string, Expression]>,\r\n        options: {omitTypeAnnotations?: boolean} = {}\r\n    ): ?Expression {\r\n        let context = this;\r\n        if (index) {\r\n            context = context.concat(index, expectedType, bindings);\r\n        }\r\n\r\n        if (expr === null || typeof expr === 'string' || typeof expr === 'boolean' || typeof expr === 'number') {\r\n            expr = ['literal', expr];\r\n        }\r\n\r\n        if (Array.isArray(expr)) {\r\n            if (expr.length === 0) {\r\n                return context.error(`Expected an array with at least one element. If you wanted a literal array, use [\"literal\", []].`);\r\n            }\r\n\r\n            const op = expr[0];\r\n            if (typeof op !== 'string') {\r\n                context.error(`Expression name must be a string, but found ${typeof op} instead. If you wanted a literal array, use [\"literal\", [...]].`, 0);\r\n                return null;\r\n            }\r\n\r\n            const Expr = context.registry[op];\r\n            if (Expr) {\r\n                let parsed = Expr.parse(expr, context);\r\n                if (!parsed) return null;\r\n\r\n                if (context.expectedType) {\r\n                    const expected = context.expectedType;\r\n                    const actual = parsed.type;\r\n\r\n                    // When we expect a number, string, boolean, or array but\r\n                    // have a Value, we can wrap it in a refining assertion.\r\n                    // When we expect a Color but have a String or Value, we\r\n                    // can wrap it in \"to-color\" coercion.\r\n                    // Otherwise, we do static type-checking.\r\n                    if ((expected.kind === 'string' || expected.kind === 'number' || expected.kind === 'boolean') && actual.kind === 'value') {\r\n                        if (!options.omitTypeAnnotations) {\r\n                            parsed = new Assertion(expected, [parsed]);\r\n                        }\r\n                    } else if (expected.kind === 'array' && actual.kind === 'value') {\r\n                        if (!options.omitTypeAnnotations) {\r\n                            parsed = new ArrayAssertion(expected, parsed);\r\n                        }\r\n                    } else if (expected.kind === 'color' && (actual.kind === 'value' || actual.kind === 'string')) {\r\n                        if (!options.omitTypeAnnotations) {\r\n                            parsed = new Coercion(expected, [parsed]);\r\n                        }\r\n                    } else if (context.checkSubtype(context.expectedType, parsed.type)) {\r\n                        return null;\r\n                    }\r\n                }\r\n\r\n                // If an expression's arguments are all literals, we can evaluate\r\n                // it immediately and replace it with a literal value in the\r\n                // parsed/compiled result.\r\n                if (!(parsed instanceof Literal) && isConstant(parsed)) {\r\n                    const ec = new (require('./evaluation_context'))();\r\n                    try {\r\n                        parsed = new Literal(parsed.type, parsed.evaluate(ec));\r\n                    } catch (e) {\r\n                        context.error(e.message);\r\n                        return null;\r\n                    }\r\n                }\r\n\r\n                return parsed;\r\n            }\r\n\r\n            return context.error(`Unknown expression \"${op}\". If you wanted a literal array, use [\"literal\", [...]].`, 0);\r\n        } else if (typeof expr === 'undefined') {\r\n            return context.error(`'undefined' value invalid. Use null instead.`);\r\n        } else if (typeof expr === 'object') {\r\n            return context.error(`Bare objects invalid. Use [\"literal\", {...}] instead.`);\r\n        } else {\r\n            return context.error(`Expected an array, but found ${typeof expr} instead.`);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Returns a copy of this context suitable for parsing the subexpression at\r\n     * index `index`, optionally appending to 'let' binding map.\r\n     *\r\n     * Note that `errors` property, intended for collecting errors while\r\n     * parsing, is copied by reference rather than cloned.\r\n     * @private\r\n     */\r\n    concat(index: number, expectedType?: ?Type, bindings?: Array<[string, Expression]>) {\r\n        const path = typeof index === 'number' ? this.path.concat(index) : this.path;\r\n        const scope = bindings ? this.scope.concat(bindings) : this.scope;\r\n        return new ParsingContext(\r\n            this.registry,\r\n            path,\r\n            expectedType || null,\r\n            scope,\r\n            this.errors\r\n        );\r\n    }\r\n\r\n    /**\r\n     * Push a parsing (or type checking) error into the `this.errors`\r\n     * @param error The message\r\n     * @param keys Optionally specify the source of the error at a child\r\n     * of the current expression at `this.key`.\r\n     * @private\r\n     */\r\n    error(error: string, ...keys: Array<number>) {\r\n        const key = `${this.key}${keys.map(k => `[${k}]`).join('')}`;\r\n        this.errors.push(new ParsingError(key, error));\r\n    }\r\n\r\n    /**\r\n     * Returns null if `t` is a subtype of `expected`; otherwise returns an\r\n     * error message and also pushes it to `this.errors`.\r\n     */\r\n    checkSubtype(expected: Type, t: Type): ?string {\r\n        const error = checkSubtype(expected, t);\r\n        if (error) this.error(error);\r\n        return error;\r\n    }\r\n}\r\n\r\nmodule.exports = ParsingContext;\r\n\r\nfunction isConstant(expression: Expression) {\r\n    // requires within function body to workaround circular dependency\r\n    const {CompoundExpression} = require('./compound_expression');\r\n    const {isGlobalPropertyConstant, isFeatureConstant} = require('./is_constant');\r\n    const Var = require('./definitions/var');\r\n\r\n    if (expression instanceof Var) {\r\n        return false;\r\n    } else if (expression instanceof CompoundExpression && expression.name === 'error') {\r\n        return false;\r\n    }\r\n\r\n    let literalArgs = true;\r\n    expression.eachChild(arg => {\r\n        if (!(arg instanceof Literal)) { literalArgs = false; }\r\n    });\r\n    if (!literalArgs) {\r\n        return false;\r\n    }\r\n\r\n    return isFeatureConstant(expression) &&\r\n        isGlobalPropertyConstant(expression, ['zoom', 'heatmap-density']);\r\n}\r\n","// @flow\r\n\r\nimport type {Expression} from './expression';\r\n\r\n/**\r\n * Tracks `let` bindings during expression parsing.\r\n * @private\r\n */\r\nclass Scope {\r\n    parent: ?Scope;\r\n    bindings: {[string]: Expression};\r\n    constructor(parent?: Scope, bindings: Array<[string, Expression]> = []) {\r\n        this.parent = parent;\r\n        this.bindings = {};\r\n        for (const [name, expression] of bindings) {\r\n            this.bindings[name] = expression;\r\n        }\r\n    }\r\n\r\n    concat(bindings: Array<[string, Expression]>) {\r\n        return new Scope(this, bindings);\r\n    }\r\n\r\n    get(name: string): Expression {\r\n        if (this.bindings[name]) { return this.bindings[name]; }\r\n        if (this.parent) { return this.parent.get(name); }\r\n        throw new Error(`${name} not found in scope.`);\r\n    }\r\n\r\n    has(name: string): boolean {\r\n        if (this.bindings[name]) return true;\r\n        return this.parent ? this.parent.has(name) : false;\r\n    }\r\n}\r\n\r\nmodule.exports = Scope;\r\n","// @flow\r\n\r\nconst { isValue, typeOf } = require('../values');\r\n\r\nimport type { Type } from '../types';\r\nimport type { Value }  from '../values';\r\nimport type { Expression } from '../expression';\r\nimport type ParsingContext from '../parsing_context';\r\n\r\nclass Literal implements Expression {\r\n    type: Type;\r\n    value: Value;\r\n\r\n    constructor(type: Type, value: Value) {\r\n        this.type = type;\r\n        this.value = value;\r\n    }\r\n\r\n    static parse(args: Array<mixed>, context: ParsingContext) {\r\n        if (args.length !== 2)\r\n            return context.error(`'literal' expression requires exactly one argument, but found ${args.length - 1} instead.`);\r\n\r\n        if (!isValue(args[1]))\r\n            return context.error(`invalid value`);\r\n\r\n        const value = (args[1]: any);\r\n        let type = typeOf(value);\r\n\r\n        // special case: infer the item type if possible for zero-length arrays\r\n        const expected = context.expectedType;\r\n        if (\r\n            type.kind === 'array' &&\r\n            type.N === 0 &&\r\n            expected &&\r\n            expected.kind === 'array' &&\r\n            (typeof expected.N !== 'number' || expected.N === 0)\r\n        ) {\r\n            type = expected;\r\n        }\r\n\r\n        return new Literal(type, value);\r\n    }\r\n\r\n    evaluate() {\r\n        return this.value;\r\n    }\r\n\r\n    eachChild() {}\r\n\r\n    possibleOutputs() {\r\n        return [this.value];\r\n    }\r\n}\r\n\r\nmodule.exports = Literal;\r\n","// @flow\r\n\r\nconst assert = require('assert');\r\nconst {\r\n    ObjectType,\r\n    ValueType,\r\n    StringType,\r\n    NumberType,\r\n    BooleanType\r\n} = require('../types');\r\n\r\nconst RuntimeError = require('../runtime_error');\r\nconst {checkSubtype, toString} = require('../types');\r\nconst {typeOf} = require('../values');\r\n\r\nimport type { Expression } from '../expression';\r\nimport type ParsingContext from '../parsing_context';\r\nimport type EvaluationContext from '../evaluation_context';\r\nimport type { Type } from '../types';\r\n\r\nconst types = {\r\n    string: StringType,\r\n    number: NumberType,\r\n    boolean: BooleanType,\r\n    object: ObjectType\r\n};\r\n\r\nclass Assertion implements Expression {\r\n    type: Type;\r\n    args: Array<Expression>;\r\n\r\n    constructor(type: Type, args: Array<Expression>) {\r\n        this.type = type;\r\n        this.args = args;\r\n    }\r\n\r\n    static parse(args: Array<mixed>, context: ParsingContext): ?Expression {\r\n        if (args.length < 2)\r\n            return context.error(`Expected at least one argument.`);\r\n\r\n        const name: string = (args[0]: any);\r\n        assert(types[name], name);\r\n\r\n        const type = types[name];\r\n\r\n        const parsed = [];\r\n        for (let i = 1; i < args.length; i++) {\r\n            const input = context.parse(args[i], i, ValueType);\r\n            if (!input) return null;\r\n            parsed.push(input);\r\n        }\r\n\r\n        return new Assertion(type, parsed);\r\n    }\r\n\r\n    evaluate(ctx: EvaluationContext) {\r\n        for (let i = 0; i < this.args.length; i++) {\r\n            const value = this.args[i].evaluate(ctx);\r\n            const error = checkSubtype(this.type, typeOf(value));\r\n            if (!error) {\r\n                return value;\r\n            } else if (i === this.args.length - 1) {\r\n                throw new RuntimeError(`Expected value to be of type ${toString(this.type)}, but found ${toString(typeOf(value))} instead.`);\r\n            }\r\n        }\r\n\r\n        assert(false);\r\n        return null;\r\n    }\r\n\r\n    eachChild(fn: (Expression) => void) {\r\n        this.args.forEach(fn);\r\n    }\r\n\r\n    possibleOutputs() {\r\n        return [].concat(...this.args.map((arg) => arg.possibleOutputs()));\r\n    }\r\n}\r\n\r\nmodule.exports = Assertion;\r\n","// @flow\r\n\r\nconst {\r\n    toString,\r\n    array,\r\n    ValueType,\r\n    StringType,\r\n    NumberType,\r\n    BooleanType,\r\n    checkSubtype\r\n} = require('../types');\r\n\r\nconst {typeOf} = require('../values');\r\nconst RuntimeError = require('../runtime_error');\r\n\r\nimport type { Expression } from '../expression';\r\nimport type ParsingContext from '../parsing_context';\r\nimport type EvaluationContext from '../evaluation_context';\r\nimport type { ArrayType } from '../types';\r\n\r\nconst types = {\r\n    string: StringType,\r\n    number: NumberType,\r\n    boolean: BooleanType\r\n};\r\n\r\nclass ArrayAssertion implements Expression {\r\n    type: ArrayType;\r\n    input: Expression;\r\n\r\n    constructor(type: ArrayType, input: Expression) {\r\n        this.type = type;\r\n        this.input = input;\r\n    }\r\n\r\n    static parse(args: Array<mixed>, context: ParsingContext): ?Expression {\r\n        if (args.length < 2 || args.length > 4)\r\n            return context.error(`Expected 1, 2, or 3 arguments, but found ${args.length - 1} instead.`);\r\n\r\n        let itemType;\r\n        let N;\r\n        if (args.length > 2) {\r\n            const type = args[1];\r\n            if (typeof type !== 'string' || !(type in types))\r\n                return context.error('The item type argument of \"array\" must be one of string, number, boolean', 1);\r\n            itemType = types[type];\r\n        } else {\r\n            itemType = ValueType;\r\n        }\r\n\r\n        if (args.length > 3) {\r\n            if (\r\n                typeof args[2] !== 'number' ||\r\n                args[2] < 0 ||\r\n                args[2] !== Math.floor(args[2])\r\n            ) {\r\n                return context.error('The length argument to \"array\" must be a positive integer literal', 2);\r\n            }\r\n            N = args[2];\r\n        }\r\n\r\n        const type = array(itemType, N);\r\n\r\n        const input = context.parse(args[args.length - 1], args.length - 1, ValueType);\r\n        if (!input) return null;\r\n\r\n        return new ArrayAssertion(type, input);\r\n    }\r\n\r\n    evaluate(ctx: EvaluationContext) {\r\n        const value = this.input.evaluate(ctx);\r\n        const error = checkSubtype(this.type, typeOf(value));\r\n        if (error) {\r\n            throw new RuntimeError(`Expected value to be of type ${toString(this.type)}, but found ${toString(typeOf(value))} instead.`);\r\n        }\r\n        return value;\r\n    }\r\n\r\n    eachChild(fn: (Expression) => void) {\r\n        fn(this.input);\r\n    }\r\n\r\n    possibleOutputs() {\r\n        return this.input.possibleOutputs();\r\n    }\r\n}\r\n\r\nmodule.exports = ArrayAssertion;\r\n","// @flow\r\n\r\nconst assert = require('assert');\r\nconst {\r\n    ColorType,\r\n    ValueType,\r\n    NumberType,\r\n} = require('../types');\r\n\r\nconst { Color, validateRGBA } = require('../values');\r\nconst RuntimeError = require('../runtime_error');\r\n\r\nimport type { Expression } from '../expression';\r\nimport type ParsingContext from '../parsing_context';\r\nimport type EvaluationContext from '../evaluation_context';\r\nimport type { Type } from '../types';\r\n\r\nconst types = {\r\n    'to-number': NumberType,\r\n    'to-color': ColorType\r\n};\r\n\r\n/**\r\n * Special form for error-coalescing coercion expressions \"to-number\",\r\n * \"to-color\".  Since these coercions can fail at runtime, they accept multiple\r\n * arguments, only evaluating one at a time until one succeeds.\r\n *\r\n * @private\r\n */\r\nclass Coercion implements Expression {\r\n    type: Type;\r\n    args: Array<Expression>;\r\n\r\n    constructor(type: Type, args: Array<Expression>) {\r\n        this.type = type;\r\n        this.args = args;\r\n    }\r\n\r\n    static parse(args: Array<mixed>, context: ParsingContext): ?Expression {\r\n        if (args.length < 2)\r\n            return context.error(`Expected at least one argument.`);\r\n\r\n        const name: string = (args[0]: any);\r\n        assert(types[name], name);\r\n\r\n        const type = types[name];\r\n\r\n        const parsed = [];\r\n        for (let i = 1; i < args.length; i++) {\r\n            const input = context.parse(args[i], i, ValueType);\r\n            if (!input) return null;\r\n            parsed.push(input);\r\n        }\r\n\r\n        return new Coercion(type, parsed);\r\n    }\r\n\r\n    evaluate(ctx: EvaluationContext) {\r\n        if (this.type.kind === 'color') {\r\n            let input;\r\n            let error;\r\n            for (const arg of this.args) {\r\n                input = arg.evaluate(ctx);\r\n                error = null;\r\n                if (typeof input === 'string') {\r\n                    const c = ctx.parseColor(input);\r\n                    if (c) return c;\r\n                } else if (Array.isArray(input)) {\r\n                    if (input.length < 3 || input.length > 4) {\r\n                        error = `Invalid rbga value ${JSON.stringify(input)}: expected an array containing either three or four numeric values.`;\r\n                    } else {\r\n                        error = validateRGBA(input[0], input[1], input[2], input[3]);\r\n                    }\r\n                    if (!error) {\r\n                        return new Color((input[0]: any) / 255, (input[1]: any) / 255, (input[2]: any) / 255, (input[3]: any));\r\n                    }\r\n                }\r\n            }\r\n            throw new RuntimeError(error || `Could not parse color from value '${typeof input === 'string' ? input : JSON.stringify(input)}'`);\r\n        } else {\r\n            let value = null;\r\n            for (const arg of this.args) {\r\n                value = arg.evaluate(ctx);\r\n                if (value === null) continue;\r\n                const num = Number(value);\r\n                if (isNaN(num)) continue;\r\n                return num;\r\n            }\r\n            throw new RuntimeError(`Could not convert ${JSON.stringify(value)} to number.`);\r\n        }\r\n    }\r\n\r\n    eachChild(fn: (Expression) => void) {\r\n        this.args.forEach(fn);\r\n    }\r\n\r\n    possibleOutputs() {\r\n        return [].concat(...this.args.map((arg) => arg.possibleOutputs()));\r\n    }\r\n}\r\n\r\nmodule.exports = Coercion;\r\n","// @flow\r\n\r\nconst { CompoundExpression } = require('./compound_expression');\r\n\r\nimport type { Expression } from './expression.js';\r\n\r\nfunction isFeatureConstant(e: Expression) {\r\n    if (e instanceof CompoundExpression) {\r\n        if (e.name === 'get' && e.args.length === 1) {\r\n            return false;\r\n        } else if (e.name === 'has' && e.args.length === 1) {\r\n            return false;\r\n        } else if (\r\n            e.name === 'properties' ||\r\n            e.name === 'geometry-type' ||\r\n            e.name === 'id'\r\n        ) {\r\n            return false;\r\n        } else if (e.name.startsWith('filter-')) {\r\n            return false;\r\n        }\r\n    }\r\n\r\n    let result = true;\r\n    e.eachChild(arg => {\r\n        if (result && !isFeatureConstant(arg)) { result = false; }\r\n    });\r\n    return result;\r\n}\r\n\r\nfunction isGlobalPropertyConstant(e: Expression, properties: Array<string>) {\r\n    if (e instanceof CompoundExpression && properties.indexOf(e.name) >= 0) { return false; }\r\n    let result = true;\r\n    e.eachChild((arg) => {\r\n        if (result && !isGlobalPropertyConstant(arg, properties)) { result = false; }\r\n    });\r\n    return result;\r\n}\r\n\r\nmodule.exports = {\r\n    isFeatureConstant,\r\n    isGlobalPropertyConstant,\r\n};\r\n","// @flow\r\n\r\nimport type { Type } from '../types';\r\nimport type { Expression } from '../expression';\r\nimport type ParsingContext from '../parsing_context';\r\nimport type EvaluationContext  from '../evaluation_context';\r\n\r\nclass Var implements Expression {\r\n    type: Type;\r\n    name: string;\r\n\r\n    constructor(name: string, type: Type) {\r\n        this.type = type;\r\n        this.name = name;\r\n    }\r\n\r\n    static parse(args: Array<mixed>, context: ParsingContext) {\r\n        if (args.length !== 2 || typeof args[1] !== 'string')\r\n            return context.error(`'var' expression requires exactly one string literal argument.`);\r\n\r\n        const name = args[1];\r\n        if (!context.scope.has(name)) {\r\n            return context.error(`Unknown variable \"${name}\". Make sure \"${name}\" has been bound in an enclosing \"let\" expression before using it.`, 1);\r\n        }\r\n\r\n        return new Var(name, context.scope.get(name).type);\r\n    }\r\n\r\n    evaluate(ctx: EvaluationContext) {\r\n        return ctx.scope.get(this.name).evaluate(ctx);\r\n    }\r\n\r\n    eachChild() {}\r\n\r\n    possibleOutputs() {\r\n        return [undefined];\r\n    }\r\n}\r\n\r\nmodule.exports = Var;\r\n","// @flow\r\n\r\nconst { NumberType } = require('../types');\r\nconst { findStopLessThanOrEqualTo } = require(\"../stops\");\r\n\r\nimport type { Stops } from '../stops';\r\nimport type { Expression } from '../expression';\r\nimport type ParsingContext from '../parsing_context';\r\nimport type EvaluationContext from '../evaluation_context';\r\nimport type { Type } from '../types';\r\n\r\nclass Step implements Expression {\r\n    type: Type;\r\n\r\n    input: Expression;\r\n    labels: Array<number>;\r\n    outputs: Array<Expression>;\r\n\r\n    constructor(type: Type, input: Expression, stops: Stops) {\r\n        this.type = type;\r\n        this.input = input;\r\n\r\n        this.labels = [];\r\n        this.outputs = [];\r\n        for (const [label, expression] of stops) {\r\n            this.labels.push(label);\r\n            this.outputs.push(expression);\r\n        }\r\n    }\r\n\r\n    static parse(args: Array<mixed>, context: ParsingContext) {\r\n        let [ , input, ...rest] = args;\r\n\r\n        if (args.length - 1 < 4) {\r\n            return context.error(`Expected at least 4 arguments, but found only ${args.length - 1}.`);\r\n        }\r\n\r\n        if ((args.length - 1) % 2 !== 0) {\r\n            return context.error(`Expected an even number of arguments.`);\r\n        }\r\n\r\n        input = context.parse(input, 1, NumberType);\r\n        if (!input) return null;\r\n\r\n        const stops: Stops = [];\r\n\r\n        let outputType: Type = (null: any);\r\n        if (context.expectedType && context.expectedType.kind !== 'value') {\r\n            outputType = context.expectedType;\r\n        }\r\n\r\n        rest.unshift(-Infinity);\r\n\r\n        for (let i = 0; i < rest.length; i += 2) {\r\n            const label = rest[i];\r\n            const value = rest[i + 1];\r\n\r\n            const labelKey = i + 1;\r\n            const valueKey = i + 2;\r\n\r\n            if (typeof label !== 'number') {\r\n                return context.error('Input/output pairs for \"step\" expressions must be defined using literal numeric values (not computed expressions) for the input values.', labelKey);\r\n            }\r\n\r\n            if (stops.length && stops[stops.length - 1][0] >= label) {\r\n                return context.error('Input/output pairs for \"step\" expressions must be arranged with input values in strictly ascending order.', labelKey);\r\n            }\r\n\r\n            const parsed = context.parse(value, valueKey, outputType);\r\n            if (!parsed) return null;\r\n            outputType = outputType || parsed.type;\r\n            stops.push([label, parsed]);\r\n        }\r\n\r\n        return new Step(outputType, input, stops);\r\n    }\r\n\r\n    evaluate(ctx: EvaluationContext) {\r\n        const labels = this.labels;\r\n        const outputs = this.outputs;\r\n\r\n        if (labels.length === 1) {\r\n            return outputs[0].evaluate(ctx);\r\n        }\r\n\r\n        const value = ((this.input.evaluate(ctx): any): number);\r\n        if (value <= labels[0]) {\r\n            return outputs[0].evaluate(ctx);\r\n        }\r\n\r\n        const stopCount = labels.length;\r\n        if (value >= labels[stopCount - 1]) {\r\n            return outputs[stopCount - 1].evaluate(ctx);\r\n        }\r\n\r\n        const index = findStopLessThanOrEqualTo(labels, value);\r\n        return outputs[index].evaluate(ctx);\r\n    }\r\n\r\n    eachChild(fn: (Expression) => void) {\r\n        fn(this.input);\r\n        for (const expression of this.outputs) {\r\n            fn(expression);\r\n        }\r\n    }\r\n\r\n    possibleOutputs() {\r\n        return [].concat(...this.outputs.map((output) => output.possibleOutputs()));\r\n    }\r\n}\r\n\r\nmodule.exports = Step;\r\n","// @flow\r\n\r\nconst RuntimeError = require('./runtime_error');\r\n\r\nimport type { Expression } from './expression';\r\n\r\nexport type Stops = Array<[number, Expression]>;\r\n\r\n/**\r\n * Returns the index of the last stop <= input, or 0 if it doesn't exist.\r\n * @private\r\n */\r\nfunction findStopLessThanOrEqualTo(stops: Array<number>, input: number) {\r\n    const n = stops.length;\r\n    let lowerIndex = 0;\r\n    let upperIndex = n - 1;\r\n    let currentIndex = 0;\r\n    let currentValue, upperValue;\r\n\r\n    while (lowerIndex <= upperIndex) {\r\n        currentIndex = Math.floor((lowerIndex + upperIndex) / 2);\r\n        currentValue = stops[currentIndex];\r\n        upperValue = stops[currentIndex + 1];\r\n        if (input === currentValue || input > currentValue && input < upperValue) { // Search complete\r\n            return currentIndex;\r\n        } else if (currentValue < input) {\r\n            lowerIndex = currentIndex + 1;\r\n        } else if (currentValue > input) {\r\n            upperIndex = currentIndex - 1;\r\n        } else {\r\n            throw new RuntimeError('Input is not a number.');\r\n        }\r\n    }\r\n\r\n    return Math.max(currentIndex - 1, 0);\r\n}\r\n\r\nmodule.exports = {findStopLessThanOrEqualTo};\r\n","// @flow\r\n\r\nconst assert = require('assert');\r\nconst {checkSubtype, ValueType} = require('../types');\r\n\r\nimport type { Expression } from '../expression';\r\nimport type ParsingContext from '../parsing_context';\r\nimport type EvaluationContext from '../evaluation_context';\r\nimport type { Type } from '../types';\r\n\r\nclass Coalesce implements Expression {\r\n    type: Type;\r\n    args: Array<Expression>;\r\n\r\n    constructor(type: Type, args: Array<Expression>) {\r\n        this.type = type;\r\n        this.args = args;\r\n    }\r\n\r\n    static parse(args: Array<mixed>, context: ParsingContext) {\r\n        if (args.length < 2) {\r\n            return context.error(\"Expectected at least one argument.\");\r\n        }\r\n        let outputType: Type = (null: any);\r\n        const expectedType = context.expectedType;\r\n        if (expectedType && expectedType.kind !== 'value') {\r\n            outputType = expectedType;\r\n        }\r\n        const parsedArgs = [];\r\n\r\n        for (const arg of args.slice(1)) {\r\n            const parsed = context.parse(arg, 1 + parsedArgs.length, outputType, undefined, {omitTypeAnnotations: true});\r\n            if (!parsed) return null;\r\n            outputType = outputType || parsed.type;\r\n            parsedArgs.push(parsed);\r\n        }\r\n        assert(outputType);\r\n\r\n        // Above, we parse arguments without inferred type annotation so that\r\n        // they don't produce a runtime error for `null` input, which would\r\n        // preempt the desired null-coalescing behavior.\r\n        // Thus, if any of our arguments would have needed an annotation, we\r\n        // need to wrap the enclosing coalesce expression with it instead.\r\n        const needsAnnotation = expectedType &&\r\n            parsedArgs.some(arg => checkSubtype(expectedType, arg.type));\r\n\r\n        return needsAnnotation ?\r\n            new Coalesce(ValueType, parsedArgs) :\r\n            new Coalesce((outputType: any), parsedArgs);\r\n    }\r\n\r\n    evaluate(ctx: EvaluationContext) {\r\n        let result = null;\r\n        for (const arg of this.args) {\r\n            result = arg.evaluate(ctx);\r\n            if (result !== null) break;\r\n        }\r\n        return result;\r\n    }\r\n\r\n    eachChild(fn: (Expression) => void) {\r\n        this.args.forEach(fn);\r\n    }\r\n\r\n    possibleOutputs() {\r\n        return [].concat(...this.args.map((arg) => arg.possibleOutputs()));\r\n    }\r\n}\r\n\r\nmodule.exports = Coalesce;\r\n","// @flow\r\n\r\nimport type { Type } from '../types';\r\nimport type { Expression } from '../expression';\r\nimport type ParsingContext from '../parsing_context';\r\nimport type EvaluationContext  from '../evaluation_context';\r\n\r\nclass Let implements Expression {\r\n    type: Type;\r\n    bindings: Array<[string, Expression]>;\r\n    result: Expression;\r\n\r\n    constructor(bindings: Array<[string, Expression]>, result: Expression) {\r\n        this.type = result.type;\r\n        this.bindings = [].concat(bindings);\r\n        this.result = result;\r\n    }\r\n\r\n    evaluate(ctx: EvaluationContext) {\r\n        ctx.pushScope(this.bindings);\r\n        const result = this.result.evaluate(ctx);\r\n        ctx.popScope();\r\n        return result;\r\n    }\r\n\r\n    eachChild(fn: (Expression) => void) {\r\n        for (const binding of this.bindings) {\r\n            fn(binding[1]);\r\n        }\r\n        fn(this.result);\r\n    }\r\n\r\n    static parse(args: Array<mixed>, context: ParsingContext) {\r\n        if (args.length < 4)\r\n            return context.error(`Expected at least 3 arguments, but found ${args.length - 1} instead.`);\r\n\r\n        const bindings: Array<[string, Expression]> = [];\r\n        for (let i = 1; i < args.length - 1; i += 2) {\r\n            const name = args[i];\r\n\r\n            if (typeof name !== 'string') {\r\n                return context.error(`Expected string, but found ${typeof name} instead.`, i);\r\n            }\r\n\r\n            if (/[^a-zA-Z0-9_]/.test(name)) {\r\n                return context.error(`Variable names must contain only alphanumeric characters or '_'.`, i);\r\n            }\r\n\r\n            const value = context.parse(args[i + 1], i + 1);\r\n            if (!value) return null;\r\n\r\n            bindings.push([name, value]);\r\n        }\r\n\r\n        const result = context.parse(args[args.length - 1], args.length - 1, undefined, bindings);\r\n        if (!result) return null;\r\n\r\n        return new Let(bindings, result);\r\n    }\r\n\r\n    possibleOutputs() {\r\n        return this.result.possibleOutputs();\r\n    }\r\n}\r\n\r\nmodule.exports = Let;\r\n","// @flow\r\n\r\nconst {\r\n    NumberType,\r\n    StringType,\r\n    BooleanType,\r\n    ColorType,\r\n    ObjectType,\r\n    ValueType,\r\n    ErrorType,\r\n    array,\r\n    toString\r\n} = require('../types');\r\n\r\nconst { typeOf, Color, validateRGBA } = require('../values');\r\nconst { CompoundExpression, varargs } = require('../compound_expression');\r\nconst RuntimeError = require('../runtime_error');\r\nconst Let = require('./let');\r\nconst Var = require('./var');\r\nconst Literal = require('./literal');\r\nconst Assertion = require('./assertion');\r\nconst ArrayAssertion = require('./array');\r\nconst Coercion = require('./coercion');\r\nconst At = require('./at');\r\nconst Match = require('./match');\r\nconst Case = require('./case');\r\nconst Step = require('./step');\r\nconst Interpolate = require('./interpolate');\r\nconst Coalesce = require('./coalesce');\r\nconst {Equals, NotEquals} = require('./equals');\r\n\r\nimport type { ExpressionRegistry } from '../expression';\r\n\r\nconst expressions: ExpressionRegistry = {\r\n    // special forms\r\n    '==': Equals,\r\n    '!=': NotEquals,\r\n    'array': ArrayAssertion,\r\n    'at': At,\r\n    'boolean': Assertion,\r\n    'case': Case,\r\n    'coalesce': Coalesce,\r\n    'interpolate': Interpolate,\r\n    'let': Let,\r\n    'literal': Literal,\r\n    'match': Match,\r\n    'number': Assertion,\r\n    'object': Assertion,\r\n    'step': Step,\r\n    'string': Assertion,\r\n    'to-color': Coercion,\r\n    'to-number': Coercion,\r\n    'var': Var\r\n};\r\n\r\nfunction rgba(ctx, [r, g, b, a]) {\r\n    r = r.evaluate(ctx);\r\n    g = g.evaluate(ctx);\r\n    b = b.evaluate(ctx);\r\n    const alpha = a ? a.evaluate(ctx) : 1;\r\n    const error = validateRGBA(r, g, b, alpha);\r\n    if (error) throw new RuntimeError(error);\r\n    return new Color(r / 255 * alpha, g / 255 * alpha, b / 255 * alpha, alpha);\r\n}\r\n\r\nfunction has(key, obj) {\r\n    return key in obj;\r\n}\r\n\r\nfunction get(key, obj) {\r\n    const v = obj[key];\r\n    return typeof v === 'undefined' ? null : v;\r\n}\r\n\r\nfunction length(ctx, [v]) {\r\n    return v.evaluate(ctx).length;\r\n}\r\n\r\nfunction lt(ctx, [a, b]) { return a.evaluate(ctx) < b.evaluate(ctx); }\r\nfunction gt(ctx, [a, b]) { return a.evaluate(ctx) > b.evaluate(ctx); }\r\nfunction lteq(ctx, [a, b]) { return a.evaluate(ctx) <= b.evaluate(ctx); }\r\nfunction gteq(ctx, [a, b]) { return a.evaluate(ctx) >= b.evaluate(ctx); }\r\n\r\nfunction binarySearch(v, a, i, j) {\r\n    while (i <= j) {\r\n        const m = (i + j) >> 1;\r\n        if (a[m] === v)\r\n            return true;\r\n        if (a[m] > v)\r\n            j = m - 1;\r\n        else\r\n            i = m + 1;\r\n    }\r\n    return false;\r\n}\r\n\r\n\r\nCompoundExpression.register(expressions, {\r\n    'error': [\r\n        ErrorType,\r\n        [StringType],\r\n        (ctx, [v]) => { throw new RuntimeError(v.evaluate(ctx)); }\r\n    ],\r\n    'typeof': [\r\n        StringType,\r\n        [ValueType],\r\n        (ctx, [v]) => toString(typeOf(v.evaluate(ctx)))\r\n    ],\r\n    'to-string': [\r\n        StringType,\r\n        [ValueType],\r\n        (ctx, [v]) => {\r\n            v = v.evaluate(ctx);\r\n            const type = typeof v;\r\n            if (v === null || type === 'string' || type === 'number' || type === 'boolean') {\r\n                return String(v);\r\n            } else if (v instanceof Color) {\r\n                return v.toString();\r\n            } else {\r\n                return JSON.stringify(v);\r\n            }\r\n        }\r\n    ],\r\n    'to-boolean': [\r\n        BooleanType,\r\n        [ValueType],\r\n        (ctx, [v]) => Boolean(v.evaluate(ctx))\r\n    ],\r\n    'to-rgba': [\r\n        array(NumberType, 4),\r\n        [ColorType],\r\n        (ctx, [v]) => {\r\n            const {r, g, b, a} = v.evaluate(ctx);\r\n            return [255 * r / a, 255 * g / a, 255 * b / a, a];\r\n        }\r\n    ],\r\n    'rgb': [\r\n        ColorType,\r\n        [NumberType, NumberType, NumberType],\r\n        rgba\r\n    ],\r\n    'rgba': [\r\n        ColorType,\r\n        [NumberType, NumberType, NumberType, NumberType],\r\n        rgba\r\n    ],\r\n    'length': {\r\n        type: NumberType,\r\n        overloads: [\r\n            [\r\n                [StringType],\r\n                length\r\n            ], [\r\n                [array(ValueType)],\r\n                length\r\n            ]\r\n        ]\r\n    },\r\n    'has': {\r\n        type: BooleanType,\r\n        overloads: [\r\n            [\r\n                [StringType],\r\n                (ctx, [key]) => has(key.evaluate(ctx), ctx.properties())\r\n            ], [\r\n                [StringType, ObjectType],\r\n                (ctx, [key, obj]) => has(key.evaluate(ctx), obj.evaluate(ctx))\r\n            ]\r\n        ]\r\n    },\r\n    'get': {\r\n        type: ValueType,\r\n        overloads: [\r\n            [\r\n                [StringType],\r\n                (ctx, [key]) => get(key.evaluate(ctx), ctx.properties())\r\n            ], [\r\n                [StringType, ObjectType],\r\n                (ctx, [key, obj]) => get(key.evaluate(ctx), obj.evaluate(ctx))\r\n            ]\r\n        ]\r\n    },\r\n    'properties': [\r\n        ObjectType,\r\n        [],\r\n        (ctx) => ctx.properties()\r\n    ],\r\n    'geometry-type': [\r\n        StringType,\r\n        [],\r\n        (ctx) => ctx.geometryType()\r\n    ],\r\n    'id': [\r\n        ValueType,\r\n        [],\r\n        (ctx) => ctx.id()\r\n    ],\r\n    'zoom': [\r\n        NumberType,\r\n        [],\r\n        (ctx) => ctx.globals.zoom\r\n    ],\r\n    'heatmap-density': [\r\n        NumberType,\r\n        [],\r\n        (ctx) => ctx.globals.heatmapDensity || 0\r\n    ],\r\n    '+': [\r\n        NumberType,\r\n        varargs(NumberType),\r\n        (ctx, args) => {\r\n            let result = 0;\r\n            for (const arg of args) {\r\n                result += arg.evaluate(ctx);\r\n            }\r\n            return result;\r\n        }\r\n    ],\r\n    '*': [\r\n        NumberType,\r\n        varargs(NumberType),\r\n        (ctx, args) => {\r\n            let result = 1;\r\n            for (const arg of args) {\r\n                result *= arg.evaluate(ctx);\r\n            }\r\n            return result;\r\n        }\r\n    ],\r\n    '-': {\r\n        type: NumberType,\r\n        overloads: [\r\n            [\r\n                [NumberType, NumberType],\r\n                (ctx, [a, b]) => a.evaluate(ctx) - b.evaluate(ctx)\r\n            ], [\r\n                [NumberType],\r\n                (ctx, [a]) => -a.evaluate(ctx)\r\n            ]\r\n        ]\r\n    },\r\n    '/': [\r\n        NumberType,\r\n        [NumberType, NumberType],\r\n        (ctx, [a, b]) => a.evaluate(ctx) / b.evaluate(ctx)\r\n    ],\r\n    '%': [\r\n        NumberType,\r\n        [NumberType, NumberType],\r\n        (ctx, [a, b]) => a.evaluate(ctx) % b.evaluate(ctx)\r\n    ],\r\n    'ln2': [\r\n        NumberType,\r\n        [],\r\n        () => Math.LN2\r\n    ],\r\n    'pi': [\r\n        NumberType,\r\n        [],\r\n        () => Math.PI\r\n    ],\r\n    'e': [\r\n        NumberType,\r\n        [],\r\n        () => Math.E\r\n    ],\r\n    '^': [\r\n        NumberType,\r\n        [NumberType, NumberType],\r\n        (ctx, [b, e]) => Math.pow(b.evaluate(ctx), e.evaluate(ctx))\r\n    ],\r\n    'sqrt': [\r\n        NumberType,\r\n        [NumberType],\r\n        (ctx, [x]) => Math.sqrt(x.evaluate(ctx))\r\n    ],\r\n    'log10': [\r\n        NumberType,\r\n        [NumberType],\r\n        (ctx, [n]) => Math.log10(n.evaluate(ctx))\r\n    ],\r\n    'ln': [\r\n        NumberType,\r\n        [NumberType],\r\n        (ctx, [n]) => Math.log(n.evaluate(ctx))\r\n    ],\r\n    'log2': [\r\n        NumberType,\r\n        [NumberType],\r\n        (ctx, [n]) => Math.log2(n.evaluate(ctx))\r\n    ],\r\n    'sin': [\r\n        NumberType,\r\n        [NumberType],\r\n        (ctx, [n]) => Math.sin(n.evaluate(ctx))\r\n    ],\r\n    'cos': [\r\n        NumberType,\r\n        [NumberType],\r\n        (ctx, [n]) => Math.cos(n.evaluate(ctx))\r\n    ],\r\n    'tan': [\r\n        NumberType,\r\n        [NumberType],\r\n        (ctx, [n]) => Math.tan(n.evaluate(ctx))\r\n    ],\r\n    'asin': [\r\n        NumberType,\r\n        [NumberType],\r\n        (ctx, [n]) => Math.asin(n.evaluate(ctx))\r\n    ],\r\n    'acos': [\r\n        NumberType,\r\n        [NumberType],\r\n        (ctx, [n]) => Math.acos(n.evaluate(ctx))\r\n    ],\r\n    'atan': [\r\n        NumberType,\r\n        [NumberType],\r\n        (ctx, [n]) => Math.atan(n.evaluate(ctx))\r\n    ],\r\n    'min': [\r\n        NumberType,\r\n        varargs(NumberType),\r\n        (ctx, args) => Math.min(...args.map(arg => arg.evaluate(ctx)))\r\n    ],\r\n    'max': [\r\n        NumberType,\r\n        varargs(NumberType),\r\n        (ctx, args) => Math.max(...args.map(arg => arg.evaluate(ctx)))\r\n    ],\r\n    'filter-==': [\r\n        BooleanType,\r\n        [StringType, ValueType],\r\n        (ctx, [k, v]) => ctx.properties()[(k: any).value] === (v: any).value\r\n    ],\r\n    'filter-id-==': [\r\n        BooleanType,\r\n        [ValueType],\r\n        (ctx, [v]) => ctx.id() === (v: any).value\r\n    ],\r\n    'filter-type-==': [\r\n        BooleanType,\r\n        [StringType],\r\n        (ctx, [v]) => ctx.geometryType() === (v: any).value\r\n    ],\r\n    'filter-<': [\r\n        BooleanType,\r\n        [StringType, ValueType],\r\n        (ctx, [k, v]) => {\r\n            const a = ctx.properties()[(k: any).value];\r\n            const b = (v: any).value;\r\n            return typeof a === typeof b && a < b;\r\n        }\r\n    ],\r\n    'filter-id-<': [\r\n        BooleanType,\r\n        [ValueType],\r\n        (ctx, [v]) => {\r\n            const a = ctx.id();\r\n            const b = (v: any).value;\r\n            return typeof a === typeof b && a < b;\r\n        }\r\n    ],\r\n    'filter->': [\r\n        BooleanType,\r\n        [StringType, ValueType],\r\n        (ctx, [k, v]) => {\r\n            const a = ctx.properties()[(k: any).value];\r\n            const b = (v: any).value;\r\n            return typeof a === typeof b && a > b;\r\n        }\r\n    ],\r\n    'filter-id->': [\r\n        BooleanType,\r\n        [ValueType],\r\n        (ctx, [v]) => {\r\n            const a = ctx.id();\r\n            const b = (v: any).value;\r\n            return typeof a === typeof b && a > b;\r\n        }\r\n    ],\r\n    'filter-<=': [\r\n        BooleanType,\r\n        [StringType, ValueType],\r\n        (ctx, [k, v]) => {\r\n            const a = ctx.properties()[(k: any).value];\r\n            const b = (v: any).value;\r\n            return typeof a === typeof b && a <= b;\r\n        }\r\n    ],\r\n    'filter-id-<=': [\r\n        BooleanType,\r\n        [ValueType],\r\n        (ctx, [v]) => {\r\n            const a = ctx.id();\r\n            const b = (v: any).value;\r\n            return typeof a === typeof b && a <= b;\r\n        }\r\n    ],\r\n    'filter->=': [\r\n        BooleanType,\r\n        [StringType, ValueType],\r\n        (ctx, [k, v]) => {\r\n            const a = ctx.properties()[(k: any).value];\r\n            const b = (v: any).value;\r\n            return typeof a === typeof b && a >= b;\r\n        }\r\n    ],\r\n    'filter-id->=': [\r\n        BooleanType,\r\n        [ValueType],\r\n        (ctx, [v]) => {\r\n            const a = ctx.id();\r\n            const b = (v: any).value;\r\n            return typeof a === typeof b && a >= b;\r\n        }\r\n    ],\r\n    'filter-has': [\r\n        BooleanType,\r\n        [ValueType],\r\n        (ctx, [k]) => (k: any).value in ctx.properties()\r\n    ],\r\n    'filter-has-id': [\r\n        BooleanType,\r\n        [],\r\n        (ctx) => ctx.id() !== null\r\n    ],\r\n    'filter-type-in': [\r\n        BooleanType,\r\n        [array(StringType)],\r\n        (ctx, [v]) => (v: any).value.indexOf(ctx.geometryType()) >= 0\r\n    ],\r\n    'filter-id-in': [\r\n        BooleanType,\r\n        [array(ValueType)],\r\n        (ctx, [v]) => (v: any).value.indexOf(ctx.id()) >= 0\r\n    ],\r\n    'filter-in-small': [\r\n        BooleanType,\r\n        [StringType, array(ValueType)],\r\n        // assumes v is an array literal\r\n        (ctx, [k, v]) => (v: any).value.indexOf(ctx.properties()[(k: any).value]) >= 0\r\n    ],\r\n    'filter-in-large': [\r\n        BooleanType,\r\n        [StringType, array(ValueType)],\r\n        // assumes v is a array literal with values sorted in ascending order and of a single type\r\n        (ctx, [k, v]) => binarySearch(ctx.properties()[(k: any).value], (v: any).value, 0, (v: any).value.length - 1)\r\n    ],\r\n    '>': {\r\n        type: BooleanType,\r\n        overloads: [\r\n            [[NumberType, NumberType], gt],\r\n            [[StringType, StringType], gt]\r\n        ]\r\n    },\r\n    '<': {\r\n        type: BooleanType,\r\n        overloads: [\r\n            [[NumberType, NumberType], lt],\r\n            [[StringType, StringType], lt]\r\n        ]\r\n    },\r\n    '>=': {\r\n        type: BooleanType,\r\n        overloads: [\r\n            [[NumberType, NumberType], gteq],\r\n            [[StringType, StringType], gteq]\r\n        ]\r\n    },\r\n    '<=': {\r\n        type: BooleanType,\r\n        overloads: [\r\n            [[NumberType, NumberType], lteq],\r\n            [[StringType, StringType], lteq]\r\n        ]\r\n    },\r\n    'all': {\r\n        type: BooleanType,\r\n        overloads: [\r\n            [\r\n                [BooleanType, BooleanType],\r\n                (ctx, [a, b]) => a.evaluate(ctx) && b.evaluate(ctx)\r\n            ],\r\n            [\r\n                varargs(BooleanType),\r\n                (ctx, args) => {\r\n                    for (const arg of args) {\r\n                        if (!arg.evaluate(ctx))\r\n                            return false;\r\n                    }\r\n                    return true;\r\n                }\r\n            ]\r\n        ]\r\n    },\r\n    'any': {\r\n        type: BooleanType,\r\n        overloads: [\r\n            [\r\n                [BooleanType, BooleanType],\r\n                (ctx, [a, b]) => a.evaluate(ctx) || b.evaluate(ctx)\r\n            ],\r\n            [\r\n                varargs(BooleanType),\r\n                (ctx, args) => {\r\n                    for (const arg of args) {\r\n                        if (arg.evaluate(ctx))\r\n                            return true;\r\n                    }\r\n                    return false;\r\n                }\r\n            ]\r\n        ]\r\n    },\r\n    '!': [\r\n        BooleanType,\r\n        [BooleanType],\r\n        (ctx, [b]) => !b.evaluate(ctx)\r\n    ],\r\n    'upcase': [\r\n        StringType,\r\n        [StringType],\r\n        (ctx, [s]) => s.evaluate(ctx).toUpperCase()\r\n    ],\r\n    'downcase': [\r\n        StringType,\r\n        [StringType],\r\n        (ctx, [s]) => s.evaluate(ctx).toLowerCase()\r\n    ],\r\n    'concat': [\r\n        StringType,\r\n        varargs(StringType),\r\n        (ctx, args) => args.map(arg => arg.evaluate(ctx)).join('')\r\n    ]\r\n});\r\n\r\nmodule.exports = expressions;\r\n","\r\nconst ValidationError = require('../error/validation_error');\r\n\r\nmodule.exports = function validateConstants(options) {\r\n    const key = options.key;\r\n    const constants = options.value;\r\n\r\n    if (constants) {\r\n        return [new ValidationError(key, constants, 'constants have been deprecated as of v8')];\r\n    } else {\r\n        return [];\r\n    }\r\n};\r\n","\r\nconst ValidationError = require('../error/validation_error');\r\nconst getType = require('../util/get_type');\r\nconst validate = require('./validate');\r\nconst validateObject = require('./validate_object');\r\nconst validateArray = require('./validate_array');\r\nconst validateNumber = require('./validate_number');\r\nconst unbundle = require('../util/unbundle_jsonlint');\r\n\r\nmodule.exports = function validateFunction(options) {\r\n    const functionValueSpec = options.valueSpec;\r\n    const functionType = unbundle(options.value.type);\r\n    let stopKeyType;\r\n    let stopDomainValues = {};\r\n    let previousStopDomainValue;\r\n    let previousStopDomainZoom;\r\n\r\n    const isZoomFunction = functionType !== 'categorical' && options.value.property === undefined;\r\n    const isPropertyFunction = !isZoomFunction;\r\n    const isZoomAndPropertyFunction =\r\n        getType(options.value.stops) === 'array' &&\r\n        getType(options.value.stops[0]) === 'array' &&\r\n        getType(options.value.stops[0][0]) === 'object';\r\n\r\n    const errors = validateObject({\r\n        key: options.key,\r\n        value: options.value,\r\n        valueSpec: options.styleSpec.function,\r\n        style: options.style,\r\n        styleSpec: options.styleSpec,\r\n        objectElementValidators: {\r\n            stops: validateFunctionStops,\r\n            default: validateFunctionDefault\r\n        }\r\n    });\r\n\r\n    if (functionType === 'identity' && isZoomFunction) {\r\n        errors.push(new ValidationError(options.key, options.value, 'missing required property \"property\"'));\r\n    }\r\n\r\n    if (functionType !== 'identity' && !options.value.stops) {\r\n        errors.push(new ValidationError(options.key, options.value, 'missing required property \"stops\"'));\r\n    }\r\n\r\n    if (functionType === 'exponential' && options.valueSpec['function'] === 'piecewise-constant') {\r\n        errors.push(new ValidationError(options.key, options.value, 'exponential functions not supported'));\r\n    }\r\n\r\n    if (options.styleSpec.$version >= 8) {\r\n        if (isPropertyFunction && !options.valueSpec['property-function']) {\r\n            errors.push(new ValidationError(options.key, options.value, 'property functions not supported'));\r\n        } else if (isZoomFunction && !options.valueSpec['zoom-function'] && options.objectKey !== 'heatmap-color') {\r\n            errors.push(new ValidationError(options.key, options.value, 'zoom functions not supported'));\r\n        }\r\n    }\r\n\r\n    if ((functionType === 'categorical' || isZoomAndPropertyFunction) && options.value.property === undefined) {\r\n        errors.push(new ValidationError(options.key, options.value, '\"property\" property is required'));\r\n    }\r\n\r\n    return errors;\r\n\r\n    function validateFunctionStops(options) {\r\n        if (functionType === 'identity') {\r\n            return [new ValidationError(options.key, options.value, 'identity function may not have a \"stops\" property')];\r\n        }\r\n\r\n        let errors = [];\r\n        const value = options.value;\r\n\r\n        errors = errors.concat(validateArray({\r\n            key: options.key,\r\n            value: value,\r\n            valueSpec: options.valueSpec,\r\n            style: options.style,\r\n            styleSpec: options.styleSpec,\r\n            arrayElementValidator: validateFunctionStop\r\n        }));\r\n\r\n        if (getType(value) === 'array' && value.length === 0) {\r\n            errors.push(new ValidationError(options.key, value, 'array must have at least one stop'));\r\n        }\r\n\r\n        return errors;\r\n    }\r\n\r\n    function validateFunctionStop(options) {\r\n        let errors = [];\r\n        const value = options.value;\r\n        const key = options.key;\r\n\r\n        if (getType(value) !== 'array') {\r\n            return [new ValidationError(key, value, `array expected, ${getType(value)} found`)];\r\n        }\r\n\r\n        if (value.length !== 2) {\r\n            return [new ValidationError(key, value, `array length 2 expected, length ${value.length} found`)];\r\n        }\r\n\r\n        if (isZoomAndPropertyFunction) {\r\n            if (getType(value[0]) !== 'object') {\r\n                return [new ValidationError(key, value, `object expected, ${getType(value[0])} found`)];\r\n            }\r\n            if (value[0].zoom === undefined) {\r\n                return [new ValidationError(key, value, 'object stop key must have zoom')];\r\n            }\r\n            if (value[0].value === undefined) {\r\n                return [new ValidationError(key, value, 'object stop key must have value')];\r\n            }\r\n            if (previousStopDomainZoom && previousStopDomainZoom > unbundle(value[0].zoom)) {\r\n                return [new ValidationError(key, value[0].zoom, 'stop zoom values must appear in ascending order')];\r\n            }\r\n            if (unbundle(value[0].zoom) !== previousStopDomainZoom) {\r\n                previousStopDomainZoom = unbundle(value[0].zoom);\r\n                previousStopDomainValue = undefined;\r\n                stopDomainValues = {};\r\n            }\r\n            errors = errors.concat(validateObject({\r\n                key: `${key}[0]`,\r\n                value: value[0],\r\n                valueSpec: { zoom: {} },\r\n                style: options.style,\r\n                styleSpec: options.styleSpec,\r\n                objectElementValidators: { zoom: validateNumber, value: validateStopDomainValue }\r\n            }));\r\n        } else {\r\n            errors = errors.concat(validateStopDomainValue({\r\n                key: `${key}[0]`,\r\n                value: value[0],\r\n                valueSpec: {},\r\n                style: options.style,\r\n                styleSpec: options.styleSpec\r\n            }, value));\r\n        }\r\n\r\n        return errors.concat(validate({\r\n            key: `${key}[1]`,\r\n            value: value[1],\r\n            valueSpec: functionValueSpec,\r\n            style: options.style,\r\n            styleSpec: options.styleSpec\r\n        }));\r\n    }\r\n\r\n    function validateStopDomainValue(options, stop) {\r\n        const type = getType(options.value);\r\n        const value = unbundle(options.value);\r\n\r\n        const reportValue = options.value !== null ? options.value : stop;\r\n\r\n        if (!stopKeyType) {\r\n            stopKeyType = type;\r\n        } else if (type !== stopKeyType) {\r\n            return [new ValidationError(options.key, reportValue, `${type} stop domain type must match previous stop domain type ${stopKeyType}`)];\r\n        }\r\n\r\n        if (type !== 'number' && type !== 'string' && type !== 'boolean') {\r\n            return [new ValidationError(options.key, reportValue, 'stop domain value must be a number, string, or boolean')];\r\n        }\r\n\r\n        if (type !== 'number' && functionType !== 'categorical') {\r\n            let message = `number expected, ${type} found`;\r\n            if (functionValueSpec['property-function'] && functionType === undefined) {\r\n                message += '\\nIf you intended to use a categorical function, specify `\"type\": \"categorical\"`.';\r\n            }\r\n            return [new ValidationError(options.key, reportValue, message)];\r\n        }\r\n\r\n        if (functionType === 'categorical' && type === 'number' && (!isFinite(value) || Math.floor(value) !== value)) {\r\n            return [new ValidationError(options.key, reportValue, `integer expected, found ${value}`)];\r\n        }\r\n\r\n        if (functionType !== 'categorical' && type === 'number' && previousStopDomainValue !== undefined && value < previousStopDomainValue) {\r\n            return [new ValidationError(options.key, reportValue, 'stop domain values must appear in ascending order')];\r\n        } else {\r\n            previousStopDomainValue = value;\r\n        }\r\n\r\n        if (functionType === 'categorical' && value in stopDomainValues) {\r\n            return [new ValidationError(options.key, reportValue, 'stop domain values must be unique')];\r\n        } else {\r\n            stopDomainValues[value] = true;\r\n        }\r\n\r\n        return [];\r\n    }\r\n\r\n    function validateFunctionDefault(options) {\r\n        return validate({\r\n            key: options.key,\r\n            value: options.value,\r\n            valueSpec: functionValueSpec,\r\n            style: options.style,\r\n            styleSpec: options.styleSpec\r\n        });\r\n    }\r\n};\r\n","\r\nconst getType = require('../util/get_type');\r\nconst validate = require('./validate');\r\nconst ValidationError = require('../error/validation_error');\r\n\r\nmodule.exports = function validateArray(options) {\r\n    const array = options.value;\r\n    const arraySpec = options.valueSpec;\r\n    const style = options.style;\r\n    const styleSpec = options.styleSpec;\r\n    const key = options.key;\r\n    const validateArrayElement = options.arrayElementValidator || validate;\r\n\r\n    if (getType(array) !== 'array') {\r\n        return [new ValidationError(key, array, `array expected, ${getType(array)} found`)];\r\n    }\r\n\r\n    if (arraySpec.length && array.length !== arraySpec.length) {\r\n        return [new ValidationError(key, array, `array length ${arraySpec.length} expected, length ${array.length} found`)];\r\n    }\r\n\r\n    if (arraySpec['min-length'] && array.length < arraySpec['min-length']) {\r\n        return [new ValidationError(key, array, `array length at least ${arraySpec['min-length']} expected, length ${array.length} found`)];\r\n    }\r\n\r\n    let arrayElementSpec = {\r\n        \"type\": arraySpec.value\r\n    };\r\n\r\n    if (styleSpec.$version < 7) {\r\n        arrayElementSpec.function = arraySpec.function;\r\n    }\r\n\r\n    if (getType(arraySpec.value) === 'object') {\r\n        arrayElementSpec = arraySpec.value;\r\n    }\r\n\r\n    let errors = [];\r\n    for (let i = 0; i < array.length; i++) {\r\n        errors = errors.concat(validateArrayElement({\r\n            array: array,\r\n            arrayIndex: i,\r\n            value: array[i],\r\n            valueSpec: arrayElementSpec,\r\n            style: style,\r\n            styleSpec: styleSpec,\r\n            key: `${key}[${i}]`\r\n        }));\r\n    }\r\n    return errors;\r\n};\r\n","\r\nconst getType = require('../util/get_type');\r\nconst ValidationError = require('../error/validation_error');\r\n\r\nmodule.exports = function validateNumber(options) {\r\n    const key = options.key;\r\n    const value = options.value;\r\n    const valueSpec = options.valueSpec;\r\n    const type = getType(value);\r\n\r\n    if (type !== 'number') {\r\n        return [new ValidationError(key, value, `number expected, ${type} found`)];\r\n    }\r\n\r\n    if ('minimum' in valueSpec && value < valueSpec.minimum) {\r\n        return [new ValidationError(key, value, `${value} is less than the minimum value ${valueSpec.minimum}`)];\r\n    }\r\n\r\n    if ('maximum' in valueSpec && value > valueSpec.maximum) {\r\n        return [new ValidationError(key, value, `${value} is greater than the maximum value ${valueSpec.maximum}`)];\r\n    }\r\n\r\n    return [];\r\n};\r\n","// @flow\r\n\r\nconst ValidationError = require('../error/validation_error');\r\nconst {createExpression, createPropertyExpression} = require('../expression');\r\nconst unbundle = require('../util/unbundle_jsonlint');\r\n\r\nmodule.exports = function validateExpression(options: any) {\r\n    const expression = (options.expressionContext === 'property' ? createPropertyExpression : createExpression)(unbundle.deep(options.value), options.valueSpec);\r\n    if (expression.result === 'error') {\r\n        return expression.value.map((error) => {\r\n            return new ValidationError(`${options.key}${error.key}`, options.value, error.message);\r\n        });\r\n    }\r\n\r\n    if (options.expressionContext === 'property' && options.propertyKey === 'text-font' &&\r\n        (expression.value: any)._styleExpression.expression.possibleOutputs().indexOf(undefined) !== -1) {\r\n        return [new ValidationError(options.key, options.value, 'Invalid data expression for \"text-font\". Output values must be contained as literals within the expression.')];\r\n    }\r\n\r\n    return [];\r\n};\r\n","\r\nconst ValidationError = require('../error/validation_error');\r\nconst unbundle = require('../util/unbundle_jsonlint');\r\nconst validateObject = require('./validate_object');\r\nconst validateFilter = require('./validate_filter');\r\nconst validatePaintProperty = require('./validate_paint_property');\r\nconst validateLayoutProperty = require('./validate_layout_property');\r\nconst validateSpec = require('./validate');\r\nconst extend = require('../util/extend');\r\n\r\nmodule.exports = function validateLayer(options) {\r\n    let errors = [];\r\n\r\n    const layer = options.value;\r\n    const key = options.key;\r\n    const style = options.style;\r\n    const styleSpec = options.styleSpec;\r\n\r\n    if (!layer.type && !layer.ref) {\r\n        errors.push(new ValidationError(key, layer, 'either \"type\" or \"ref\" is required'));\r\n    }\r\n    let type = unbundle(layer.type);\r\n    const ref = unbundle(layer.ref);\r\n\r\n    if (layer.id) {\r\n        const layerId = unbundle(layer.id);\r\n        for (let i = 0; i < options.arrayIndex; i++) {\r\n            const otherLayer = style.layers[i];\r\n            if (unbundle(otherLayer.id) === layerId) {\r\n                errors.push(new ValidationError(key, layer.id, `duplicate layer id \"${layer.id}\", previously used at line ${otherLayer.id.__line__}`));\r\n            }\r\n        }\r\n    }\r\n\r\n    if ('ref' in layer) {\r\n        ['type', 'source', 'source-layer', 'filter', 'layout'].forEach((p) => {\r\n            if (p in layer) {\r\n                errors.push(new ValidationError(key, layer[p], `\"${p}\" is prohibited for ref layers`));\r\n            }\r\n        });\r\n\r\n        let parent;\r\n\r\n        style.layers.forEach((layer) => {\r\n            if (unbundle(layer.id) === ref) parent = layer;\r\n        });\r\n\r\n        if (!parent) {\r\n            errors.push(new ValidationError(key, layer.ref, `ref layer \"${ref}\" not found`));\r\n        } else if (parent.ref) {\r\n            errors.push(new ValidationError(key, layer.ref, 'ref cannot reference another ref layer'));\r\n        } else {\r\n            type = unbundle(parent.type);\r\n        }\r\n    } else if (type !== 'background') {\r\n        if (!layer.source) {\r\n            errors.push(new ValidationError(key, layer, 'missing required property \"source\"'));\r\n        } else {\r\n            const source = style.sources && style.sources[layer.source];\r\n            const sourceType = source && unbundle(source.type);\r\n            if (!source) {\r\n                errors.push(new ValidationError(key, layer.source, `source \"${layer.source}\" not found`));\r\n            } else if (sourceType === 'vector' && type === 'raster') {\r\n                errors.push(new ValidationError(key, layer.source, `layer \"${layer.id}\" requires a raster source`));\r\n            } else if (sourceType === 'raster' && type !== 'raster') {\r\n                errors.push(new ValidationError(key, layer.source, `layer \"${layer.id}\" requires a vector source`));\r\n            } else if (sourceType === 'vector' && !layer['source-layer']) {\r\n                errors.push(new ValidationError(key, layer, `layer \"${layer.id}\" must specify a \"source-layer\"`));\r\n            } else if (sourceType === 'raster-dem' && type !== 'hillshade') {\r\n                errors.push(new ValidationError(key, layer.source, 'raster-dem source can only be used with layer type \\'hillshade\\'.'));\r\n            }\r\n        }\r\n    }\r\n\r\n    errors = errors.concat(validateObject({\r\n        key: key,\r\n        value: layer,\r\n        valueSpec: styleSpec.layer,\r\n        style: options.style,\r\n        styleSpec: options.styleSpec,\r\n        objectElementValidators: {\r\n            '*': function() {\r\n                return [];\r\n            },\r\n            // We don't want to enforce the spec's `\"requires\": true` for backward compatibility with refs;\r\n            // the actual requirement is validated above. See https://github.com/mapbox/mapbox-gl-js/issues/5772.\r\n            type: function() {\r\n                return validateSpec({\r\n                    key: `${key}.type`,\r\n                    value: layer.type,\r\n                    valueSpec: styleSpec.layer.type,\r\n                    style: options.style,\r\n                    styleSpec: options.styleSpec,\r\n                    object: layer,\r\n                    objectKey: 'type'\r\n                });\r\n            },\r\n            filter: validateFilter,\r\n            layout: function(options) {\r\n                return validateObject({\r\n                    layer: layer,\r\n                    key: options.key,\r\n                    value: options.value,\r\n                    style: options.style,\r\n                    styleSpec: options.styleSpec,\r\n                    objectElementValidators: {\r\n                        '*': function(options) {\r\n                            return validateLayoutProperty(extend({layerType: type}, options));\r\n                        }\r\n                    }\r\n                });\r\n            },\r\n            paint: function(options) {\r\n                return validateObject({\r\n                    layer: layer,\r\n                    key: options.key,\r\n                    value: options.value,\r\n                    style: options.style,\r\n                    styleSpec: options.styleSpec,\r\n                    objectElementValidators: {\r\n                        '*': function(options) {\r\n                            return validatePaintProperty(extend({layerType: type}, options));\r\n                        }\r\n                    }\r\n                });\r\n            }\r\n        }\r\n    }));\r\n\r\n    return errors;\r\n};\r\n","\r\nconst validateProperty = require('./validate_property');\r\n\r\nmodule.exports = function validatePaintProperty(options) {\r\n    return validateProperty(options, 'paint');\r\n};\r\n","\r\nconst validate = require('./validate');\r\nconst ValidationError = require('../error/validation_error');\r\nconst getType = require('../util/get_type');\r\nconst {isFunction} = require('../function');\r\nconst unbundle = require('../util/unbundle_jsonlint');\r\n\r\nmodule.exports = function validateProperty(options, propertyType) {\r\n    const key = options.key;\r\n    const style = options.style;\r\n    const styleSpec = options.styleSpec;\r\n    const value = options.value;\r\n    const propertyKey = options.objectKey;\r\n    const layerSpec = styleSpec[`${propertyType}_${options.layerType}`];\r\n\r\n    if (!layerSpec) return [];\r\n\r\n    const transitionMatch = propertyKey.match(/^(.*)-transition$/);\r\n    if (propertyType === 'paint' && transitionMatch && layerSpec[transitionMatch[1]] && layerSpec[transitionMatch[1]].transition) {\r\n        return validate({\r\n            key: key,\r\n            value: value,\r\n            valueSpec: styleSpec.transition,\r\n            style: style,\r\n            styleSpec: styleSpec\r\n        });\r\n    }\r\n\r\n    const valueSpec = options.valueSpec || layerSpec[propertyKey];\r\n    if (!valueSpec) {\r\n        return [new ValidationError(key, value, `unknown property \"${propertyKey}\"`)];\r\n    }\r\n\r\n    let tokenMatch;\r\n    if (getType(value) === 'string' && valueSpec['property-function'] && !valueSpec.tokens && (tokenMatch = /^{([^}]+)}$/.exec(value))) {\r\n        return [new ValidationError(\r\n            key, value,\r\n            `\"${propertyKey}\" does not support interpolation syntax\\n` +\r\n                `Use an identity property function instead: \\`{ \"type\": \"identity\", \"property\": ${JSON.stringify(tokenMatch[1])} }\\`.`)];\r\n    }\r\n\r\n    const errors = [];\r\n\r\n    if (options.layerType === 'symbol') {\r\n        if (propertyKey === 'text-field' && style && !style.glyphs) {\r\n            errors.push(new ValidationError(key, value, 'use of \"text-field\" requires a style \"glyphs\" property'));\r\n        }\r\n        if (propertyKey === 'text-font' && isFunction(unbundle.deep(value)) && unbundle(value.type) === 'identity') {\r\n            errors.push(new ValidationError(key, value, '\"text-font\" does not support identity functions'));\r\n        }\r\n    }\r\n\r\n    return errors.concat(validate({\r\n        key: options.key,\r\n        value: value,\r\n        valueSpec: valueSpec,\r\n        style: style,\r\n        styleSpec: styleSpec,\r\n        expressionContext: 'property',\r\n        propertyKey\r\n    }));\r\n};\r\n","\r\nconst validateProperty = require('./validate_property');\r\n\r\nmodule.exports = function validateLayoutProperty(options) {\r\n    return validateProperty(options, 'layout');\r\n};\r\n","\r\nconst ValidationError = require('../error/validation_error');\r\nconst unbundle = require('../util/unbundle_jsonlint');\r\nconst validateObject = require('./validate_object');\r\nconst validateEnum = require('./validate_enum');\r\n\r\nmodule.exports = function validateSource(options) {\r\n    const value = options.value;\r\n    const key = options.key;\r\n    const styleSpec = options.styleSpec;\r\n    const style = options.style;\r\n\r\n    if (!value.type) {\r\n        return [new ValidationError(key, value, '\"type\" is required')];\r\n    }\r\n\r\n    const type = unbundle(value.type);\r\n    let errors = [];\r\n\r\n    switch (type) {\r\n    case 'vector':\r\n    case 'raster':\r\n    case 'raster-dem':\r\n        errors = errors.concat(validateObject({\r\n            key: key,\r\n            value: value,\r\n            valueSpec: styleSpec[`source_${type.replace('-', '_')}`],\r\n            style: options.style,\r\n            styleSpec: styleSpec\r\n        }));\r\n        if ('url' in value) {\r\n            for (const prop in value) {\r\n                if (['type', 'url', 'tileSize'].indexOf(prop) < 0) {\r\n                    errors.push(new ValidationError(`${key}.${prop}`, value[prop], `a source with a \"url\" property may not include a \"${prop}\" property`));\r\n                }\r\n            }\r\n        }\r\n        return errors;\r\n\r\n    case 'geojson':\r\n        return validateObject({\r\n            key: key,\r\n            value: value,\r\n            valueSpec: styleSpec.source_geojson,\r\n            style: style,\r\n            styleSpec: styleSpec\r\n        });\r\n\r\n    case 'video':\r\n        return validateObject({\r\n            key: key,\r\n            value: value,\r\n            valueSpec: styleSpec.source_video,\r\n            style: style,\r\n            styleSpec: styleSpec\r\n        });\r\n\r\n    case 'image':\r\n        return validateObject({\r\n            key: key,\r\n            value: value,\r\n            valueSpec: styleSpec.source_image,\r\n            style: style,\r\n            styleSpec: styleSpec\r\n        });\r\n\r\n    case 'canvas':\r\n        return validateObject({\r\n            key: key,\r\n            value: value,\r\n            valueSpec: styleSpec.source_canvas,\r\n            style: style,\r\n            styleSpec: styleSpec\r\n        });\r\n\r\n    default:\r\n        return validateEnum({\r\n            key: `${key}.type`,\r\n            value: value.type,\r\n            valueSpec: {values: ['vector', 'raster', 'raster-dem', 'geojson', 'video', 'image', 'canvas']},\r\n            style: style,\r\n            styleSpec: styleSpec\r\n        });\r\n    }\r\n};\r\n","\r\nconst ValidationError = require('../error/validation_error');\r\nconst getType = require('../util/get_type');\r\nconst validate = require('./validate');\r\n\r\nmodule.exports = function validateLight(options) {\r\n    const light = options.value;\r\n    const styleSpec = options.styleSpec;\r\n    const lightSpec = styleSpec.light;\r\n    const style = options.style;\r\n\r\n    let errors = [];\r\n\r\n    const rootType = getType(light);\r\n    if (light === undefined) {\r\n        return errors;\r\n    } else if (rootType !== 'object') {\r\n        errors = errors.concat([new ValidationError('light', light, `object expected, ${rootType} found`)]);\r\n        return errors;\r\n    }\r\n\r\n    for (const key in light) {\r\n        const transitionMatch = key.match(/^(.*)-transition$/);\r\n\r\n        if (transitionMatch && lightSpec[transitionMatch[1]] && lightSpec[transitionMatch[1]].transition) {\r\n            errors = errors.concat(validate({\r\n                key: key,\r\n                value: light[key],\r\n                valueSpec: styleSpec.transition,\r\n                style: style,\r\n                styleSpec: styleSpec\r\n            }));\r\n        } else if (lightSpec[key]) {\r\n            errors = errors.concat(validate({\r\n                key: key,\r\n                value: light[key],\r\n                valueSpec: lightSpec[key],\r\n                style: style,\r\n                styleSpec: styleSpec\r\n            }));\r\n        } else {\r\n            errors = errors.concat([new ValidationError(key, light[key], `unknown property \"${key}\"`)]);\r\n        }\r\n    }\r\n\r\n    return errors;\r\n};\r\n","\r\nconst getType = require('../util/get_type');\r\nconst ValidationError = require('../error/validation_error');\r\n\r\nmodule.exports = function validateString(options) {\r\n    const value = options.value;\r\n    const key = options.key;\r\n    const type = getType(value);\r\n\r\n    if (type !== 'string') {\r\n        return [new ValidationError(key, value, `string expected, ${type} found`)];\r\n    }\r\n\r\n    return [];\r\n};\r\n","// @flow\r\n\r\nconst util = require('./util');\r\n\r\ntype Listener = (Object) => any;\r\ntype Listeners = { [string]: Array<Listener> };\r\n\r\nfunction _addEventListener(type: string, listener: Listener, listenerList: Listeners) {\r\n    listenerList[type] = listenerList[type] || [];\r\n    listenerList[type].push(listener);\r\n}\r\n\r\nfunction _removeEventListener(type: string, listener: Listener, listenerList: Listeners) {\r\n    if (listenerList && listenerList[type]) {\r\n        const index = listenerList[type].indexOf(listener);\r\n        if (index !== -1) {\r\n            listenerList[type].splice(index, 1);\r\n        }\r\n    }\r\n}\r\n\r\n/**\r\n * Methods mixed in to other classes for event capabilities.\r\n *\r\n * @mixin Evented\r\n */\r\nclass Evented {\r\n    _listeners: Listeners;\r\n    _oneTimeListeners: Listeners;\r\n    _eventedParent: ?Evented;\r\n    _eventedParentData: ?(Object | () => Object);\r\n\r\n    /**\r\n     * Adds a listener to a specified event type.\r\n     *\r\n     * @param {string} type The event type to add a listen for.\r\n     * @param {Function} listener The function to be called when the event is fired.\r\n     *   The listener function is called with the data object passed to `fire`,\r\n     *   extended with `target` and `type` properties.\r\n     * @returns {Object} `this`\r\n     */\r\n    on(type: *, listener: Listener): this {\r\n        this._listeners = this._listeners || {};\r\n        _addEventListener(type, listener, this._listeners);\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Removes a previously registered event listener.\r\n     *\r\n     * @param {string} type The event type to remove listeners for.\r\n     * @param {Function} listener The listener function to remove.\r\n     * @returns {Object} `this`\r\n     */\r\n    off(type: *, listener: Listener) {\r\n        _removeEventListener(type, listener, this._listeners);\r\n        _removeEventListener(type, listener, this._oneTimeListeners);\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Adds a listener that will be called only once to a specified event type.\r\n     *\r\n     * The listener will be called first time the event fires after the listener is registered.\r\n     *\r\n     * @param {string} type The event type to listen for.\r\n     * @param {Function} listener The function to be called when the event is fired the first time.\r\n     * @returns {Object} `this`\r\n     */\r\n    once(type: string, listener: Listener) {\r\n        this._oneTimeListeners = this._oneTimeListeners || {};\r\n        _addEventListener(type, listener, this._oneTimeListeners);\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Fires an event of the specified type.\r\n     *\r\n     * @param {string} type The type of event to fire.\r\n     * @param {Object} [data] Data to be passed to any listeners.\r\n     * @returns {Object} `this`\r\n     */\r\n    fire(type: string, data?: Object) {\r\n        if (this.listens(type)) {\r\n            data = util.extend({}, data, {type: type, target: this});\r\n\r\n            // make sure adding or removing listeners inside other listeners won't cause an infinite loop\r\n            const listeners = this._listeners && this._listeners[type] ? this._listeners[type].slice() : [];\r\n            for (const listener of listeners) {\r\n                listener.call(this, data);\r\n            }\r\n\r\n            const oneTimeListeners = this._oneTimeListeners && this._oneTimeListeners[type] ? this._oneTimeListeners[type].slice() : [];\r\n            for (const listener of oneTimeListeners) {\r\n                _removeEventListener(type, listener, this._oneTimeListeners);\r\n                listener.call(this, data);\r\n            }\r\n\r\n            if (this._eventedParent) {\r\n                this._eventedParent.fire(type, util.extend({}, data, typeof this._eventedParentData === 'function' ? this._eventedParentData() : this._eventedParentData));\r\n            }\r\n\r\n        // To ensure that no error events are dropped, print them to the\r\n        // console if they have no listeners.\r\n        } else if (util.endsWith(type, 'error')) {\r\n            console.error((data && data.error) || data || 'Empty error event');\r\n        }\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Returns a true if this instance of Evented or any forwardeed instances of Evented have a listener for the specified type.\r\n     *\r\n     * @param {string} type The event type\r\n     * @returns {boolean} `true` if there is at least one registered listener for specified event type, `false` otherwise\r\n     */\r\n    listens(type: string) {\r\n        return (\r\n            (this._listeners && this._listeners[type] && this._listeners[type].length > 0) ||\r\n            (this._oneTimeListeners && this._oneTimeListeners[type] && this._oneTimeListeners[type].length > 0) ||\r\n            (this._eventedParent && this._eventedParent.listens(type))\r\n        );\r\n    }\r\n\r\n    /**\r\n     * Bubble all events fired by this instance of Evented to this parent instance of Evented.\r\n     *\r\n     * @private\r\n     * @returns {Object} `this`\r\n     */\r\n    setEventedParent(parent: ?Evented, data?: Object | () => Object) {\r\n        this._eventedParent = parent;\r\n        this._eventedParentData = data;\r\n\r\n        return this;\r\n    }\r\n}\r\n\r\nmodule.exports = Evented;\r\n","// @flow\r\n\r\nconst {CircleLayoutArray} = require('../array_types');\r\nconst layoutAttributes = require('./circle_attributes').members;\r\nconst {SegmentVector} = require('../segment');\r\nconst {ProgramConfigurationSet} = require('../program_configuration');\r\nconst {TriangleIndexArray} = require('../index_array_type');\r\nconst loadGeometry = require('../load_geometry');\r\nconst EXTENT = require('../extent');\r\nconst {register} = require('../../util/web_worker_transfer');\r\n\r\nimport type {\r\n    Bucket,\r\n    BucketParameters,\r\n    IndexedFeature,\r\n    PopulateParameters\r\n} from '../bucket';\r\nimport type CircleStyleLayer from '../../style/style_layer/circle_style_layer';\r\nimport type HeatmapStyleLayer from '../../style/style_layer/heatmap_style_layer';\r\nimport type Context from '../../gl/context';\r\nimport type IndexBuffer from '../../gl/index_buffer';\r\nimport type VertexBuffer from '../../gl/vertex_buffer';\r\nimport type Point from '@mapbox/point-geometry';\r\n\r\nfunction addCircleVertex(layoutVertexArray, x, y, extrudeX, extrudeY) {\r\n    layoutVertexArray.emplaceBack(\r\n        (x * 2) + ((extrudeX + 1) / 2),\r\n        (y * 2) + ((extrudeY + 1) / 2));\r\n}\r\n\r\n\r\n/**\r\n * Circles are represented by two triangles.\r\n *\r\n * Each corner has a pos that is the center of the circle and an extrusion\r\n * vector that is where it points.\r\n * @private\r\n */\r\nclass CircleBucket<Layer: CircleStyleLayer | HeatmapStyleLayer> implements Bucket {\r\n    index: number;\r\n    zoom: number;\r\n    overscaling: number;\r\n    layerIds: Array<string>;\r\n    layers: Array<Layer>;\r\n\r\n    layoutVertexArray: CircleLayoutArray;\r\n    layoutVertexBuffer: VertexBuffer;\r\n\r\n    indexArray: TriangleIndexArray;\r\n    indexBuffer: IndexBuffer;\r\n\r\n    programConfigurations: ProgramConfigurationSet<Layer>;\r\n    segments: SegmentVector;\r\n    uploaded: boolean;\r\n\r\n    constructor(options: BucketParameters<Layer>) {\r\n        this.zoom = options.zoom;\r\n        this.overscaling = options.overscaling;\r\n        this.layers = options.layers;\r\n        this.layerIds = this.layers.map(layer => layer.id);\r\n        this.index = options.index;\r\n\r\n        this.layoutVertexArray = new CircleLayoutArray();\r\n        this.indexArray = new TriangleIndexArray();\r\n        this.segments = new SegmentVector();\r\n        this.programConfigurations = new ProgramConfigurationSet(layoutAttributes, options.layers, options.zoom);\r\n    }\r\n\r\n    populate(features: Array<IndexedFeature>, options: PopulateParameters) {\r\n        for (const {feature, index, sourceLayerIndex} of features) {\r\n            if (this.layers[0]._featureFilter({zoom: this.zoom}, feature)) {\r\n                const geometry = loadGeometry(feature);\r\n                this.addFeature(feature, geometry);\r\n                options.featureIndex.insert(feature, geometry, index, sourceLayerIndex, this.index);\r\n            }\r\n        }\r\n    }\r\n\r\n    isEmpty() {\r\n        return this.layoutVertexArray.length === 0;\r\n    }\r\n\r\n    upload(context: Context) {\r\n        this.layoutVertexBuffer = context.createVertexBuffer(this.layoutVertexArray, layoutAttributes);\r\n        this.indexBuffer = context.createIndexBuffer(this.indexArray);\r\n        this.programConfigurations.upload(context);\r\n    }\r\n\r\n    destroy() {\r\n        if (!this.layoutVertexBuffer) return;\r\n        this.layoutVertexBuffer.destroy();\r\n        this.indexBuffer.destroy();\r\n        this.programConfigurations.destroy();\r\n        this.segments.destroy();\r\n    }\r\n\r\n    addFeature(feature: VectorTileFeature, geometry: Array<Array<Point>>) {\r\n        for (const ring of geometry) {\r\n            for (const point of ring) {\r\n                const x = point.x;\r\n                const y = point.y;\r\n\r\n                // Do not include points that are outside the tile boundaries.\r\n                if (x < 0 || x >= EXTENT || y < 0 || y >= EXTENT) continue;\r\n\r\n                // this geometry will be of the Point type, and we'll derive\r\n                // two triangles from it.\r\n                //\r\n                // ┌─────────┐\r\n                // │ 3     2 │\r\n                // │         │\r\n                // │ 0     1 │\r\n                // └─────────┘\r\n\r\n                const segment = this.segments.prepareSegment(4, this.layoutVertexArray, this.indexArray);\r\n                const index = segment.vertexLength;\r\n\r\n                addCircleVertex(this.layoutVertexArray, x, y, -1, -1);\r\n                addCircleVertex(this.layoutVertexArray, x, y, 1, -1);\r\n                addCircleVertex(this.layoutVertexArray, x, y, 1, 1);\r\n                addCircleVertex(this.layoutVertexArray, x, y, -1, 1);\r\n\r\n                this.indexArray.emplaceBack(index, index + 1, index + 2);\r\n                this.indexArray.emplaceBack(index, index + 3, index + 2);\r\n\r\n                segment.vertexLength += 4;\r\n                segment.primitiveLength += 2;\r\n            }\r\n        }\r\n\r\n        this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length, feature);\r\n    }\r\n}\r\n\r\nregister('CircleBucket', CircleBucket, {omit: ['layers']});\r\n\r\nmodule.exports = CircleBucket;\r\n","'use strict';\n\nmodule.exports = earcut;\nmodule.exports.default = earcut;\n\nfunction earcut(data, holeIndices, dim) {\n\n    dim = dim || 2;\n\n    var hasHoles = holeIndices && holeIndices.length,\n        outerLen = hasHoles ? holeIndices[0] * dim : data.length,\n        outerNode = linkedList(data, 0, outerLen, dim, true),\n        triangles = [];\n\n    if (!outerNode) return triangles;\n\n    var minX, minY, maxX, maxY, x, y, invSize;\n\n    if (hasHoles) outerNode = eliminateHoles(data, holeIndices, outerNode, dim);\n\n    // if the shape is not too simple, we'll use z-order curve hash later; calculate polygon bbox\n    if (data.length > 80 * dim) {\n        minX = maxX = data[0];\n        minY = maxY = data[1];\n\n        for (var i = dim; i < outerLen; i += dim) {\n            x = data[i];\n            y = data[i + 1];\n            if (x < minX) minX = x;\n            if (y < minY) minY = y;\n            if (x > maxX) maxX = x;\n            if (y > maxY) maxY = y;\n        }\n\n        // minX, minY and invSize are later used to transform coords into integers for z-order calculation\n        invSize = Math.max(maxX - minX, maxY - minY);\n        invSize = invSize !== 0 ? 1 / invSize : 0;\n    }\n\n    earcutLinked(outerNode, triangles, dim, minX, minY, invSize);\n\n    return triangles;\n}\n\n// create a circular doubly linked list from polygon points in the specified winding order\nfunction linkedList(data, start, end, dim, clockwise) {\n    var i, last;\n\n    if (clockwise === (signedArea(data, start, end, dim) > 0)) {\n        for (i = start; i < end; i += dim) last = insertNode(i, data[i], data[i + 1], last);\n    } else {\n        for (i = end - dim; i >= start; i -= dim) last = insertNode(i, data[i], data[i + 1], last);\n    }\n\n    if (last && equals(last, last.next)) {\n        removeNode(last);\n        last = last.next;\n    }\n\n    return last;\n}\n\n// eliminate colinear or duplicate points\nfunction filterPoints(start, end) {\n    if (!start) return start;\n    if (!end) end = start;\n\n    var p = start,\n        again;\n    do {\n        again = false;\n\n        if (!p.steiner && (equals(p, p.next) || area(p.prev, p, p.next) === 0)) {\n            removeNode(p);\n            p = end = p.prev;\n            if (p === p.next) break;\n            again = true;\n\n        } else {\n            p = p.next;\n        }\n    } while (again || p !== end);\n\n    return end;\n}\n\n// main ear slicing loop which triangulates a polygon (given as a linked list)\nfunction earcutLinked(ear, triangles, dim, minX, minY, invSize, pass) {\n    if (!ear) return;\n\n    // interlink polygon nodes in z-order\n    if (!pass && invSize) indexCurve(ear, minX, minY, invSize);\n\n    var stop = ear,\n        prev, next;\n\n    // iterate through ears, slicing them one by one\n    while (ear.prev !== ear.next) {\n        prev = ear.prev;\n        next = ear.next;\n\n        if (invSize ? isEarHashed(ear, minX, minY, invSize) : isEar(ear)) {\n            // cut off the triangle\n            triangles.push(prev.i / dim);\n            triangles.push(ear.i / dim);\n            triangles.push(next.i / dim);\n\n            removeNode(ear);\n\n            // skipping the next vertice leads to less sliver triangles\n            ear = next.next;\n            stop = next.next;\n\n            continue;\n        }\n\n        ear = next;\n\n        // if we looped through the whole remaining polygon and can't find any more ears\n        if (ear === stop) {\n            // try filtering points and slicing again\n            if (!pass) {\n                earcutLinked(filterPoints(ear), triangles, dim, minX, minY, invSize, 1);\n\n            // if this didn't work, try curing all small self-intersections locally\n            } else if (pass === 1) {\n                ear = cureLocalIntersections(ear, triangles, dim);\n                earcutLinked(ear, triangles, dim, minX, minY, invSize, 2);\n\n            // as a last resort, try splitting the remaining polygon into two\n            } else if (pass === 2) {\n                splitEarcut(ear, triangles, dim, minX, minY, invSize);\n            }\n\n            break;\n        }\n    }\n}\n\n// check whether a polygon node forms a valid ear with adjacent nodes\nfunction isEar(ear) {\n    var a = ear.prev,\n        b = ear,\n        c = ear.next;\n\n    if (area(a, b, c) >= 0) return false; // reflex, can't be an ear\n\n    // now make sure we don't have other points inside the potential ear\n    var p = ear.next.next;\n\n    while (p !== ear.prev) {\n        if (pointInTriangle(a.x, a.y, b.x, b.y, c.x, c.y, p.x, p.y) &&\n            area(p.prev, p, p.next) >= 0) return false;\n        p = p.next;\n    }\n\n    return true;\n}\n\nfunction isEarHashed(ear, minX, minY, invSize) {\n    var a = ear.prev,\n        b = ear,\n        c = ear.next;\n\n    if (area(a, b, c) >= 0) return false; // reflex, can't be an ear\n\n    // triangle bbox; min & max are calculated like this for speed\n    var minTX = a.x < b.x ? (a.x < c.x ? a.x : c.x) : (b.x < c.x ? b.x : c.x),\n        minTY = a.y < b.y ? (a.y < c.y ? a.y : c.y) : (b.y < c.y ? b.y : c.y),\n        maxTX = a.x > b.x ? (a.x > c.x ? a.x : c.x) : (b.x > c.x ? b.x : c.x),\n        maxTY = a.y > b.y ? (a.y > c.y ? a.y : c.y) : (b.y > c.y ? b.y : c.y);\n\n    // z-order range for the current triangle bbox;\n    var minZ = zOrder(minTX, minTY, minX, minY, invSize),\n        maxZ = zOrder(maxTX, maxTY, minX, minY, invSize);\n\n    var p = ear.prevZ,\n        n = ear.nextZ;\n\n    // look for points inside the triangle in both directions\n    while (p && p.z >= minZ && n && n.z <= maxZ) {\n        if (p !== ear.prev && p !== ear.next &&\n            pointInTriangle(a.x, a.y, b.x, b.y, c.x, c.y, p.x, p.y) &&\n            area(p.prev, p, p.next) >= 0) return false;\n        p = p.prevZ;\n\n        if (n !== ear.prev && n !== ear.next &&\n            pointInTriangle(a.x, a.y, b.x, b.y, c.x, c.y, n.x, n.y) &&\n            area(n.prev, n, n.next) >= 0) return false;\n        n = n.nextZ;\n    }\n\n    // look for remaining points in decreasing z-order\n    while (p && p.z >= minZ) {\n        if (p !== ear.prev && p !== ear.next &&\n            pointInTriangle(a.x, a.y, b.x, b.y, c.x, c.y, p.x, p.y) &&\n            area(p.prev, p, p.next) >= 0) return false;\n        p = p.prevZ;\n    }\n\n    // look for remaining points in increasing z-order\n    while (n && n.z <= maxZ) {\n        if (n !== ear.prev && n !== ear.next &&\n            pointInTriangle(a.x, a.y, b.x, b.y, c.x, c.y, n.x, n.y) &&\n            area(n.prev, n, n.next) >= 0) return false;\n        n = n.nextZ;\n    }\n\n    return true;\n}\n\n// go through all polygon nodes and cure small local self-intersections\nfunction cureLocalIntersections(start, triangles, dim) {\n    var p = start;\n    do {\n        var a = p.prev,\n            b = p.next.next;\n\n        if (!equals(a, b) && intersects(a, p, p.next, b) && locallyInside(a, b) && locallyInside(b, a)) {\n\n            triangles.push(a.i / dim);\n            triangles.push(p.i / dim);\n            triangles.push(b.i / dim);\n\n            // remove two nodes involved\n            removeNode(p);\n            removeNode(p.next);\n\n            p = start = b;\n        }\n        p = p.next;\n    } while (p !== start);\n\n    return p;\n}\n\n// try splitting polygon into two and triangulate them independently\nfunction splitEarcut(start, triangles, dim, minX, minY, invSize) {\n    // look for a valid diagonal that divides the polygon into two\n    var a = start;\n    do {\n        var b = a.next.next;\n        while (b !== a.prev) {\n            if (a.i !== b.i && isValidDiagonal(a, b)) {\n                // split the polygon in two by the diagonal\n                var c = splitPolygon(a, b);\n\n                // filter colinear points around the cuts\n                a = filterPoints(a, a.next);\n                c = filterPoints(c, c.next);\n\n                // run earcut on each half\n                earcutLinked(a, triangles, dim, minX, minY, invSize);\n                earcutLinked(c, triangles, dim, minX, minY, invSize);\n                return;\n            }\n            b = b.next;\n        }\n        a = a.next;\n    } while (a !== start);\n}\n\n// link every hole into the outer loop, producing a single-ring polygon without holes\nfunction eliminateHoles(data, holeIndices, outerNode, dim) {\n    var queue = [],\n        i, len, start, end, list;\n\n    for (i = 0, len = holeIndices.length; i < len; i++) {\n        start = holeIndices[i] * dim;\n        end = i < len - 1 ? holeIndices[i + 1] * dim : data.length;\n        list = linkedList(data, start, end, dim, false);\n        if (list === list.next) list.steiner = true;\n        queue.push(getLeftmost(list));\n    }\n\n    queue.sort(compareX);\n\n    // process holes from left to right\n    for (i = 0; i < queue.length; i++) {\n        eliminateHole(queue[i], outerNode);\n        outerNode = filterPoints(outerNode, outerNode.next);\n    }\n\n    return outerNode;\n}\n\nfunction compareX(a, b) {\n    return a.x - b.x;\n}\n\n// find a bridge between vertices that connects hole with an outer ring and and link it\nfunction eliminateHole(hole, outerNode) {\n    outerNode = findHoleBridge(hole, outerNode);\n    if (outerNode) {\n        var b = splitPolygon(outerNode, hole);\n        filterPoints(b, b.next);\n    }\n}\n\n// David Eberly's algorithm for finding a bridge between hole and outer polygon\nfunction findHoleBridge(hole, outerNode) {\n    var p = outerNode,\n        hx = hole.x,\n        hy = hole.y,\n        qx = -Infinity,\n        m;\n\n    // find a segment intersected by a ray from the hole's leftmost point to the left;\n    // segment's endpoint with lesser x will be potential connection point\n    do {\n        if (hy <= p.y && hy >= p.next.y && p.next.y !== p.y) {\n            var x = p.x + (hy - p.y) * (p.next.x - p.x) / (p.next.y - p.y);\n            if (x <= hx && x > qx) {\n                qx = x;\n                if (x === hx) {\n                    if (hy === p.y) return p;\n                    if (hy === p.next.y) return p.next;\n                }\n                m = p.x < p.next.x ? p : p.next;\n            }\n        }\n        p = p.next;\n    } while (p !== outerNode);\n\n    if (!m) return null;\n\n    if (hx === qx) return m.prev; // hole touches outer segment; pick lower endpoint\n\n    // look for points inside the triangle of hole point, segment intersection and endpoint;\n    // if there are no points found, we have a valid connection;\n    // otherwise choose the point of the minimum angle with the ray as connection point\n\n    var stop = m,\n        mx = m.x,\n        my = m.y,\n        tanMin = Infinity,\n        tan;\n\n    p = m.next;\n\n    while (p !== stop) {\n        if (hx >= p.x && p.x >= mx && hx !== p.x &&\n                pointInTriangle(hy < my ? hx : qx, hy, mx, my, hy < my ? qx : hx, hy, p.x, p.y)) {\n\n            tan = Math.abs(hy - p.y) / (hx - p.x); // tangential\n\n            if ((tan < tanMin || (tan === tanMin && p.x > m.x)) && locallyInside(p, hole)) {\n                m = p;\n                tanMin = tan;\n            }\n        }\n\n        p = p.next;\n    }\n\n    return m;\n}\n\n// interlink polygon nodes in z-order\nfunction indexCurve(start, minX, minY, invSize) {\n    var p = start;\n    do {\n        if (p.z === null) p.z = zOrder(p.x, p.y, minX, minY, invSize);\n        p.prevZ = p.prev;\n        p.nextZ = p.next;\n        p = p.next;\n    } while (p !== start);\n\n    p.prevZ.nextZ = null;\n    p.prevZ = null;\n\n    sortLinked(p);\n}\n\n// Simon Tatham's linked list merge sort algorithm\n// http://www.chiark.greenend.org.uk/~sgtatham/algorithms/listsort.html\nfunction sortLinked(list) {\n    var i, p, q, e, tail, numMerges, pSize, qSize,\n        inSize = 1;\n\n    do {\n        p = list;\n        list = null;\n        tail = null;\n        numMerges = 0;\n\n        while (p) {\n            numMerges++;\n            q = p;\n            pSize = 0;\n            for (i = 0; i < inSize; i++) {\n                pSize++;\n                q = q.nextZ;\n                if (!q) break;\n            }\n            qSize = inSize;\n\n            while (pSize > 0 || (qSize > 0 && q)) {\n\n                if (pSize !== 0 && (qSize === 0 || !q || p.z <= q.z)) {\n                    e = p;\n                    p = p.nextZ;\n                    pSize--;\n                } else {\n                    e = q;\n                    q = q.nextZ;\n                    qSize--;\n                }\n\n                if (tail) tail.nextZ = e;\n                else list = e;\n\n                e.prevZ = tail;\n                tail = e;\n            }\n\n            p = q;\n        }\n\n        tail.nextZ = null;\n        inSize *= 2;\n\n    } while (numMerges > 1);\n\n    return list;\n}\n\n// z-order of a point given coords and inverse of the longer side of data bbox\nfunction zOrder(x, y, minX, minY, invSize) {\n    // coords are transformed into non-negative 15-bit integer range\n    x = 32767 * (x - minX) * invSize;\n    y = 32767 * (y - minY) * invSize;\n\n    x = (x | (x << 8)) & 0x00FF00FF;\n    x = (x | (x << 4)) & 0x0F0F0F0F;\n    x = (x | (x << 2)) & 0x33333333;\n    x = (x | (x << 1)) & 0x55555555;\n\n    y = (y | (y << 8)) & 0x00FF00FF;\n    y = (y | (y << 4)) & 0x0F0F0F0F;\n    y = (y | (y << 2)) & 0x33333333;\n    y = (y | (y << 1)) & 0x55555555;\n\n    return x | (y << 1);\n}\n\n// find the leftmost node of a polygon ring\nfunction getLeftmost(start) {\n    var p = start,\n        leftmost = start;\n    do {\n        if (p.x < leftmost.x) leftmost = p;\n        p = p.next;\n    } while (p !== start);\n\n    return leftmost;\n}\n\n// check if a point lies within a convex triangle\nfunction pointInTriangle(ax, ay, bx, by, cx, cy, px, py) {\n    return (cx - px) * (ay - py) - (ax - px) * (cy - py) >= 0 &&\n           (ax - px) * (by - py) - (bx - px) * (ay - py) >= 0 &&\n           (bx - px) * (cy - py) - (cx - px) * (by - py) >= 0;\n}\n\n// check if a diagonal between two polygon nodes is valid (lies in polygon interior)\nfunction isValidDiagonal(a, b) {\n    return a.next.i !== b.i && a.prev.i !== b.i && !intersectsPolygon(a, b) &&\n           locallyInside(a, b) && locallyInside(b, a) && middleInside(a, b);\n}\n\n// signed area of a triangle\nfunction area(p, q, r) {\n    return (q.y - p.y) * (r.x - q.x) - (q.x - p.x) * (r.y - q.y);\n}\n\n// check if two points are equal\nfunction equals(p1, p2) {\n    return p1.x === p2.x && p1.y === p2.y;\n}\n\n// check if two segments intersect\nfunction intersects(p1, q1, p2, q2) {\n    if ((equals(p1, q1) && equals(p2, q2)) ||\n        (equals(p1, q2) && equals(p2, q1))) return true;\n    return area(p1, q1, p2) > 0 !== area(p1, q1, q2) > 0 &&\n           area(p2, q2, p1) > 0 !== area(p2, q2, q1) > 0;\n}\n\n// check if a polygon diagonal intersects any polygon segments\nfunction intersectsPolygon(a, b) {\n    var p = a;\n    do {\n        if (p.i !== a.i && p.next.i !== a.i && p.i !== b.i && p.next.i !== b.i &&\n                intersects(p, p.next, a, b)) return true;\n        p = p.next;\n    } while (p !== a);\n\n    return false;\n}\n\n// check if a polygon diagonal is locally inside the polygon\nfunction locallyInside(a, b) {\n    return area(a.prev, a, a.next) < 0 ?\n        area(a, b, a.next) >= 0 && area(a, a.prev, b) >= 0 :\n        area(a, b, a.prev) < 0 || area(a, a.next, b) < 0;\n}\n\n// check if the middle point of a polygon diagonal is inside the polygon\nfunction middleInside(a, b) {\n    var p = a,\n        inside = false,\n        px = (a.x + b.x) / 2,\n        py = (a.y + b.y) / 2;\n    do {\n        if (((p.y > py) !== (p.next.y > py)) && p.next.y !== p.y &&\n                (px < (p.next.x - p.x) * (py - p.y) / (p.next.y - p.y) + p.x))\n            inside = !inside;\n        p = p.next;\n    } while (p !== a);\n\n    return inside;\n}\n\n// link two polygon vertices with a bridge; if the vertices belong to the same ring, it splits polygon into two;\n// if one belongs to the outer ring and another to a hole, it merges it into a single ring\nfunction splitPolygon(a, b) {\n    var a2 = new Node(a.i, a.x, a.y),\n        b2 = new Node(b.i, b.x, b.y),\n        an = a.next,\n        bp = b.prev;\n\n    a.next = b;\n    b.prev = a;\n\n    a2.next = an;\n    an.prev = a2;\n\n    b2.next = a2;\n    a2.prev = b2;\n\n    bp.next = b2;\n    b2.prev = bp;\n\n    return b2;\n}\n\n// create a node and optionally link it with previous one (in a circular doubly linked list)\nfunction insertNode(i, x, y, last) {\n    var p = new Node(i, x, y);\n\n    if (!last) {\n        p.prev = p;\n        p.next = p;\n\n    } else {\n        p.next = last.next;\n        p.prev = last;\n        last.next.prev = p;\n        last.next = p;\n    }\n    return p;\n}\n\nfunction removeNode(p) {\n    p.next.prev = p.prev;\n    p.prev.next = p.next;\n\n    if (p.prevZ) p.prevZ.nextZ = p.nextZ;\n    if (p.nextZ) p.nextZ.prevZ = p.prevZ;\n}\n\nfunction Node(i, x, y) {\n    // vertice index in coordinates array\n    this.i = i;\n\n    // vertex coordinates\n    this.x = x;\n    this.y = y;\n\n    // previous and next vertice nodes in a polygon ring\n    this.prev = null;\n    this.next = null;\n\n    // z-order curve value\n    this.z = null;\n\n    // previous and next nodes in z-order\n    this.prevZ = null;\n    this.nextZ = null;\n\n    // indicates whether this is a steiner point\n    this.steiner = false;\n}\n\n// return a percentage difference between the polygon area and its triangulation area;\n// used to verify correctness of triangulation\nearcut.deviation = function (data, holeIndices, dim, triangles) {\n    var hasHoles = holeIndices && holeIndices.length;\n    var outerLen = hasHoles ? holeIndices[0] * dim : data.length;\n\n    var polygonArea = Math.abs(signedArea(data, 0, outerLen, dim));\n    if (hasHoles) {\n        for (var i = 0, len = holeIndices.length; i < len; i++) {\n            var start = holeIndices[i] * dim;\n            var end = i < len - 1 ? holeIndices[i + 1] * dim : data.length;\n            polygonArea -= Math.abs(signedArea(data, start, end, dim));\n        }\n    }\n\n    var trianglesArea = 0;\n    for (i = 0; i < triangles.length; i += 3) {\n        var a = triangles[i] * dim;\n        var b = triangles[i + 1] * dim;\n        var c = triangles[i + 2] * dim;\n        trianglesArea += Math.abs(\n            (data[a] - data[c]) * (data[b + 1] - data[a + 1]) -\n            (data[a] - data[b]) * (data[c + 1] - data[a + 1]));\n    }\n\n    return polygonArea === 0 && trianglesArea === 0 ? 0 :\n        Math.abs((trianglesArea - polygonArea) / polygonArea);\n};\n\nfunction signedArea(data, start, end, dim) {\n    var sum = 0;\n    for (var i = start, j = end - dim; i < end; i += dim) {\n        sum += (data[j] - data[i]) * (data[i + 1] + data[j + 1]);\n        j = i;\n    }\n    return sum;\n}\n\n// turn a polygon in a multi-dimensional array form (e.g. as in GeoJSON) into a form Earcut accepts\nearcut.flatten = function (data) {\n    var dim = data[0][0].length,\n        result = {vertices: [], holes: [], dimensions: dim},\n        holeIndex = 0;\n\n    for (var i = 0; i < data.length; i++) {\n        for (var j = 0; j < data[i].length; j++) {\n            for (var d = 0; d < dim; d++) result.vertices.push(data[i][j][d]);\n        }\n        if (i > 0) {\n            holeIndex += data[i - 1].length;\n            result.holes.push(holeIndex);\n        }\n    }\n    return result;\n};\n","'use strict';\n\nvar VectorTileFeature = require('./vectortilefeature.js');\n\nmodule.exports = VectorTileLayer;\n\nfunction VectorTileLayer(pbf, end) {\n    // Public\n    this.version = 1;\n    this.name = null;\n    this.extent = 4096;\n    this.length = 0;\n\n    // Private\n    this._pbf = pbf;\n    this._keys = [];\n    this._values = [];\n    this._features = [];\n\n    pbf.readFields(readLayer, this, end);\n\n    this.length = this._features.length;\n}\n\nfunction readLayer(tag, layer, pbf) {\n    if (tag === 15) layer.version = pbf.readVarint();\n    else if (tag === 1) layer.name = pbf.readString();\n    else if (tag === 5) layer.extent = pbf.readVarint();\n    else if (tag === 2) layer._features.push(pbf.pos);\n    else if (tag === 3) layer._keys.push(pbf.readString());\n    else if (tag === 4) layer._values.push(readValueMessage(pbf));\n}\n\nfunction readValueMessage(pbf) {\n    var value = null,\n        end = pbf.readVarint() + pbf.pos;\n\n    while (pbf.pos < end) {\n        var tag = pbf.readVarint() >> 3;\n\n        value = tag === 1 ? pbf.readString() :\n            tag === 2 ? pbf.readFloat() :\n            tag === 3 ? pbf.readDouble() :\n            tag === 4 ? pbf.readVarint64() :\n            tag === 5 ? pbf.readVarint() :\n            tag === 6 ? pbf.readSVarint() :\n            tag === 7 ? pbf.readBoolean() : null;\n    }\n\n    return value;\n}\n\n// return feature `i` from this layer as a `VectorTileFeature`\nVectorTileLayer.prototype.feature = function(i) {\n    if (i < 0 || i >= this._features.length) throw new Error('feature index out of bounds');\n\n    this._pbf.pos = this._features[i];\n\n    var end = this._pbf.readVarint() + this._pbf.pos;\n    return new VectorTileFeature(this._pbf, end, this.extent, this._keys, this._values);\n};\n","'use strict';\n\nvar Point = require('@mapbox/point-geometry');\n\nmodule.exports = VectorTileFeature;\n\nfunction VectorTileFeature(pbf, end, extent, keys, values) {\n    // Public\n    this.properties = {};\n    this.extent = extent;\n    this.type = 0;\n\n    // Private\n    this._pbf = pbf;\n    this._geometry = -1;\n    this._keys = keys;\n    this._values = values;\n\n    pbf.readFields(readFeature, this, end);\n}\n\nfunction readFeature(tag, feature, pbf) {\n    if (tag == 1) feature.id = pbf.readVarint();\n    else if (tag == 2) readTag(pbf, feature);\n    else if (tag == 3) feature.type = pbf.readVarint();\n    else if (tag == 4) feature._geometry = pbf.pos;\n}\n\nfunction readTag(pbf, feature) {\n    var end = pbf.readVarint() + pbf.pos;\n\n    while (pbf.pos < end) {\n        var key = feature._keys[pbf.readVarint()],\n            value = feature._values[pbf.readVarint()];\n        feature.properties[key] = value;\n    }\n}\n\nVectorTileFeature.types = ['Unknown', 'Point', 'LineString', 'Polygon'];\n\nVectorTileFeature.prototype.loadGeometry = function() {\n    var pbf = this._pbf;\n    pbf.pos = this._geometry;\n\n    var end = pbf.readVarint() + pbf.pos,\n        cmd = 1,\n        length = 0,\n        x = 0,\n        y = 0,\n        lines = [],\n        line;\n\n    while (pbf.pos < end) {\n        if (!length) {\n            var cmdLen = pbf.readVarint();\n            cmd = cmdLen & 0x7;\n            length = cmdLen >> 3;\n        }\n\n        length--;\n\n        if (cmd === 1 || cmd === 2) {\n            x += pbf.readSVarint();\n            y += pbf.readSVarint();\n\n            if (cmd === 1) { // moveTo\n                if (line) lines.push(line);\n                line = [];\n            }\n\n            line.push(new Point(x, y));\n\n        } else if (cmd === 7) {\n\n            // Workaround for https://github.com/mapbox/mapnik-vector-tile/issues/90\n            if (line) {\n                line.push(line[0].clone()); // closePolygon\n            }\n\n        } else {\n            throw new Error('unknown command ' + cmd);\n        }\n    }\n\n    if (line) lines.push(line);\n\n    return lines;\n};\n\nVectorTileFeature.prototype.bbox = function() {\n    var pbf = this._pbf;\n    pbf.pos = this._geometry;\n\n    var end = pbf.readVarint() + pbf.pos,\n        cmd = 1,\n        length = 0,\n        x = 0,\n        y = 0,\n        x1 = Infinity,\n        x2 = -Infinity,\n        y1 = Infinity,\n        y2 = -Infinity;\n\n    while (pbf.pos < end) {\n        if (!length) {\n            var cmdLen = pbf.readVarint();\n            cmd = cmdLen & 0x7;\n            length = cmdLen >> 3;\n        }\n\n        length--;\n\n        if (cmd === 1 || cmd === 2) {\n            x += pbf.readSVarint();\n            y += pbf.readSVarint();\n            if (x < x1) x1 = x;\n            if (x > x2) x2 = x;\n            if (y < y1) y1 = y;\n            if (y > y2) y2 = y;\n\n        } else if (cmd !== 7) {\n            throw new Error('unknown command ' + cmd);\n        }\n    }\n\n    return [x1, y1, x2, y2];\n};\n\nVectorTileFeature.prototype.toGeoJSON = function(x, y, z) {\n    var size = this.extent * Math.pow(2, z),\n        x0 = this.extent * x,\n        y0 = this.extent * y,\n        coords = this.loadGeometry(),\n        type = VectorTileFeature.types[this.type],\n        i, j;\n\n    function project(line) {\n        for (var j = 0; j < line.length; j++) {\n            var p = line[j], y2 = 180 - (p.y + y0) * 360 / size;\n            line[j] = [\n                (p.x + x0) * 360 / size - 180,\n                360 / Math.PI * Math.atan(Math.exp(y2 * Math.PI / 180)) - 90\n            ];\n        }\n    }\n\n    switch (this.type) {\n    case 1:\n        var points = [];\n        for (i = 0; i < coords.length; i++) {\n            points[i] = coords[i][0];\n        }\n        coords = points;\n        project(coords);\n        break;\n\n    case 2:\n        for (i = 0; i < coords.length; i++) {\n            project(coords[i]);\n        }\n        break;\n\n    case 3:\n        coords = classifyRings(coords);\n        for (i = 0; i < coords.length; i++) {\n            for (j = 0; j < coords[i].length; j++) {\n                project(coords[i][j]);\n            }\n        }\n        break;\n    }\n\n    if (coords.length === 1) {\n        coords = coords[0];\n    } else {\n        type = 'Multi' + type;\n    }\n\n    var result = {\n        type: \"Feature\",\n        geometry: {\n            type: type,\n            coordinates: coords\n        },\n        properties: this.properties\n    };\n\n    if ('id' in this) {\n        result.id = this.id;\n    }\n\n    return result;\n};\n\n// classifies an array of rings into polygons with outer rings and holes\n\nfunction classifyRings(rings) {\n    var len = rings.length;\n\n    if (len <= 1) return [rings];\n\n    var polygons = [],\n        polygon,\n        ccw;\n\n    for (var i = 0; i < len; i++) {\n        var area = signedArea(rings[i]);\n        if (area === 0) continue;\n\n        if (ccw === undefined) ccw = area < 0;\n\n        if (ccw === area < 0) {\n            if (polygon) polygons.push(polygon);\n            polygon = [rings[i]];\n\n        } else {\n            polygon.push(rings[i]);\n        }\n    }\n    if (polygon) polygons.push(polygon);\n\n    return polygons;\n}\n\nfunction signedArea(ring) {\n    var sum = 0;\n    for (var i = 0, len = ring.length, j = len - 1, p1, p2; i < len; j = i++) {\n        p1 = ring[i];\n        p2 = ring[j];\n        sum += (p2.x - p1.x) * (p1.y + p2.y);\n    }\n    return sum;\n}\n","// @flow\r\n\r\nconst scriptDetection = require('./script_detection');\r\n\r\nmodule.exports = function verticalizePunctuation(input: string) {\r\n    let output = '';\r\n\r\n    for (let i = 0; i < input.length; i++) {\r\n        const nextCharCode = input.charCodeAt(i + 1) || null;\r\n        const prevCharCode = input.charCodeAt(i - 1) || null;\r\n\r\n        const canReplacePunctuation = (\r\n            (!nextCharCode || !scriptDetection.charHasRotatedVerticalOrientation(nextCharCode) || module.exports.lookup[input[i + 1]]) &&\r\n            (!prevCharCode || !scriptDetection.charHasRotatedVerticalOrientation(prevCharCode) || module.exports.lookup[input[i - 1]])\r\n        );\r\n\r\n        if (canReplacePunctuation && module.exports.lookup[input[i]]) {\r\n            output += module.exports.lookup[input[i]];\r\n        } else {\r\n            output += input[i];\r\n        }\r\n    }\r\n\r\n    return output;\r\n};\r\n\r\nmodule.exports.lookup = {\r\n    '!': '︕',\r\n    '#': '＃',\r\n    '$': '＄',\r\n    '%': '％',\r\n    '&': '＆',\r\n    '(': '︵',\r\n    ')': '︶',\r\n    '*': '＊',\r\n    '+': '＋',\r\n    ',': '︐',\r\n    '-': '︲',\r\n    '.': '・',\r\n    '/': '／',\r\n    ':': '︓',\r\n    ';': '︔',\r\n    '<': '︿',\r\n    '=': '＝',\r\n    '>': '﹀',\r\n    '?': '︖',\r\n    '@': '＠',\r\n    '[': '﹇',\r\n    '\\\\': '＼',\r\n    ']': '﹈',\r\n    '^': '＾',\r\n    '_': '︳',\r\n    '`': '｀',\r\n    '{': '︷',\r\n    '|': '―',\r\n    '}': '︸',\r\n    '~': '～',\r\n    '¢': '￠',\r\n    '£': '￡',\r\n    '¥': '￥',\r\n    '¦': '￤',\r\n    '¬': '￢',\r\n    '¯': '￣',\r\n    '–': '︲',\r\n    '—': '︱',\r\n    '‘': '﹃',\r\n    '’': '﹄',\r\n    '“': '﹁',\r\n    '”': '﹂',\r\n    '…': '︙',\r\n    '‧': '・',\r\n    '₩': '￦',\r\n    '、': '︑',\r\n    '。': '︒',\r\n    '〈': '︿',\r\n    '〉': '﹀',\r\n    '《': '︽',\r\n    '》': '︾',\r\n    '「': '﹁',\r\n    '」': '﹂',\r\n    '『': '﹃',\r\n    '』': '﹄',\r\n    '【': '︻',\r\n    '】': '︼',\r\n    '〔': '︹',\r\n    '〕': '︺',\r\n    '〖': '︗',\r\n    '〗': '︘',\r\n    '！': '︕',\r\n    '（': '︵',\r\n    '）': '︶',\r\n    '，': '︐',\r\n    '－': '︲',\r\n    '．': '・',\r\n    '：': '︓',\r\n    '；': '︔',\r\n    '＜': '︿',\r\n    '＞': '﹀',\r\n    '？': '︖',\r\n    '［': '﹇',\r\n    '］': '﹈',\r\n    '＿': '︳',\r\n    '｛': '︷',\r\n    '｜': '―',\r\n    '｝': '︸',\r\n    '｟': '︵',\r\n    '｠': '︶',\r\n    '｡': '︒',\r\n    '｢': '﹁',\r\n    '｣': '﹂'\r\n};\r\n","// @flow\r\n\r\nconst ajax = require('../util/ajax');\r\nconst vt = require('@mapbox/vector-tile');\r\nconst Protobuf = require('pbf');\r\nconst WorkerTile = require('./worker_tile');\r\nconst util = require('../util/util');\r\n\r\nimport type {\r\n    WorkerSource,\r\n    WorkerTileParameters,\r\n    WorkerTileCallback,\r\n    TileParameters\r\n} from '../source/worker_source';\r\n\r\nimport type Actor from '../util/actor';\r\nimport type StyleLayerIndex from '../style/style_layer_index';\r\nimport type {Callback} from '../types/callback';\r\n\r\nexport type LoadVectorTileResult = {\r\n    vectorTile: VectorTile;\r\n    rawData: ArrayBuffer;\r\n    expires?: any;\r\n    cacheControl?: any;\r\n};\r\n\r\n/**\r\n * @callback LoadVectorDataCallback\r\n * @param error\r\n * @param vectorTile\r\n * @private\r\n */\r\nexport type LoadVectorDataCallback = Callback<?LoadVectorTileResult>;\r\n\r\nexport type AbortVectorData = () => void;\r\nexport type LoadVectorData = (params: WorkerTileParameters, callback: LoadVectorDataCallback) => ?AbortVectorData;\r\n\r\n/**\r\n * @private\r\n */\r\nfunction loadVectorTile(params: WorkerTileParameters, callback: LoadVectorDataCallback) {\r\n    console.log(\"loadVectorTile\");\r\n\r\n    const xhr = ajax.getArrayBuffer(params.request, (err, response) => {\r\n        if (err) {\r\n            callback(err);\r\n            console.log(\"qq error in receiving raw data\", err);\r\n        } else if (response) {\r\n            console.log(\"received raw data\");\r\n            callback(null, {\r\n                \r\n                vectorTile: new vt.VectorTile(new Protobuf(response.data)),\r\n                rawData: response.data,\r\n                cacheControl: response.cacheControl,\r\n                expires: response.expires\r\n            });\r\n        }\r\n    });\r\n    return () => {\r\n        xhr.abort();\r\n        callback();\r\n    };\r\n}\r\n\r\n/**\r\n * The {@link WorkerSource} implementation that supports {@link VectorTileSource}.\r\n * This class is designed to be easily reused to support custom source types\r\n * for data formats that can be parsed/converted into an in-memory VectorTile\r\n * representation.  To do so, create it with\r\n * `new VectorTileWorkerSource(actor, styleLayers, customLoadVectorDataFunction)`.\r\n *\r\n * @private\r\n */\r\nclass VectorTileWorkerSource implements WorkerSource {\r\n    actor: Actor;\r\n    layerIndex: StyleLayerIndex;\r\n    loadVectorData: LoadVectorData;\r\n    loading: { [string]: { [string]: WorkerTile } };\r\n    loaded: { [string]: { [string]: WorkerTile } };\r\n\r\n    /**\r\n     * @param [loadVectorData] Optional method for custom loading of a VectorTile\r\n     * object based on parameters passed from the main-thread Source. See\r\n     * {@link VectorTileWorkerSource#loadTile}. The default implementation simply\r\n     * loads the pbf at `params.url`.\r\n     */\r\n    constructor(actor: Actor, layerIndex: StyleLayerIndex, loadVectorData: ?LoadVectorData) {\r\n        this.actor = actor;\r\n        this.layerIndex = layerIndex;\r\n        this.loadVectorData = loadVectorData || loadVectorTile;\r\n        this.loading = {};\r\n        this.loaded = {};\r\n    }\r\n\r\n    /**\r\n     * Implements {@link WorkerSource#loadTile}. Delegates to\r\n     * {@link VectorTileWorkerSource#loadVectorData} (which by default expects\r\n     * a `params.url` property) for fetching and producing a VectorTile object.\r\n     */\r\n    loadTile(params: WorkerTileParameters, callback: WorkerTileCallback) {\r\n        const source = params.source,\r\n            uid = params.uid;\r\n\r\n        if (!this.loading[source])\r\n            this.loading[source] = {};\r\n\r\n        const workerTile = this.loading[source][uid] = new WorkerTile(params);\r\n        workerTile.abort = this.loadVectorData(params, (err, response) => {\r\n            delete this.loading[source][uid];\r\n\r\n            if (err || !response) {\r\n                return callback(err);\r\n            }\r\n\r\n            const rawTileData = response.rawData;\r\n            const cacheControl = {};\r\n            if (response.expires) cacheControl.expires = response.expires;\r\n            if (response.cacheControl) cacheControl.cacheControl = response.cacheControl;\r\n\r\n            workerTile.vectorTile = response.vectorTile;\r\n            workerTile.parse(response.vectorTile, this.layerIndex, this.actor, (err, result) => {\r\n                if (err || !result) return callback(err);\r\n\r\n                // Transferring a copy of rawTileData because the worker needs to retain its copy.\r\n                callback(null, util.extend({rawTileData: rawTileData.slice(0)}, result, cacheControl));\r\n            });\r\n\r\n            this.loaded[source] = this.loaded[source] || {};\r\n            this.loaded[source][uid] = workerTile;\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Implements {@link WorkerSource#reloadTile}.\r\n     */\r\n    reloadTile(params: WorkerTileParameters, callback: WorkerTileCallback) {\r\n        const loaded = this.loaded[params.source],\r\n            uid = params.uid,\r\n            vtSource = this;\r\n        if (loaded && loaded[uid]) {\r\n            const workerTile = loaded[uid];\r\n            workerTile.showCollisionBoxes = params.showCollisionBoxes;\r\n\r\n            if (workerTile.status === 'parsing') {\r\n                workerTile.reloadCallback = done.bind(workerTile);\r\n            } else if (workerTile.status === 'done') {\r\n                workerTile.parse(workerTile.vectorTile, this.layerIndex, this.actor, done.bind(workerTile));\r\n            }\r\n\r\n        }\r\n\r\n        function done(err, data) {\r\n            if (this.reloadCallback) {\r\n                const reloadCallback = this.reloadCallback;\r\n                delete this.reloadCallback;\r\n                this.parse(this.vectorTile, vtSource.layerIndex, vtSource.actor, reloadCallback);\r\n            }\r\n\r\n            callback(err, data);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Implements {@link WorkerSource#abortTile}.\r\n     *\r\n     * @param params\r\n     * @param params.source The id of the source for which we're loading this tile.\r\n     * @param params.uid The UID for this tile.\r\n     */\r\n    abortTile(params: TileParameters, callback: WorkerTileCallback) {\r\n        const loading = this.loading[params.source],\r\n            uid = params.uid;\r\n        if (loading && loading[uid] && loading[uid].abort) {\r\n            loading[uid].abort();\r\n            delete loading[uid];\r\n        }\r\n        callback();\r\n    }\r\n\r\n    /**\r\n     * Implements {@link WorkerSource#removeTile}.\r\n     *\r\n     * @param params\r\n     * @param params.source The id of the source for which we're loading this tile.\r\n     * @param params.uid The UID for this tile.\r\n     */\r\n    removeTile(params: TileParameters, callback: WorkerTileCallback) {\r\n        const loaded = this.loaded[params.source],\r\n            uid = params.uid;\r\n        if (loaded && loaded[uid]) {\r\n            delete loaded[uid];\r\n        }\r\n        callback();\r\n    }\r\n}\r\n\r\nmodule.exports = VectorTileWorkerSource;\r\n","// @flow\r\n\r\nconst assert = require('assert');\r\n\r\nclass DictionaryCoder {\r\n    _stringToNumber: { [string]: number };\r\n    _numberToString: Array<string>;\r\n\r\n    constructor(strings: Array<string>) {\r\n        this._stringToNumber = {};\r\n        this._numberToString = [];\r\n        for (let i = 0; i < strings.length; i++) {\r\n            const string = strings[i];\r\n            this._stringToNumber[string] = i;\r\n            this._numberToString[i] = string;\r\n        }\r\n    }\r\n\r\n    encode(string: string) {\r\n        assert(string in this._stringToNumber);\r\n        return this._stringToNumber[string];\r\n    }\r\n\r\n    decode(n: number) {\r\n        assert(n < this._numberToString.length);\r\n        return this._numberToString[n];\r\n    }\r\n}\r\n\r\nmodule.exports = DictionaryCoder;\r\n","// @flow\r\n\r\nconst WhooTS = require('@mapbox/whoots-js');\r\nconst assert = require('assert');\r\nconst {register} = require('../util/web_worker_transfer');\r\nconst Coordinate = require('../geo/coordinate');\r\n\r\nclass CanonicalTileID {\r\n    z: number;\r\n    x: number;\r\n    y: number;\r\n    key: number;\r\n\r\n    constructor(z: number, x: number, y: number) {\r\n        assert(z >= 0 && z <= 25);\r\n        assert(x >= 0 && x < Math.pow(2, z));\r\n        assert(y >= 0 && y < Math.pow(2, z));\r\n        this.z = z;\r\n        this.x = x;\r\n        this.y = y;\r\n        this.key = calculateKey(0, z, x, y);\r\n    }\r\n\r\n    equals(id: CanonicalTileID) {\r\n        return this.z === id.z && this.x === id.x && this.y === id.y;\r\n    }\r\n\r\n    // given a list of urls, choose a url template and return a tile URL\r\n    url(urls: Array<string>, scheme: ?string) {\r\n        const bbox = WhooTS.getTileBBox(this.x, this.y, this.z);\r\n        const quadkey = getQuadkey(this.z, this.x, this.y);\r\n\r\n        return urls[(this.x + this.y) % urls.length]\r\n            .replace('{prefix}', (this.x % 16).toString(16) + (this.y % 16).toString(16))\r\n            .replace('{z}', String(this.z))\r\n            .replace('{x}', String(this.x))\r\n            .replace('{y}', String(scheme === 'tms' ? (Math.pow(2, this.z) - this.y - 1) : this.y))\r\n            .replace('{quadkey}', quadkey)\r\n            .replace('{bbox-epsg-3857}', bbox);\r\n    }\r\n}\r\n\r\nclass UnwrappedTileID {\r\n    wrap: number;\r\n    canonical: CanonicalTileID;\r\n    key: number;\r\n\r\n    constructor(wrap: number, canonical: CanonicalTileID, posMatrix) {\r\n        this.wrap = wrap;\r\n        this.canonical = canonical;\r\n        this.key = calculateKey(wrap, canonical.z, canonical.x, canonical.y);\r\n        this.posMatrix = posMatrix\r\n    }\r\n}\r\n\r\nclass OverscaledTileID {\r\n    overscaledZ: number;\r\n    wrap: number;\r\n    canonical: CanonicalTileID;\r\n    key: number;\r\n    posMatrix: Float32Array;\r\n\r\n    constructor(overscaledZ: number, wrap: number, z: number, x: number, y: number) {\r\n        assert(overscaledZ >= z);\r\n        this.overscaledZ = overscaledZ;\r\n        this.wrap = wrap;\r\n        this.canonical = new CanonicalTileID(z, +x, +y);\r\n        this.key = calculateKey(wrap, overscaledZ, x, y);\r\n    }\r\n\r\n    scaledTo(targetZ: number) {\r\n        assert(targetZ <= this.overscaledZ);\r\n        const zDifference = this.canonical.z - targetZ;\r\n        if (targetZ > this.canonical.z) {\r\n            return new OverscaledTileID(targetZ, this.wrap, this.canonical.z, this.canonical.x, this.canonical.y);\r\n        } else {\r\n            return new OverscaledTileID(targetZ, this.wrap, targetZ, this.canonical.x >> zDifference, this.canonical.y >> zDifference);\r\n        }\r\n    }\r\n\r\n    isChildOf(parent: OverscaledTileID) {\r\n        const zDifference = this.canonical.z - parent.canonical.z;\r\n        // We're first testing for z == 0, to avoid a 32 bit shift, which is undefined.\r\n        return parent.overscaledZ === 0 || (\r\n            parent.overscaledZ < this.overscaledZ &&\r\n                parent.canonical.x === (this.canonical.x >> zDifference) &&\r\n                parent.canonical.y === (this.canonical.y >> zDifference));\r\n    }\r\n\r\n    children(sourceMaxZoom: number) {\r\n        if (this.overscaledZ >= sourceMaxZoom) {\r\n            // return a single tile coord representing a an overscaled tile\r\n            return [new OverscaledTileID(this.overscaledZ + 1, this.wrap, this.canonical.z, this.canonical.x, this.canonical.y)];\r\n        }\r\n\r\n        const z = this.canonical.z + 1;\r\n        const x = this.canonical.x * 2;\r\n        const y = this.canonical.y * 2;\r\n        return [\r\n            new OverscaledTileID(z, this.wrap, z, x, y),\r\n            new OverscaledTileID(z, this.wrap, z, x + 1, y),\r\n            new OverscaledTileID(z, this.wrap, z, x, y + 1),\r\n            new OverscaledTileID(z, this.wrap, z, x + 1, y + 1)\r\n        ];\r\n    }\r\n\r\n    isLessThan(rhs: OverscaledTileID) {\r\n        if (this.wrap < rhs.wrap) return true;\r\n        if (this.wrap > rhs.wrap) return false;\r\n\r\n        if (this.overscaledZ < rhs.overscaledZ) return true;\r\n        if (this.overscaledZ > rhs.overscaledZ) return false;\r\n\r\n        if (this.canonical.x < rhs.canonical.x) return true;\r\n        if (this.canonical.x > rhs.canonical.x) return false;\r\n\r\n        if (this.canonical.y < rhs.canonical.y) return true;\r\n        return false;\r\n    }\r\n\r\n    wrapped() {\r\n        return new OverscaledTileID(this.overscaledZ, 0, this.canonical.z, this.canonical.x, this.canonical.y);\r\n    }\r\n\r\n    overscaleFactor() {\r\n        return Math.pow(2, this.overscaledZ - this.canonical.z);\r\n    }\r\n\r\n    toUnwrapped() {\r\n        return new UnwrappedTileID(this.wrap, this.canonical, this.posMatrix);\r\n    }\r\n\r\n    toString() {\r\n        return `${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`;\r\n    }\r\n\r\n    toCoordinate() {\r\n        return new Coordinate(this.canonical.x + Math.pow(2, this.wrap), this.canonical.y, this.canonical.z);\r\n    }\r\n}\r\n\r\nfunction calculateKey(wrap: number, z: number, x: number, y: number) {\r\n    wrap *= 2;\r\n    if (wrap < 0) wrap = wrap * -1 - 1;\r\n    const dim = 1 << z;\r\n    return ((dim * dim * wrap + dim * y + x) * 32) + z;\r\n}\r\n\r\n\r\nfunction getQuadkey(z, x, y) {\r\n    let quadkey = '', mask;\r\n    for (let i = z; i > 0; i--) {\r\n        mask = 1 << (i - 1);\r\n        quadkey += ((x & mask ? 1 : 0) + (y & mask ? 2 : 0));\r\n    }\r\n    return quadkey;\r\n}\r\n\r\nregister('CanonicalTileID', CanonicalTileID);\r\nregister('OverscaledTileID', OverscaledTileID, {omit: ['posMatrix']});\r\n\r\nmodule.exports = {\r\n    CanonicalTileID: CanonicalTileID,\r\n    OverscaledTileID: OverscaledTileID,\r\n    UnwrappedTileID: UnwrappedTileID\r\n};\r\n","(function (global, factory) {\n\ttypeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory() :\n\ttypeof define === 'function' && define.amd ? define(factory) :\n\t(global.ShelfPack = factory());\n}(this, (function () {\n\n/**\n * Create a new ShelfPack bin allocator.\n *\n * Uses the Shelf Best Height Fit algorithm from\n * http://clb.demon.fi/files/RectangleBinPack.pdf\n *\n * @class  ShelfPack\n * @param  {number}  [w=64]  Initial width of the sprite\n * @param  {number}  [h=64]  Initial width of the sprite\n * @param  {Object}  [options]\n * @param  {boolean} [options.autoResize=false]  If `true`, the sprite will automatically grow\n * @example\n * var sprite = new ShelfPack(64, 64, { autoResize: false });\n */\nfunction ShelfPack$1(w, h, options) {\n    options = options || {};\n    this.w = w || 64;\n    this.h = h || 64;\n    this.autoResize = !!options.autoResize;\n    this.shelves = [];\n    this.freebins = [];\n    this.stats = {};\n    this.bins = {};\n    this.maxId = 0;\n}\n\n\n/**\n * Batch pack multiple bins into the sprite.\n *\n * @param   {Object[]} bins       Array of requested bins - each object should have `width`, `height` (or `w`, `h`) properties\n * @param   {number}   bins[].w   Requested bin width\n * @param   {number}   bins[].h   Requested bin height\n * @param   {Object}   [options]\n * @param   {boolean}  [options.inPlace=false] If `true`, the supplied bin objects will be updated inplace with `x` and `y` properties\n * @returns {Bin[]}    Array of allocated Bins - each Bin is an object with `id`, `x`, `y`, `w`, `h` properties\n * @example\n * var bins = [\n *     { id: 1, w: 12, h: 12 },\n *     { id: 2, w: 12, h: 16 },\n *     { id: 3, w: 12, h: 24 }\n * ];\n * var results = sprite.pack(bins, { inPlace: false });\n */\nShelfPack$1.prototype.pack = function(bins, options) {\n    bins = [].concat(bins);\n    options = options || {};\n\n    var results = [],\n        w, h, id, allocation;\n\n    for (var i = 0; i < bins.length; i++) {\n        w  = bins[i].w || bins[i].width;\n        h  = bins[i].h || bins[i].height;\n        id = bins[i].id;\n\n        if (w && h) {\n            allocation = this.packOne(w, h, id);\n            if (!allocation) {\n                continue;\n            }\n            if (options.inPlace) {\n                bins[i].x  = allocation.x;\n                bins[i].y  = allocation.y;\n                bins[i].id = allocation.id;\n            }\n            results.push(allocation);\n        }\n    }\n\n    this.shrink();\n\n    return results;\n};\n\n\n/**\n * Pack a single bin into the sprite.\n *\n * Each bin will have a unique identitifer.\n * If no identifier is supplied in the `id` parameter, one will be created.\n * Note: The supplied `id` is used as an object index, so numeric values are fastest!\n *\n * Bins are automatically refcounted (i.e. a newly packed Bin will have a refcount of 1).\n * When a bin is no longer needed, use the `ShelfPack.unref` function to mark it\n *   as unused.  When a Bin's refcount decrements to 0, the Bin will be marked\n *   as free and its space may be reused by the packing code.\n *\n * @param    {number}         w      Width of the bin to allocate\n * @param    {number}         h      Height of the bin to allocate\n * @param    {number|string}  [id]   Unique identifier for this bin, (if unsupplied, assume it's a new bin and create an id)\n * @returns  {Bin}            Bin object with `id`, `x`, `y`, `w`, `h` properties, or `null` if allocation failed\n * @example\n * var results = sprite.packOne(12, 16, 'a');\n */\nShelfPack$1.prototype.packOne = function(w, h, id) {\n    var best = { freebin: -1, shelf: -1, waste: Infinity },\n        y = 0,\n        bin, shelf, waste, i;\n\n    // if id was supplied, attempt a lookup..\n    if (typeof id === 'string' || typeof id === 'number') {\n        bin = this.getBin(id);\n        if (bin) {              // we packed this bin already\n            this.ref(bin);\n            return bin;\n        }\n        if (typeof id === 'number') {\n            this.maxId = Math.max(id, this.maxId);\n        }\n    } else {\n        id = ++this.maxId;\n    }\n\n    // First try to reuse a free bin..\n    for (i = 0; i < this.freebins.length; i++) {\n        bin = this.freebins[i];\n\n        // exactly the right height and width, use it..\n        if (h === bin.maxh && w === bin.maxw) {\n            return this.allocFreebin(i, w, h, id);\n        }\n        // not enough height or width, skip it..\n        if (h > bin.maxh || w > bin.maxw) {\n            continue;\n        }\n        // extra height or width, minimize wasted area..\n        if (h <= bin.maxh && w <= bin.maxw) {\n            waste = (bin.maxw * bin.maxh) - (w * h);\n            if (waste < best.waste) {\n                best.waste = waste;\n                best.freebin = i;\n            }\n        }\n    }\n\n    // Next find the best shelf..\n    for (i = 0; i < this.shelves.length; i++) {\n        shelf = this.shelves[i];\n        y += shelf.h;\n\n        // not enough width on this shelf, skip it..\n        if (w > shelf.free) {\n            continue;\n        }\n        // exactly the right height, pack it..\n        if (h === shelf.h) {\n            return this.allocShelf(i, w, h, id);\n        }\n        // not enough height, skip it..\n        if (h > shelf.h) {\n            continue;\n        }\n        // extra height, minimize wasted area..\n        if (h < shelf.h) {\n            waste = (shelf.h - h) * w;\n            if (waste < best.waste) {\n                best.freebin = -1;\n                best.waste = waste;\n                best.shelf = i;\n            }\n        }\n    }\n\n    if (best.freebin !== -1) {\n        return this.allocFreebin(best.freebin, w, h, id);\n    }\n\n    if (best.shelf !== -1) {\n        return this.allocShelf(best.shelf, w, h, id);\n    }\n\n    // No free bins or shelves.. add shelf..\n    if (h <= (this.h - y) && w <= this.w) {\n        shelf = new Shelf(y, this.w, h);\n        return this.allocShelf(this.shelves.push(shelf) - 1, w, h, id);\n    }\n\n    // No room for more shelves..\n    // If `autoResize` option is set, grow the sprite as follows:\n    //  * double whichever sprite dimension is smaller (`w1` or `h1`)\n    //  * if sprite dimensions are equal, grow width before height\n    //  * accomodate very large bin requests (big `w` or `h`)\n    if (this.autoResize) {\n        var h1, h2, w1, w2;\n\n        h1 = h2 = this.h;\n        w1 = w2 = this.w;\n\n        if (w1 <= h1 || w > w1) {   // grow width..\n            w2 = Math.max(w, w1) * 2;\n        }\n        if (h1 < w1 || h > h1) {    // grow height..\n            h2 = Math.max(h, h1) * 2;\n        }\n\n        this.resize(w2, h2);\n        return this.packOne(w, h, id);  // retry\n    }\n\n    return null;\n};\n\n\n/**\n * Called by packOne() to allocate a bin by reusing an existing freebin\n *\n * @private\n * @param    {number}         index  Index into the `this.freebins` array\n * @param    {number}         w      Width of the bin to allocate\n * @param    {number}         h      Height of the bin to allocate\n * @param    {number|string}  id     Unique identifier for this bin\n * @returns  {Bin}            Bin object with `id`, `x`, `y`, `w`, `h` properties\n * @example\n * var bin = sprite.allocFreebin(0, 12, 16, 'a');\n */\nShelfPack$1.prototype.allocFreebin = function (index, w, h, id) {\n    var bin = this.freebins.splice(index, 1)[0];\n    bin.id = id;\n    bin.w = w;\n    bin.h = h;\n    bin.refcount = 0;\n    this.bins[id] = bin;\n    this.ref(bin);\n    return bin;\n};\n\n\n/**\n * Called by `packOne() to allocate bin on an existing shelf\n *\n * @private\n * @param    {number}         index  Index into the `this.shelves` array\n * @param    {number}         w      Width of the bin to allocate\n * @param    {number}         h      Height of the bin to allocate\n * @param    {number|string}  id     Unique identifier for this bin\n * @returns  {Bin}            Bin object with `id`, `x`, `y`, `w`, `h` properties\n * @example\n * var results = sprite.allocShelf(0, 12, 16, 'a');\n */\nShelfPack$1.prototype.allocShelf = function(index, w, h, id) {\n    var shelf = this.shelves[index];\n    var bin = shelf.alloc(w, h, id);\n    this.bins[id] = bin;\n    this.ref(bin);\n    return bin;\n};\n\n\n/**\n * Shrink the width/height of the sprite to the bare minimum.\n * Since shelf-pack doubles first width, then height when running out of shelf space\n * this can result in fairly large unused space both in width and height if that happens\n * towards the end of bin packing.\n */\nShelfPack$1.prototype.shrink = function() {\n    if (this.shelves.length > 0) {\n        var w2 = 0;\n        var h2 = 0;\n\n        for (var j = 0; j < this.shelves.length; j++) {\n            var shelf = this.shelves[j];\n            h2 += shelf.h;\n            w2 = Math.max(shelf.w - shelf.free, w2);\n        }\n\n        this.resize(w2, h2);\n    }\n};\n\n\n/**\n * Return a packed bin given its id, or undefined if the id is not found\n *\n * @param    {number|string}  id  Unique identifier for this bin,\n * @returns  {Bin}            The requested bin, or undefined if not yet packed\n * @example\n * var b = sprite.getBin('a');\n */\nShelfPack$1.prototype.getBin = function(id) {\n    return this.bins[id];\n};\n\n\n/**\n * Increment the ref count of a bin and update statistics.\n *\n * @param    {Bin}     bin  Bin instance\n * @returns  {number}  New refcount of the bin\n * @example\n * var bin = sprite.getBin('a');\n * sprite.ref(bin);\n */\nShelfPack$1.prototype.ref = function(bin) {\n    if (++bin.refcount === 1) {   // a new Bin.. record height in stats historgram..\n        var h = bin.h;\n        this.stats[h] = (this.stats[h] | 0) + 1;\n    }\n\n    return bin.refcount;\n};\n\n\n/**\n * Decrement the ref count of a bin and update statistics.\n * The bin will be automatically marked as free space once the refcount reaches 0.\n *\n * @param    {Bin}     bin  Bin instance\n * @returns  {number}  New refcount of the bin\n * @example\n * var bin = sprite.getBin('a');\n * sprite.unref(bin);\n */\nShelfPack$1.prototype.unref = function(bin) {\n    if (bin.refcount === 0) {\n        return 0;\n    }\n\n    if (--bin.refcount === 0) {\n        this.stats[bin.h]--;\n        delete this.bins[bin.id];\n        this.freebins.push(bin);\n    }\n\n    return bin.refcount;\n};\n\n\n/**\n * Clear the sprite.  Resets everything and resets statistics.\n *\n * @example\n * sprite.clear();\n */\nShelfPack$1.prototype.clear = function() {\n    this.shelves = [];\n    this.freebins = [];\n    this.stats = {};\n    this.bins = {};\n    this.maxId = 0;\n};\n\n\n/**\n * Resize the sprite.\n *\n * @param   {number}  w  Requested new sprite width\n * @param   {number}  h  Requested new sprite height\n * @returns {boolean} `true` if resize succeeded, `false` if failed\n * @example\n * sprite.resize(256, 256);\n */\nShelfPack$1.prototype.resize = function(w, h) {\n    this.w = w;\n    this.h = h;\n    for (var i = 0; i < this.shelves.length; i++) {\n        this.shelves[i].resize(w);\n    }\n    return true;\n};\n\n\n/**\n * Create a new Shelf.\n *\n * @private\n * @class  Shelf\n * @param  {number}  y   Top coordinate of the new shelf\n * @param  {number}  w   Width of the new shelf\n * @param  {number}  h   Height of the new shelf\n * @example\n * var shelf = new Shelf(64, 512, 24);\n */\nfunction Shelf(y, w, h) {\n    this.x = 0;\n    this.y = y;\n    this.w = this.free = w;\n    this.h = h;\n}\n\n\n/**\n * Allocate a single bin into the shelf.\n *\n * @private\n * @param   {number}         w   Width of the bin to allocate\n * @param   {number}         h   Height of the bin to allocate\n * @param   {number|string}  id  Unique id of the bin to allocate\n * @returns {Bin}            Bin object with `id`, `x`, `y`, `w`, `h` properties, or `null` if allocation failed\n * @example\n * shelf.alloc(12, 16, 'a');\n */\nShelf.prototype.alloc = function(w, h, id) {\n    if (w > this.free || h > this.h) {\n        return null;\n    }\n    var x = this.x;\n    this.x += w;\n    this.free -= w;\n    return new Bin(id, x, this.y, w, h, w, this.h);\n};\n\n\n/**\n * Resize the shelf.\n *\n * @private\n * @param   {number}  w  Requested new width of the shelf\n * @returns {boolean}    true\n * @example\n * shelf.resize(512);\n */\nShelf.prototype.resize = function(w) {\n    this.free += (w - this.w);\n    this.w = w;\n    return true;\n};\n\n\n/**\n * Create a new Bin object.\n *\n * @class  Bin\n * @param  {number|string}  id      Unique id of the bin\n * @param  {number}         x       Left coordinate of the bin\n * @param  {number}         y       Top coordinate of the bin\n * @param  {number}         w       Width of the bin\n * @param  {number}         h       Height of the bin\n * @param  {number}         [maxw]  Max width of the bin (defaults to `w` if not provided)\n * @param  {number}         [maxh]  Max height of the bin (defaults to `h` if not provided)\n * @example\n * var bin = new Bin('a', 0, 0, 12, 16);\n */\nfunction Bin(id, x, y, w, h, maxw, maxh) {\n    this.id = id;\n    this.x  = x;\n    this.y  = y;\n    this.w  = w;\n    this.h  = h;\n    this.maxw = maxw || w;\n    this.maxh = maxh || h;\n    this.refcount = 0;\n}\n\nreturn ShelfPack$1;\n\n})));\n","'use strict';\n\nmodule.exports = clip;\n\nvar createFeature = require('./feature');\n\n/* clip features between two axis-parallel lines:\n *     |        |\n *  ___|___     |     /\n * /   |   \\____|____/\n *     |        |\n */\n\nfunction clip(features, scale, k1, k2, axis, minAll, maxAll) {\n\n    k1 /= scale;\n    k2 /= scale;\n\n    if (minAll >= k1 && maxAll <= k2) return features; // trivial accept\n    else if (minAll > k2 || maxAll < k1) return null; // trivial reject\n\n    var clipped = [];\n\n    for (var i = 0; i < features.length; i++) {\n\n        var feature = features[i];\n        var geometry = feature.geometry;\n        var type = feature.type;\n\n        var min = axis === 0 ? feature.minX : feature.minY;\n        var max = axis === 0 ? feature.maxX : feature.maxY;\n\n        if (min >= k1 && max <= k2) { // trivial accept\n            clipped.push(feature);\n            continue;\n        } else if (min > k2 || max < k1) { // trivial reject\n            continue;\n        }\n\n        var newGeometry = [];\n\n        if (type === 'Point' || type === 'MultiPoint') {\n            clipPoints(geometry, newGeometry, k1, k2, axis);\n\n        } else if (type === 'LineString') {\n            clipLine(geometry, newGeometry, k1, k2, axis, false);\n\n        } else if (type === 'MultiLineString') {\n            clipLines(geometry, newGeometry, k1, k2, axis, false);\n\n        } else if (type === 'Polygon') {\n            clipLines(geometry, newGeometry, k1, k2, axis, true);\n\n        } else if (type === 'MultiPolygon') {\n            for (var j = 0; j < geometry.length; j++) {\n                var polygon = [];\n                clipLines(geometry[j], polygon, k1, k2, axis, true);\n                if (polygon.length) {\n                    newGeometry.push(polygon);\n                }\n            }\n        }\n\n        if (newGeometry.length) {\n            if (type === 'LineString' || type === 'MultiLineString') {\n                if (newGeometry.length === 1) {\n                    type = 'LineString';\n                    newGeometry = newGeometry[0];\n                } else {\n                    type = 'MultiLineString';\n                }\n            }\n            if (type === 'Point' || type === 'MultiPoint') {\n                type = newGeometry.length === 3 ? 'Point' : 'MultiPoint';\n            }\n\n            clipped.push(createFeature(feature.id, type, newGeometry, feature.tags));\n        }\n    }\n\n    return clipped.length ? clipped : null;\n}\n\nfunction clipPoints(geom, newGeom, k1, k2, axis) {\n    for (var i = 0; i < geom.length; i += 3) {\n        var a = geom[i + axis];\n\n        if (a >= k1 && a <= k2) {\n            newGeom.push(geom[i]);\n            newGeom.push(geom[i + 1]);\n            newGeom.push(geom[i + 2]);\n        }\n    }\n}\n\nfunction clipLine(geom, newGeom, k1, k2, axis, isPolygon) {\n\n    var slice = [];\n    var intersect = axis === 0 ? intersectX : intersectY;\n\n    for (var i = 0; i < geom.length - 3; i += 3) {\n        var ax = geom[i];\n        var ay = geom[i + 1];\n        var az = geom[i + 2];\n        var bx = geom[i + 3];\n        var by = geom[i + 4];\n        var a = axis === 0 ? ax : ay;\n        var b = axis === 0 ? bx : by;\n        var sliced = false;\n\n        if (a < k1) {\n            // ---|-->  |\n            if (b >= k1) intersect(slice, ax, ay, bx, by, k1);\n        } else if (a > k2) {\n            // |  <--|---\n            if (b <= k2) intersect(slice, ax, ay, bx, by, k2);\n        } else {\n            addPoint(slice, ax, ay, az);\n        }\n        if (b < k1 && a >= k1) {\n            // <--|---  | or <--|-----|---\n            intersect(slice, ax, ay, bx, by, k1);\n            sliced = true;\n        }\n        if (b > k2 && a <= k2) {\n            // |  ---|--> or ---|-----|-->\n            intersect(slice, ax, ay, bx, by, k2);\n            sliced = true;\n        }\n\n        if (!isPolygon && sliced) {\n            slice.size = geom.size;\n            newGeom.push(slice);\n            slice = [];\n        }\n    }\n\n    // add the last point\n    var last = geom.length - 3;\n    ax = geom[last];\n    ay = geom[last + 1];\n    az = geom[last + 2];\n    a = axis === 0 ? ax : ay;\n    if (a >= k1 && a <= k2) addPoint(slice, ax, ay, az);\n\n    // close the polygon if its endpoints are not the same after clipping\n    last = slice.length - 3;\n    if (isPolygon && last >= 3 && (slice[last] !== slice[0] || slice[last + 1] !== slice[1])) {\n        addPoint(slice, slice[0], slice[1], slice[2]);\n    }\n\n    // add the final slice\n    if (slice.length) {\n        slice.size = geom.size;\n        newGeom.push(slice);\n    }\n}\n\nfunction clipLines(geom, newGeom, k1, k2, axis, isPolygon) {\n    for (var i = 0; i < geom.length; i++) {\n        clipLine(geom[i], newGeom, k1, k2, axis, isPolygon);\n    }\n}\n\nfunction addPoint(out, x, y, z) {\n    out.push(x);\n    out.push(y);\n    out.push(z);\n}\n\nfunction intersectX(out, ax, ay, bx, by, x) {\n    out.push(x);\n    out.push(ay + (x - ax) * (by - ay) / (bx - ax));\n    out.push(1);\n}\n\nfunction intersectY(out, ax, ay, bx, by, y) {\n    out.push(ax + (y - ay) * (bx - ax) / (by - ay));\n    out.push(y);\n    out.push(1);\n}\n","// @flow\r\n\r\nconst Actor = require('../util/actor');\r\nconst StyleLayerIndex = require('../style/style_layer_index');\r\n\r\nconst VectorTileWorkerSource = require('./vector_tile_worker_source');\r\nconst RasterDEMTileWorkerSource = require('./raster_dem_tile_worker_source');\r\nconst GeoJSONWorkerSource = require('./geojson_worker_source');\r\nconst assert = require('assert');\r\n\r\nconst globalRTLTextPlugin = require('./rtl_text_plugin');\r\n\r\nimport type {\r\n    WorkerSource,\r\n    WorkerTileParameters,\r\n    WorkerDEMTileParameters,\r\n    WorkerTileCallback,\r\n    WorkerDEMTileCallback,\r\n    TileParameters\r\n} from '../source/worker_source';\r\n\r\nimport type {WorkerGlobalScopeInterface} from '../util/web_worker';\r\nimport type {Callback} from '../types/callback';\r\n\r\n/**\r\n * @private\r\n */\r\nclass Worker {\r\n    self: WorkerGlobalScopeInterface;\r\n    actor: Actor;\r\n    layerIndexes: { [string]: StyleLayerIndex };\r\n    workerSourceTypes: { [string]: Class<WorkerSource> };\r\n    workerSources: { [string]: { [string]: WorkerSource } };\r\n    demWorkerSources: { [string]: RasterDEMTileWorkerSource };\r\n\r\n    constructor(self: WorkerGlobalScopeInterface) {\r\n        this.self = self;\r\n        this.actor = new Actor(self, this);\r\n\r\n        this.layerIndexes = {};\r\n\r\n        this.workerSourceTypes = {\r\n            vector: VectorTileWorkerSource,\r\n            geojson: GeoJSONWorkerSource\r\n        };\r\n\r\n        // [mapId][sourceType] => worker source instance\r\n        this.workerSources = {};\r\n        this.demWorkerSources = {};\r\n\r\n        this.self.registerWorkerSource = (name: string, WorkerSource: Class<WorkerSource>) => {\r\n            if (this.workerSourceTypes[name]) {\r\n                throw new Error(`Worker source with name \"${name}\" already registered.`);\r\n            }\r\n            this.workerSourceTypes[name] = WorkerSource;\r\n        };\r\n\r\n        this.self.registerRTLTextPlugin = (rtlTextPlugin: {applyArabicShaping: Function, processBidirectionalText: Function}) => {\r\n            if (globalRTLTextPlugin.applyArabicShaping || globalRTLTextPlugin.processBidirectionalText) {\r\n                throw new Error('RTL text plugin already registered.');\r\n            }\r\n            globalRTLTextPlugin['applyArabicShaping'] = rtlTextPlugin.applyArabicShaping;\r\n            globalRTLTextPlugin['processBidirectionalText'] = rtlTextPlugin.processBidirectionalText;\r\n        };\r\n    }\r\n\r\n    setLayers(mapId: string, layers: Array<LayerSpecification>, callback: WorkerTileCallback) {\r\n        this.getLayerIndex(mapId).replace(layers);\r\n        callback();\r\n    }\r\n\r\n    updateLayers(mapId: string, params: {layers: Array<LayerSpecification>, removedIds: Array<string>}, callback: WorkerTileCallback) {\r\n        this.getLayerIndex(mapId).update(params.layers, params.removedIds);\r\n        callback();\r\n    }\r\n\r\n    loadTile(mapId: string, params: WorkerTileParameters & {type: string}, callback: WorkerTileCallback) {\r\n        assert(params.type);\r\n        this.getWorkerSource(mapId, params.type).loadTile(params, callback);\r\n    }\r\n\r\n    loadDEMTile(mapId: string, params: WorkerDEMTileParameters, callback: WorkerDEMTileCallback) {\r\n        this.getDEMWorkerSource(mapId).loadTile(params, callback);\r\n    }\r\n\r\n    reloadTile(mapId: string, params: WorkerTileParameters & {type: string}, callback: WorkerTileCallback) {\r\n        assert(params.type);\r\n        this.getWorkerSource(mapId, params.type).reloadTile(params, callback);\r\n    }\r\n\r\n    abortTile(mapId: string, params: TileParameters & {type: string}, callback: WorkerTileCallback) {\r\n        assert(params.type);\r\n        this.getWorkerSource(mapId, params.type).abortTile(params, callback);\r\n    }\r\n\r\n    removeTile(mapId: string, params: TileParameters & {type: string}, callback: WorkerTileCallback) {\r\n        assert(params.type);\r\n        this.getWorkerSource(mapId, params.type).removeTile(params, callback);\r\n    }\r\n\r\n    removeDEMTile(mapId: string, params: TileParameters) {\r\n        this.getDEMWorkerSource(mapId).removeTile(params);\r\n    }\r\n\r\n    removeSource(mapId: string, params: {source: string} & {type: string}, callback: WorkerTileCallback) {\r\n        assert(params.type);\r\n        const worker = this.getWorkerSource(mapId, params.type);\r\n        if (worker.removeSource !== undefined) {\r\n            worker.removeSource(params, callback);\r\n        } else {\r\n            callback();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Load a {@link WorkerSource} script at params.url.  The script is run\r\n     * (using importScripts) with `registerWorkerSource` in scope, which is a\r\n     * function taking `(name, workerSourceObject)`.\r\n     *  @private\r\n     */\r\n    loadWorkerSource(map: string, params: { url: string }, callback: Callback<void>) {\r\n        try {\r\n            this.self.importScripts(params.url);\r\n            callback();\r\n        } catch (e) {\r\n            callback(e);\r\n        }\r\n    }\r\n\r\n    loadRTLTextPlugin(map: string, pluginURL: string, callback: Callback<void>) {\r\n        try {\r\n            if (!globalRTLTextPlugin.applyArabicShaping && !globalRTLTextPlugin.processBidirectionalText) {\r\n                this.self.importScripts(pluginURL);\r\n                if (!globalRTLTextPlugin.applyArabicShaping || !globalRTLTextPlugin.processBidirectionalText) {\r\n                    callback(new Error(`RTL Text Plugin failed to import scripts from ${pluginURL}`));\r\n                }\r\n            }\r\n        } catch (e) {\r\n            callback(e);\r\n        }\r\n    }\r\n\r\n    getLayerIndex(mapId: string) {\r\n        let layerIndexes = this.layerIndexes[mapId];\r\n        if (!layerIndexes) {\r\n            layerIndexes = this.layerIndexes[mapId] = new StyleLayerIndex();\r\n        }\r\n        return layerIndexes;\r\n    }\r\n\r\n    getWorkerSource(mapId: string, type: string) {\r\n        if (!this.workerSources[mapId])\r\n            this.workerSources[mapId] = {};\r\n        if (!this.workerSources[mapId][type]) {\r\n            // use a wrapped actor so that we can attach a target mapId param\r\n            // to any messages invoked by the WorkerSource\r\n            const actor = {\r\n                send: (type, data, callback) => {\r\n                    this.actor.send(type, data, callback, mapId);\r\n                }\r\n            };\r\n\r\n            this.workerSources[mapId][type] = new (this.workerSourceTypes[type]: any)((actor: any), this.getLayerIndex(mapId));\r\n        }\r\n\r\n        return this.workerSources[mapId][type];\r\n    }\r\n\r\n    getDEMWorkerSource(mapId: string) {\r\n        if (!this.demWorkerSources[mapId]) {\r\n            this.demWorkerSources[mapId] = new RasterDEMTileWorkerSource();\r\n        }\r\n\r\n        return this.demWorkerSources[mapId];\r\n    }\r\n}\r\n\r\nconst w = new Worker(self);\r\n","// @flow\r\n\r\nconst util = require('./util');\r\nconst {serialize, deserialize} = require('./web_worker_transfer');\r\n\r\nimport type {Transferable} from '../types/transferable';\r\n\r\n/**\r\n * An implementation of the [Actor design pattern](http://en.wikipedia.org/wiki/Actor_model)\r\n * that maintains the relationship between asynchronous tasks and the objects\r\n * that spin them off - in this case, tasks like parsing parts of styles,\r\n * owned by the styles\r\n *\r\n * @param {WebWorker} target\r\n * @param {WebWorker} parent\r\n * @param {string|number} mapId A unique identifier for the Map instance using this Actor.\r\n * @private\r\n */\r\nclass Actor {\r\n    target: any;\r\n    parent: any;\r\n    mapId: string;\r\n    callbacks: any;\r\n    callbackID: number;\r\n    name: string;\r\n\r\n    constructor(target: any, parent: any, mapId: any) {\r\n        this.target = target;\r\n        this.parent = parent;\r\n        this.mapId = mapId;\r\n        this.callbacks = {};\r\n        this.callbackID = 0;\r\n        util.bindAll(['receive'], this);\r\n        this.target.addEventListener('message', this.receive, false);\r\n    }\r\n\r\n    /**\r\n     * Sends a message from a main-thread map to a Worker or from a Worker back to\r\n     * a main-thread map instance.\r\n     *\r\n     * @param type The name of the target method to invoke or '[source-type].name' for a method on a WorkerSource.\r\n     * @param targetMapId A particular mapId to which to send this message.\r\n     * @private\r\n     */\r\n    send(type: string, data: mixed, callback: ?Function, targetMapId: ?string) {\r\n        const id = callback ? `${this.mapId}:${this.callbackID++}` : null;\r\n        if (callback) this.callbacks[id] = callback;\r\n        const buffers: Array<Transferable> = [];\r\n        this.target.postMessage({\r\n            targetMapId: targetMapId,\r\n            sourceMapId: this.mapId,\r\n            type: type,\r\n            id: String(id),\r\n            data: serialize(data, buffers)\r\n        }, buffers);\r\n    }\r\n\r\n    receive(message: Object) {\r\n        const data = message.data,\r\n            id = data.id;\r\n        let callback;\r\n\r\n        if (data.targetMapId && this.mapId !== data.targetMapId)\r\n            return;\r\n\r\n        const done = (err, data) => {\r\n            const buffers: Array<Transferable> = [];\r\n            this.target.postMessage({\r\n                sourceMapId: this.mapId,\r\n                type: '<response>',\r\n                id: String(id),\r\n                error: err ? String(err) : null,\r\n                data: serialize(data, buffers)\r\n            }, buffers);\r\n        };\r\n\r\n        if (data.type === '<response>') {\r\n            callback = this.callbacks[data.id];\r\n            delete this.callbacks[data.id];\r\n            if (callback && data.error) {\r\n                callback(new Error(data.error));\r\n            } else if (callback) {\r\n                callback(null, deserialize(data.data));\r\n            }\r\n        } else if (typeof data.id !== 'undefined' && this.parent[data.type]) {\r\n            // data.type == 'loadTile', 'removeTile', etc.\r\n            this.parent[data.type](data.sourceMapId, deserialize(data.data), done);\r\n        } else if (typeof data.id !== 'undefined' && this.parent.getWorkerSource) {\r\n            // data.type == sourcetype.method\r\n            const keys = data.type.split('.');\r\n            const workerSource = (this.parent: any).getWorkerSource(data.sourceMapId, keys[0]);\r\n            workerSource[keys[1]](deserialize(data.data), done);\r\n        } else {\r\n            this.parent[data.type](deserialize(data.data));\r\n        }\r\n    }\r\n\r\n    remove() {\r\n        this.target.removeEventListener('message', this.receive, false);\r\n    }\r\n}\r\n\r\nmodule.exports = Actor;\r\n","// @flow\r\n\r\n/**\r\n * Deeply compares two object literals.\r\n *\r\n * @private\r\n */\r\nfunction deepEqual(a: ?mixed, b: ?mixed): boolean {\r\n    if (Array.isArray(a)) {\r\n        if (!Array.isArray(b) || a.length !== b.length) return false;\r\n        for (let i = 0; i < a.length; i++) {\r\n            if (!deepEqual(a[i], b[i])) return false;\r\n        }\r\n        return true;\r\n    }\r\n    if (typeof a === 'object' && a !== null && b !== null) {\r\n        if (!(typeof b === 'object')) return false;\r\n        const keys = Object.keys(a);\r\n        if (keys.length !== Object.keys(b).length) return false;\r\n        for (const key in a) {\r\n            if (!deepEqual(a[key], b[key])) return false;\r\n        }\r\n        return true;\r\n    }\r\n    return a === b;\r\n}\r\n\r\nmodule.exports = deepEqual;\r\n","var g;\n\n// This works in non-strict mode\ng = (function() {\n\treturn this;\n})();\n\ntry {\n\t// This works if eval is allowed (see CSP)\n\tg = g || new Function(\"return this\")();\n} catch (e) {\n\t// This works if the window reference is available\n\tif (typeof window === \"object\") g = window;\n}\n\n// g can still be undefined, but nothing to do about it...\n// We return undefined, instead of nothing here, so it's\n// easier to handle this case. if(!global) { ...}\n\nmodule.exports = g;\n","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\nvar getOwnPropertyDescriptors = Object.getOwnPropertyDescriptors ||\n  function getOwnPropertyDescriptors(obj) {\n    var keys = Object.keys(obj);\n    var descriptors = {};\n    for (var i = 0; i < keys.length; i++) {\n      descriptors[keys[i]] = Object.getOwnPropertyDescriptor(obj, keys[i]);\n    }\n    return descriptors;\n  };\n\nvar formatRegExp = /%[sdj%]/g;\nexports.format = function(f) {\n  if (!isString(f)) {\n    var objects = [];\n    for (var i = 0; i < arguments.length; i++) {\n      objects.push(inspect(arguments[i]));\n    }\n    return objects.join(' ');\n  }\n\n  var i = 1;\n  var args = arguments;\n  var len = args.length;\n  var str = String(f).replace(formatRegExp, function(x) {\n    if (x === '%%') return '%';\n    if (i >= len) return x;\n    switch (x) {\n      case '%s': return String(args[i++]);\n      case '%d': return Number(args[i++]);\n      case '%j':\n        try {\n          return JSON.stringify(args[i++]);\n        } catch (_) {\n          return '[Circular]';\n        }\n      default:\n        return x;\n    }\n  });\n  for (var x = args[i]; i < len; x = args[++i]) {\n    if (isNull(x) || !isObject(x)) {\n      str += ' ' + x;\n    } else {\n      str += ' ' + inspect(x);\n    }\n  }\n  return str;\n};\n\n\n// Mark that a method should not be used.\n// Returns a modified function which warns once by default.\n// If --no-deprecation is set, then it is a no-op.\nexports.deprecate = function(fn, msg) {\n  if (typeof process !== 'undefined' && process.noDeprecation === true) {\n    return fn;\n  }\n\n  // Allow for deprecating things in the process of starting up.\n  if (typeof process === 'undefined') {\n    return function() {\n      return exports.deprecate(fn, msg).apply(this, arguments);\n    };\n  }\n\n  var warned = false;\n  function deprecated() {\n    if (!warned) {\n      if (process.throwDeprecation) {\n        throw new Error(msg);\n      } else if (process.traceDeprecation) {\n        console.trace(msg);\n      } else {\n        console.error(msg);\n      }\n      warned = true;\n    }\n    return fn.apply(this, arguments);\n  }\n\n  return deprecated;\n};\n\n\nvar debugs = {};\nvar debugEnviron;\nexports.debuglog = function(set) {\n  if (isUndefined(debugEnviron))\n    debugEnviron = process.env.NODE_DEBUG || '';\n  set = set.toUpperCase();\n  if (!debugs[set]) {\n    if (new RegExp('\\\\b' + set + '\\\\b', 'i').test(debugEnviron)) {\n      var pid = process.pid;\n      debugs[set] = function() {\n        var msg = exports.format.apply(exports, arguments);\n        console.error('%s %d: %s', set, pid, msg);\n      };\n    } else {\n      debugs[set] = function() {};\n    }\n  }\n  return debugs[set];\n};\n\n\n/**\n * Echos the value of a value. Trys to print the value out\n * in the best way possible given the different types.\n *\n * @param {Object} obj The object to print out.\n * @param {Object} opts Optional options object that alters the output.\n */\n/* legacy: obj, showHidden, depth, colors*/\nfunction inspect(obj, opts) {\n  // default options\n  var ctx = {\n    seen: [],\n    stylize: stylizeNoColor\n  };\n  // legacy...\n  if (arguments.length >= 3) ctx.depth = arguments[2];\n  if (arguments.length >= 4) ctx.colors = arguments[3];\n  if (isBoolean(opts)) {\n    // legacy...\n    ctx.showHidden = opts;\n  } else if (opts) {\n    // got an \"options\" object\n    exports._extend(ctx, opts);\n  }\n  // set default options\n  if (isUndefined(ctx.showHidden)) ctx.showHidden = false;\n  if (isUndefined(ctx.depth)) ctx.depth = 2;\n  if (isUndefined(ctx.colors)) ctx.colors = false;\n  if (isUndefined(ctx.customInspect)) ctx.customInspect = true;\n  if (ctx.colors) ctx.stylize = stylizeWithColor;\n  return formatValue(ctx, obj, ctx.depth);\n}\nexports.inspect = inspect;\n\n\n// http://en.wikipedia.org/wiki/ANSI_escape_code#graphics\ninspect.colors = {\n  'bold' : [1, 22],\n  'italic' : [3, 23],\n  'underline' : [4, 24],\n  'inverse' : [7, 27],\n  'white' : [37, 39],\n  'grey' : [90, 39],\n  'black' : [30, 39],\n  'blue' : [34, 39],\n  'cyan' : [36, 39],\n  'green' : [32, 39],\n  'magenta' : [35, 39],\n  'red' : [31, 39],\n  'yellow' : [33, 39]\n};\n\n// Don't use 'blue' not visible on cmd.exe\ninspect.styles = {\n  'special': 'cyan',\n  'number': 'yellow',\n  'boolean': 'yellow',\n  'undefined': 'grey',\n  'null': 'bold',\n  'string': 'green',\n  'date': 'magenta',\n  // \"name\": intentionally not styling\n  'regexp': 'red'\n};\n\n\nfunction stylizeWithColor(str, styleType) {\n  var style = inspect.styles[styleType];\n\n  if (style) {\n    return '\\u001b[' + inspect.colors[style][0] + 'm' + str +\n           '\\u001b[' + inspect.colors[style][1] + 'm';\n  } else {\n    return str;\n  }\n}\n\n\nfunction stylizeNoColor(str, styleType) {\n  return str;\n}\n\n\nfunction arrayToHash(array) {\n  var hash = {};\n\n  array.forEach(function(val, idx) {\n    hash[val] = true;\n  });\n\n  return hash;\n}\n\n\nfunction formatValue(ctx, value, recurseTimes) {\n  // Provide a hook for user-specified inspect functions.\n  // Check that value is an object with an inspect function on it\n  if (ctx.customInspect &&\n      value &&\n      isFunction(value.inspect) &&\n      // Filter out the util module, it's inspect function is special\n      value.inspect !== exports.inspect &&\n      // Also filter out any prototype objects using the circular check.\n      !(value.constructor && value.constructor.prototype === value)) {\n    var ret = value.inspect(recurseTimes, ctx);\n    if (!isString(ret)) {\n      ret = formatValue(ctx, ret, recurseTimes);\n    }\n    return ret;\n  }\n\n  // Primitive types cannot have properties\n  var primitive = formatPrimitive(ctx, value);\n  if (primitive) {\n    return primitive;\n  }\n\n  // Look up the keys of the object.\n  var keys = Object.keys(value);\n  var visibleKeys = arrayToHash(keys);\n\n  if (ctx.showHidden) {\n    keys = Object.getOwnPropertyNames(value);\n  }\n\n  // IE doesn't make error fields non-enumerable\n  // http://msdn.microsoft.com/en-us/library/ie/dww52sbt(v=vs.94).aspx\n  if (isError(value)\n      && (keys.indexOf('message') >= 0 || keys.indexOf('description') >= 0)) {\n    return formatError(value);\n  }\n\n  // Some type of object without properties can be shortcutted.\n  if (keys.length === 0) {\n    if (isFunction(value)) {\n      var name = value.name ? ': ' + value.name : '';\n      return ctx.stylize('[Function' + name + ']', 'special');\n    }\n    if (isRegExp(value)) {\n      return ctx.stylize(RegExp.prototype.toString.call(value), 'regexp');\n    }\n    if (isDate(value)) {\n      return ctx.stylize(Date.prototype.toString.call(value), 'date');\n    }\n    if (isError(value)) {\n      return formatError(value);\n    }\n  }\n\n  var base = '', array = false, braces = ['{', '}'];\n\n  // Make Array say that they are Array\n  if (isArray(value)) {\n    array = true;\n    braces = ['[', ']'];\n  }\n\n  // Make functions say that they are functions\n  if (isFunction(value)) {\n    var n = value.name ? ': ' + value.name : '';\n    base = ' [Function' + n + ']';\n  }\n\n  // Make RegExps say that they are RegExps\n  if (isRegExp(value)) {\n    base = ' ' + RegExp.prototype.toString.call(value);\n  }\n\n  // Make dates with properties first say the date\n  if (isDate(value)) {\n    base = ' ' + Date.prototype.toUTCString.call(value);\n  }\n\n  // Make error with message first say the error\n  if (isError(value)) {\n    base = ' ' + formatError(value);\n  }\n\n  if (keys.length === 0 && (!array || value.length == 0)) {\n    return braces[0] + base + braces[1];\n  }\n\n  if (recurseTimes < 0) {\n    if (isRegExp(value)) {\n      return ctx.stylize(RegExp.prototype.toString.call(value), 'regexp');\n    } else {\n      return ctx.stylize('[Object]', 'special');\n    }\n  }\n\n  ctx.seen.push(value);\n\n  var output;\n  if (array) {\n    output = formatArray(ctx, value, recurseTimes, visibleKeys, keys);\n  } else {\n    output = keys.map(function(key) {\n      return formatProperty(ctx, value, recurseTimes, visibleKeys, key, array);\n    });\n  }\n\n  ctx.seen.pop();\n\n  return reduceToSingleString(output, base, braces);\n}\n\n\nfunction formatPrimitive(ctx, value) {\n  if (isUndefined(value))\n    return ctx.stylize('undefined', 'undefined');\n  if (isString(value)) {\n    var simple = '\\'' + JSON.stringify(value).replace(/^\"|\"$/g, '')\n                                             .replace(/'/g, \"\\\\'\")\n                                             .replace(/\\\\\"/g, '\"') + '\\'';\n    return ctx.stylize(simple, 'string');\n  }\n  if (isNumber(value))\n    return ctx.stylize('' + value, 'number');\n  if (isBoolean(value))\n    return ctx.stylize('' + value, 'boolean');\n  // For some reason typeof null is \"object\", so special case here.\n  if (isNull(value))\n    return ctx.stylize('null', 'null');\n}\n\n\nfunction formatError(value) {\n  return '[' + Error.prototype.toString.call(value) + ']';\n}\n\n\nfunction formatArray(ctx, value, recurseTimes, visibleKeys, keys) {\n  var output = [];\n  for (var i = 0, l = value.length; i < l; ++i) {\n    if (hasOwnProperty(value, String(i))) {\n      output.push(formatProperty(ctx, value, recurseTimes, visibleKeys,\n          String(i), true));\n    } else {\n      output.push('');\n    }\n  }\n  keys.forEach(function(key) {\n    if (!key.match(/^\\d+$/)) {\n      output.push(formatProperty(ctx, value, recurseTimes, visibleKeys,\n          key, true));\n    }\n  });\n  return output;\n}\n\n\nfunction formatProperty(ctx, value, recurseTimes, visibleKeys, key, array) {\n  var name, str, desc;\n  desc = Object.getOwnPropertyDescriptor(value, key) || { value: value[key] };\n  if (desc.get) {\n    if (desc.set) {\n      str = ctx.stylize('[Getter/Setter]', 'special');\n    } else {\n      str = ctx.stylize('[Getter]', 'special');\n    }\n  } else {\n    if (desc.set) {\n      str = ctx.stylize('[Setter]', 'special');\n    }\n  }\n  if (!hasOwnProperty(visibleKeys, key)) {\n    name = '[' + key + ']';\n  }\n  if (!str) {\n    if (ctx.seen.indexOf(desc.value) < 0) {\n      if (isNull(recurseTimes)) {\n        str = formatValue(ctx, desc.value, null);\n      } else {\n        str = formatValue(ctx, desc.value, recurseTimes - 1);\n      }\n      if (str.indexOf('\\n') > -1) {\n        if (array) {\n          str = str.split('\\n').map(function(line) {\n            return '  ' + line;\n          }).join('\\n').substr(2);\n        } else {\n          str = '\\n' + str.split('\\n').map(function(line) {\n            return '   ' + line;\n          }).join('\\n');\n        }\n      }\n    } else {\n      str = ctx.stylize('[Circular]', 'special');\n    }\n  }\n  if (isUndefined(name)) {\n    if (array && key.match(/^\\d+$/)) {\n      return str;\n    }\n    name = JSON.stringify('' + key);\n    if (name.match(/^\"([a-zA-Z_][a-zA-Z_0-9]*)\"$/)) {\n      name = name.substr(1, name.length - 2);\n      name = ctx.stylize(name, 'name');\n    } else {\n      name = name.replace(/'/g, \"\\\\'\")\n                 .replace(/\\\\\"/g, '\"')\n                 .replace(/(^\"|\"$)/g, \"'\");\n      name = ctx.stylize(name, 'string');\n    }\n  }\n\n  return name + ': ' + str;\n}\n\n\nfunction reduceToSingleString(output, base, braces) {\n  var numLinesEst = 0;\n  var length = output.reduce(function(prev, cur) {\n    numLinesEst++;\n    if (cur.indexOf('\\n') >= 0) numLinesEst++;\n    return prev + cur.replace(/\\u001b\\[\\d\\d?m/g, '').length + 1;\n  }, 0);\n\n  if (length > 60) {\n    return braces[0] +\n           (base === '' ? '' : base + '\\n ') +\n           ' ' +\n           output.join(',\\n  ') +\n           ' ' +\n           braces[1];\n  }\n\n  return braces[0] + base + ' ' + output.join(', ') + ' ' + braces[1];\n}\n\n\n// NOTE: These type checking functions intentionally don't use `instanceof`\n// because it is fragile and can be easily faked with `Object.create()`.\nfunction isArray(ar) {\n  return Array.isArray(ar);\n}\nexports.isArray = isArray;\n\nfunction isBoolean(arg) {\n  return typeof arg === 'boolean';\n}\nexports.isBoolean = isBoolean;\n\nfunction isNull(arg) {\n  return arg === null;\n}\nexports.isNull = isNull;\n\nfunction isNullOrUndefined(arg) {\n  return arg == null;\n}\nexports.isNullOrUndefined = isNullOrUndefined;\n\nfunction isNumber(arg) {\n  return typeof arg === 'number';\n}\nexports.isNumber = isNumber;\n\nfunction isString(arg) {\n  return typeof arg === 'string';\n}\nexports.isString = isString;\n\nfunction isSymbol(arg) {\n  return typeof arg === 'symbol';\n}\nexports.isSymbol = isSymbol;\n\nfunction isUndefined(arg) {\n  return arg === void 0;\n}\nexports.isUndefined = isUndefined;\n\nfunction isRegExp(re) {\n  return isObject(re) && objectToString(re) === '[object RegExp]';\n}\nexports.isRegExp = isRegExp;\n\nfunction isObject(arg) {\n  return typeof arg === 'object' && arg !== null;\n}\nexports.isObject = isObject;\n\nfunction isDate(d) {\n  return isObject(d) && objectToString(d) === '[object Date]';\n}\nexports.isDate = isDate;\n\nfunction isError(e) {\n  return isObject(e) &&\n      (objectToString(e) === '[object Error]' || e instanceof Error);\n}\nexports.isError = isError;\n\nfunction isFunction(arg) {\n  return typeof arg === 'function';\n}\nexports.isFunction = isFunction;\n\nfunction isPrimitive(arg) {\n  return arg === null ||\n         typeof arg === 'boolean' ||\n         typeof arg === 'number' ||\n         typeof arg === 'string' ||\n         typeof arg === 'symbol' ||  // ES6 symbol\n         typeof arg === 'undefined';\n}\nexports.isPrimitive = isPrimitive;\n\nexports.isBuffer = require('./support/isBuffer');\n\nfunction objectToString(o) {\n  return Object.prototype.toString.call(o);\n}\n\n\nfunction pad(n) {\n  return n < 10 ? '0' + n.toString(10) : n.toString(10);\n}\n\n\nvar months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep',\n              'Oct', 'Nov', 'Dec'];\n\n// 26 Feb 16:19:34\nfunction timestamp() {\n  var d = new Date();\n  var time = [pad(d.getHours()),\n              pad(d.getMinutes()),\n              pad(d.getSeconds())].join(':');\n  return [d.getDate(), months[d.getMonth()], time].join(' ');\n}\n\n\n// log is just a thin wrapper to console.log that prepends a timestamp\nexports.log = function() {\n  console.log('%s - %s', timestamp(), exports.format.apply(exports, arguments));\n};\n\n\n/**\n * Inherit the prototype methods from one constructor into another.\n *\n * The Function.prototype.inherits from lang.js rewritten as a standalone\n * function (not on Function.prototype). NOTE: If this file is to be loaded\n * during bootstrapping this function needs to be rewritten using some native\n * functions as prototype setup using normal JavaScript does not work as\n * expected during bootstrapping (see mirror.js in r114903).\n *\n * @param {function} ctor Constructor function which needs to inherit the\n *     prototype.\n * @param {function} superCtor Constructor function to inherit prototype from.\n */\nexports.inherits = require('inherits');\n\nexports._extend = function(origin, add) {\n  // Don't do anything if add isn't an object\n  if (!add || !isObject(add)) return origin;\n\n  var keys = Object.keys(add);\n  var i = keys.length;\n  while (i--) {\n    origin[keys[i]] = add[keys[i]];\n  }\n  return origin;\n};\n\nfunction hasOwnProperty(obj, prop) {\n  return Object.prototype.hasOwnProperty.call(obj, prop);\n}\n\nvar kCustomPromisifiedSymbol = typeof Symbol !== 'undefined' ? Symbol('util.promisify.custom') : undefined;\n\nexports.promisify = function promisify(original) {\n  if (typeof original !== 'function')\n    throw new TypeError('The \"original\" argument must be of type Function');\n\n  if (kCustomPromisifiedSymbol && original[kCustomPromisifiedSymbol]) {\n    var fn = original[kCustomPromisifiedSymbol];\n    if (typeof fn !== 'function') {\n      throw new TypeError('The \"util.promisify.custom\" argument must be of type Function');\n    }\n    Object.defineProperty(fn, kCustomPromisifiedSymbol, {\n      value: fn, enumerable: false, writable: false, configurable: true\n    });\n    return fn;\n  }\n\n  function fn() {\n    var promiseResolve, promiseReject;\n    var promise = new Promise(function (resolve, reject) {\n      promiseResolve = resolve;\n      promiseReject = reject;\n    });\n\n    var args = [];\n    for (var i = 0; i < arguments.length; i++) {\n      args.push(arguments[i]);\n    }\n    args.push(function (err, value) {\n      if (err) {\n        promiseReject(err);\n      } else {\n        promiseResolve(value);\n      }\n    });\n\n    try {\n      original.apply(this, args);\n    } catch (err) {\n      promiseReject(err);\n    }\n\n    return promise;\n  }\n\n  Object.setPrototypeOf(fn, Object.getPrototypeOf(original));\n\n  if (kCustomPromisifiedSymbol) Object.defineProperty(fn, kCustomPromisifiedSymbol, {\n    value: fn, enumerable: false, writable: false, configurable: true\n  });\n  return Object.defineProperties(\n    fn,\n    getOwnPropertyDescriptors(original)\n  );\n}\n\nexports.promisify.custom = kCustomPromisifiedSymbol\n\nfunction callbackifyOnRejected(reason, cb) {\n  // `!reason` guard inspired by bluebird (Ref: https://goo.gl/t5IS6M).\n  // Because `null` is a special error value in callbacks which means \"no error\n  // occurred\", we error-wrap so the callback consumer can distinguish between\n  // \"the promise rejected with null\" or \"the promise fulfilled with undefined\".\n  if (!reason) {\n    var newReason = new Error('Promise was rejected with a falsy value');\n    newReason.reason = reason;\n    reason = newReason;\n  }\n  return cb(reason);\n}\n\nfunction callbackify(original) {\n  if (typeof original !== 'function') {\n    throw new TypeError('The \"original\" argument must be of type Function');\n  }\n\n  // We DO NOT return the promise as it gives the user a false sense that\n  // the promise is actually somehow related to the callback's execution\n  // and that the callback throwing will reject the promise.\n  function callbackified() {\n    var args = [];\n    for (var i = 0; i < arguments.length; i++) {\n      args.push(arguments[i]);\n    }\n\n    var maybeCb = args.pop();\n    if (typeof maybeCb !== 'function') {\n      throw new TypeError('The last argument must be of type Function');\n    }\n    var self = this;\n    var cb = function() {\n      return maybeCb.apply(self, arguments);\n    };\n    // In true node style we process the callback on `nextTick` with all the\n    // implications (stack, `uncaughtException`, `async_hooks`)\n    original.apply(this, args)\n      .then(function(ret) { process.nextTick(cb, null, ret) },\n            function(rej) { process.nextTick(callbackifyOnRejected, rej, cb) });\n  }\n\n  Object.setPrototypeOf(callbackified, Object.getPrototypeOf(original));\n  Object.defineProperties(callbackified,\n                          getOwnPropertyDescriptors(original));\n  return callbackified;\n}\nexports.callbackify = callbackify;\n","// shim for using process in browser\nvar process = module.exports = {};\n\n// cached from whatever global is present so that test runners that stub it\n// don't break things.  But we need to wrap it in a try catch in case it is\n// wrapped in strict mode code which doesn't define any globals.  It's inside a\n// function because try/catches deoptimize in certain engines.\n\nvar cachedSetTimeout;\nvar cachedClearTimeout;\n\nfunction defaultSetTimout() {\n    throw new Error('setTimeout has not been defined');\n}\nfunction defaultClearTimeout () {\n    throw new Error('clearTimeout has not been defined');\n}\n(function () {\n    try {\n        if (typeof setTimeout === 'function') {\n            cachedSetTimeout = setTimeout;\n        } else {\n            cachedSetTimeout = defaultSetTimout;\n        }\n    } catch (e) {\n        cachedSetTimeout = defaultSetTimout;\n    }\n    try {\n        if (typeof clearTimeout === 'function') {\n            cachedClearTimeout = clearTimeout;\n        } else {\n            cachedClearTimeout = defaultClearTimeout;\n        }\n    } catch (e) {\n        cachedClearTimeout = defaultClearTimeout;\n    }\n} ())\nfunction runTimeout(fun) {\n    if (cachedSetTimeout === setTimeout) {\n        //normal enviroments in sane situations\n        return setTimeout(fun, 0);\n    }\n    // if setTimeout wasn't available but was latter defined\n    if ((cachedSetTimeout === defaultSetTimout || !cachedSetTimeout) && setTimeout) {\n        cachedSetTimeout = setTimeout;\n        return setTimeout(fun, 0);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedSetTimeout(fun, 0);\n    } catch(e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't trust the global object when called normally\n            return cachedSetTimeout.call(null, fun, 0);\n        } catch(e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error\n            return cachedSetTimeout.call(this, fun, 0);\n        }\n    }\n\n\n}\nfunction runClearTimeout(marker) {\n    if (cachedClearTimeout === clearTimeout) {\n        //normal enviroments in sane situations\n        return clearTimeout(marker);\n    }\n    // if clearTimeout wasn't available but was latter defined\n    if ((cachedClearTimeout === defaultClearTimeout || !cachedClearTimeout) && clearTimeout) {\n        cachedClearTimeout = clearTimeout;\n        return clearTimeout(marker);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedClearTimeout(marker);\n    } catch (e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't  trust the global object when called normally\n            return cachedClearTimeout.call(null, marker);\n        } catch (e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error.\n            // Some versions of I.E. have different rules for clearTimeout vs setTimeout\n            return cachedClearTimeout.call(this, marker);\n        }\n    }\n\n\n\n}\nvar queue = [];\nvar draining = false;\nvar currentQueue;\nvar queueIndex = -1;\n\nfunction cleanUpNextTick() {\n    if (!draining || !currentQueue) {\n        return;\n    }\n    draining = false;\n    if (currentQueue.length) {\n        queue = currentQueue.concat(queue);\n    } else {\n        queueIndex = -1;\n    }\n    if (queue.length) {\n        drainQueue();\n    }\n}\n\nfunction drainQueue() {\n    if (draining) {\n        return;\n    }\n    var timeout = runTimeout(cleanUpNextTick);\n    draining = true;\n\n    var len = queue.length;\n    while(len) {\n        currentQueue = queue;\n        queue = [];\n        while (++queueIndex < len) {\n            if (currentQueue) {\n                currentQueue[queueIndex].run();\n            }\n        }\n        queueIndex = -1;\n        len = queue.length;\n    }\n    currentQueue = null;\n    draining = false;\n    runClearTimeout(timeout);\n}\n\nprocess.nextTick = function (fun) {\n    var args = new Array(arguments.length - 1);\n    if (arguments.length > 1) {\n        for (var i = 1; i < arguments.length; i++) {\n            args[i - 1] = arguments[i];\n        }\n    }\n    queue.push(new Item(fun, args));\n    if (queue.length === 1 && !draining) {\n        runTimeout(drainQueue);\n    }\n};\n\n// v8 likes predictible objects\nfunction Item(fun, array) {\n    this.fun = fun;\n    this.array = array;\n}\nItem.prototype.run = function () {\n    this.fun.apply(null, this.array);\n};\nprocess.title = 'browser';\nprocess.browser = true;\nprocess.env = {};\nprocess.argv = [];\nprocess.version = ''; // empty string to avoid regexp issues\nprocess.versions = {};\n\nfunction noop() {}\n\nprocess.on = noop;\nprocess.addListener = noop;\nprocess.once = noop;\nprocess.off = noop;\nprocess.removeListener = noop;\nprocess.removeAllListeners = noop;\nprocess.emit = noop;\nprocess.prependListener = noop;\nprocess.prependOnceListener = noop;\n\nprocess.listeners = function (name) { return [] }\n\nprocess.binding = function (name) {\n    throw new Error('process.binding is not supported');\n};\n\nprocess.cwd = function () { return '/' };\nprocess.chdir = function (dir) {\n    throw new Error('process.chdir is not supported');\n};\nprocess.umask = function() { return 0; };\n","module.exports = function isBuffer(arg) {\n  return arg && typeof arg === 'object'\n    && typeof arg.copy === 'function'\n    && typeof arg.fill === 'function'\n    && typeof arg.readUInt8 === 'function';\n}","if (typeof Object.create === 'function') {\n  // implementation from standard node.js 'util' module\n  module.exports = function inherits(ctor, superCtor) {\n    ctor.super_ = superCtor\n    ctor.prototype = Object.create(superCtor.prototype, {\n      constructor: {\n        value: ctor,\n        enumerable: false,\n        writable: true,\n        configurable: true\n      }\n    });\n  };\n} else {\n  // old school shim for old browsers\n  module.exports = function inherits(ctor, superCtor) {\n    ctor.super_ = superCtor\n    var TempCtor = function () {}\n    TempCtor.prototype = superCtor.prototype\n    ctor.prototype = new TempCtor()\n    ctor.prototype.constructor = ctor\n  }\n}\n","// @flow\r\n\r\nconst {\r\n    array,\r\n    ValueType,\r\n    NumberType\r\n} = require('../types');\r\n\r\nconst RuntimeError = require('../runtime_error');\r\n\r\nimport type { Expression } from '../expression';\r\nimport type ParsingContext from '../parsing_context';\r\nimport type EvaluationContext from '../evaluation_context';\r\nimport type { Type, ArrayType } from '../types';\r\nimport type { Value } from '../values';\r\n\r\nclass At implements Expression {\r\n    type: Type;\r\n    index: Expression;\r\n    input: Expression;\r\n\r\n    constructor(type: Type, index: Expression, input: Expression) {\r\n        this.type = type;\r\n        this.index = index;\r\n        this.input = input;\r\n    }\r\n\r\n    static parse(args: Array<mixed>, context: ParsingContext) {\r\n        if (args.length !== 3)\r\n            return context.error(`Expected 2 arguments, but found ${args.length - 1} instead.`);\r\n\r\n        const index = context.parse(args[1], 1, NumberType);\r\n        const input = context.parse(args[2], 2, array(context.expectedType || ValueType));\r\n\r\n        if (!index || !input) return null;\r\n\r\n        const t: ArrayType = (input.type: any);\r\n        return new At(t.itemType, index, input);\r\n    }\r\n\r\n    evaluate(ctx: EvaluationContext) {\r\n        const index = ((this.index.evaluate(ctx): any): number);\r\n        const array = ((this.input.evaluate(ctx): any): Array<Value>);\r\n\r\n        if (index < 0 || index >= array.length) {\r\n            throw new RuntimeError(`Array index out of bounds: ${index} > ${array.length}.`);\r\n        }\r\n\r\n        if (index !== Math.floor(index)) {\r\n            throw new RuntimeError(`Array index must be an integer, but found ${index} instead.`);\r\n        }\r\n\r\n        return array[index];\r\n    }\r\n\r\n    eachChild(fn: (Expression) => void) {\r\n        fn(this.index);\r\n        fn(this.input);\r\n    }\r\n\r\n    possibleOutputs() {\r\n        return [undefined];\r\n    }\r\n}\r\n\r\nmodule.exports = At;\r\n","// @flow\r\n\r\nconst assert = require('assert');\r\nconst { typeOf } = require('../values');\r\n\r\nimport type { Expression } from '../expression';\r\nimport type ParsingContext from '../parsing_context';\r\nimport type EvaluationContext from '../evaluation_context';\r\nimport type { Type } from '../types';\r\n\r\n// Map input label values to output expression index\r\ntype Cases = {[number | string]: number};\r\n\r\nclass Match implements Expression {\r\n    type: Type;\r\n    inputType: Type;\r\n\r\n    input: Expression;\r\n    cases: Cases;\r\n    outputs: Array<Expression>;\r\n    otherwise: Expression;\r\n\r\n    constructor(inputType: Type, outputType: Type, input: Expression, cases: Cases, outputs: Array<Expression>, otherwise: Expression) {\r\n        this.inputType = inputType;\r\n        this.type = outputType;\r\n        this.input = input;\r\n        this.cases = cases;\r\n        this.outputs = outputs;\r\n        this.otherwise = otherwise;\r\n    }\r\n\r\n    static parse(args: Array<mixed>, context: ParsingContext) {\r\n        if (args.length < 5)\r\n            return context.error(`Expected at least 4 arguments, but found only ${args.length - 1}.`);\r\n        if (args.length % 2 !== 1)\r\n            return context.error(`Expected an even number of arguments.`);\r\n\r\n        let inputType;\r\n        let outputType;\r\n        if (context.expectedType && context.expectedType.kind !== 'value') {\r\n            outputType = context.expectedType;\r\n        }\r\n        const cases = {};\r\n        const outputs = [];\r\n        for (let i = 2; i < args.length - 1; i += 2) {\r\n            let labels = args[i];\r\n            const value = args[i + 1];\r\n\r\n            if (!Array.isArray(labels)) {\r\n                labels = [labels];\r\n            }\r\n\r\n            const labelContext = context.concat(i);\r\n            if (labels.length === 0) {\r\n                return labelContext.error('Expected at least one branch label.');\r\n            }\r\n\r\n            for (const label of labels) {\r\n                if (typeof label !== 'number' && typeof label !== 'string') {\r\n                    return labelContext.error(`Branch labels must be numbers or strings.`);\r\n                } else if (typeof label === 'number' && Math.abs(label) > Number.MAX_SAFE_INTEGER) {\r\n                    return labelContext.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);\r\n\r\n                } else if (typeof label === 'number' && Math.floor(label) !== label) {\r\n                    return labelContext.error(`Numeric branch labels must be integer values.`);\r\n\r\n                } else if (!inputType) {\r\n                    inputType = typeOf(label);\r\n                } else if (labelContext.checkSubtype(inputType, typeOf(label))) {\r\n                    return null;\r\n                }\r\n\r\n                if (typeof cases[String(label)] !== 'undefined') {\r\n                    return labelContext.error('Branch labels must be unique.');\r\n                }\r\n\r\n                cases[String(label)] = outputs.length;\r\n            }\r\n\r\n            const result = context.parse(value, i, outputType);\r\n            if (!result) return null;\r\n            outputType = outputType || result.type;\r\n            outputs.push(result);\r\n        }\r\n\r\n        const input = context.parse(args[1], 1, inputType);\r\n        if (!input) return null;\r\n\r\n        const otherwise = context.parse(args[args.length - 1], args.length - 1, outputType);\r\n        if (!otherwise) return null;\r\n\r\n        assert(inputType && outputType);\r\n        return new Match((inputType: any), (outputType: any), input, cases, outputs, otherwise);\r\n    }\r\n\r\n    evaluate(ctx: EvaluationContext) {\r\n        const input = (this.input.evaluate(ctx): any);\r\n        return (this.outputs[this.cases[input]] || this.otherwise).evaluate(ctx);\r\n    }\r\n\r\n    eachChild(fn: (Expression) => void) {\r\n        fn(this.input);\r\n        this.outputs.forEach(fn);\r\n        fn(this.otherwise);\r\n    }\r\n\r\n    possibleOutputs() {\r\n        return []\r\n            .concat(...this.outputs.map((out) => out.possibleOutputs()))\r\n            .concat(this.otherwise.possibleOutputs());\r\n    }\r\n}\r\n\r\nmodule.exports = Match;\r\n","// @flow\r\n\r\nconst assert = require('assert');\r\nconst { BooleanType } = require('../types');\r\n\r\nimport type { Expression } from '../expression';\r\nimport type ParsingContext from '../parsing_context';\r\nimport type EvaluationContext from '../evaluation_context';\r\nimport type { Type } from '../types';\r\n\r\ntype Branches = Array<[Expression, Expression]>;\r\n\r\nclass Case implements Expression {\r\n    type: Type;\r\n\r\n    branches: Branches;\r\n    otherwise: Expression;\r\n\r\n    constructor(type: Type, branches: Branches, otherwise: Expression) {\r\n        this.type = type;\r\n        this.branches = branches;\r\n        this.otherwise = otherwise;\r\n    }\r\n\r\n    static parse(args: Array<mixed>, context: ParsingContext) {\r\n        if (args.length < 4)\r\n            return context.error(`Expected at least 3 arguments, but found only ${args.length - 1}.`);\r\n        if (args.length % 2 !== 0)\r\n            return context.error(`Expected an odd number of arguments.`);\r\n\r\n        let outputType: ?Type;\r\n        if (context.expectedType && context.expectedType.kind !== 'value') {\r\n            outputType = context.expectedType;\r\n        }\r\n\r\n        const branches = [];\r\n        for (let i = 1; i < args.length - 1; i += 2) {\r\n            const test = context.parse(args[i], i, BooleanType);\r\n            if (!test) return null;\r\n\r\n            const result = context.parse(args[i + 1], i + 1, outputType);\r\n            if (!result) return null;\r\n\r\n            branches.push([test, result]);\r\n\r\n            outputType = outputType || result.type;\r\n        }\r\n\r\n        const otherwise = context.parse(args[args.length - 1], args.length - 1, outputType);\r\n        if (!otherwise) return null;\r\n\r\n        assert(outputType);\r\n        return new Case((outputType: any), branches, otherwise);\r\n    }\r\n\r\n    evaluate(ctx: EvaluationContext) {\r\n        for (const [test, expression] of this.branches) {\r\n            if (test.evaluate(ctx)) {\r\n                return expression.evaluate(ctx);\r\n            }\r\n        }\r\n        return this.otherwise.evaluate(ctx);\r\n    }\r\n\r\n    eachChild(fn: (Expression) => void) {\r\n        for (const [test, expression] of this.branches) {\r\n            fn(test);\r\n            fn(expression);\r\n        }\r\n        fn(this.otherwise);\r\n    }\r\n\r\n    possibleOutputs() {\r\n        return []\r\n            .concat(...this.branches.map(([_, out]) => out.possibleOutputs()))\r\n            .concat(this.otherwise.possibleOutputs());\r\n    }\r\n}\r\n\r\nmodule.exports = Case;\r\n","// @flow\r\n\r\nconst {\r\n    ValueType,\r\n    BooleanType,\r\n} = require('../types');\r\nconst {toString} = require('../types');\r\n\r\nimport type { Expression } from '../expression';\r\nimport type EvaluationContext from '../evaluation_context';\r\nimport type ParsingContext from '../parsing_context';\r\nimport type { Type } from '../types';\r\n\r\nfunction isComparableType(type: Type) {\r\n    return type.kind === 'string' ||\r\n        type.kind === 'number' ||\r\n        type.kind === 'boolean' ||\r\n        type.kind === 'null';\r\n}\r\n\r\n/**\r\n * Special form for ==, !=, implementing the following signatures:\r\n * - (T1: Comparable, T2: Comparable) => boolean { T1 == T2 }\r\n * - (Comparable, value) => boolean\r\n * - (value, Comparable) => boolean\r\n *\r\n * Where Comparable = string | number | boolean | null.\r\n *\r\n * Evaluation semantics for the value cases are equivalent to Javascript's\r\n * strict equality (===/!==) -- i.e., when the value argument's type doesn't\r\n * match that of the Comparable argument, == evaluates to false, != to true.\r\n *\r\n * @private\r\n */\r\nfunction makeComparison(compare) {\r\n    return class Comparison implements Expression {\r\n        type: Type;\r\n        lhs: Expression;\r\n        rhs: Expression;\r\n\r\n        constructor(lhs: Expression, rhs: Expression) {\r\n            this.type = BooleanType;\r\n            this.lhs = lhs;\r\n            this.rhs = rhs;\r\n        }\r\n\r\n        static parse(args: Array<mixed>, context: ParsingContext): ?Expression {\r\n            if (args.length !== 3)\r\n                return context.error(`Expected two arguments.`);\r\n\r\n            const lhs = context.parse(args[1], 1, ValueType);\r\n            if (!lhs) return null;\r\n            const rhs = context.parse(args[2], 2, ValueType);\r\n            if (!rhs) return null;\r\n\r\n            if (!isComparableType(lhs.type) && !isComparableType(rhs.type)) {\r\n                return context.error(`Expected at least one argument to be a string, number, boolean, or null, but found (${toString(lhs.type)}, ${toString(rhs.type)}) instead.`);\r\n            }\r\n\r\n            if (lhs.type.kind !== rhs.type.kind && lhs.type.kind !== 'value' && rhs.type.kind !== 'value') {\r\n                return context.error(`Cannot compare ${toString(lhs.type)} and ${toString(rhs.type)}.`);\r\n            }\r\n\r\n            return new Comparison(lhs, rhs);\r\n        }\r\n\r\n        evaluate(ctx: EvaluationContext) {\r\n            return compare(this.lhs.evaluate(ctx), this.rhs.evaluate(ctx));\r\n        }\r\n\r\n        eachChild(fn: (Expression) => void) {\r\n            fn(this.lhs);\r\n            fn(this.rhs);\r\n        }\r\n\r\n        possibleOutputs() {\r\n            return [true, false];\r\n        }\r\n    };\r\n}\r\n\r\nmodule.exports = {\r\n    Equals: makeComparison((lhs, rhs) => lhs === rhs),\r\n    NotEquals: makeComparison((lhs, rhs) => lhs !== rhs)\r\n};\r\n","// @flow\r\n\r\n/**\r\n * A type used for returning and propagating errors. The first element of the union\r\n * represents success and contains a value, and the second represents an error and\r\n * contains an error value.\r\n */\r\nexport type Result<T, E> =\r\n    | {| result: 'success', value: T |}\r\n    | {| result: 'error', value: E |};\r\n\r\nfunction success<T, E>(value: T): Result<T, E> {\r\n    return { result: 'success', value };\r\n}\r\n\r\nfunction error<T, E>(value: E): Result<T, E> {\r\n    return { result: 'error', value };\r\n}\r\n\r\nmodule.exports = {\r\n    success,\r\n    error\r\n};\r\n","// @flow\r\n\r\nconst Color = require('./color');\r\nconst interpolateNumber = require('./interpolate').number;\r\n\r\ntype LABColor = {\r\n    l: number,\r\n    a: number,\r\n    b: number,\r\n    alpha: number\r\n};\r\n\r\ntype HCLColor = {\r\n    h: number,\r\n    c: number,\r\n    l: number,\r\n    alpha: number\r\n};\r\n\r\n// Constants\r\nconst Xn = 0.950470, // D65 standard referent\r\n    Yn = 1,\r\n    Zn = 1.088830,\r\n    t0 = 4 / 29,\r\n    t1 = 6 / 29,\r\n    t2 = 3 * t1 * t1,\r\n    t3 = t1 * t1 * t1,\r\n    deg2rad = Math.PI / 180,\r\n    rad2deg = 180 / Math.PI;\r\n\r\n// Utilities\r\nfunction xyz2lab(t) {\r\n    return t > t3 ? Math.pow(t, 1 / 3) : t / t2 + t0;\r\n}\r\n\r\nfunction lab2xyz(t) {\r\n    return t > t1 ? t * t * t : t2 * (t - t0);\r\n}\r\n\r\nfunction xyz2rgb(x) {\r\n    return 255 * (x <= 0.0031308 ? 12.92 * x : 1.055 * Math.pow(x, 1 / 2.4) - 0.055);\r\n}\r\n\r\nfunction rgb2xyz(x) {\r\n    x /= 255;\r\n    return x <= 0.04045 ? x / 12.92 : Math.pow((x + 0.055) / 1.055, 2.4);\r\n}\r\n\r\n// LAB\r\nfunction rgbToLab(rgbColor: Color): LABColor {\r\n    const b = rgb2xyz(rgbColor.r),\r\n        a = rgb2xyz(rgbColor.g),\r\n        l = rgb2xyz(rgbColor.b),\r\n        x = xyz2lab((0.4124564 * b + 0.3575761 * a + 0.1804375 * l) / Xn),\r\n        y = xyz2lab((0.2126729 * b + 0.7151522 * a + 0.0721750 * l) / Yn),\r\n        z = xyz2lab((0.0193339 * b + 0.1191920 * a + 0.9503041 * l) / Zn);\r\n\r\n    return {\r\n        l: 116 * y - 16,\r\n        a: 500 * (x - y),\r\n        b: 200 * (y - z),\r\n        alpha: rgbColor.a\r\n    };\r\n}\r\n\r\nfunction labToRgb(labColor: LABColor): Color {\r\n    let y = (labColor.l + 16) / 116,\r\n        x = isNaN(labColor.a) ? y : y + labColor.a / 500,\r\n        z = isNaN(labColor.b) ? y : y - labColor.b / 200;\r\n    y = Yn * lab2xyz(y);\r\n    x = Xn * lab2xyz(x);\r\n    z = Zn * lab2xyz(z);\r\n    return new Color(\r\n        xyz2rgb(3.2404542 * x - 1.5371385 * y - 0.4985314 * z), // D65 -> sRGB\r\n        xyz2rgb(-0.9692660 * x + 1.8760108 * y + 0.0415560 * z),\r\n        xyz2rgb(0.0556434 * x - 0.2040259 * y + 1.0572252 * z),\r\n        labColor.alpha\r\n    );\r\n}\r\n\r\nfunction interpolateLab(from: LABColor, to: LABColor, t: number) {\r\n    return {\r\n        l: interpolateNumber(from.l, to.l, t),\r\n        a: interpolateNumber(from.a, to.a, t),\r\n        b: interpolateNumber(from.b, to.b, t),\r\n        alpha: interpolateNumber(from.alpha, to.alpha, t)\r\n    };\r\n}\r\n\r\n// HCL\r\nfunction rgbToHcl(rgbColor: Color): HCLColor {\r\n    const {l, a, b} = rgbToLab(rgbColor);\r\n    const h = Math.atan2(b, a) * rad2deg;\r\n    return {\r\n        h: h < 0 ? h + 360 : h,\r\n        c: Math.sqrt(a * a + b * b),\r\n        l: l,\r\n        alpha: rgbColor.a\r\n    };\r\n}\r\n\r\nfunction hclToRgb(hclColor: HCLColor): Color {\r\n    const h = hclColor.h * deg2rad,\r\n        c = hclColor.c,\r\n        l = hclColor.l;\r\n    return labToRgb({\r\n        l: l,\r\n        a: Math.cos(h) * c,\r\n        b: Math.sin(h) * c,\r\n        alpha: hclColor.alpha\r\n    });\r\n}\r\n\r\nfunction interpolateHue(a: number, b: number, t: number) {\r\n    const d = b - a;\r\n    return a + t * (d > 180 || d < -180 ? d - 360 * Math.round(d / 360) : d);\r\n}\r\n\r\nfunction interpolateHcl(from: HCLColor, to: HCLColor, t: number) {\r\n    return {\r\n        h: interpolateHue(from.h, to.h, t),\r\n        c: interpolateNumber(from.c, to.c, t),\r\n        l: interpolateNumber(from.l, to.l, t),\r\n        alpha: interpolateNumber(from.alpha, to.alpha, t)\r\n    };\r\n}\r\n\r\nmodule.exports = {\r\n    lab: {\r\n        forward: rgbToLab,\r\n        reverse: labToRgb,\r\n        interpolate: interpolateLab\r\n    },\r\n    hcl: {\r\n        forward: rgbToHcl,\r\n        reverse: hclToRgb,\r\n        interpolate: interpolateHcl\r\n    }\r\n};\r\n","// @flow\r\n\r\nconst StyleLayer = require('./style_layer');\r\nconst util = require('../util/util');\r\nconst featureFilter = require('../style-spec/feature_filter');\r\nconst groupByLayout = require('../style-spec/group_by_layout');\r\n\r\nimport type {TypedStyleLayer} from './style_layer/typed_style_layer';\r\n\r\nexport type LayerConfigs = { [string]: LayerSpecification };\r\nexport type Family<Layer: TypedStyleLayer> = Array<Layer>;\r\n\r\nclass StyleLayerIndex {\r\n    familiesBySource: { [source: string]: { [sourceLayer: string]: Array<Family<*>> } };\r\n\r\n    _layerConfigs: LayerConfigs;\r\n    _layers: { [string]: StyleLayer };\r\n\r\n    constructor(layerConfigs: ?Array<LayerSpecification>) {\r\n        if (layerConfigs) {\r\n            this.replace(layerConfigs);\r\n        }\r\n    }\r\n\r\n    replace(layerConfigs: Array<LayerSpecification>) {\r\n        this._layerConfigs = {};\r\n        this._layers = {};\r\n        this.update(layerConfigs, []);\r\n    }\r\n\r\n    update(layerConfigs: Array<LayerSpecification>, removedIds: Array<string>) {\r\n        for (const layerConfig of layerConfigs) {\r\n            this._layerConfigs[layerConfig.id] = layerConfig;\r\n\r\n            const layer = this._layers[layerConfig.id] = StyleLayer.create(layerConfig);\r\n            layer._featureFilter = featureFilter(layer.filter);\r\n        }\r\n        for (const id of removedIds) {\r\n            delete this._layerConfigs[id];\r\n            delete this._layers[id];\r\n        }\r\n\r\n        this.familiesBySource = {};\r\n\r\n        const groups = groupByLayout(util.values(this._layerConfigs));\r\n\r\n        for (const layerConfigs of groups) {\r\n            const layers = layerConfigs.map((layerConfig) => this._layers[layerConfig.id]);\r\n\r\n            const layer = layers[0];\r\n            if (layer.visibility === 'none') {\r\n                continue;\r\n            }\r\n\r\n            const sourceId = layer.source || '';\r\n            let sourceGroup = this.familiesBySource[sourceId];\r\n            if (!sourceGroup) {\r\n                sourceGroup = this.familiesBySource[sourceId] = {};\r\n            }\r\n\r\n            const sourceLayerId = layer.sourceLayer || '_geojsonTileLayer';\r\n            let sourceLayerFamilies = sourceGroup[sourceLayerId];\r\n            if (!sourceLayerFamilies) {\r\n                sourceLayerFamilies = sourceGroup[sourceLayerId] = [];\r\n            }\r\n\r\n            sourceLayerFamilies.push(layers);\r\n        }\r\n    }\r\n}\r\n\r\nmodule.exports = StyleLayerIndex;\r\n","// @flow\r\n\r\nmodule.exports = require('../style-spec/validate_style.min');\r\n\r\nimport type Evented from '../util/evented';\r\n\r\nmodule.exports.emitErrors = function (emitter: Evented, errors: ?Array<{message: string}>) {\r\n    if (errors && errors.length) {\r\n        for (const {message} of errors) {\r\n            emitter.fire('error', { error: new Error(message) });\r\n        }\r\n        return true;\r\n    } else {\r\n        return false;\r\n    }\r\n};\r\n","\r\nconst validateConstants = require('./validate/validate_constants');\r\nconst validate = require('./validate/validate');\r\nconst latestStyleSpec = require('./reference/latest');\r\nconst validateGlyphsURL = require('./validate/validate_glyphs_url');\r\n\r\n/**\r\n * Validate a Mapbox GL style against the style specification. This entrypoint,\r\n * `mapbox-gl-style-spec/lib/validate_style.min`, is designed to produce as\r\n * small a browserify bundle as possible by omitting unnecessary functionality\r\n * and legacy style specifications.\r\n *\r\n * @private\r\n * @param {Object} style The style to be validated.\r\n * @param {Object} [styleSpec] The style specification to validate against.\r\n *     If omitted, the latest style spec is used.\r\n * @returns {Array<ValidationError>}\r\n * @example\r\n *   var validate = require('mapbox-gl-style-spec/lib/validate_style.min');\r\n *   var errors = validate(style);\r\n */\r\nfunction validateStyleMin(style, styleSpec) {\r\n    styleSpec = styleSpec || latestStyleSpec;\r\n\r\n    let errors = [];\r\n\r\n    errors = errors.concat(validate({\r\n        key: '',\r\n        value: style,\r\n        valueSpec: styleSpec.$root,\r\n        styleSpec: styleSpec,\r\n        style: style,\r\n        objectElementValidators: {\r\n            glyphs: validateGlyphsURL,\r\n            '*': function() {\r\n                return [];\r\n            }\r\n        }\r\n    }));\r\n\r\n    if (style.constants) {\r\n        errors = errors.concat(validateConstants({\r\n            key: 'constants',\r\n            value: style.constants,\r\n            style: style,\r\n            styleSpec: styleSpec\r\n        }));\r\n    }\r\n\r\n    return sortErrors(errors);\r\n}\r\n\r\nvalidateStyleMin.source = wrapCleanErrors(require('./validate/validate_source'));\r\nvalidateStyleMin.light = wrapCleanErrors(require('./validate/validate_light'));\r\nvalidateStyleMin.layer = wrapCleanErrors(require('./validate/validate_layer'));\r\nvalidateStyleMin.filter = wrapCleanErrors(require('./validate/validate_filter'));\r\nvalidateStyleMin.paintProperty = wrapCleanErrors(require('./validate/validate_paint_property'));\r\nvalidateStyleMin.layoutProperty = wrapCleanErrors(require('./validate/validate_layout_property'));\r\n\r\nfunction sortErrors(errors) {\r\n    return [].concat(errors).sort((a, b) => {\r\n        return a.line - b.line;\r\n    });\r\n}\r\n\r\nfunction wrapCleanErrors(inner) {\r\n    return function() {\r\n        return sortErrors(inner.apply(this, arguments));\r\n    };\r\n}\r\n\r\nmodule.exports = validateStyleMin;\r\n","\r\nconst getType = require('../util/get_type');\r\nconst ValidationError = require('../error/validation_error');\r\n\r\nmodule.exports = function validateBoolean(options) {\r\n    const value = options.value;\r\n    const key = options.key;\r\n    const type = getType(value);\r\n\r\n    if (type !== 'boolean') {\r\n        return [new ValidationError(key, value, `boolean expected, ${type} found`)];\r\n    }\r\n\r\n    return [];\r\n};\r\n","\r\nconst ValidationError = require('../error/validation_error');\r\nconst getType = require('../util/get_type');\r\nconst parseCSSColor = require('csscolorparser').parseCSSColor;\r\n\r\nmodule.exports = function validateColor(options) {\r\n    const key = options.key;\r\n    const value = options.value;\r\n    const type = getType(value);\r\n\r\n    if (type !== 'string') {\r\n        return [new ValidationError(key, value, `color expected, ${type} found`)];\r\n    }\r\n\r\n    if (parseCSSColor(value) === null) {\r\n        return [new ValidationError(key, value, `color expected, \"${value}\" found`)];\r\n    }\r\n\r\n    return [];\r\n};\r\n","\r\nconst ValidationError = require('../error/validation_error');\r\nconst validateString = require('./validate_string');\r\n\r\nmodule.exports = function(options) {\r\n    const value = options.value;\r\n    const key = options.key;\r\n\r\n    const errors = validateString(options);\r\n    if (errors.length) return errors;\r\n\r\n    if (value.indexOf('{fontstack}') === -1) {\r\n        errors.push(new ValidationError(key, value, '\"glyphs\" url must include a \"{fontstack}\" token'));\r\n    }\r\n\r\n    if (value.indexOf('{range}') === -1) {\r\n        errors.push(new ValidationError(key, value, '\"glyphs\" url must include a \"{range}\" token'));\r\n    }\r\n\r\n    return errors;\r\n};\r\n","// @flow\r\n\r\nconst StyleLayer = require('../style_layer');\r\nconst CircleBucket = require('../../data/bucket/circle_bucket');\r\nconst {multiPolygonIntersectsBufferedMultiPoint} = require('../../util/intersection_tests');\r\nconst {getMaximumPaintValue, translateDistance, translate} = require('../query_utils');\r\nconst properties = require('./circle_style_layer_properties');\r\n\r\nconst {\r\n    Transitionable,\r\n    Transitioning,\r\n    PossiblyEvaluated\r\n} = require('../properties');\r\n\r\nimport type {Bucket, BucketParameters} from '../../data/bucket';\r\nimport type Point from '@mapbox/point-geometry';\r\nimport type {PaintProps} from './circle_style_layer_properties';\r\n\r\nclass CircleStyleLayer extends StyleLayer {\r\n    _transitionablePaint: Transitionable<PaintProps>;\r\n    _transitioningPaint: Transitioning<PaintProps>;\r\n    paint: PossiblyEvaluated<PaintProps>;\r\n\r\n    constructor(layer: LayerSpecification) {\r\n        super(layer, properties);\r\n    }\r\n\r\n    createBucket(parameters: BucketParameters<*>) {\r\n        return new CircleBucket(parameters);\r\n    }\r\n\r\n    queryRadius(bucket: Bucket): number {\r\n        const circleBucket: CircleBucket<CircleStyleLayer> = (bucket: any);\r\n        return getMaximumPaintValue('circle-radius', this, circleBucket) +\r\n            getMaximumPaintValue('circle-stroke-width', this, circleBucket) +\r\n            translateDistance(this.paint.get('circle-translate'));\r\n    }\r\n\r\n    queryIntersectsFeature(queryGeometry: Array<Array<Point>>,\r\n                           feature: VectorTileFeature,\r\n                           geometry: Array<Array<Point>>,\r\n                           zoom: number,\r\n                           bearing: number,\r\n                           pixelsToTileUnits: number): boolean {\r\n        const translatedPolygon = translate(queryGeometry,\r\n            this.paint.get('circle-translate'),\r\n            this.paint.get('circle-translate-anchor'),\r\n            bearing, pixelsToTileUnits);\r\n        const radius = this.paint.get('circle-radius').evaluate(feature) * pixelsToTileUnits;\r\n        const stroke = this.paint.get('circle-stroke-width').evaluate(feature) * pixelsToTileUnits;\r\n        return multiPolygonIntersectsBufferedMultiPoint(translatedPolygon, geometry, radius + stroke);\r\n    }\r\n}\r\n\r\nmodule.exports = CircleStyleLayer;\r\n","// @flow\r\nconst {createLayout} = require('../../util/struct_array');\r\nmodule.exports = createLayout([\r\n    {name: 'a_pos', components: 2, type: 'Int16'}\r\n], 4);\r\n","// @flow\r\n\r\nconst util = require('../util/util');\r\n\r\n/**\r\n * Packs two numbers, interpreted as 8-bit unsigned integers, into a single\r\n * float.  Unpack them in the shader using the `unpack_float()` function,\r\n * defined in _prelude.vertex.glsl\r\n *\r\n * @private\r\n */\r\nexports.packUint8ToFloat = function pack(a: number, b: number) {\r\n    // coerce a and b to 8-bit ints\r\n    a = util.clamp(Math.floor(a), 0, 255);\r\n    b = util.clamp(Math.floor(b), 0, 255);\r\n    return 256 * a + b;\r\n};\r\n\r\n","// This file is generated. Edit build/generate-style-code.js, then run `yarn run codegen`.\r\n// @flow\r\n/* eslint-disable */\r\n\r\nconst styleSpec = require('../../style-spec/reference/latest');\r\n\r\nconst {\r\n    Properties,\r\n    DataConstantProperty,\r\n    DataDrivenProperty,\r\n    CrossFadedProperty,\r\n    HeatmapColorProperty\r\n} = require('../properties');\r\n\r\nimport type Color from '../../style-spec/util/color';\r\n\r\n\r\nexport type PaintProps = {|\r\n    \"circle-radius\": DataDrivenProperty<number>,\r\n    \"circle-color\": DataDrivenProperty<Color>,\r\n    \"circle-blur\": DataDrivenProperty<number>,\r\n    \"circle-opacity\": DataDrivenProperty<number>,\r\n    \"circle-translate\": DataConstantProperty<[number, number]>,\r\n    \"circle-translate-anchor\": DataConstantProperty<\"map\" | \"viewport\">,\r\n    \"circle-pitch-scale\": DataConstantProperty<\"map\" | \"viewport\">,\r\n    \"circle-pitch-alignment\": DataConstantProperty<\"map\" | \"viewport\">,\r\n    \"circle-stroke-width\": DataDrivenProperty<number>,\r\n    \"circle-stroke-color\": DataDrivenProperty<Color>,\r\n    \"circle-stroke-opacity\": DataDrivenProperty<number>,\r\n|};\r\n\r\nconst paint: Properties<PaintProps> = new Properties({\r\n    \"circle-radius\": new DataDrivenProperty(styleSpec[\"paint_circle\"][\"circle-radius\"]),\r\n    \"circle-color\": new DataDrivenProperty(styleSpec[\"paint_circle\"][\"circle-color\"]),\r\n    \"circle-blur\": new DataDrivenProperty(styleSpec[\"paint_circle\"][\"circle-blur\"]),\r\n    \"circle-opacity\": new DataDrivenProperty(styleSpec[\"paint_circle\"][\"circle-opacity\"]),\r\n    \"circle-translate\": new DataConstantProperty(styleSpec[\"paint_circle\"][\"circle-translate\"]),\r\n    \"circle-translate-anchor\": new DataConstantProperty(styleSpec[\"paint_circle\"][\"circle-translate-anchor\"]),\r\n    \"circle-pitch-scale\": new DataConstantProperty(styleSpec[\"paint_circle\"][\"circle-pitch-scale\"]),\r\n    \"circle-pitch-alignment\": new DataConstantProperty(styleSpec[\"paint_circle\"][\"circle-pitch-alignment\"]),\r\n    \"circle-stroke-width\": new DataDrivenProperty(styleSpec[\"paint_circle\"][\"circle-stroke-width\"]),\r\n    \"circle-stroke-color\": new DataDrivenProperty(styleSpec[\"paint_circle\"][\"circle-stroke-color\"]),\r\n    \"circle-stroke-opacity\": new DataDrivenProperty(styleSpec[\"paint_circle\"][\"circle-stroke-opacity\"]),\r\n});\r\n\r\nmodule.exports = { paint };\r\n","// @flow\r\n\r\nconst StyleLayer = require('../style_layer');\r\nconst HeatmapBucket = require('../../data/bucket/heatmap_bucket');\r\nconst RGBAImage = require('../../util/image').RGBAImage;\r\nconst properties = require('./heatmap_style_layer_properties');\r\n\r\nconst {\r\n    Transitionable,\r\n    Transitioning,\r\n    PossiblyEvaluated\r\n} = require('../properties');\r\n\r\nimport type Texture from '../../render/texture';\r\nimport type Framebuffer from '../../gl/framebuffer';\r\nimport type {PaintProps} from './heatmap_style_layer_properties';\r\n\r\nclass HeatmapStyleLayer extends StyleLayer {\r\n\r\n    heatmapFbo: ?Framebuffer;\r\n    colorRamp: RGBAImage;\r\n    colorRampTexture: ?Texture;\r\n\r\n    _transitionablePaint: Transitionable<PaintProps>;\r\n    _transitioningPaint: Transitioning<PaintProps>;\r\n    paint: PossiblyEvaluated<PaintProps>;\r\n\r\n    createBucket(options: any) {\r\n        return new HeatmapBucket(options);\r\n    }\r\n\r\n    constructor(layer: LayerSpecification) {\r\n        super(layer, properties);\r\n\r\n        // make sure color ramp texture is generated for default heatmap color too\r\n        this._updateColorRamp();\r\n    }\r\n\r\n    setPaintProperty(name: string, value: mixed, options: {validate: boolean}) {\r\n        super.setPaintProperty(name, value, options);\r\n        if (name === 'heatmap-color') {\r\n            this._updateColorRamp();\r\n        }\r\n    }\r\n\r\n    _updateColorRamp() {\r\n        const expression = this._transitionablePaint._values['heatmap-color'].value.expression;\r\n        const colorRampData = new Uint8Array(256 * 4);\r\n        const len = colorRampData.length;\r\n        for (let i = 4; i < len; i += 4) {\r\n            const pxColor = expression.evaluate(({heatmapDensity: i / len}: any));\r\n            // the colors are being unpremultiplied because Color uses\r\n            // premultiplied values, and the Texture class expects unpremultiplied ones\r\n            colorRampData[i + 0] = Math.floor(pxColor.r * 255 / pxColor.a);\r\n            colorRampData[i + 1] = Math.floor(pxColor.g * 255 / pxColor.a);\r\n            colorRampData[i + 2] = Math.floor(pxColor.b * 255 / pxColor.a);\r\n            colorRampData[i + 3] = Math.floor(pxColor.a * 255);\r\n        }\r\n        this.colorRamp = new RGBAImage({width: 256, height: 1}, colorRampData);\r\n        this.colorRampTexture = null;\r\n    }\r\n\r\n    resize() {\r\n        if (this.heatmapFbo) {\r\n            this.heatmapFbo.destroy();\r\n            this.heatmapFbo = null;\r\n        }\r\n    }\r\n\r\n    queryRadius(): number {\r\n        return 0;\r\n    }\r\n\r\n    queryIntersectsFeature(): boolean  {\r\n        return false;\r\n    }\r\n\r\n    hasOffscreenPass() {\r\n        return this.paint.get('heatmap-opacity') !== 0 && this.visibility !== 'none';\r\n    }\r\n}\r\n\r\nmodule.exports = HeatmapStyleLayer;\r\n","// @flow\r\n\r\nconst CircleBucket = require('./circle_bucket');\r\nconst {register} = require('../../util/web_worker_transfer');\r\n\r\nimport type HeatmapStyleLayer from '../../style/style_layer/heatmap_style_layer';\r\n\r\nclass HeatmapBucket extends CircleBucket<HeatmapStyleLayer> {\r\n    // Needed for flow to accept omit: ['layers'] below, due to\r\n    // https://github.com/facebook/flow/issues/4262\r\n    layers: Array<HeatmapStyleLayer>;\r\n}\r\n\r\nregister('HeatmapBucket', HeatmapBucket, {omit: ['layers']});\r\n\r\nmodule.exports = HeatmapBucket;\r\n","// This file is generated. Edit build/generate-style-code.js, then run `yarn run codegen`.\r\n// @flow\r\n/* eslint-disable */\r\n\r\nconst styleSpec = require('../../style-spec/reference/latest');\r\n\r\nconst {\r\n    Properties,\r\n    DataConstantProperty,\r\n    DataDrivenProperty,\r\n    CrossFadedProperty,\r\n    HeatmapColorProperty\r\n} = require('../properties');\r\n\r\nimport type Color from '../../style-spec/util/color';\r\n\r\n\r\nexport type PaintProps = {|\r\n    \"heatmap-radius\": DataDrivenProperty<number>,\r\n    \"heatmap-weight\": DataDrivenProperty<number>,\r\n    \"heatmap-intensity\": DataConstantProperty<number>,\r\n    \"heatmap-color\": HeatmapColorProperty,\r\n    \"heatmap-opacity\": DataConstantProperty<number>,\r\n|};\r\n\r\nconst paint: Properties<PaintProps> = new Properties({\r\n    \"heatmap-radius\": new DataDrivenProperty(styleSpec[\"paint_heatmap\"][\"heatmap-radius\"]),\r\n    \"heatmap-weight\": new DataDrivenProperty(styleSpec[\"paint_heatmap\"][\"heatmap-weight\"]),\r\n    \"heatmap-intensity\": new DataConstantProperty(styleSpec[\"paint_heatmap\"][\"heatmap-intensity\"]),\r\n    \"heatmap-color\": new HeatmapColorProperty(styleSpec[\"paint_heatmap\"][\"heatmap-color\"]),\r\n    \"heatmap-opacity\": new DataConstantProperty(styleSpec[\"paint_heatmap\"][\"heatmap-opacity\"]),\r\n});\r\n\r\nmodule.exports = { paint };\r\n","// @flow\r\n\r\nconst StyleLayer = require('../style_layer');\r\nconst properties = require('./hillshade_style_layer_properties');\r\n\r\nconst {\r\n    Transitionable,\r\n    Transitioning,\r\n    PossiblyEvaluated\r\n} = require('../properties');\r\n\r\nimport type {PaintProps} from './hillshade_style_layer_properties';\r\n\r\nclass HillshadeStyleLayer extends StyleLayer {\r\n    _transitionablePaint: Transitionable<PaintProps>;\r\n    _transitioningPaint: Transitioning<PaintProps>;\r\n    paint: PossiblyEvaluated<PaintProps>;\r\n\r\n    constructor(layer: LayerSpecification) {\r\n        super(layer, properties);\r\n    }\r\n\r\n    hasOffscreenPass() {\r\n        return this.paint.get('hillshade-exaggeration') !== 0 && this.visibility !== 'none';\r\n    }\r\n}\r\n\r\nmodule.exports = HillshadeStyleLayer;\r\n","// This file is generated. Edit build/generate-style-code.js, then run `yarn run codegen`.\r\n// @flow\r\n/* eslint-disable */\r\n\r\nconst styleSpec = require('../../style-spec/reference/latest');\r\n\r\nconst {\r\n    Properties,\r\n    DataConstantProperty,\r\n    DataDrivenProperty,\r\n    CrossFadedProperty,\r\n    HeatmapColorProperty\r\n} = require('../properties');\r\n\r\nimport type Color from '../../style-spec/util/color';\r\n\r\n\r\nexport type PaintProps = {|\r\n    \"hillshade-illumination-direction\": DataConstantProperty<number>,\r\n    \"hillshade-illumination-anchor\": DataConstantProperty<\"map\" | \"viewport\">,\r\n    \"hillshade-exaggeration\": DataConstantProperty<number>,\r\n    \"hillshade-shadow-color\": DataConstantProperty<Color>,\r\n    \"hillshade-highlight-color\": DataConstantProperty<Color>,\r\n    \"hillshade-accent-color\": DataConstantProperty<Color>,\r\n|};\r\n\r\nconst paint: Properties<PaintProps> = new Properties({\r\n    \"hillshade-illumination-direction\": new DataConstantProperty(styleSpec[\"paint_hillshade\"][\"hillshade-illumination-direction\"]),\r\n    \"hillshade-illumination-anchor\": new DataConstantProperty(styleSpec[\"paint_hillshade\"][\"hillshade-illumination-anchor\"]),\r\n    \"hillshade-exaggeration\": new DataConstantProperty(styleSpec[\"paint_hillshade\"][\"hillshade-exaggeration\"]),\r\n    \"hillshade-shadow-color\": new DataConstantProperty(styleSpec[\"paint_hillshade\"][\"hillshade-shadow-color\"]),\r\n    \"hillshade-highlight-color\": new DataConstantProperty(styleSpec[\"paint_hillshade\"][\"hillshade-highlight-color\"]),\r\n    \"hillshade-accent-color\": new DataConstantProperty(styleSpec[\"paint_hillshade\"][\"hillshade-accent-color\"]),\r\n});\r\n\r\nmodule.exports = { paint };\r\n","// @flow\r\n\r\nconst StyleLayer = require('../style_layer');\r\nconst FillBucket = require('../../data/bucket/fill_bucket');\r\nconst {multiPolygonIntersectsMultiPolygon} = require('../../util/intersection_tests');\r\nconst {translateDistance, translate} = require('../query_utils');\r\nconst properties = require('./fill_style_layer_properties');\r\n\r\nconst {\r\n    Transitionable,\r\n    Transitioning,\r\n    PossiblyEvaluated\r\n} = require('../properties');\r\n\r\nimport type {BucketParameters} from '../../data/bucket';\r\nimport type Point from '@mapbox/point-geometry';\r\nimport type {PaintProps} from './fill_style_layer_properties';\r\nimport type EvaluationParameters from '../evaluation_parameters';\r\n\r\nclass FillStyleLayer extends StyleLayer {\r\n    _transitionablePaint: Transitionable<PaintProps>;\r\n    _transitioningPaint: Transitioning<PaintProps>;\r\n    paint: PossiblyEvaluated<PaintProps>;\r\n\r\n    constructor(layer: LayerSpecification) {\r\n        super(layer, properties);\r\n    }\r\n\r\n    recalculate(parameters: EvaluationParameters) {\r\n        this.paint = this._transitioningPaint.possiblyEvaluate(parameters);\r\n\r\n        if (this._transitionablePaint.getValue('fill-outline-color') === undefined) {\r\n            this.paint._values['fill-outline-color'] = this.paint._values['fill-color'];\r\n        }\r\n    }\r\n\r\n    createBucket(parameters: BucketParameters<*>) {\r\n        return new FillBucket(parameters);\r\n    }\r\n\r\n    queryRadius(): number {\r\n        return translateDistance(this.paint.get('fill-translate'));\r\n    }\r\n\r\n    queryIntersectsFeature(queryGeometry: Array<Array<Point>>,\r\n                           feature: VectorTileFeature,\r\n                           geometry: Array<Array<Point>>,\r\n                           zoom: number,\r\n                           bearing: number,\r\n                           pixelsToTileUnits: number): boolean {\r\n        const translatedPolygon = translate(queryGeometry,\r\n            this.paint.get('fill-translate'),\r\n            this.paint.get('fill-translate-anchor'),\r\n            bearing, pixelsToTileUnits);\r\n        return multiPolygonIntersectsMultiPolygon(translatedPolygon, geometry);\r\n    }\r\n}\r\n\r\nmodule.exports = FillStyleLayer;\r\n","// @flow\r\n\r\nconst {FillLayoutArray} = require('../array_types');\r\nconst layoutAttributes = require('./fill_attributes').members;\r\nconst {SegmentVector} = require('../segment');\r\nconst {ProgramConfigurationSet} = require('../program_configuration');\r\nconst {LineIndexArray, TriangleIndexArray} = require('../index_array_type');\r\nconst loadGeometry = require('../load_geometry');\r\nconst earcut = require('earcut');\r\nconst classifyRings = require('../../util/classify_rings');\r\nconst assert = require('assert');\r\nconst EARCUT_MAX_RINGS = 500;\r\nconst {register} = require('../../util/web_worker_transfer');\r\n\r\nimport type {\r\n    Bucket,\r\n    BucketParameters,\r\n    IndexedFeature,\r\n    PopulateParameters\r\n} from '../bucket';\r\nimport type FillStyleLayer from '../../style/style_layer/fill_style_layer';\r\nimport type Context from '../../gl/context';\r\nimport type IndexBuffer from '../../gl/index_buffer';\r\nimport type VertexBuffer from '../../gl/vertex_buffer';\r\nimport type Point from '@mapbox/point-geometry';\r\n\r\nclass FillBucket implements Bucket {\r\n    index: number;\r\n    zoom: number;\r\n    overscaling: number;\r\n    layers: Array<FillStyleLayer>;\r\n    layerIds: Array<string>;\r\n\r\n    layoutVertexArray: FillLayoutArray;\r\n    layoutVertexBuffer: VertexBuffer;\r\n\r\n    indexArray: TriangleIndexArray;\r\n    indexBuffer: IndexBuffer;\r\n\r\n    indexArray2: LineIndexArray;\r\n    indexBuffer2: IndexBuffer;\r\n\r\n    programConfigurations: ProgramConfigurationSet<FillStyleLayer>;\r\n    segments: SegmentVector;\r\n    segments2: SegmentVector;\r\n    uploaded: boolean;\r\n\r\n    constructor(options: BucketParameters<FillStyleLayer>) {\r\n        this.zoom = options.zoom;\r\n        this.overscaling = options.overscaling;\r\n        this.layers = options.layers;\r\n        this.layerIds = this.layers.map(layer => layer.id);\r\n        this.index = options.index;\r\n\r\n        this.layoutVertexArray = new FillLayoutArray();\r\n        this.indexArray = new TriangleIndexArray();\r\n        this.indexArray2 = new LineIndexArray();\r\n        this.programConfigurations = new ProgramConfigurationSet(layoutAttributes, options.layers, options.zoom);\r\n        this.segments = new SegmentVector();\r\n        this.segments2 = new SegmentVector();\r\n    }\r\n\r\n    populate(features: Array<IndexedFeature>, options: PopulateParameters) {\r\n        for (const {feature, index, sourceLayerIndex} of features) {\r\n            if (this.layers[0]._featureFilter({zoom: this.zoom}, feature)) {\r\n                const geometry = loadGeometry(feature);\r\n                this.addFeature(feature, geometry);\r\n                options.featureIndex.insert(feature, geometry, index, sourceLayerIndex, this.index);\r\n            }\r\n        }\r\n    }\r\n\r\n    isEmpty() {\r\n        return this.layoutVertexArray.length === 0;\r\n    }\r\n\r\n    upload(context: Context) {\r\n        this.layoutVertexBuffer = context.createVertexBuffer(this.layoutVertexArray, layoutAttributes);\r\n        this.indexBuffer = context.createIndexBuffer(this.indexArray);\r\n        this.indexBuffer2 = context.createIndexBuffer(this.indexArray2);\r\n        this.programConfigurations.upload(context);\r\n    }\r\n\r\n    destroy() {\r\n        if (!this.layoutVertexBuffer) return;\r\n        this.layoutVertexBuffer.destroy();\r\n        this.indexBuffer.destroy();\r\n        this.indexBuffer2.destroy();\r\n        this.programConfigurations.destroy();\r\n        this.segments.destroy();\r\n        this.segments2.destroy();\r\n    }\r\n\r\n    addFeature(feature: VectorTileFeature, geometry: Array<Array<Point>>) {\r\n        for (const polygon of classifyRings(geometry, EARCUT_MAX_RINGS)) {\r\n            let numVertices = 0;\r\n            for (const ring of polygon) {\r\n                numVertices += ring.length;\r\n            }\r\n\r\n            const triangleSegment = this.segments.prepareSegment(numVertices, this.layoutVertexArray, this.indexArray);\r\n            const triangleIndex = triangleSegment.vertexLength;\r\n\r\n            const flattened = [];\r\n            const holeIndices = [];\r\n\r\n            for (const ring of polygon) {\r\n                if (ring.length === 0) {\r\n                    continue;\r\n                }\r\n\r\n                if (ring !== polygon[0]) {\r\n                    holeIndices.push(flattened.length / 2);\r\n                }\r\n\r\n                const lineSegment = this.segments2.prepareSegment(ring.length, this.layoutVertexArray, this.indexArray2);\r\n                const lineIndex = lineSegment.vertexLength;\r\n\r\n                this.layoutVertexArray.emplaceBack(ring[0].x, ring[0].y);\r\n                this.indexArray2.emplaceBack(lineIndex + ring.length - 1, lineIndex);\r\n                flattened.push(ring[0].x);\r\n                flattened.push(ring[0].y);\r\n\r\n                for (let i = 1; i < ring.length; i++) {\r\n                    this.layoutVertexArray.emplaceBack(ring[i].x, ring[i].y);\r\n                    this.indexArray2.emplaceBack(lineIndex + i - 1, lineIndex + i);\r\n                    flattened.push(ring[i].x);\r\n                    flattened.push(ring[i].y);\r\n                }\r\n\r\n                lineSegment.vertexLength += ring.length;\r\n                lineSegment.primitiveLength += ring.length;\r\n            }\r\n\r\n            const indices = earcut(flattened, holeIndices);\r\n            assert(indices.length % 3 === 0);\r\n\r\n            for (let i = 0; i < indices.length; i += 3) {\r\n                this.indexArray.emplaceBack(\r\n                    triangleIndex + indices[i],\r\n                    triangleIndex + indices[i + 1],\r\n                    triangleIndex + indices[i + 2]);\r\n            }\r\n\r\n            triangleSegment.vertexLength += numVertices;\r\n            triangleSegment.primitiveLength += indices.length / 3;\r\n        }\r\n\r\n        this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length, feature);\r\n    }\r\n}\r\n\r\nregister('FillBucket', FillBucket, {omit: ['layers']});\r\n\r\nmodule.exports = FillBucket;\r\n","// @flow\r\nconst {createLayout} = require('../../util/struct_array');\r\nmodule.exports = createLayout([\r\n    {name: 'a_pos', components: 2, type: 'Int16'}\r\n], 4);\r\n","'use strict';\n\nmodule.exports = partialSort;\n\n// Floyd-Rivest selection algorithm:\n// Rearrange items so that all items in the [left, k] range are smaller than all items in (k, right];\n// The k-th element will have the (k - left + 1)th smallest value in [left, right]\n\nfunction partialSort(arr, k, left, right, compare) {\n    left = left || 0;\n    right = right || (arr.length - 1);\n    compare = compare || defaultCompare;\n\n    while (right > left) {\n        if (right - left > 600) {\n            var n = right - left + 1;\n            var m = k - left + 1;\n            var z = Math.log(n);\n            var s = 0.5 * Math.exp(2 * z / 3);\n            var sd = 0.5 * Math.sqrt(z * s * (n - s) / n) * (m - n / 2 < 0 ? -1 : 1);\n            var newLeft = Math.max(left, Math.floor(k - m * s / n + sd));\n            var newRight = Math.min(right, Math.floor(k + (n - m) * s / n + sd));\n            partialSort(arr, k, newLeft, newRight, compare);\n        }\n\n        var t = arr[k];\n        var i = left;\n        var j = right;\n\n        swap(arr, left, k);\n        if (compare(arr[right], t) > 0) swap(arr, left, right);\n\n        while (i < j) {\n            swap(arr, i, j);\n            i++;\n            j--;\n            while (compare(arr[i], t) < 0) i++;\n            while (compare(arr[j], t) > 0) j--;\n        }\n\n        if (compare(arr[left], t) === 0) swap(arr, left, j);\n        else {\n            j++;\n            swap(arr, j, right);\n        }\n\n        if (j <= k) left = j + 1;\n        if (k <= j) right = j - 1;\n    }\n}\n\nfunction swap(arr, i, j) {\n    var tmp = arr[i];\n    arr[i] = arr[j];\n    arr[j] = tmp;\n}\n\nfunction defaultCompare(a, b) {\n    return a < b ? -1 : a > b ? 1 : 0;\n}\n","// This file is generated. Edit build/generate-style-code.js, then run `yarn run codegen`.\r\n// @flow\r\n/* eslint-disable */\r\n\r\nconst styleSpec = require('../../style-spec/reference/latest');\r\n\r\nconst {\r\n    Properties,\r\n    DataConstantProperty,\r\n    DataDrivenProperty,\r\n    CrossFadedProperty,\r\n    HeatmapColorProperty\r\n} = require('../properties');\r\n\r\nimport type Color from '../../style-spec/util/color';\r\n\r\n\r\nexport type PaintProps = {|\r\n    \"fill-antialias\": DataConstantProperty<boolean>,\r\n    \"fill-opacity\": DataDrivenProperty<number>,\r\n    \"fill-color\": DataDrivenProperty<Color>,\r\n    \"fill-outline-color\": DataDrivenProperty<Color>,\r\n    \"fill-translate\": DataConstantProperty<[number, number]>,\r\n    \"fill-translate-anchor\": DataConstantProperty<\"map\" | \"viewport\">,\r\n    \"fill-pattern\": CrossFadedProperty<string>,\r\n|};\r\n\r\nconst paint: Properties<PaintProps> = new Properties({\r\n    \"fill-antialias\": new DataConstantProperty(styleSpec[\"paint_fill\"][\"fill-antialias\"]),\r\n    \"fill-opacity\": new DataDrivenProperty(styleSpec[\"paint_fill\"][\"fill-opacity\"]),\r\n    \"fill-color\": new DataDrivenProperty(styleSpec[\"paint_fill\"][\"fill-color\"]),\r\n    \"fill-outline-color\": new DataDrivenProperty(styleSpec[\"paint_fill\"][\"fill-outline-color\"]),\r\n    \"fill-translate\": new DataConstantProperty(styleSpec[\"paint_fill\"][\"fill-translate\"]),\r\n    \"fill-translate-anchor\": new DataConstantProperty(styleSpec[\"paint_fill\"][\"fill-translate-anchor\"]),\r\n    \"fill-pattern\": new CrossFadedProperty(styleSpec[\"paint_fill\"][\"fill-pattern\"]),\r\n});\r\n\r\nmodule.exports = { paint };\r\n","// @flow\r\n\r\nconst StyleLayer = require('../style_layer');\r\nconst FillExtrusionBucket = require('../../data/bucket/fill_extrusion_bucket');\r\nconst {multiPolygonIntersectsMultiPolygon} = require('../../util/intersection_tests');\r\nconst {translateDistance, translate} = require('../query_utils');\r\nconst properties = require('./fill_extrusion_style_layer_properties');\r\n\r\nconst {\r\n    Transitionable,\r\n    Transitioning,\r\n    PossiblyEvaluated\r\n} = require('../properties');\r\n\r\nimport type {BucketParameters} from '../../data/bucket';\r\nimport type Point from '@mapbox/point-geometry';\r\nimport type {PaintProps} from './fill_extrusion_style_layer_properties';\r\nimport type Framebuffer from '../../gl/framebuffer';\r\n\r\nclass FillExtrusionStyleLayer extends StyleLayer {\r\n    _transitionablePaint: Transitionable<PaintProps>;\r\n    _transitioningPaint: Transitioning<PaintProps>;\r\n    paint: PossiblyEvaluated<PaintProps>;\r\n    viewportFrame: ?Framebuffer;\r\n\r\n    constructor(layer: LayerSpecification) {\r\n        super(layer, properties);\r\n    }\r\n\r\n    createBucket(parameters: BucketParameters<FillExtrusionStyleLayer>) {\r\n        return new FillExtrusionBucket(parameters);\r\n    }\r\n\r\n    queryRadius(): number {\r\n        return translateDistance(this.paint.get('fill-extrusion-translate'));\r\n    }\r\n\r\n    queryIntersectsFeature(queryGeometry: Array<Array<Point>>,\r\n                           feature: VectorTileFeature,\r\n                           geometry: Array<Array<Point>>,\r\n                           zoom: number,\r\n                           bearing: number,\r\n                           pixelsToTileUnits: number): boolean {\r\n        const translatedPolygon = translate(queryGeometry,\r\n            this.paint.get('fill-extrusion-translate'),\r\n            this.paint.get('fill-extrusion-translate-anchor'),\r\n            bearing, pixelsToTileUnits);\r\n        return multiPolygonIntersectsMultiPolygon(translatedPolygon, geometry);\r\n    }\r\n\r\n    hasOffscreenPass() {\r\n        return this.paint.get('fill-extrusion-opacity') !== 0 && this.visibility !== 'none';\r\n    }\r\n\r\n    resize() {\r\n        if (this.viewportFrame) {\r\n            this.viewportFrame.destroy();\r\n            this.viewportFrame = null;\r\n        }\r\n    }\r\n}\r\n\r\nmodule.exports = FillExtrusionStyleLayer;\r\n","// @flow\r\n\r\nconst {FillExtrusionLayoutArray} = require('../array_types');\r\nconst layoutAttributes = require('./fill_extrusion_attributes').members;\r\nconst {SegmentVector, MAX_VERTEX_ARRAY_LENGTH} = require('../segment');\r\nconst {ProgramConfigurationSet} = require('../program_configuration');\r\nconst {TriangleIndexArray} = require('../index_array_type');\r\nconst loadGeometry = require('../load_geometry');\r\nconst EXTENT = require('../extent');\r\nconst earcut = require('earcut');\r\nconst classifyRings = require('../../util/classify_rings');\r\nconst assert = require('assert');\r\nconst EARCUT_MAX_RINGS = 500;\r\nconst {register} = require('../../util/web_worker_transfer');\r\n\r\nimport type {\r\n    Bucket,\r\n    BucketParameters,\r\n    IndexedFeature,\r\n    PopulateParameters\r\n} from '../bucket';\r\nimport type FillExtrusionStyleLayer from '../../style/style_layer/fill_extrusion_style_layer';\r\nimport type Context from '../../gl/context';\r\nimport type IndexBuffer from '../../gl/index_buffer';\r\nimport type VertexBuffer from '../../gl/vertex_buffer';\r\nimport type Point from '@mapbox/point-geometry';\r\n\r\nconst FACTOR = Math.pow(2, 13);\r\n\r\nfunction addVertex(vertexArray, x, y, nx, ny, nz, t, e) {\r\n    vertexArray.emplaceBack(\r\n        // a_pos\r\n        x,\r\n        y,\r\n        // a_normal_ed: 3-component normal and 1-component edgedistance\r\n        Math.floor(nx * FACTOR) * 2 + t,\r\n        ny * FACTOR * 2,\r\n        nz * FACTOR * 2,\r\n        // edgedistance (used for wrapping patterns around extrusion sides)\r\n        Math.round(e)\r\n    );\r\n}\r\n\r\n\r\nclass FillExtrusionBucket implements Bucket {\r\n    index: number;\r\n    zoom: number;\r\n    overscaling: number;\r\n    layers: Array<FillExtrusionStyleLayer>;\r\n    layerIds: Array<string>;\r\n\r\n    layoutVertexArray: FillExtrusionLayoutArray;\r\n    layoutVertexBuffer: VertexBuffer;\r\n\r\n    indexArray: TriangleIndexArray;\r\n    indexBuffer: IndexBuffer;\r\n\r\n    programConfigurations: ProgramConfigurationSet<FillExtrusionStyleLayer>;\r\n    segments: SegmentVector;\r\n    uploaded: boolean;\r\n\r\n    constructor(options: BucketParameters<FillExtrusionStyleLayer>) {\r\n        this.zoom = options.zoom;\r\n        this.overscaling = options.overscaling;\r\n        this.layers = options.layers;\r\n        this.layerIds = this.layers.map(layer => layer.id);\r\n        this.index = options.index;\r\n\r\n        this.layoutVertexArray = new FillExtrusionLayoutArray();\r\n        this.indexArray = new TriangleIndexArray();\r\n        this.programConfigurations = new ProgramConfigurationSet(layoutAttributes, options.layers, options.zoom);\r\n        this.segments = new SegmentVector();\r\n    }\r\n\r\n    populate(features: Array<IndexedFeature>, options: PopulateParameters) {\r\n        for (const {feature, index, sourceLayerIndex} of features) {\r\n            if (this.layers[0]._featureFilter({zoom: this.zoom}, feature)) {\r\n                const geometry = loadGeometry(feature);\r\n                this.addFeature(feature, geometry);\r\n                options.featureIndex.insert(feature, geometry, index, sourceLayerIndex, this.index);\r\n            }\r\n        }\r\n    }\r\n\r\n    isEmpty() {\r\n        return this.layoutVertexArray.length === 0;\r\n    }\r\n\r\n    upload(context: Context) {\r\n        this.layoutVertexBuffer = context.createVertexBuffer(this.layoutVertexArray, layoutAttributes);\r\n        this.indexBuffer = context.createIndexBuffer(this.indexArray);\r\n        this.programConfigurations.upload(context);\r\n    }\r\n\r\n    destroy() {\r\n        if (!this.layoutVertexBuffer) return;\r\n        this.layoutVertexBuffer.destroy();\r\n        this.indexBuffer.destroy();\r\n        this.programConfigurations.destroy();\r\n        this.segments.destroy();\r\n    }\r\n\r\n    addFeature(feature: VectorTileFeature, geometry: Array<Array<Point>>) {\r\n        for (const polygon of classifyRings(geometry, EARCUT_MAX_RINGS)) {\r\n            let numVertices = 0;\r\n            for (const ring of polygon) {\r\n                numVertices += ring.length;\r\n            }\r\n            let segment = this.segments.prepareSegment(4, this.layoutVertexArray, this.indexArray);\r\n\r\n            for (const ring of polygon) {\r\n                if (ring.length === 0) {\r\n                    continue;\r\n                }\r\n\r\n                if (isEntirelyOutside(ring)) {\r\n                    continue;\r\n                }\r\n\r\n                let edgeDistance = 0;\r\n\r\n                for (let p = 0; p < ring.length; p++) {\r\n                    const p1 = ring[p];\r\n\r\n                    if (p >= 1) {\r\n                        const p2 = ring[p - 1];\r\n\r\n                        if (!isBoundaryEdge(p1, p2)) {\r\n                            if (segment.vertexLength + 4 > MAX_VERTEX_ARRAY_LENGTH) {\r\n                                segment = this.segments.prepareSegment(4, this.layoutVertexArray, this.indexArray);\r\n                            }\r\n\r\n                            const perp = p1.sub(p2)._perp()._unit();\r\n                            const dist = p2.dist(p1);\r\n                            if (edgeDistance + dist > 32768) edgeDistance = 0;\r\n\r\n                            addVertex(this.layoutVertexArray, p1.x, p1.y, perp.x, perp.y, 0, 0, edgeDistance);\r\n                            addVertex(this.layoutVertexArray, p1.x, p1.y, perp.x, perp.y, 0, 1, edgeDistance);\r\n\r\n                            edgeDistance += dist;\r\n\r\n                            addVertex(this.layoutVertexArray, p2.x, p2.y, perp.x, perp.y, 0, 0, edgeDistance);\r\n                            addVertex(this.layoutVertexArray, p2.x, p2.y, perp.x, perp.y, 0, 1, edgeDistance);\r\n\r\n                            const bottomRight = segment.vertexLength;\r\n\r\n                            this.indexArray.emplaceBack(bottomRight, bottomRight + 1, bottomRight + 2);\r\n                            this.indexArray.emplaceBack(bottomRight + 1, bottomRight + 2, bottomRight + 3);\r\n\r\n                            segment.vertexLength += 4;\r\n                            segment.primitiveLength += 2;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n\r\n            if (segment.vertexLength + numVertices > MAX_VERTEX_ARRAY_LENGTH) {\r\n                segment = this.segments.prepareSegment(numVertices, this.layoutVertexArray, this.indexArray);\r\n            }\r\n\r\n            const flattened = [];\r\n            const holeIndices = [];\r\n            const triangleIndex = segment.vertexLength;\r\n\r\n            for (const ring of polygon) {\r\n                if (ring.length === 0) {\r\n                    continue;\r\n                }\r\n\r\n                if (ring !== polygon[0]) {\r\n                    holeIndices.push(flattened.length / 2);\r\n                }\r\n\r\n                for (let i = 0; i < ring.length; i++) {\r\n                    const p = ring[i];\r\n\r\n                    addVertex(this.layoutVertexArray, p.x, p.y, 0, 0, 1, 1, 0);\r\n\r\n                    flattened.push(p.x);\r\n                    flattened.push(p.y);\r\n                }\r\n            }\r\n\r\n            const indices = earcut(flattened, holeIndices);\r\n            assert(indices.length % 3 === 0);\r\n\r\n            for (let j = 0; j < indices.length; j += 3) {\r\n                this.indexArray.emplaceBack(\r\n                    triangleIndex + indices[j],\r\n                    triangleIndex + indices[j + 1],\r\n                    triangleIndex + indices[j + 2]);\r\n            }\r\n\r\n            segment.primitiveLength += indices.length / 3;\r\n            segment.vertexLength += numVertices;\r\n        }\r\n\r\n        this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length, feature);\r\n    }\r\n}\r\n\r\nregister('FillExtrusionBucket', FillExtrusionBucket, {omit: ['layers']});\r\n\r\nmodule.exports = FillExtrusionBucket;\r\n\r\nfunction isBoundaryEdge(p1, p2) {\r\n    return (p1.x === p2.x && (p1.x < 0 || p1.x > EXTENT)) ||\r\n        (p1.y === p2.y && (p1.y < 0 || p1.y > EXTENT));\r\n}\r\n\r\nfunction isEntirelyOutside(ring) {\r\n    return ring.every(p => p.x < 0) ||\r\n        ring.every(p => p.x > EXTENT) ||\r\n        ring.every(p => p.y < 0) ||\r\n        ring.every(p => p.y > EXTENT);\r\n}\r\n","// @flow\r\nconst {createLayout} = require('../../util/struct_array');\r\nmodule.exports = createLayout([\r\n    {name: 'a_pos',          components: 2, type: 'Int16'},\r\n    {name: 'a_normal_ed',    components: 4, type: 'Int16'},\r\n], 4);\r\n","// This file is generated. Edit build/generate-style-code.js, then run `yarn run codegen`.\r\n// @flow\r\n/* eslint-disable */\r\n\r\nconst styleSpec = require('../../style-spec/reference/latest');\r\n\r\nconst {\r\n    Properties,\r\n    DataConstantProperty,\r\n    DataDrivenProperty,\r\n    CrossFadedProperty,\r\n    HeatmapColorProperty\r\n} = require('../properties');\r\n\r\nimport type Color from '../../style-spec/util/color';\r\n\r\n\r\nexport type PaintProps = {|\r\n    \"fill-extrusion-opacity\": DataConstantProperty<number>,\r\n    \"fill-extrusion-color\": DataDrivenProperty<Color>,\r\n    \"fill-extrusion-translate\": DataConstantProperty<[number, number]>,\r\n    \"fill-extrusion-translate-anchor\": DataConstantProperty<\"map\" | \"viewport\">,\r\n    \"fill-extrusion-pattern\": CrossFadedProperty<string>,\r\n    \"fill-extrusion-height\": DataDrivenProperty<number>,\r\n    \"fill-extrusion-base\": DataDrivenProperty<number>,\r\n|};\r\n\r\nconst paint: Properties<PaintProps> = new Properties({\r\n    \"fill-extrusion-opacity\": new DataConstantProperty(styleSpec[\"paint_fill-extrusion\"][\"fill-extrusion-opacity\"]),\r\n    \"fill-extrusion-color\": new DataDrivenProperty(styleSpec[\"paint_fill-extrusion\"][\"fill-extrusion-color\"]),\r\n    \"fill-extrusion-translate\": new DataConstantProperty(styleSpec[\"paint_fill-extrusion\"][\"fill-extrusion-translate\"]),\r\n    \"fill-extrusion-translate-anchor\": new DataConstantProperty(styleSpec[\"paint_fill-extrusion\"][\"fill-extrusion-translate-anchor\"]),\r\n    \"fill-extrusion-pattern\": new CrossFadedProperty(styleSpec[\"paint_fill-extrusion\"][\"fill-extrusion-pattern\"]),\r\n    \"fill-extrusion-height\": new DataDrivenProperty(styleSpec[\"paint_fill-extrusion\"][\"fill-extrusion-height\"]),\r\n    \"fill-extrusion-base\": new DataDrivenProperty(styleSpec[\"paint_fill-extrusion\"][\"fill-extrusion-base\"]),\r\n});\r\n\r\nmodule.exports = { paint };\r\n","// @flow\r\n\r\nconst Point = require('@mapbox/point-geometry');\r\n\r\nconst StyleLayer = require('../style_layer');\r\nconst LineBucket = require('../../data/bucket/line_bucket');\r\nconst {multiPolygonIntersectsBufferedMultiLine} = require('../../util/intersection_tests');\r\nconst {getMaximumPaintValue, translateDistance, translate} = require('../query_utils');\r\nconst properties = require('./line_style_layer_properties');\r\nconst {extend} = require('../../util/util');\r\nconst EvaluationParameters = require('../evaluation_parameters');\r\n\r\nconst {\r\n    Transitionable,\r\n    Transitioning,\r\n    Layout,\r\n    PossiblyEvaluated,\r\n    DataDrivenProperty\r\n} = require('../properties');\r\n\r\nimport type {Bucket, BucketParameters} from '../../data/bucket';\r\nimport type {LayoutProps, PaintProps} from './line_style_layer_properties';\r\n\r\nclass LineFloorwidthProperty extends DataDrivenProperty<number> {\r\n    useIntegerZoom: true;\r\n\r\n    possiblyEvaluate(value, parameters) {\r\n        parameters = new EvaluationParameters(Math.floor(parameters.zoom), {\r\n            now: parameters.now,\r\n            fadeDuration: parameters.fadeDuration,\r\n            zoomHistory: parameters.zoomHistory,\r\n            transition: parameters.transition\r\n        });\r\n        return super.possiblyEvaluate(value, parameters);\r\n    }\r\n\r\n    evaluate(value, globals, feature) {\r\n        globals = extend({}, globals, {zoom: Math.floor(globals.zoom)});\r\n        return super.evaluate(value, globals, feature);\r\n    }\r\n}\r\n\r\nconst lineFloorwidthProperty = new LineFloorwidthProperty(properties.paint.properties['line-width'].specification);\r\nlineFloorwidthProperty.useIntegerZoom = true;\r\n\r\nclass LineStyleLayer extends StyleLayer {\r\n    _unevaluatedLayout: Layout<LayoutProps>;\r\n    layout: PossiblyEvaluated<LayoutProps>;\r\n\r\n    _transitionablePaint: Transitionable<PaintProps>;\r\n    _transitioningPaint: Transitioning<PaintProps>;\r\n    paint: PossiblyEvaluated<PaintProps>;\r\n\r\n    constructor(layer: LayerSpecification) {\r\n        super(layer, properties);\r\n    }\r\n\r\n    recalculate(parameters: EvaluationParameters) {\r\n        super.recalculate(parameters);\r\n\r\n        (this.paint._values: any)['line-floorwidth'] =\r\n            lineFloorwidthProperty.possiblyEvaluate(this._transitioningPaint._values['line-width'].value, parameters);\r\n    }\r\n\r\n    createBucket(parameters: BucketParameters<*>) {\r\n        return new LineBucket(parameters);\r\n    }\r\n\r\n    queryRadius(bucket: Bucket): number {\r\n        const lineBucket: LineBucket = (bucket: any);\r\n        const width = getLineWidth(\r\n            getMaximumPaintValue('line-width', this, lineBucket),\r\n            getMaximumPaintValue('line-gap-width', this, lineBucket));\r\n        const offset = getMaximumPaintValue('line-offset', this, lineBucket);\r\n        return width / 2 + Math.abs(offset) + translateDistance(this.paint.get('line-translate'));\r\n    }\r\n\r\n    queryIntersectsFeature(queryGeometry: Array<Array<Point>>,\r\n                           feature: VectorTileFeature,\r\n                           geometry: Array<Array<Point>>,\r\n                           zoom: number,\r\n                           bearing: number,\r\n                           pixelsToTileUnits: number): boolean {\r\n        const translatedPolygon = translate(queryGeometry,\r\n            this.paint.get('line-translate'),\r\n            this.paint.get('line-translate-anchor'),\r\n            bearing, pixelsToTileUnits);\r\n        const halfWidth = pixelsToTileUnits / 2 * getLineWidth(\r\n            this.paint.get('line-width').evaluate(feature),\r\n            this.paint.get('line-gap-width').evaluate(feature));\r\n        const lineOffset = this.paint.get('line-offset').evaluate(feature);\r\n        if (lineOffset) {\r\n            geometry = offsetLine(geometry, lineOffset * pixelsToTileUnits);\r\n        }\r\n        return multiPolygonIntersectsBufferedMultiLine(translatedPolygon, geometry, halfWidth);\r\n    }\r\n}\r\n\r\nmodule.exports = LineStyleLayer;\r\n\r\nfunction getLineWidth(lineWidth, lineGapWidth) {\r\n    if (lineGapWidth > 0) {\r\n        return lineGapWidth + 2 * lineWidth;\r\n    } else {\r\n        return lineWidth;\r\n    }\r\n}\r\n\r\nfunction offsetLine(rings, offset) {\r\n    const newRings = [];\r\n    const zero = new Point(0, 0);\r\n    for (let k = 0; k < rings.length; k++) {\r\n        const ring = rings[k];\r\n        const newRing = [];\r\n        for (let i = 0; i < ring.length; i++) {\r\n            const a = ring[i - 1];\r\n            const b = ring[i];\r\n            const c = ring[i + 1];\r\n            const aToB = i === 0 ? zero : b.sub(a)._unit()._perp();\r\n            const bToC = i === ring.length - 1 ? zero : c.sub(b)._unit()._perp();\r\n            const extrude = aToB._add(bToC)._unit();\r\n\r\n            const cosHalfAngle = extrude.x * bToC.x + extrude.y * bToC.y;\r\n            extrude._mult(1 / cosHalfAngle);\r\n\r\n            newRing.push(extrude._mult(offset)._add(b));\r\n        }\r\n        newRings.push(newRing);\r\n    }\r\n    return newRings;\r\n}\r\n","// @flow\r\n\r\nconst {LineLayoutArray} = require('../array_types');\r\nconst layoutAttributes = require('./line_attributes').members;\r\nconst {SegmentVector} = require('../segment');\r\nconst {ProgramConfigurationSet} = require('../program_configuration');\r\nconst {TriangleIndexArray} = require('../index_array_type');\r\nconst loadGeometry = require('../load_geometry');\r\nconst EXTENT = require('../extent');\r\nconst vectorTileFeatureTypes = require('@mapbox/vector-tile').VectorTileFeature.types;\r\nconst {register} = require('../../util/web_worker_transfer');\r\n\r\nimport type {\r\n    Bucket,\r\n    BucketParameters,\r\n    IndexedFeature,\r\n    PopulateParameters\r\n} from '../bucket';\r\nimport type LineStyleLayer from '../../style/style_layer/line_style_layer';\r\nimport type Point from '@mapbox/point-geometry';\r\nimport type {Segment} from '../segment';\r\nimport type Context from '../../gl/context';\r\nimport type IndexBuffer from '../../gl/index_buffer';\r\nimport type VertexBuffer from '../../gl/vertex_buffer';\r\n\r\n// NOTE ON EXTRUDE SCALE:\r\n// scale the extrusion vector so that the normal length is this value.\r\n// contains the \"texture\" normals (-1..1). this is distinct from the extrude\r\n// normals for line joins, because the x-value remains 0 for the texture\r\n// normal array, while the extrude normal actually moves the vertex to create\r\n// the acute/bevelled line join.\r\nconst EXTRUDE_SCALE = 63;\r\n\r\n/*\r\n * Sharp corners cause dashed lines to tilt because the distance along the line\r\n * is the same at both the inner and outer corners. To improve the appearance of\r\n * dashed lines we add extra points near sharp corners so that a smaller part\r\n * of the line is tilted.\r\n *\r\n * COS_HALF_SHARP_CORNER controls how sharp a corner has to be for us to add an\r\n * extra vertex. The default is 75 degrees.\r\n *\r\n * The newly created vertices are placed SHARP_CORNER_OFFSET pixels from the corner.\r\n */\r\nconst COS_HALF_SHARP_CORNER = Math.cos(75 / 2 * (Math.PI / 180));\r\nconst SHARP_CORNER_OFFSET = 15;\r\n\r\n// The number of bits that is used to store the line distance in the buffer.\r\nconst LINE_DISTANCE_BUFFER_BITS = 15;\r\n\r\n// We don't have enough bits for the line distance as we'd like to have, so\r\n// use this value to scale the line distance (in tile units) down to a smaller\r\n// value. This lets us store longer distances while sacrificing precision.\r\nconst LINE_DISTANCE_SCALE = 1 / 2;\r\n\r\n// The maximum line distance, in tile units, that fits in the buffer.\r\nconst MAX_LINE_DISTANCE = Math.pow(2, LINE_DISTANCE_BUFFER_BITS - 1) / LINE_DISTANCE_SCALE;\r\n\r\nfunction addLineVertex(layoutVertexBuffer, point: Point, extrude: Point, round: boolean, up: boolean, dir: number, linesofar: number) {\r\n    layoutVertexBuffer.emplaceBack(\r\n        // a_pos_normal\r\n        point.x,\r\n        point.y,\r\n        round ? 1 : 0,\r\n        up ? 1 : -1,\r\n        // a_data\r\n        // add 128 to store a byte in an unsigned byte\r\n        Math.round(EXTRUDE_SCALE * extrude.x) + 128,\r\n        Math.round(EXTRUDE_SCALE * extrude.y) + 128,\r\n        // Encode the -1/0/1 direction value into the first two bits of .z of a_data.\r\n        // Combine it with the lower 6 bits of `linesofar` (shifted by 2 bites to make\r\n        // room for the direction value). The upper 8 bits of `linesofar` are placed in\r\n        // the `w` component. `linesofar` is scaled down by `LINE_DISTANCE_SCALE` so that\r\n        // we can store longer distances while sacrificing precision.\r\n        ((dir === 0 ? 0 : (dir < 0 ? -1 : 1)) + 1) | (((linesofar * LINE_DISTANCE_SCALE) & 0x3F) << 2),\r\n        (linesofar * LINE_DISTANCE_SCALE) >> 6);\r\n}\r\n\r\n\r\n/**\r\n * @private\r\n */\r\nclass LineBucket implements Bucket {\r\n    distance: number;\r\n    e1: number;\r\n    e2: number;\r\n    e3: number;\r\n\r\n    index: number;\r\n    zoom: number;\r\n    overscaling: number;\r\n    layers: Array<LineStyleLayer>;\r\n    layerIds: Array<string>;\r\n\r\n    layoutVertexArray: LineLayoutArray;\r\n    layoutVertexBuffer: VertexBuffer;\r\n\r\n    indexArray: TriangleIndexArray;\r\n    indexBuffer: IndexBuffer;\r\n\r\n    programConfigurations: ProgramConfigurationSet<LineStyleLayer>;\r\n    segments: SegmentVector;\r\n    uploaded: boolean;\r\n\r\n    constructor(options: BucketParameters<LineStyleLayer>) {\r\n        this.zoom = options.zoom;\r\n        this.overscaling = options.overscaling;\r\n        this.layers = options.layers;\r\n        this.layerIds = this.layers.map(layer => layer.id);\r\n        this.index = options.index;\r\n\r\n        this.layoutVertexArray = new LineLayoutArray();\r\n        this.indexArray = new TriangleIndexArray();\r\n        this.programConfigurations = new ProgramConfigurationSet(layoutAttributes, options.layers, options.zoom);\r\n        this.segments = new SegmentVector();\r\n    }\r\n\r\n    populate(features: Array<IndexedFeature>, options: PopulateParameters) {\r\n        for (const {feature, index, sourceLayerIndex} of features) {\r\n            if (this.layers[0]._featureFilter({zoom: this.zoom}, feature)) {\r\n                const geometry = loadGeometry(feature);\r\n                this.addFeature(feature, geometry);\r\n                options.featureIndex.insert(feature, geometry, index, sourceLayerIndex, this.index);\r\n            }\r\n        }\r\n    }\r\n\r\n    isEmpty() {\r\n        return this.layoutVertexArray.length === 0;\r\n    }\r\n\r\n    upload(context: Context) {\r\n        this.layoutVertexBuffer = context.createVertexBuffer(this.layoutVertexArray, layoutAttributes);\r\n        this.indexBuffer = context.createIndexBuffer(this.indexArray);\r\n        this.programConfigurations.upload(context);\r\n    }\r\n\r\n    destroy() {\r\n        if (!this.layoutVertexBuffer) return;\r\n        this.layoutVertexBuffer.destroy();\r\n        this.indexBuffer.destroy();\r\n        this.programConfigurations.destroy();\r\n        this.segments.destroy();\r\n    }\r\n\r\n    addFeature(feature: VectorTileFeature, geometry: Array<Array<Point>>) {\r\n        const layout = this.layers[0].layout;\r\n        const join = layout.get('line-join').evaluate(feature);\r\n        const cap = layout.get('line-cap');\r\n        const miterLimit = layout.get('line-miter-limit');\r\n        const roundLimit = layout.get('line-round-limit');\r\n\r\n        for (const line of geometry) {\r\n            this.addLine(line, feature, join, cap, miterLimit, roundLimit);\r\n        }\r\n    }\r\n\r\n    addLine(vertices: Array<Point>, feature: VectorTileFeature, join: string, cap: string, miterLimit: number, roundLimit: number) {\r\n        const isPolygon = vectorTileFeatureTypes[feature.type] === 'Polygon';\r\n\r\n        // If the line has duplicate vertices at the ends, adjust start/length to remove them.\r\n        let len = vertices.length;\r\n        while (len >= 2 && vertices[len - 1].equals(vertices[len - 2])) {\r\n            len--;\r\n        }\r\n        let first = 0;\r\n        while (first < len - 1 && vertices[first].equals(vertices[first + 1])) {\r\n            first++;\r\n        }\r\n\r\n        // Ignore invalid geometry.\r\n        if (len < (isPolygon ? 3 : 2)) return;\r\n\r\n        if (join === 'bevel') miterLimit = 1.05;\r\n\r\n        const sharpCornerOffset = SHARP_CORNER_OFFSET * (EXTENT / (512 * this.overscaling));\r\n\r\n        const firstVertex = vertices[first];\r\n\r\n        // we could be more precise, but it would only save a negligible amount of space\r\n        const segment = this.segments.prepareSegment(len * 10, this.layoutVertexArray, this.indexArray);\r\n\r\n        this.distance = 0;\r\n\r\n        const beginCap = cap,\r\n            endCap = isPolygon ? 'butt' : cap;\r\n        let startOfLine = true;\r\n        let currentVertex;\r\n        let prevVertex = ((undefined: any): Point);\r\n        let nextVertex = ((undefined: any): Point);\r\n        let prevNormal = ((undefined: any): Point);\r\n        let nextNormal = ((undefined: any): Point);\r\n        let offsetA;\r\n        let offsetB;\r\n\r\n        // the last three vertices added\r\n        this.e1 = this.e2 = this.e3 = -1;\r\n\r\n        if (isPolygon) {\r\n            currentVertex = vertices[len - 2];\r\n            nextNormal = firstVertex.sub(currentVertex)._unit()._perp();\r\n        }\r\n\r\n        for (let i = first; i < len; i++) {\r\n\r\n            nextVertex = isPolygon && i === len - 1 ?\r\n                vertices[first + 1] : // if the line is closed, we treat the last vertex like the first\r\n                vertices[i + 1]; // just the next vertex\r\n\r\n            // if two consecutive vertices exist, skip the current one\r\n            if (nextVertex && vertices[i].equals(nextVertex)) continue;\r\n\r\n            if (nextNormal) prevNormal = nextNormal;\r\n            if (currentVertex) prevVertex = currentVertex;\r\n\r\n            currentVertex = vertices[i];\r\n\r\n            // Calculate the normal towards the next vertex in this line. In case\r\n            // there is no next vertex, pretend that the line is continuing straight,\r\n            // meaning that we are just using the previous normal.\r\n            nextNormal = nextVertex ? nextVertex.sub(currentVertex)._unit()._perp() : prevNormal;\r\n\r\n            // If we still don't have a previous normal, this is the beginning of a\r\n            // non-closed line, so we're doing a straight \"join\".\r\n            prevNormal = prevNormal || nextNormal;\r\n\r\n            // Determine the normal of the join extrusion. It is the angle bisector\r\n            // of the segments between the previous line and the next line.\r\n            // In the case of 180° angles, the prev and next normals cancel each other out:\r\n            // prevNormal + nextNormal = (0, 0), its magnitude is 0, so the unit vector would be\r\n            // undefined. In that case, we're keeping the joinNormal at (0, 0), so that the cosHalfAngle\r\n            // below will also become 0 and miterLength will become Infinity.\r\n            let joinNormal = prevNormal.add(nextNormal);\r\n            if (joinNormal.x !== 0 || joinNormal.y !== 0) {\r\n                joinNormal._unit();\r\n            }\r\n            /*  joinNormal     prevNormal\r\n             *             ↖      ↑\r\n             *                .________. prevVertex\r\n             *                |\r\n             * nextNormal  ←  |  currentVertex\r\n             *                |\r\n             *     nextVertex !\r\n             *\r\n             */\r\n\r\n            // Calculate the length of the miter (the ratio of the miter to the width).\r\n            // Find the cosine of the angle between the next and join normals\r\n            // using dot product. The inverse of that is the miter length.\r\n            const cosHalfAngle = joinNormal.x * nextNormal.x + joinNormal.y * nextNormal.y;\r\n            const miterLength = cosHalfAngle !== 0 ? 1 / cosHalfAngle : Infinity;\r\n\r\n            const isSharpCorner = cosHalfAngle < COS_HALF_SHARP_CORNER && prevVertex && nextVertex;\r\n\r\n            if (isSharpCorner && i > first) {\r\n                const prevSegmentLength = currentVertex.dist(prevVertex);\r\n                if (prevSegmentLength > 2 * sharpCornerOffset) {\r\n                    const newPrevVertex = currentVertex.sub(currentVertex.sub(prevVertex)._mult(sharpCornerOffset / prevSegmentLength)._round());\r\n                    this.distance += newPrevVertex.dist(prevVertex);\r\n                    this.addCurrentVertex(newPrevVertex, this.distance, prevNormal.mult(1), 0, 0, false, segment);\r\n                    prevVertex = newPrevVertex;\r\n                }\r\n            }\r\n\r\n            // The join if a middle vertex, otherwise the cap.\r\n            const middleVertex = prevVertex && nextVertex;\r\n            let currentJoin = middleVertex ? join : nextVertex ? beginCap : endCap;\r\n\r\n            if (middleVertex && currentJoin === 'round') {\r\n                if (miterLength < roundLimit) {\r\n                    currentJoin = 'miter';\r\n                } else if (miterLength <= 2) {\r\n                    currentJoin = 'fakeround';\r\n                }\r\n            }\r\n\r\n            if (currentJoin === 'miter' && miterLength > miterLimit) {\r\n                currentJoin = 'bevel';\r\n            }\r\n\r\n            if (currentJoin === 'bevel') {\r\n                // The maximum extrude length is 128 / 63 = 2 times the width of the line\r\n                // so if miterLength >= 2 we need to draw a different type of bevel here.\r\n                if (miterLength > 2) currentJoin = 'flipbevel';\r\n\r\n                // If the miterLength is really small and the line bevel wouldn't be visible,\r\n                // just draw a miter join to save a triangle.\r\n                if (miterLength < miterLimit) currentJoin = 'miter';\r\n            }\r\n\r\n            // Calculate how far along the line the currentVertex is\r\n            if (prevVertex) this.distance += currentVertex.dist(prevVertex);\r\n\r\n            if (currentJoin === 'miter') {\r\n\r\n                joinNormal._mult(miterLength);\r\n                this.addCurrentVertex(currentVertex, this.distance, joinNormal, 0, 0, false, segment);\r\n\r\n            } else if (currentJoin === 'flipbevel') {\r\n                // miter is too big, flip the direction to make a beveled join\r\n\r\n                if (miterLength > 100) {\r\n                    // Almost parallel lines\r\n                    joinNormal = nextNormal.clone().mult(-1);\r\n\r\n                } else {\r\n                    const direction = prevNormal.x * nextNormal.y - prevNormal.y * nextNormal.x > 0 ? -1 : 1;\r\n                    const bevelLength = miterLength * prevNormal.add(nextNormal).mag() / prevNormal.sub(nextNormal).mag();\r\n                    joinNormal._perp()._mult(bevelLength * direction);\r\n                }\r\n                this.addCurrentVertex(currentVertex, this.distance, joinNormal, 0, 0, false, segment);\r\n                this.addCurrentVertex(currentVertex, this.distance, joinNormal.mult(-1), 0, 0, false, segment);\r\n\r\n            } else if (currentJoin === 'bevel' || currentJoin === 'fakeround') {\r\n                const lineTurnsLeft = (prevNormal.x * nextNormal.y - prevNormal.y * nextNormal.x) > 0;\r\n                const offset = -Math.sqrt(miterLength * miterLength - 1);\r\n                if (lineTurnsLeft) {\r\n                    offsetB = 0;\r\n                    offsetA = offset;\r\n                } else {\r\n                    offsetA = 0;\r\n                    offsetB = offset;\r\n                }\r\n\r\n                // Close previous segment with a bevel\r\n                if (!startOfLine) {\r\n                    this.addCurrentVertex(currentVertex, this.distance, prevNormal, offsetA, offsetB, false, segment);\r\n                }\r\n\r\n                if (currentJoin === 'fakeround') {\r\n                    // The join angle is sharp enough that a round join would be visible.\r\n                    // Bevel joins fill the gap between segments with a single pie slice triangle.\r\n                    // Create a round join by adding multiple pie slices. The join isn't actually round, but\r\n                    // it looks like it is at the sizes we render lines at.\r\n\r\n                    // Add more triangles for sharper angles.\r\n                    // This math is just a good enough approximation. It isn't \"correct\".\r\n                    const n = Math.floor((0.5 - (cosHalfAngle - 0.5)) * 8);\r\n                    let approxFractionalJoinNormal;\r\n\r\n                    for (let m = 0; m < n; m++) {\r\n                        approxFractionalJoinNormal = nextNormal.mult((m + 1) / (n + 1))._add(prevNormal)._unit();\r\n                        this.addPieSliceVertex(currentVertex, this.distance, approxFractionalJoinNormal, lineTurnsLeft, segment);\r\n                    }\r\n\r\n                    this.addPieSliceVertex(currentVertex, this.distance, joinNormal, lineTurnsLeft, segment);\r\n\r\n                    for (let k = n - 1; k >= 0; k--) {\r\n                        approxFractionalJoinNormal = prevNormal.mult((k + 1) / (n + 1))._add(nextNormal)._unit();\r\n                        this.addPieSliceVertex(currentVertex, this.distance, approxFractionalJoinNormal, lineTurnsLeft, segment);\r\n                    }\r\n                }\r\n\r\n                // Start next segment\r\n                if (nextVertex) {\r\n                    this.addCurrentVertex(currentVertex, this.distance, nextNormal, -offsetA, -offsetB, false, segment);\r\n                }\r\n\r\n            } else if (currentJoin === 'butt') {\r\n                if (!startOfLine) {\r\n                    // Close previous segment with a butt\r\n                    this.addCurrentVertex(currentVertex, this.distance, prevNormal, 0, 0, false, segment);\r\n                }\r\n\r\n                // Start next segment with a butt\r\n                if (nextVertex) {\r\n                    this.addCurrentVertex(currentVertex, this.distance, nextNormal, 0, 0, false, segment);\r\n                }\r\n\r\n            } else if (currentJoin === 'square') {\r\n\r\n                if (!startOfLine) {\r\n                    // Close previous segment with a square cap\r\n                    this.addCurrentVertex(currentVertex, this.distance, prevNormal, 1, 1, false, segment);\r\n\r\n                    // The segment is done. Unset vertices to disconnect segments.\r\n                    this.e1 = this.e2 = -1;\r\n                }\r\n\r\n                // Start next segment\r\n                if (nextVertex) {\r\n                    this.addCurrentVertex(currentVertex, this.distance, nextNormal, -1, -1, false, segment);\r\n                }\r\n\r\n            } else if (currentJoin === 'round') {\r\n\r\n                if (!startOfLine) {\r\n                    // Close previous segment with butt\r\n                    this.addCurrentVertex(currentVertex, this.distance, prevNormal, 0, 0, false, segment);\r\n\r\n                    // Add round cap or linejoin at end of segment\r\n                    this.addCurrentVertex(currentVertex, this.distance, prevNormal, 1, 1, true, segment);\r\n\r\n                    // The segment is done. Unset vertices to disconnect segments.\r\n                    this.e1 = this.e2 = -1;\r\n                }\r\n\r\n\r\n                // Start next segment with a butt\r\n                if (nextVertex) {\r\n                    // Add round cap before first segment\r\n                    this.addCurrentVertex(currentVertex, this.distance, nextNormal, -1, -1, true, segment);\r\n\r\n                    this.addCurrentVertex(currentVertex, this.distance, nextNormal, 0, 0, false, segment);\r\n                }\r\n            }\r\n\r\n            if (isSharpCorner && i < len - 1) {\r\n                const nextSegmentLength = currentVertex.dist(nextVertex);\r\n                if (nextSegmentLength > 2 * sharpCornerOffset) {\r\n                    const newCurrentVertex = currentVertex.add(nextVertex.sub(currentVertex)._mult(sharpCornerOffset / nextSegmentLength)._round());\r\n                    this.distance += newCurrentVertex.dist(currentVertex);\r\n                    this.addCurrentVertex(newCurrentVertex, this.distance, nextNormal.mult(1), 0, 0, false, segment);\r\n                    currentVertex = newCurrentVertex;\r\n                }\r\n            }\r\n\r\n            startOfLine = false;\r\n        }\r\n\r\n        this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length, feature);\r\n    }\r\n\r\n    /**\r\n     * Add two vertices to the buffers.\r\n     *\r\n     * @param {Object} currentVertex the line vertex to add buffer vertices for\r\n     * @param {number} distance the distance from the beginning of the line to the vertex\r\n     * @param {number} endLeft extrude to shift the left vertex along the line\r\n     * @param {number} endRight extrude to shift the left vertex along the line\r\n     * @param {boolean} round whether this is a round cap\r\n     * @private\r\n     */\r\n    addCurrentVertex(currentVertex: Point,\r\n                     distance: number,\r\n                     normal: Point,\r\n                     endLeft: number,\r\n                     endRight: number,\r\n                     round: boolean,\r\n                     segment: Segment) {\r\n        let extrude;\r\n        const layoutVertexArray = this.layoutVertexArray;\r\n        const indexArray = this.indexArray;\r\n\r\n        extrude = normal.clone();\r\n        if (endLeft) extrude._sub(normal.perp()._mult(endLeft));\r\n        addLineVertex(layoutVertexArray, currentVertex, extrude, round, false, endLeft, distance);\r\n        this.e3 = segment.vertexLength++;\r\n        if (this.e1 >= 0 && this.e2 >= 0) {\r\n            indexArray.emplaceBack(this.e1, this.e2, this.e3);\r\n            segment.primitiveLength++;\r\n        }\r\n        this.e1 = this.e2;\r\n        this.e2 = this.e3;\r\n\r\n        extrude = normal.mult(-1);\r\n        if (endRight) extrude._sub(normal.perp()._mult(endRight));\r\n        addLineVertex(layoutVertexArray, currentVertex, extrude, round, true, -endRight, distance);\r\n        this.e3 = segment.vertexLength++;\r\n        if (this.e1 >= 0 && this.e2 >= 0) {\r\n            indexArray.emplaceBack(this.e1, this.e2, this.e3);\r\n            segment.primitiveLength++;\r\n        }\r\n        this.e1 = this.e2;\r\n        this.e2 = this.e3;\r\n\r\n        // There is a maximum \"distance along the line\" that we can store in the buffers.\r\n        // When we get close to the distance, reset it to zero and add the vertex again with\r\n        // a distance of zero. The max distance is determined by the number of bits we allocate\r\n        // to `linesofar`.\r\n        if (distance > MAX_LINE_DISTANCE / 2) {\r\n            this.distance = 0;\r\n            this.addCurrentVertex(currentVertex, this.distance, normal, endLeft, endRight, round, segment);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Add a single new vertex and a triangle using two previous vertices.\r\n     * This adds a pie slice triangle near a join to simulate round joins\r\n     *\r\n     * @param currentVertex the line vertex to add buffer vertices for\r\n     * @param distance the distance from the beggining of the line to the vertex\r\n     * @param extrude the offset of the new vertex from the currentVertex\r\n     * @param lineTurnsLeft whether the line is turning left or right at this angle\r\n     * @private\r\n     */\r\n    addPieSliceVertex(currentVertex: Point,\r\n                      distance: number,\r\n                      extrude: Point,\r\n                      lineTurnsLeft: boolean,\r\n                      segment: Segment) {\r\n        extrude = extrude.mult(lineTurnsLeft ? -1 : 1);\r\n        const layoutVertexArray = this.layoutVertexArray;\r\n        const indexArray = this.indexArray;\r\n\r\n        addLineVertex(layoutVertexArray, currentVertex, extrude, false, lineTurnsLeft, 0, distance);\r\n        this.e3 = segment.vertexLength++;\r\n        if (this.e1 >= 0 && this.e2 >= 0) {\r\n            indexArray.emplaceBack(this.e1, this.e2, this.e3);\r\n            segment.primitiveLength++;\r\n        }\r\n\r\n        if (lineTurnsLeft) {\r\n            this.e2 = this.e3;\r\n        } else {\r\n            this.e1 = this.e3;\r\n        }\r\n    }\r\n}\r\n\r\nregister('LineBucket', LineBucket, {omit: ['layers']});\r\n\r\nmodule.exports = LineBucket;\r\n","// @flow\r\nconst {createLayout} = require('../../util/struct_array');\r\nmodule.exports = createLayout([\r\n    {name: 'a_pos_normal', components: 4, type: 'Int16'},\r\n    {name: 'a_data', components: 4, type: 'Uint8'}\r\n], 4);\r\n","'use strict';\n\nvar VectorTileLayer = require('./vectortilelayer');\n\nmodule.exports = VectorTile;\n\nfunction VectorTile(pbf, end) {\n    this.layers = pbf.readFields(readTile, {}, end);\n}\n\nfunction readTile(tag, layers, pbf) {\n    if (tag === 3) {\n        var layer = new VectorTileLayer(pbf, pbf.readVarint() + pbf.pos);\n        if (layer.length) layers[layer.name] = layer;\n    }\n}\n\n","// This file is generated. Edit build/generate-style-code.js, then run `yarn run codegen`.\r\n// @flow\r\n/* eslint-disable */\r\n\r\nconst styleSpec = require('../../style-spec/reference/latest');\r\n\r\nconst {\r\n    Properties,\r\n    DataConstantProperty,\r\n    DataDrivenProperty,\r\n    CrossFadedProperty,\r\n    HeatmapColorProperty\r\n} = require('../properties');\r\n\r\nimport type Color from '../../style-spec/util/color';\r\n\r\nexport type LayoutProps = {|\r\n    \"line-cap\": DataConstantProperty<\"butt\" | \"round\" | \"square\">,\r\n    \"line-join\": DataDrivenProperty<\"bevel\" | \"round\" | \"miter\">,\r\n    \"line-miter-limit\": DataConstantProperty<number>,\r\n    \"line-round-limit\": DataConstantProperty<number>,\r\n|};\r\n\r\nconst layout: Properties<LayoutProps> = new Properties({\r\n    \"line-cap\": new DataConstantProperty(styleSpec[\"layout_line\"][\"line-cap\"]),\r\n    \"line-join\": new DataDrivenProperty(styleSpec[\"layout_line\"][\"line-join\"]),\r\n    \"line-miter-limit\": new DataConstantProperty(styleSpec[\"layout_line\"][\"line-miter-limit\"]),\r\n    \"line-round-limit\": new DataConstantProperty(styleSpec[\"layout_line\"][\"line-round-limit\"]),\r\n});\r\n\r\nexport type PaintProps = {|\r\n    \"line-opacity\": DataDrivenProperty<number>,\r\n    \"line-color\": DataDrivenProperty<Color>,\r\n    \"line-translate\": DataConstantProperty<[number, number]>,\r\n    \"line-translate-anchor\": DataConstantProperty<\"map\" | \"viewport\">,\r\n    \"line-width\": DataDrivenProperty<number>,\r\n    \"line-gap-width\": DataDrivenProperty<number>,\r\n    \"line-offset\": DataDrivenProperty<number>,\r\n    \"line-blur\": DataDrivenProperty<number>,\r\n    \"line-dasharray\": CrossFadedProperty<Array<number>>,\r\n    \"line-pattern\": CrossFadedProperty<string>,\r\n|};\r\n\r\nconst paint: Properties<PaintProps> = new Properties({\r\n    \"line-opacity\": new DataDrivenProperty(styleSpec[\"paint_line\"][\"line-opacity\"]),\r\n    \"line-color\": new DataDrivenProperty(styleSpec[\"paint_line\"][\"line-color\"]),\r\n    \"line-translate\": new DataConstantProperty(styleSpec[\"paint_line\"][\"line-translate\"]),\r\n    \"line-translate-anchor\": new DataConstantProperty(styleSpec[\"paint_line\"][\"line-translate-anchor\"]),\r\n    \"line-width\": new DataDrivenProperty(styleSpec[\"paint_line\"][\"line-width\"]),\r\n    \"line-gap-width\": new DataDrivenProperty(styleSpec[\"paint_line\"][\"line-gap-width\"]),\r\n    \"line-offset\": new DataDrivenProperty(styleSpec[\"paint_line\"][\"line-offset\"]),\r\n    \"line-blur\": new DataDrivenProperty(styleSpec[\"paint_line\"][\"line-blur\"]),\r\n    \"line-dasharray\": new CrossFadedProperty(styleSpec[\"paint_line\"][\"line-dasharray\"]),\r\n    \"line-pattern\": new CrossFadedProperty(styleSpec[\"paint_line\"][\"line-pattern\"]),\r\n});\r\n\r\nmodule.exports = { paint, layout };\r\n","// @flow\r\n\r\nclass ZoomHistory {\r\n    lastZoom: number;\r\n    lastFloorZoom: number;\r\n    lastIntegerZoom: number;\r\n    lastIntegerZoomTime: number;\r\n    first: boolean;\r\n\r\n    constructor() {\r\n        this.first = true;\r\n    }\r\n\r\n    update(z: number, now: number) {\r\n        const floorZ = Math.floor(z);\r\n\r\n        if (this.first) {\r\n            this.first = false;\r\n            this.lastIntegerZoom = floorZ;\r\n            this.lastIntegerZoomTime = 0;\r\n            this.lastZoom = z;\r\n            this.lastFloorZoom = floorZ;\r\n            return true;\r\n        }\r\n\r\n        if (this.lastFloorZoom > floorZ) {\r\n            this.lastIntegerZoom = floorZ + 1;\r\n            this.lastIntegerZoomTime = now;\r\n        } else if (this.lastFloorZoom < floorZ) {\r\n            this.lastIntegerZoom = floorZ;\r\n            this.lastIntegerZoomTime = now;\r\n        }\r\n\r\n        if (z !== this.lastZoom) {\r\n            this.lastZoom = z;\r\n            this.lastFloorZoom = floorZ;\r\n            return true;\r\n        }\r\n\r\n        return false;\r\n    }\r\n}\r\n\r\nmodule.exports = ZoomHistory;\r\n","// @flow\r\n\r\nconst StyleLayer = require('../style_layer');\r\nconst SymbolBucket = require('../../data/bucket/symbol_bucket');\r\nconst resolveTokens = require('../../util/token');\r\nconst {isExpression} = require('../../style-spec/expression');\r\nconst assert = require('assert');\r\nconst properties = require('./symbol_style_layer_properties');\r\n\r\nconst {\r\n    Transitionable,\r\n    Transitioning,\r\n    Layout,\r\n    PossiblyEvaluated\r\n} = require('../properties');\r\n\r\nimport type {BucketParameters} from '../../data/bucket';\r\nimport type {LayoutProps, PaintProps} from './symbol_style_layer_properties';\r\nimport type {Feature} from '../../style-spec/expression';\r\nimport type EvaluationParameters from '../evaluation_parameters';\r\n\r\nclass SymbolStyleLayer extends StyleLayer {\r\n    _unevaluatedLayout: Layout<LayoutProps>;\r\n    layout: PossiblyEvaluated<LayoutProps>;\r\n\r\n    _transitionablePaint: Transitionable<PaintProps>;\r\n    _transitioningPaint: Transitioning<PaintProps>;\r\n    paint: PossiblyEvaluated<PaintProps>;\r\n\r\n    constructor(layer: LayerSpecification) {\r\n        super(layer, properties);\r\n    }\r\n\r\n    recalculate(parameters: EvaluationParameters) {\r\n        super.recalculate(parameters);\r\n\r\n        if (this.layout.get('icon-rotation-alignment') === 'auto') {\r\n            if (this.layout.get('symbol-placement') === 'line') {\r\n                this.layout._values['icon-rotation-alignment'] = 'map';\r\n            } else {\r\n                this.layout._values['icon-rotation-alignment'] = 'viewport';\r\n            }\r\n        }\r\n\r\n        if (this.layout.get('text-rotation-alignment') === 'auto') {\r\n            if (this.layout.get('symbol-placement') === 'line') {\r\n                this.layout._values['text-rotation-alignment'] = 'map';\r\n            } else {\r\n                this.layout._values['text-rotation-alignment'] = 'viewport';\r\n            }\r\n        }\r\n\r\n        // If unspecified, `*-pitch-alignment` inherits `*-rotation-alignment`\r\n        if (this.layout.get('text-pitch-alignment') === 'auto') {\r\n            this.layout._values['text-pitch-alignment'] = this.layout.get('text-rotation-alignment');\r\n        }\r\n        if (this.layout.get('icon-pitch-alignment') === 'auto') {\r\n            this.layout._values['icon-pitch-alignment'] = this.layout.get('icon-rotation-alignment');\r\n        }\r\n    }\r\n\r\n    getValueAndResolveTokens(name: *, feature: Feature) {\r\n        const value = this.layout.get(name).evaluate(feature);\r\n        const unevaluated = this._unevaluatedLayout._values[name];\r\n        if (!unevaluated.isDataDriven() && !isExpression(unevaluated.value)) {\r\n            return resolveTokens(feature.properties, value);\r\n        }\r\n\r\n        return value;\r\n    }\r\n\r\n    createBucket(parameters: BucketParameters<*>) {\r\n        return new SymbolBucket(parameters);\r\n    }\r\n\r\n    queryRadius(): number {\r\n        return 0;\r\n    }\r\n\r\n    queryIntersectsFeature(): boolean {\r\n        assert(false); // Should take a different path in FeatureIndex\r\n        return false;\r\n    }\r\n}\r\n\r\nmodule.exports = SymbolStyleLayer;\r\n","// @flow\r\n\r\nconst {createLayout} = require('../../util/struct_array');\r\nimport type {StructArrayLayout} from '../../util/struct_array';\r\n\r\nconst symbolLayoutAttributes = createLayout([\r\n    {name: 'a_pos_offset',  components: 4, type: 'Int16'},\r\n    {name: 'a_data',        components: 4, type: 'Uint16'}\r\n]);\r\n\r\nconst dynamicLayoutAttributes = createLayout([\r\n    { name: 'a_projected_pos', components: 3, type: 'Float32' }\r\n], 4);\r\n\r\nconst placementOpacityAttributes = createLayout([\r\n    { name: 'a_fade_opacity', components: 1, type: 'Uint32' }\r\n], 4);\r\n\r\nconst collisionVertexAttributes = createLayout([\r\n    { name: 'a_placed', components: 2, type: 'Uint8' }\r\n], 4);\r\n\r\nconst symbolAttributes: {[string]: StructArrayLayout} = {\r\n    symbolLayoutAttributes,\r\n    dynamicLayoutAttributes,\r\n    placementOpacityAttributes,\r\n    collisionVertexAttributes,\r\n    collisionBox: createLayout([\r\n        // the box is centered around the anchor point\r\n        { type: 'Int16', name: 'anchorPointX' },\r\n        { type: 'Int16', name: 'anchorPointY' },\r\n\r\n        // distances to the edges from the anchor\r\n        { type: 'Int16', name: 'x1' },\r\n        { type: 'Int16', name: 'y1' },\r\n        { type: 'Int16', name: 'x2' },\r\n        { type: 'Int16', name: 'y2' },\r\n\r\n        // the index of the feature in the original vectortile\r\n        { type: 'Uint32', name: 'featureIndex' },\r\n        // the source layer the feature appears in\r\n        { type: 'Uint16', name: 'sourceLayerIndex' },\r\n        // the bucket the feature appears in\r\n        { type: 'Uint16', name: 'bucketIndex' },\r\n\r\n        // collision circles for lines store their distance to the anchor in tile units\r\n        // so that they can be ignored if the projected label doesn't extend into\r\n        // the box area\r\n        { type: 'Int16', name: 'radius' },\r\n        { type: 'Int16', name: 'signedDistanceFromAnchor' }\r\n    ]),\r\n    collisionBoxLayout: createLayout([ // used to render collision boxes for debugging purposes\r\n        {name: 'a_pos',        components: 2, type: 'Int16'},\r\n        {name: 'a_anchor_pos', components: 2, type: 'Int16'},\r\n        {name: 'a_extrude',    components: 2, type: 'Int16'}\r\n    ], 4),\r\n    collisionCircleLayout: createLayout([ // used to render collision circles for debugging purposes\r\n        {name: 'a_pos',        components: 2, type: 'Int16'},\r\n        {name: 'a_anchor_pos', components: 2, type: 'Int16'},\r\n        {name: 'a_extrude',    components: 2, type: 'Int16'}\r\n    ], 4),\r\n    placement: createLayout([\r\n        { type: 'Int16', name: 'anchorX' },\r\n        { type: 'Int16', name: 'anchorY' },\r\n        { type: 'Uint16', name: 'glyphStartIndex' },\r\n        { type: 'Uint16', name: 'numGlyphs' },\r\n        { type: 'Uint32', name: 'vertexStartIndex' },\r\n        { type: 'Uint32', name: 'lineStartIndex' },\r\n        { type: 'Uint32', name: 'lineLength' },\r\n        { type: 'Uint16', name: 'segment' },\r\n        { type: 'Uint16', name: 'lowerSize' },\r\n        { type: 'Uint16', name: 'upperSize' },\r\n        { type: 'Float32', name: 'lineOffsetX' },\r\n        { type: 'Float32', name: 'lineOffsetY' },\r\n        { type: 'Uint8', name: 'writingMode' },\r\n        { type: 'Uint8', name: 'hidden' }\r\n    ]),\r\n    glyphOffset: createLayout([\r\n        { type: 'Float32', name: 'offsetX' }\r\n    ]),\r\n    lineVertex: createLayout([\r\n        { type: 'Int16', name: 'x' },\r\n        { type: 'Int16', name: 'y' },\r\n        { type: 'Int16', name: 'tileUnitDistanceFromAnchor' }\r\n    ])\r\n};\r\n\r\nmodule.exports = symbolAttributes;\r\n","// @flow\r\n\r\nconst rtlTextPlugin = require('../source/rtl_text_plugin');\r\n\r\nimport type SymbolStyleLayer from '../style/style_layer/symbol_style_layer';\r\nimport type {Feature} from '../style-spec/expression';\r\n\r\nmodule.exports = function(text: string, layer: SymbolStyleLayer, feature: Feature) {\r\n    const transform = layer.layout.get('text-transform').evaluate(feature);\r\n    if (transform === 'uppercase') {\r\n        text = text.toLocaleUpperCase();\r\n    } else if (transform === 'lowercase') {\r\n        text = text.toLocaleLowerCase();\r\n    }\r\n\r\n    if (rtlTextPlugin.applyArabicShaping) {\r\n        text = rtlTextPlugin.applyArabicShaping(text);\r\n    }\r\n\r\n    return text;\r\n};\r\n","// @flow\r\n\r\nimport type {SymbolFeature} from '../data/bucket/symbol_bucket';\r\n\r\nmodule.exports = function (features: Array<SymbolFeature>) {\r\n    const leftIndex: {[string]: number} = {};\r\n    const rightIndex: {[string]: number} = {};\r\n    const mergedFeatures = [];\r\n    let mergedIndex = 0;\r\n\r\n    function add(k) {\r\n        mergedFeatures.push(features[k]);\r\n        mergedIndex++;\r\n    }\r\n\r\n    function mergeFromRight(leftKey: string, rightKey: string, geom) {\r\n        const i = rightIndex[leftKey];\r\n        delete rightIndex[leftKey];\r\n        rightIndex[rightKey] = i;\r\n\r\n        mergedFeatures[i].geometry[0].pop();\r\n        mergedFeatures[i].geometry[0] = mergedFeatures[i].geometry[0].concat(geom[0]);\r\n        return i;\r\n    }\r\n\r\n    function mergeFromLeft(leftKey: string, rightKey: string, geom) {\r\n        const i = leftIndex[rightKey];\r\n        delete leftIndex[rightKey];\r\n        leftIndex[leftKey] = i;\r\n\r\n        mergedFeatures[i].geometry[0].shift();\r\n        mergedFeatures[i].geometry[0] = geom[0].concat(mergedFeatures[i].geometry[0]);\r\n        return i;\r\n    }\r\n\r\n    function getKey(text, geom, onRight) {\r\n        const point = onRight ? geom[0][geom[0].length - 1] : geom[0][0];\r\n        return `${text}:${point.x}:${point.y}`;\r\n    }\r\n\r\n    for (let k = 0; k < features.length; k++) {\r\n        const feature = features[k];\r\n        const geom = feature.geometry;\r\n        const text = feature.text;\r\n\r\n        if (!text) {\r\n            add(k);\r\n            continue;\r\n        }\r\n\r\n        const leftKey = getKey(text, geom),\r\n            rightKey = getKey(text, geom, true);\r\n\r\n        if ((leftKey in rightIndex) && (rightKey in leftIndex) && (rightIndex[leftKey] !== leftIndex[rightKey])) {\r\n            // found lines with the same text adjacent to both ends of the current line, merge all three\r\n            const j = mergeFromLeft(leftKey, rightKey, geom);\r\n            const i = mergeFromRight(leftKey, rightKey, mergedFeatures[j].geometry);\r\n\r\n            delete leftIndex[leftKey];\r\n            delete rightIndex[rightKey];\r\n\r\n            rightIndex[getKey(text, mergedFeatures[i].geometry, true)] = i;\r\n            mergedFeatures[j].geometry = (null: any);\r\n\r\n        } else if (leftKey in rightIndex) {\r\n            // found mergeable line adjacent to the start of the current line, merge\r\n            mergeFromRight(leftKey, rightKey, geom);\r\n\r\n        } else if (rightKey in leftIndex) {\r\n            // found mergeable line adjacent to the end of the current line, merge\r\n            mergeFromLeft(leftKey, rightKey, geom);\r\n\r\n        } else {\r\n            // no adjacent lines, add as a new item\r\n            add(k);\r\n            leftIndex[leftKey] = mergedIndex - 1;\r\n            rightIndex[rightKey] = mergedIndex - 1;\r\n        }\r\n    }\r\n\r\n    return mergedFeatures.filter((f) => f.geometry);\r\n};\r\n","// @flow\r\n\r\n// The following table comes from <http://www.unicode.org/Public/10.0.0/ucd/Blocks.txt>.\r\n// Keep it synchronized with <http://www.unicode.org/Public/UCD/latest/ucd/Blocks.txt>.\r\n\r\ntype UnicodeBlockLookup = {[key: string]: (char: number) => boolean};\r\n\r\nconst unicodeBlockLookup: UnicodeBlockLookup = {\r\n    // 'Basic Latin': (char) => char >= 0x0000 && char <= 0x007F,\r\n    'Latin-1 Supplement': (char) => char >= 0x0080 && char <= 0x00FF,\r\n    // 'Latin Extended-A': (char) => char >= 0x0100 && char <= 0x017F,\r\n    // 'Latin Extended-B': (char) => char >= 0x0180 && char <= 0x024F,\r\n    // 'IPA Extensions': (char) => char >= 0x0250 && char <= 0x02AF,\r\n    // 'Spacing Modifier Letters': (char) => char >= 0x02B0 && char <= 0x02FF,\r\n    // 'Combining Diacritical Marks': (char) => char >= 0x0300 && char <= 0x036F,\r\n    // 'Greek and Coptic': (char) => char >= 0x0370 && char <= 0x03FF,\r\n    // 'Cyrillic': (char) => char >= 0x0400 && char <= 0x04FF,\r\n    // 'Cyrillic Supplement': (char) => char >= 0x0500 && char <= 0x052F,\r\n    // 'Armenian': (char) => char >= 0x0530 && char <= 0x058F,\r\n    //'Hebrew': (char) => char >= 0x0590 && char <= 0x05FF,\r\n    'Arabic': (char) => char >= 0x0600 && char <= 0x06FF,\r\n    //'Syriac': (char) => char >= 0x0700 && char <= 0x074F,\r\n    'Arabic Supplement': (char) => char >= 0x0750 && char <= 0x077F,\r\n    // 'Thaana': (char) => char >= 0x0780 && char <= 0x07BF,\r\n    // 'NKo': (char) => char >= 0x07C0 && char <= 0x07FF,\r\n    // 'Samaritan': (char) => char >= 0x0800 && char <= 0x083F,\r\n    // 'Mandaic': (char) => char >= 0x0840 && char <= 0x085F,\r\n    // 'Syriac Supplement': (char) => char >= 0x0860 && char <= 0x086F,\r\n    'Arabic Extended-A': (char) => char >= 0x08A0 && char <= 0x08FF,\r\n    // 'Devanagari': (char) => char >= 0x0900 && char <= 0x097F,\r\n    // 'Bengali': (char) => char >= 0x0980 && char <= 0x09FF,\r\n    // 'Gurmukhi': (char) => char >= 0x0A00 && char <= 0x0A7F,\r\n    // 'Gujarati': (char) => char >= 0x0A80 && char <= 0x0AFF,\r\n    // 'Oriya': (char) => char >= 0x0B00 && char <= 0x0B7F,\r\n    // 'Tamil': (char) => char >= 0x0B80 && char <= 0x0BFF,\r\n    // 'Telugu': (char) => char >= 0x0C00 && char <= 0x0C7F,\r\n    // 'Kannada': (char) => char >= 0x0C80 && char <= 0x0CFF,\r\n    // 'Malayalam': (char) => char >= 0x0D00 && char <= 0x0D7F,\r\n    // 'Sinhala': (char) => char >= 0x0D80 && char <= 0x0DFF,\r\n    // 'Thai': (char) => char >= 0x0E00 && char <= 0x0E7F,\r\n    // 'Lao': (char) => char >= 0x0E80 && char <= 0x0EFF,\r\n    // 'Tibetan': (char) => char >= 0x0F00 && char <= 0x0FFF,\r\n    // 'Myanmar': (char) => char >= 0x1000 && char <= 0x109F,\r\n    // 'Georgian': (char) => char >= 0x10A0 && char <= 0x10FF,\r\n    'Hangul Jamo': (char) => char >= 0x1100 && char <= 0x11FF,\r\n    // 'Ethiopic': (char) => char >= 0x1200 && char <= 0x137F,\r\n    // 'Ethiopic Supplement': (char) => char >= 0x1380 && char <= 0x139F,\r\n    // 'Cherokee': (char) => char >= 0x13A0 && char <= 0x13FF,\r\n    'Unified Canadian Aboriginal Syllabics': (char) => char >= 0x1400 && char <= 0x167F,\r\n    // 'Ogham': (char) => char >= 0x1680 && char <= 0x169F,\r\n    // 'Runic': (char) => char >= 0x16A0 && char <= 0x16FF,\r\n    // 'Tagalog': (char) => char >= 0x1700 && char <= 0x171F,\r\n    // 'Hanunoo': (char) => char >= 0x1720 && char <= 0x173F,\r\n    // 'Buhid': (char) => char >= 0x1740 && char <= 0x175F,\r\n    // 'Tagbanwa': (char) => char >= 0x1760 && char <= 0x177F,\r\n    // 'Khmer': (char) => char >= 0x1780 && char <= 0x17FF,\r\n    // 'Mongolian': (char) => char >= 0x1800 && char <= 0x18AF,\r\n    'Unified Canadian Aboriginal Syllabics Extended': (char) => char >= 0x18B0 && char <= 0x18FF,\r\n    // 'Limbu': (char) => char >= 0x1900 && char <= 0x194F,\r\n    // 'Tai Le': (char) => char >= 0x1950 && char <= 0x197F,\r\n    // 'New Tai Lue': (char) => char >= 0x1980 && char <= 0x19DF,\r\n    // 'Khmer Symbols': (char) => char >= 0x19E0 && char <= 0x19FF,\r\n    // 'Buginese': (char) => char >= 0x1A00 && char <= 0x1A1F,\r\n    // 'Tai Tham': (char) => char >= 0x1A20 && char <= 0x1AAF,\r\n    // 'Combining Diacritical Marks Extended': (char) => char >= 0x1AB0 && char <= 0x1AFF,\r\n    // 'Balinese': (char) => char >= 0x1B00 && char <= 0x1B7F,\r\n    // 'Sundanese': (char) => char >= 0x1B80 && char <= 0x1BBF,\r\n    // 'Batak': (char) => char >= 0x1BC0 && char <= 0x1BFF,\r\n    // 'Lepcha': (char) => char >= 0x1C00 && char <= 0x1C4F,\r\n    // 'Ol Chiki': (char) => char >= 0x1C50 && char <= 0x1C7F,\r\n    // 'Cyrillic Extended-C': (char) => char >= 0x1C80 && char <= 0x1C8F,\r\n    // 'Sundanese Supplement': (char) => char >= 0x1CC0 && char <= 0x1CCF,\r\n    // 'Vedic Extensions': (char) => char >= 0x1CD0 && char <= 0x1CFF,\r\n    // 'Phonetic Extensions': (char) => char >= 0x1D00 && char <= 0x1D7F,\r\n    // 'Phonetic Extensions Supplement': (char) => char >= 0x1D80 && char <= 0x1DBF,\r\n    // 'Combining Diacritical Marks Supplement': (char) => char >= 0x1DC0 && char <= 0x1DFF,\r\n    // 'Latin Extended Additional': (char) => char >= 0x1E00 && char <= 0x1EFF,\r\n    // 'Greek Extended': (char) => char >= 0x1F00 && char <= 0x1FFF,\r\n    'General Punctuation': (char) => char >= 0x2000 && char <= 0x206F,\r\n    // 'Superscripts and Subscripts': (char) => char >= 0x2070 && char <= 0x209F,\r\n    // 'Currency Symbols': (char) => char >= 0x20A0 && char <= 0x20CF,\r\n    // 'Combining Diacritical Marks for Symbols': (char) => char >= 0x20D0 && char <= 0x20FF,\r\n    'Letterlike Symbols': (char) => char >= 0x2100 && char <= 0x214F,\r\n    'Number Forms': (char) => char >= 0x2150 && char <= 0x218F,\r\n    // 'Arrows': (char) => char >= 0x2190 && char <= 0x21FF,\r\n    // 'Mathematical Operators': (char) => char >= 0x2200 && char <= 0x22FF,\r\n    'Miscellaneous Technical': (char) => char >= 0x2300 && char <= 0x23FF,\r\n    'Control Pictures': (char) => char >= 0x2400 && char <= 0x243F,\r\n    'Optical Character Recognition': (char) => char >= 0x2440 && char <= 0x245F,\r\n    'Enclosed Alphanumerics': (char) => char >= 0x2460 && char <= 0x24FF,\r\n    // 'Box Drawing': (char) => char >= 0x2500 && char <= 0x257F,\r\n    // 'Block Elements': (char) => char >= 0x2580 && char <= 0x259F,\r\n    'Geometric Shapes': (char) => char >= 0x25A0 && char <= 0x25FF,\r\n    'Miscellaneous Symbols': (char) => char >= 0x2600 && char <= 0x26FF,\r\n    // 'Dingbats': (char) => char >= 0x2700 && char <= 0x27BF,\r\n    // 'Miscellaneous Mathematical Symbols-A': (char) => char >= 0x27C0 && char <= 0x27EF,\r\n    // 'Supplemental Arrows-A': (char) => char >= 0x27F0 && char <= 0x27FF,\r\n    // 'Braille Patterns': (char) => char >= 0x2800 && char <= 0x28FF,\r\n    // 'Supplemental Arrows-B': (char) => char >= 0x2900 && char <= 0x297F,\r\n    // 'Miscellaneous Mathematical Symbols-B': (char) => char >= 0x2980 && char <= 0x29FF,\r\n    // 'Supplemental Mathematical Operators': (char) => char >= 0x2A00 && char <= 0x2AFF,\r\n    'Miscellaneous Symbols and Arrows': (char) => char >= 0x2B00 && char <= 0x2BFF,\r\n    // 'Glagolitic': (char) => char >= 0x2C00 && char <= 0x2C5F,\r\n    // 'Latin Extended-C': (char) => char >= 0x2C60 && char <= 0x2C7F,\r\n    // 'Coptic': (char) => char >= 0x2C80 && char <= 0x2CFF,\r\n    // 'Georgian Supplement': (char) => char >= 0x2D00 && char <= 0x2D2F,\r\n    // 'Tifinagh': (char) => char >= 0x2D30 && char <= 0x2D7F,\r\n    // 'Ethiopic Extended': (char) => char >= 0x2D80 && char <= 0x2DDF,\r\n    // 'Cyrillic Extended-A': (char) => char >= 0x2DE0 && char <= 0x2DFF,\r\n    // 'Supplemental Punctuation': (char) => char >= 0x2E00 && char <= 0x2E7F,\r\n    'CJK Radicals Supplement': (char) => char >= 0x2E80 && char <= 0x2EFF,\r\n    'Kangxi Radicals': (char) => char >= 0x2F00 && char <= 0x2FDF,\r\n    'Ideographic Description Characters': (char) => char >= 0x2FF0 && char <= 0x2FFF,\r\n    'CJK Symbols and Punctuation': (char) => char >= 0x3000 && char <= 0x303F,\r\n    'Hiragana': (char) => char >= 0x3040 && char <= 0x309F,\r\n    'Katakana': (char) => char >= 0x30A0 && char <= 0x30FF,\r\n    'Bopomofo': (char) => char >= 0x3100 && char <= 0x312F,\r\n    'Hangul Compatibility Jamo': (char) => char >= 0x3130 && char <= 0x318F,\r\n    'Kanbun': (char) => char >= 0x3190 && char <= 0x319F,\r\n    'Bopomofo Extended': (char) => char >= 0x31A0 && char <= 0x31BF,\r\n    'CJK Strokes': (char) => char >= 0x31C0 && char <= 0x31EF,\r\n    'Katakana Phonetic Extensions': (char) => char >= 0x31F0 && char <= 0x31FF,\r\n    'Enclosed CJK Letters and Months': (char) => char >= 0x3200 && char <= 0x32FF,\r\n    'CJK Compatibility': (char) => char >= 0x3300 && char <= 0x33FF,\r\n    'CJK Unified Ideographs Extension A': (char) => char >= 0x3400 && char <= 0x4DBF,\r\n    'Yijing Hexagram Symbols': (char) => char >= 0x4DC0 && char <= 0x4DFF,\r\n    'CJK Unified Ideographs': (char) => char >= 0x4E00 && char <= 0x9FFF,\r\n    'Yi Syllables': (char) => char >= 0xA000 && char <= 0xA48F,\r\n    'Yi Radicals': (char) => char >= 0xA490 && char <= 0xA4CF,\r\n    // 'Lisu': (char) => char >= 0xA4D0 && char <= 0xA4FF,\r\n    // 'Vai': (char) => char >= 0xA500 && char <= 0xA63F,\r\n    // 'Cyrillic Extended-B': (char) => char >= 0xA640 && char <= 0xA69F,\r\n    // 'Bamum': (char) => char >= 0xA6A0 && char <= 0xA6FF,\r\n    // 'Modifier Tone Letters': (char) => char >= 0xA700 && char <= 0xA71F,\r\n    // 'Latin Extended-D': (char) => char >= 0xA720 && char <= 0xA7FF,\r\n    // 'Syloti Nagri': (char) => char >= 0xA800 && char <= 0xA82F,\r\n    // 'Common Indic Number Forms': (char) => char >= 0xA830 && char <= 0xA83F,\r\n    // 'Phags-pa': (char) => char >= 0xA840 && char <= 0xA87F,\r\n    // 'Saurashtra': (char) => char >= 0xA880 && char <= 0xA8DF,\r\n    // 'Devanagari Extended': (char) => char >= 0xA8E0 && char <= 0xA8FF,\r\n    // 'Kayah Li': (char) => char >= 0xA900 && char <= 0xA92F,\r\n    // 'Rejang': (char) => char >= 0xA930 && char <= 0xA95F,\r\n    'Hangul Jamo Extended-A': (char) => char >= 0xA960 && char <= 0xA97F,\r\n    // 'Javanese': (char) => char >= 0xA980 && char <= 0xA9DF,\r\n    // 'Myanmar Extended-B': (char) => char >= 0xA9E0 && char <= 0xA9FF,\r\n    // 'Cham': (char) => char >= 0xAA00 && char <= 0xAA5F,\r\n    // 'Myanmar Extended-A': (char) => char >= 0xAA60 && char <= 0xAA7F,\r\n    // 'Tai Viet': (char) => char >= 0xAA80 && char <= 0xAADF,\r\n    // 'Meetei Mayek Extensions': (char) => char >= 0xAAE0 && char <= 0xAAFF,\r\n    // 'Ethiopic Extended-A': (char) => char >= 0xAB00 && char <= 0xAB2F,\r\n    // 'Latin Extended-E': (char) => char >= 0xAB30 && char <= 0xAB6F,\r\n    // 'Cherokee Supplement': (char) => char >= 0xAB70 && char <= 0xABBF,\r\n    // 'Meetei Mayek': (char) => char >= 0xABC0 && char <= 0xABFF,\r\n    'Hangul Syllables': (char) => char >= 0xAC00 && char <= 0xD7AF,\r\n    'Hangul Jamo Extended-B': (char) => char >= 0xD7B0 && char <= 0xD7FF,\r\n    // 'High Surrogates': (char) => char >= 0xD800 && char <= 0xDB7F,\r\n    // 'High Private Use Surrogates': (char) => char >= 0xDB80 && char <= 0xDBFF,\r\n    // 'Low Surrogates': (char) => char >= 0xDC00 && char <= 0xDFFF,\r\n    'Private Use Area': (char) => char >= 0xE000 && char <= 0xF8FF,\r\n    'CJK Compatibility Ideographs': (char) => char >= 0xF900 && char <= 0xFAFF,\r\n    // 'Alphabetic Presentation Forms': (char) => char >= 0xFB00 && char <= 0xFB4F,\r\n    'Arabic Presentation Forms-A': (char) => char >= 0xFB50 && char <= 0xFDFF,\r\n    // 'Variation Selectors': (char) => char >= 0xFE00 && char <= 0xFE0F,\r\n    'Vertical Forms': (char) => char >= 0xFE10 && char <= 0xFE1F,\r\n    // 'Combining Half Marks': (char) => char >= 0xFE20 && char <= 0xFE2F,\r\n    'CJK Compatibility Forms': (char) => char >= 0xFE30 && char <= 0xFE4F,\r\n    'Small Form Variants': (char) => char >= 0xFE50 && char <= 0xFE6F,\r\n    'Arabic Presentation Forms-B': (char) => char >= 0xFE70 && char <= 0xFEFF,\r\n    'Halfwidth and Fullwidth Forms': (char) => char >= 0xFF00 && char <= 0xFFEF\r\n    // 'Specials': (char) => char >= 0xFFF0 && char <= 0xFFFF,\r\n    // 'Linear B Syllabary': (char) => char >= 0x10000 && char <= 0x1007F,\r\n    // 'Linear B Ideograms': (char) => char >= 0x10080 && char <= 0x100FF,\r\n    // 'Aegean Numbers': (char) => char >= 0x10100 && char <= 0x1013F,\r\n    // 'Ancient Greek Numbers': (char) => char >= 0x10140 && char <= 0x1018F,\r\n    // 'Ancient Symbols': (char) => char >= 0x10190 && char <= 0x101CF,\r\n    // 'Phaistos Disc': (char) => char >= 0x101D0 && char <= 0x101FF,\r\n    // 'Lycian': (char) => char >= 0x10280 && char <= 0x1029F,\r\n    // 'Carian': (char) => char >= 0x102A0 && char <= 0x102DF,\r\n    // 'Coptic Epact Numbers': (char) => char >= 0x102E0 && char <= 0x102FF,\r\n    // 'Old Italic': (char) => char >= 0x10300 && char <= 0x1032F,\r\n    // 'Gothic': (char) => char >= 0x10330 && char <= 0x1034F,\r\n    // 'Old Permic': (char) => char >= 0x10350 && char <= 0x1037F,\r\n    // 'Ugaritic': (char) => char >= 0x10380 && char <= 0x1039F,\r\n    // 'Old Persian': (char) => char >= 0x103A0 && char <= 0x103DF,\r\n    // 'Deseret': (char) => char >= 0x10400 && char <= 0x1044F,\r\n    // 'Shavian': (char) => char >= 0x10450 && char <= 0x1047F,\r\n    // 'Osmanya': (char) => char >= 0x10480 && char <= 0x104AF,\r\n    // 'Osage': (char) => char >= 0x104B0 && char <= 0x104FF,\r\n    // 'Elbasan': (char) => char >= 0x10500 && char <= 0x1052F,\r\n    // 'Caucasian Albanian': (char) => char >= 0x10530 && char <= 0x1056F,\r\n    // 'Linear A': (char) => char >= 0x10600 && char <= 0x1077F,\r\n    // 'Cypriot Syllabary': (char) => char >= 0x10800 && char <= 0x1083F,\r\n    // 'Imperial Aramaic': (char) => char >= 0x10840 && char <= 0x1085F,\r\n    // 'Palmyrene': (char) => char >= 0x10860 && char <= 0x1087F,\r\n    // 'Nabataean': (char) => char >= 0x10880 && char <= 0x108AF,\r\n    // 'Hatran': (char) => char >= 0x108E0 && char <= 0x108FF,\r\n    // 'Phoenician': (char) => char >= 0x10900 && char <= 0x1091F,\r\n    // 'Lydian': (char) => char >= 0x10920 && char <= 0x1093F,\r\n    // 'Meroitic Hieroglyphs': (char) => char >= 0x10980 && char <= 0x1099F,\r\n    // 'Meroitic Cursive': (char) => char >= 0x109A0 && char <= 0x109FF,\r\n    // 'Kharoshthi': (char) => char >= 0x10A00 && char <= 0x10A5F,\r\n    // 'Old South Arabian': (char) => char >= 0x10A60 && char <= 0x10A7F,\r\n    // 'Old North Arabian': (char) => char >= 0x10A80 && char <= 0x10A9F,\r\n    // 'Manichaean': (char) => char >= 0x10AC0 && char <= 0x10AFF,\r\n    // 'Avestan': (char) => char >= 0x10B00 && char <= 0x10B3F,\r\n    // 'Inscriptional Parthian': (char) => char >= 0x10B40 && char <= 0x10B5F,\r\n    // 'Inscriptional Pahlavi': (char) => char >= 0x10B60 && char <= 0x10B7F,\r\n    // 'Psalter Pahlavi': (char) => char >= 0x10B80 && char <= 0x10BAF,\r\n    // 'Old Turkic': (char) => char >= 0x10C00 && char <= 0x10C4F,\r\n    // 'Old Hungarian': (char) => char >= 0x10C80 && char <= 0x10CFF,\r\n    // 'Rumi Numeral Symbols': (char) => char >= 0x10E60 && char <= 0x10E7F,\r\n    // 'Brahmi': (char) => char >= 0x11000 && char <= 0x1107F,\r\n    // 'Kaithi': (char) => char >= 0x11080 && char <= 0x110CF,\r\n    // 'Sora Sompeng': (char) => char >= 0x110D0 && char <= 0x110FF,\r\n    // 'Chakma': (char) => char >= 0x11100 && char <= 0x1114F,\r\n    // 'Mahajani': (char) => char >= 0x11150 && char <= 0x1117F,\r\n    // 'Sharada': (char) => char >= 0x11180 && char <= 0x111DF,\r\n    // 'Sinhala Archaic Numbers': (char) => char >= 0x111E0 && char <= 0x111FF,\r\n    // 'Khojki': (char) => char >= 0x11200 && char <= 0x1124F,\r\n    // 'Multani': (char) => char >= 0x11280 && char <= 0x112AF,\r\n    // 'Khudawadi': (char) => char >= 0x112B0 && char <= 0x112FF,\r\n    // 'Grantha': (char) => char >= 0x11300 && char <= 0x1137F,\r\n    // 'Newa': (char) => char >= 0x11400 && char <= 0x1147F,\r\n    // 'Tirhuta': (char) => char >= 0x11480 && char <= 0x114DF,\r\n    // 'Siddham': (char) => char >= 0x11580 && char <= 0x115FF,\r\n    // 'Modi': (char) => char >= 0x11600 && char <= 0x1165F,\r\n    // 'Mongolian Supplement': (char) => char >= 0x11660 && char <= 0x1167F,\r\n    // 'Takri': (char) => char >= 0x11680 && char <= 0x116CF,\r\n    // 'Ahom': (char) => char >= 0x11700 && char <= 0x1173F,\r\n    // 'Warang Citi': (char) => char >= 0x118A0 && char <= 0x118FF,\r\n    // 'Zanabazar Square': (char) => char >= 0x11A00 && char <= 0x11A4F,\r\n    // 'Soyombo': (char) => char >= 0x11A50 && char <= 0x11AAF,\r\n    // 'Pau Cin Hau': (char) => char >= 0x11AC0 && char <= 0x11AFF,\r\n    // 'Bhaiksuki': (char) => char >= 0x11C00 && char <= 0x11C6F,\r\n    // 'Marchen': (char) => char >= 0x11C70 && char <= 0x11CBF,\r\n    // 'Masaram Gondi': (char) => char >= 0x11D00 && char <= 0x11D5F,\r\n    // 'Cuneiform': (char) => char >= 0x12000 && char <= 0x123FF,\r\n    // 'Cuneiform Numbers and Punctuation': (char) => char >= 0x12400 && char <= 0x1247F,\r\n    // 'Early Dynastic Cuneiform': (char) => char >= 0x12480 && char <= 0x1254F,\r\n    // 'Egyptian Hieroglyphs': (char) => char >= 0x13000 && char <= 0x1342F,\r\n    // 'Anatolian Hieroglyphs': (char) => char >= 0x14400 && char <= 0x1467F,\r\n    // 'Bamum Supplement': (char) => char >= 0x16800 && char <= 0x16A3F,\r\n    // 'Mro': (char) => char >= 0x16A40 && char <= 0x16A6F,\r\n    // 'Bassa Vah': (char) => char >= 0x16AD0 && char <= 0x16AFF,\r\n    // 'Pahawh Hmong': (char) => char >= 0x16B00 && char <= 0x16B8F,\r\n    // 'Miao': (char) => char >= 0x16F00 && char <= 0x16F9F,\r\n    // 'Ideographic Symbols and Punctuation': (char) => char >= 0x16FE0 && char <= 0x16FFF,\r\n    // 'Tangut': (char) => char >= 0x17000 && char <= 0x187FF,\r\n    // 'Tangut Components': (char) => char >= 0x18800 && char <= 0x18AFF,\r\n    // 'Kana Supplement': (char) => char >= 0x1B000 && char <= 0x1B0FF,\r\n    // 'Kana Extended-A': (char) => char >= 0x1B100 && char <= 0x1B12F,\r\n    // 'Nushu': (char) => char >= 0x1B170 && char <= 0x1B2FF,\r\n    // 'Duployan': (char) => char >= 0x1BC00 && char <= 0x1BC9F,\r\n    // 'Shorthand Format Controls': (char) => char >= 0x1BCA0 && char <= 0x1BCAF,\r\n    // 'Byzantine Musical Symbols': (char) => char >= 0x1D000 && char <= 0x1D0FF,\r\n    // 'Musical Symbols': (char) => char >= 0x1D100 && char <= 0x1D1FF,\r\n    // 'Ancient Greek Musical Notation': (char) => char >= 0x1D200 && char <= 0x1D24F,\r\n    // 'Tai Xuan Jing Symbols': (char) => char >= 0x1D300 && char <= 0x1D35F,\r\n    // 'Counting Rod Numerals': (char) => char >= 0x1D360 && char <= 0x1D37F,\r\n    // 'Mathematical Alphanumeric Symbols': (char) => char >= 0x1D400 && char <= 0x1D7FF,\r\n    // 'Sutton SignWriting': (char) => char >= 0x1D800 && char <= 0x1DAAF,\r\n    // 'Glagolitic Supplement': (char) => char >= 0x1E000 && char <= 0x1E02F,\r\n    // 'Mende Kikakui': (char) => char >= 0x1E800 && char <= 0x1E8DF,\r\n    // 'Adlam': (char) => char >= 0x1E900 && char <= 0x1E95F,\r\n    // 'Arabic Mathematical Alphabetic Symbols': (char) => char >= 0x1EE00 && char <= 0x1EEFF,\r\n    // 'Mahjong Tiles': (char) => char >= 0x1F000 && char <= 0x1F02F,\r\n    // 'Domino Tiles': (char) => char >= 0x1F030 && char <= 0x1F09F,\r\n    // 'Playing Cards': (char) => char >= 0x1F0A0 && char <= 0x1F0FF,\r\n    // 'Enclosed Alphanumeric Supplement': (char) => char >= 0x1F100 && char <= 0x1F1FF,\r\n    // 'Enclosed Ideographic Supplement': (char) => char >= 0x1F200 && char <= 0x1F2FF,\r\n    // 'Miscellaneous Symbols and Pictographs': (char) => char >= 0x1F300 && char <= 0x1F5FF,\r\n    // 'Emoticons': (char) => char >= 0x1F600 && char <= 0x1F64F,\r\n    // 'Ornamental Dingbats': (char) => char >= 0x1F650 && char <= 0x1F67F,\r\n    // 'Transport and Map Symbols': (char) => char >= 0x1F680 && char <= 0x1F6FF,\r\n    // 'Alchemical Symbols': (char) => char >= 0x1F700 && char <= 0x1F77F,\r\n    // 'Geometric Shapes Extended': (char) => char >= 0x1F780 && char <= 0x1F7FF,\r\n    // 'Supplemental Arrows-C': (char) => char >= 0x1F800 && char <= 0x1F8FF,\r\n    // 'Supplemental Symbols and Pictographs': (char) => char >= 0x1F900 && char <= 0x1F9FF,\r\n    // 'CJK Unified Ideographs Extension B': (char) => char >= 0x20000 && char <= 0x2A6DF,\r\n    // 'CJK Unified Ideographs Extension C': (char) => char >= 0x2A700 && char <= 0x2B73F,\r\n    // 'CJK Unified Ideographs Extension D': (char) => char >= 0x2B740 && char <= 0x2B81F,\r\n    // 'CJK Unified Ideographs Extension E': (char) => char >= 0x2B820 && char <= 0x2CEAF,\r\n    // 'CJK Unified Ideographs Extension F': (char) => char >= 0x2CEB0 && char <= 0x2EBEF,\r\n    // 'CJK Compatibility Ideographs Supplement': (char) => char >= 0x2F800 && char <= 0x2FA1F,\r\n    // 'Tags': (char) => char >= 0xE0000 && char <= 0xE007F,\r\n    // 'Variation Selectors Supplement': (char) => char >= 0xE0100 && char <= 0xE01EF,\r\n    // 'Supplementary Private Use Area-A': (char) => char >= 0xF0000 && char <= 0xFFFFF,\r\n    // 'Supplementary Private Use Area-B': (char) => char >= 0x100000 && char <= 0x10FFFF,\r\n};\r\n\r\nmodule.exports = unicodeBlockLookup;\r\n","// @flow\r\n\r\nconst {normalizePropertyExpression} = require('../style-spec/expression');\r\nconst interpolate = require('../style-spec/util/interpolate');\r\nconst util = require('../util/util');\r\n\r\nimport type {Property, PropertyValue, PossiblyEvaluatedPropertyValue} from '../style/properties';\r\nimport type {CameraExpression, CompositeExpression} from '../style-spec/expression/index';\r\n\r\nmodule.exports = {\r\n    getSizeData,\r\n    evaluateSizeForFeature,\r\n    evaluateSizeForZoom\r\n};\r\n\r\nexport type SizeData = {\r\n    functionType: 'constant',\r\n    layoutSize: number\r\n} | {\r\n    functionType: 'source'\r\n} | {\r\n    functionType: 'camera',\r\n    layoutSize: number,\r\n    zoomRange: {min: number, max: number},\r\n    sizeRange: {min: number, max: number},\r\n    propertyValue: PropertyValueSpecification<number>\r\n} | {\r\n    functionType: 'composite',\r\n    zoomRange: {min: number, max: number},\r\n    propertyValue: PropertyValueSpecification<number>\r\n};\r\n\r\n// For {text,icon}-size, get the bucket-level data that will be needed by\r\n// the painter to set symbol-size-related uniforms\r\nfunction getSizeData(tileZoom: number, value: PropertyValue<number, PossiblyEvaluatedPropertyValue<number>>): SizeData {\r\n    const {expression} = value;\r\n    if (expression.kind === 'constant') {\r\n        return {\r\n            functionType: 'constant',\r\n            layoutSize: expression.evaluate({zoom: tileZoom + 1})\r\n        };\r\n    } else if (expression.kind === 'source') {\r\n        return {\r\n            functionType: 'source'\r\n        };\r\n    } else {\r\n        // calculate covering zoom stops for zoom-dependent values\r\n        const levels = expression.zoomStops;\r\n\r\n        let lower = 0;\r\n        while (lower < levels.length && levels[lower] <= tileZoom) lower++;\r\n        lower = Math.max(0, lower - 1);\r\n        let upper = lower;\r\n        while (upper < levels.length && levels[upper] < tileZoom + 1) upper++;\r\n        upper = Math.min(levels.length - 1, upper);\r\n\r\n        const zoomRange = {\r\n            min: levels[lower],\r\n            max: levels[upper]\r\n        };\r\n\r\n        // We'd like to be able to use CameraExpression or CompositeExpression in these\r\n        // return types rather than ExpressionSpecification, but the former are not\r\n        // transferrable across Web Worker boundaries.\r\n        if (expression.kind === 'composite') {\r\n            return {\r\n                functionType: 'composite',\r\n                zoomRange,\r\n                propertyValue: (value.value: any)\r\n            };\r\n        } else {\r\n            // for camera functions, also save off the function values\r\n            // evaluated at the covering zoom levels\r\n            return {\r\n                functionType: 'camera',\r\n                layoutSize: expression.evaluate({zoom: tileZoom + 1}),\r\n                zoomRange,\r\n                sizeRange: {\r\n                    min: expression.evaluate({zoom: zoomRange.min}),\r\n                    max: expression.evaluate({zoom: zoomRange.max})\r\n                },\r\n                propertyValue: (value.value: any)\r\n            };\r\n        }\r\n    }\r\n}\r\n\r\nfunction evaluateSizeForFeature(sizeData: SizeData,\r\n                                partiallyEvaluatedSize: { uSize: number, uSizeT: number },\r\n                                symbol: { lowerSize: number, upperSize: number}) {\r\n    const part = partiallyEvaluatedSize;\r\n    if (sizeData.functionType === 'source') {\r\n        return symbol.lowerSize / 10;\r\n    } else if (sizeData.functionType === 'composite') {\r\n        return interpolate.number(symbol.lowerSize / 10, symbol.upperSize / 10, part.uSizeT);\r\n    } else {\r\n        return part.uSize;\r\n    }\r\n}\r\n\r\nfunction evaluateSizeForZoom(sizeData: SizeData, currentZoom: number, property: Property<number, PossiblyEvaluatedPropertyValue<number>>) {\r\n    if (sizeData.functionType === 'constant') {\r\n        return {\r\n            uSizeT: 0,\r\n            uSize: sizeData.layoutSize\r\n        };\r\n    } else if (sizeData.functionType === 'source') {\r\n        return {\r\n            uSizeT: 0,\r\n            uSize: 0\r\n        };\r\n    } else if (sizeData.functionType === 'camera') {\r\n        const {propertyValue, zoomRange, sizeRange} = sizeData;\r\n        const expression = ((normalizePropertyExpression(propertyValue, property.specification): any): CameraExpression);\r\n\r\n        // Even though we could get the exact value of the camera function\r\n        // at z = tr.zoom, we intentionally do not: instead, we interpolate\r\n        // between the camera function values at a pair of zoom stops covering\r\n        // [tileZoom, tileZoom + 1] in order to be consistent with this\r\n        // restriction on composite functions\r\n        const t = util.clamp(\r\n            expression.interpolationFactor(currentZoom, zoomRange.min, zoomRange.max),\r\n            0, 1);\r\n\r\n        return {\r\n            uSizeT: 0,\r\n            uSize: sizeRange.min + t * (sizeRange.max - sizeRange.min)\r\n        };\r\n    } else {\r\n        const {propertyValue, zoomRange} = sizeData;\r\n        const expression = ((normalizePropertyExpression(propertyValue, property.specification): any): CompositeExpression);\r\n\r\n        return {\r\n            uSizeT: util.clamp(expression.interpolationFactor(currentZoom, zoomRange.min, zoomRange.max), 0, 1),\r\n            uSize: 0\r\n        };\r\n    }\r\n}\r\n","// @flow\r\n\r\nmodule.exports = resolveTokens;\r\n\r\n/**\r\n * Replace tokens in a string template with values in an object\r\n *\r\n * @param properties a key/value relationship between tokens and replacements\r\n * @param text the template string\r\n * @returns the template with tokens replaced\r\n * @private\r\n */\r\nfunction resolveTokens(properties: {+[string]: mixed}, text: string): string {\r\n    return text.replace(/{([^{}]+)}/g, (match, key: string) => {\r\n        return key in properties ? String(properties[key]) : '';\r\n    }).replace(/FORMAT_NUMBER\\(([^\\)]+)\\)/g, (match, key) => formatNumber(key));\r\n}\r\n\r\n/*\r\nAfter tokens have been resolved, anything of the form FORMAT_NUMBER(...) will be passed\r\nthrough this function, which renders numbers in a short form:\r\n   123 => 0K\r\n   123456 => 123K\r\n   123456789 => 123.45M\r\n   1234567890 => 1,234M\r\n   123456789000 => 123,456M\r\n   1234567890000 => HUGE_NUM\r\n\r\n   (12000,null,2.2) => 26K  i.e. the third argument is an optional scaling factor\r\n\r\n   the second argument is currently unused, in future it may allow customizing of\r\n   the formatting in some way. \r\n*/\r\nfunction formatNumber(arg){\r\n\targ = arg.split(\",\"); //arg is a string, which may contain multiple arguments\r\n\tlet value = parseFloat(arg[0]); \r\n\tif(arg[2]){\r\n\t\tvalue = value*parseFloat(arg[2]);\r\n\t}\r\n\tif(value<1e3){\r\n\t\treturn Math.round(value);\r\n\t} else if (value<1e5){\r\n\t\treturn (value/1e3).toFixed(1) + 'K';\r\n\t} else if (value<1e6){\r\n\t\treturn Math.round(value/1e3) + 'K';\r\n\t} else if(value<1e9){\r\n\t\treturn (value/1e6).toFixed(2) + 'M';\r\n\t} else if(value<1e12){\r\n\t\tvalue = Math.round(value/1e6).toFixed(0);\r\n\t\treturn value.slice(0,-3) + ',' + value.slice(-4,-1) + 'M';\r\n\t} else {\r\n\t\treturn 'HUGE_NUM';\r\n\t}\r\n}","// This file is generated. Edit build/generate-style-code.js, then run `yarn run codegen`.\r\n// @flow\r\n/* eslint-disable */\r\n\r\nconst styleSpec = require('../../style-spec/reference/latest');\r\n\r\nconst {\r\n    Properties,\r\n    DataConstantProperty,\r\n    DataDrivenProperty,\r\n    CrossFadedProperty,\r\n    HeatmapColorProperty\r\n} = require('../properties');\r\n\r\nimport type Color from '../../style-spec/util/color';\r\n\r\nexport type LayoutProps = {|\r\n    \"symbol-placement\": DataConstantProperty<\"point\" | \"line\">,\r\n    \"symbol-spacing\": DataConstantProperty<number>,\r\n    \"symbol-avoid-edges\": DataConstantProperty<boolean>,\r\n    \"icon-allow-overlap\": DataConstantProperty<boolean>,\r\n    \"icon-ignore-placement\": DataConstantProperty<boolean>,\r\n    \"icon-optional\": DataConstantProperty<boolean>,\r\n    \"icon-rotation-alignment\": DataConstantProperty<\"map\" | \"viewport\" | \"auto\">,\r\n    \"icon-size\": DataDrivenProperty<number>,\r\n    \"icon-text-fit\": DataConstantProperty<\"none\" | \"width\" | \"height\" | \"both\">,\r\n    \"icon-text-fit-padding\": DataConstantProperty<[number, number, number, number]>,\r\n    \"icon-image\": DataDrivenProperty<string>,\r\n    \"icon-rotate\": DataDrivenProperty<number>,\r\n    \"icon-padding\": DataConstantProperty<number>,\r\n    \"icon-keep-upright\": DataConstantProperty<boolean>,\r\n    \"icon-offset\": DataDrivenProperty<[number, number]>,\r\n    \"icon-anchor\": DataDrivenProperty<\"center\" | \"left\" | \"right\" | \"top\" | \"bottom\" | \"top-left\" | \"top-right\" | \"bottom-left\" | \"bottom-right\">,\r\n    \"icon-pitch-alignment\": DataConstantProperty<\"map\" | \"viewport\" | \"auto\">,\r\n    \"text-pitch-alignment\": DataConstantProperty<\"map\" | \"viewport\" | \"auto\">,\r\n    \"text-rotation-alignment\": DataConstantProperty<\"map\" | \"viewport\" | \"auto\">,\r\n    \"text-field\": DataDrivenProperty<string>,\r\n    \"text-font\": DataDrivenProperty<Array<string>>,\r\n    \"text-size\": DataDrivenProperty<number>,\r\n    \"text-max-width\": DataDrivenProperty<number>,\r\n    \"text-line-height\": DataConstantProperty<number>,\r\n    \"text-letter-spacing\": DataDrivenProperty<number>,\r\n    \"text-justify\": DataDrivenProperty<\"left\" | \"center\" | \"right\">,\r\n    \"text-anchor\": DataDrivenProperty<\"center\" | \"left\" | \"right\" | \"top\" | \"bottom\" | \"top-left\" | \"top-right\" | \"bottom-left\" | \"bottom-right\">,\r\n    \"text-max-angle\": DataConstantProperty<number>,\r\n    \"text-rotate\": DataDrivenProperty<number>,\r\n    \"text-padding\": DataConstantProperty<number>,\r\n    \"text-keep-upright\": DataConstantProperty<boolean>,\r\n    \"text-transform\": DataDrivenProperty<\"none\" | \"uppercase\" | \"lowercase\">,\r\n    \"text-offset\": DataDrivenProperty<[number, number]>,\r\n    \"text-allow-overlap\": DataConstantProperty<boolean>,\r\n    \"text-ignore-placement\": DataConstantProperty<boolean>,\r\n    \"text-optional\": DataConstantProperty<boolean>,\r\n|};\r\n\r\nconst layout: Properties<LayoutProps> = new Properties({\r\n    \"symbol-placement\": new DataConstantProperty(styleSpec[\"layout_symbol\"][\"symbol-placement\"]),\r\n    \"symbol-spacing\": new DataConstantProperty(styleSpec[\"layout_symbol\"][\"symbol-spacing\"]),\r\n    \"symbol-avoid-edges\": new DataConstantProperty(styleSpec[\"layout_symbol\"][\"symbol-avoid-edges\"]),\r\n    \"icon-allow-overlap\": new DataConstantProperty(styleSpec[\"layout_symbol\"][\"icon-allow-overlap\"]),\r\n    \"icon-ignore-placement\": new DataConstantProperty(styleSpec[\"layout_symbol\"][\"icon-ignore-placement\"]),\r\n    \"icon-optional\": new DataConstantProperty(styleSpec[\"layout_symbol\"][\"icon-optional\"]),\r\n    \"icon-rotation-alignment\": new DataConstantProperty(styleSpec[\"layout_symbol\"][\"icon-rotation-alignment\"]),\r\n    \"icon-size\": new DataDrivenProperty(styleSpec[\"layout_symbol\"][\"icon-size\"]),\r\n    \"icon-text-fit\": new DataConstantProperty(styleSpec[\"layout_symbol\"][\"icon-text-fit\"]),\r\n    \"icon-text-fit-padding\": new DataConstantProperty(styleSpec[\"layout_symbol\"][\"icon-text-fit-padding\"]),\r\n    \"icon-image\": new DataDrivenProperty(styleSpec[\"layout_symbol\"][\"icon-image\"]),\r\n    \"icon-rotate\": new DataDrivenProperty(styleSpec[\"layout_symbol\"][\"icon-rotate\"]),\r\n    \"icon-padding\": new DataConstantProperty(styleSpec[\"layout_symbol\"][\"icon-padding\"]),\r\n    \"icon-keep-upright\": new DataConstantProperty(styleSpec[\"layout_symbol\"][\"icon-keep-upright\"]),\r\n    \"icon-offset\": new DataDrivenProperty(styleSpec[\"layout_symbol\"][\"icon-offset\"]),\r\n    \"icon-anchor\": new DataDrivenProperty(styleSpec[\"layout_symbol\"][\"icon-anchor\"]),\r\n    \"icon-pitch-alignment\": new DataConstantProperty(styleSpec[\"layout_symbol\"][\"icon-pitch-alignment\"]),\r\n    \"text-pitch-alignment\": new DataConstantProperty(styleSpec[\"layout_symbol\"][\"text-pitch-alignment\"]),\r\n    \"text-rotation-alignment\": new DataConstantProperty(styleSpec[\"layout_symbol\"][\"text-rotation-alignment\"]),\r\n    \"text-field\": new DataDrivenProperty(styleSpec[\"layout_symbol\"][\"text-field\"]),\r\n    \"text-font\": new DataDrivenProperty(styleSpec[\"layout_symbol\"][\"text-font\"]),\r\n    \"text-size\": new DataDrivenProperty(styleSpec[\"layout_symbol\"][\"text-size\"]),\r\n    \"text-max-width\": new DataDrivenProperty(styleSpec[\"layout_symbol\"][\"text-max-width\"]),\r\n    \"text-line-height\": new DataConstantProperty(styleSpec[\"layout_symbol\"][\"text-line-height\"]),\r\n    \"text-letter-spacing\": new DataDrivenProperty(styleSpec[\"layout_symbol\"][\"text-letter-spacing\"]),\r\n    \"text-justify\": new DataDrivenProperty(styleSpec[\"layout_symbol\"][\"text-justify\"]),\r\n    \"text-anchor\": new DataDrivenProperty(styleSpec[\"layout_symbol\"][\"text-anchor\"]),\r\n    \"text-max-angle\": new DataConstantProperty(styleSpec[\"layout_symbol\"][\"text-max-angle\"]),\r\n    \"text-rotate\": new DataDrivenProperty(styleSpec[\"layout_symbol\"][\"text-rotate\"]),\r\n    \"text-padding\": new DataConstantProperty(styleSpec[\"layout_symbol\"][\"text-padding\"]),\r\n    \"text-keep-upright\": new DataConstantProperty(styleSpec[\"layout_symbol\"][\"text-keep-upright\"]),\r\n    \"text-transform\": new DataDrivenProperty(styleSpec[\"layout_symbol\"][\"text-transform\"]),\r\n    \"text-offset\": new DataDrivenProperty(styleSpec[\"layout_symbol\"][\"text-offset\"]),\r\n    \"text-allow-overlap\": new DataConstantProperty(styleSpec[\"layout_symbol\"][\"text-allow-overlap\"]),\r\n    \"text-ignore-placement\": new DataConstantProperty(styleSpec[\"layout_symbol\"][\"text-ignore-placement\"]),\r\n    \"text-optional\": new DataConstantProperty(styleSpec[\"layout_symbol\"][\"text-optional\"]),\r\n});\r\n\r\nexport type PaintProps = {|\r\n    \"icon-opacity\": DataDrivenProperty<number>,\r\n    \"icon-color\": DataDrivenProperty<Color>,\r\n    \"icon-halo-color\": DataDrivenProperty<Color>,\r\n    \"icon-halo-width\": DataDrivenProperty<number>,\r\n    \"icon-halo-blur\": DataDrivenProperty<number>,\r\n    \"icon-translate\": DataConstantProperty<[number, number]>,\r\n    \"icon-translate-anchor\": DataConstantProperty<\"map\" | \"viewport\">,\r\n    \"text-opacity\": DataDrivenProperty<number>,\r\n    \"text-color\": DataDrivenProperty<Color>,\r\n    \"text-halo-color\": DataDrivenProperty<Color>,\r\n    \"text-halo-width\": DataDrivenProperty<number>,\r\n    \"text-halo-blur\": DataDrivenProperty<number>,\r\n    \"text-translate\": DataConstantProperty<[number, number]>,\r\n    \"text-translate-anchor\": DataConstantProperty<\"map\" | \"viewport\">,\r\n|};\r\n\r\nconst paint: Properties<PaintProps> = new Properties({\r\n    \"icon-opacity\": new DataDrivenProperty(styleSpec[\"paint_symbol\"][\"icon-opacity\"]),\r\n    \"icon-color\": new DataDrivenProperty(styleSpec[\"paint_symbol\"][\"icon-color\"]),\r\n    \"icon-halo-color\": new DataDrivenProperty(styleSpec[\"paint_symbol\"][\"icon-halo-color\"]),\r\n    \"icon-halo-width\": new DataDrivenProperty(styleSpec[\"paint_symbol\"][\"icon-halo-width\"]),\r\n    \"icon-halo-blur\": new DataDrivenProperty(styleSpec[\"paint_symbol\"][\"icon-halo-blur\"]),\r\n    \"icon-translate\": new DataConstantProperty(styleSpec[\"paint_symbol\"][\"icon-translate\"]),\r\n    \"icon-translate-anchor\": new DataConstantProperty(styleSpec[\"paint_symbol\"][\"icon-translate-anchor\"]),\r\n    \"text-opacity\": new DataDrivenProperty(styleSpec[\"paint_symbol\"][\"text-opacity\"]),\r\n    \"text-color\": new DataDrivenProperty(styleSpec[\"paint_symbol\"][\"text-color\"]),\r\n    \"text-halo-color\": new DataDrivenProperty(styleSpec[\"paint_symbol\"][\"text-halo-color\"]),\r\n    \"text-halo-width\": new DataDrivenProperty(styleSpec[\"paint_symbol\"][\"text-halo-width\"]),\r\n    \"text-halo-blur\": new DataDrivenProperty(styleSpec[\"paint_symbol\"][\"text-halo-blur\"]),\r\n    \"text-translate\": new DataConstantProperty(styleSpec[\"paint_symbol\"][\"text-translate\"]),\r\n    \"text-translate-anchor\": new DataConstantProperty(styleSpec[\"paint_symbol\"][\"text-translate-anchor\"]),\r\n});\r\n\r\nmodule.exports = { paint, layout };\r\n","// @flow\r\n\r\nconst StyleLayer = require('../style_layer');\r\nconst properties = require('./background_style_layer_properties');\r\n\r\nconst {\r\n    Transitionable,\r\n    Transitioning,\r\n    PossiblyEvaluated\r\n} = require('../properties');\r\n\r\nimport type {PaintProps} from './background_style_layer_properties';\r\n\r\nclass BackgroundStyleLayer extends StyleLayer {\r\n    _transitionablePaint: Transitionable<PaintProps>;\r\n    _transitioningPaint: Transitioning<PaintProps>;\r\n    paint: PossiblyEvaluated<PaintProps>;\r\n\r\n    constructor(layer: LayerSpecification) {\r\n        super(layer, properties);\r\n    }\r\n}\r\n\r\nmodule.exports = BackgroundStyleLayer;\r\n","// This file is generated. Edit build/generate-style-code.js, then run `yarn run codegen`.\r\n// @flow\r\n/* eslint-disable */\r\n\r\nconst styleSpec = require('../../style-spec/reference/latest');\r\n\r\nconst {\r\n    Properties,\r\n    DataConstantProperty,\r\n    DataDrivenProperty,\r\n    CrossFadedProperty,\r\n    HeatmapColorProperty\r\n} = require('../properties');\r\n\r\nimport type Color from '../../style-spec/util/color';\r\n\r\n\r\nexport type PaintProps = {|\r\n    \"background-color\": DataConstantProperty<Color>,\r\n    \"background-pattern\": CrossFadedProperty<string>,\r\n    \"background-opacity\": DataConstantProperty<number>,\r\n|};\r\n\r\nconst paint: Properties<PaintProps> = new Properties({\r\n    \"background-color\": new DataConstantProperty(styleSpec[\"paint_background\"][\"background-color\"]),\r\n    \"background-pattern\": new CrossFadedProperty(styleSpec[\"paint_background\"][\"background-pattern\"]),\r\n    \"background-opacity\": new DataConstantProperty(styleSpec[\"paint_background\"][\"background-opacity\"]),\r\n});\r\n\r\nmodule.exports = { paint };\r\n","// @flow\r\n\r\nconst StyleLayer = require('../style_layer');\r\nconst properties = require('./raster_style_layer_properties');\r\n\r\nconst {\r\n    Transitionable,\r\n    Transitioning,\r\n    PossiblyEvaluated\r\n} = require('../properties');\r\n\r\nimport type {PaintProps} from './raster_style_layer_properties';\r\n\r\nclass RasterStyleLayer extends StyleLayer {\r\n    _transitionablePaint: Transitionable<PaintProps>;\r\n    _transitioningPaint: Transitioning<PaintProps>;\r\n    paint: PossiblyEvaluated<PaintProps>;\r\n\r\n    constructor(layer: LayerSpecification) {\r\n        super(layer, properties);\r\n    }\r\n}\r\n\r\nmodule.exports = RasterStyleLayer;\r\n","// This file is generated. Edit build/generate-style-code.js, then run `yarn run codegen`.\r\n// @flow\r\n/* eslint-disable */\r\n\r\nconst styleSpec = require('../../style-spec/reference/latest');\r\n\r\nconst {\r\n    Properties,\r\n    DataConstantProperty,\r\n    DataDrivenProperty,\r\n    CrossFadedProperty,\r\n    HeatmapColorProperty\r\n} = require('../properties');\r\n\r\nimport type Color from '../../style-spec/util/color';\r\n\r\n\r\nexport type PaintProps = {|\r\n    \"raster-opacity\": DataConstantProperty<number>,\r\n    \"raster-hue-rotate\": DataConstantProperty<number>,\r\n    \"raster-brightness-min\": DataConstantProperty<number>,\r\n    \"raster-brightness-max\": DataConstantProperty<number>,\r\n    \"raster-saturation\": DataConstantProperty<number>,\r\n    \"raster-contrast\": DataConstantProperty<number>,\r\n    \"raster-fade-duration\": DataConstantProperty<number>,\r\n|};\r\n\r\nconst paint: Properties<PaintProps> = new Properties({\r\n    \"raster-opacity\": new DataConstantProperty(styleSpec[\"paint_raster\"][\"raster-opacity\"]),\r\n    \"raster-hue-rotate\": new DataConstantProperty(styleSpec[\"paint_raster\"][\"raster-hue-rotate\"]),\r\n    \"raster-brightness-min\": new DataConstantProperty(styleSpec[\"paint_raster\"][\"raster-brightness-min\"]),\r\n    \"raster-brightness-max\": new DataConstantProperty(styleSpec[\"paint_raster\"][\"raster-brightness-max\"]),\r\n    \"raster-saturation\": new DataConstantProperty(styleSpec[\"paint_raster\"][\"raster-saturation\"]),\r\n    \"raster-contrast\": new DataConstantProperty(styleSpec[\"paint_raster\"][\"raster-contrast\"]),\r\n    \"raster-fade-duration\": new DataConstantProperty(styleSpec[\"paint_raster\"][\"raster-fade-duration\"]),\r\n});\r\n\r\nmodule.exports = { paint };\r\n","\r\nconst refProperties = require('./util/ref_properties');\r\n\r\nfunction stringify(obj) {\r\n    const type = typeof obj;\r\n    if (type === 'number' || type === 'boolean' || type === 'string' || obj === undefined || obj === null)\r\n        return JSON.stringify(obj);\r\n\r\n    if (Array.isArray(obj)) {\r\n        let str = '[';\r\n        for (const val of obj) {\r\n            str += `${stringify(val)},`;\r\n        }\r\n        return `${str}]`;\r\n    }\r\n\r\n    const keys = Object.keys(obj).sort();\r\n\r\n    let str = '{';\r\n    for (let i = 0; i < keys.length; i++) {\r\n        str += `${JSON.stringify(keys[i])}:${stringify(obj[keys[i]])},`;\r\n    }\r\n    return `${str}}`;\r\n}\r\n\r\nfunction getKey(layer) {\r\n    let key = '';\r\n    for (const k of refProperties) {\r\n        key += `/${stringify(layer[k])}`;\r\n    }\r\n    return key;\r\n}\r\n\r\nmodule.exports = groupByLayout;\r\n\r\n/**\r\n * Given an array of layers, return an array of arrays of layers where all\r\n * layers in each group have identical layout-affecting properties. These\r\n * are the properties that were formerly used by explicit `ref` mechanism\r\n * for layers: 'type', 'source', 'source-layer', 'minzoom', 'maxzoom',\r\n * 'filter', and 'layout'.\r\n *\r\n * The input is not modified. The output layers are references to the\r\n * input layers.\r\n *\r\n * @private\r\n * @param {Array<Layer>} layers\r\n * @returns {Array<Array<Layer>>}\r\n */\r\nfunction groupByLayout(layers) {\r\n    const groups = {};\r\n\r\n    for (let i = 0; i < layers.length; i++) {\r\n        const k = getKey(layers[i]);\r\n        let group = groups[k];\r\n        if (!group) {\r\n            group = groups[k] = [];\r\n        }\r\n        group.push(layers[i]);\r\n    }\r\n\r\n    const result = [];\r\n\r\n    for (const k in groups) {\r\n        result.push(groups[k]);\r\n    }\r\n\r\n    return result;\r\n}\r\n","\r\nmodule.exports = ['type', 'source', 'source-layer', 'minzoom', 'maxzoom', 'filter', 'layout'];\r\n","exports.read = function (buffer, offset, isLE, mLen, nBytes) {\n  var e, m\n  var eLen = nBytes * 8 - mLen - 1\n  var eMax = (1 << eLen) - 1\n  var eBias = eMax >> 1\n  var nBits = -7\n  var i = isLE ? (nBytes - 1) : 0\n  var d = isLE ? -1 : 1\n  var s = buffer[offset + i]\n\n  i += d\n\n  e = s & ((1 << (-nBits)) - 1)\n  s >>= (-nBits)\n  nBits += eLen\n  for (; nBits > 0; e = e * 256 + buffer[offset + i], i += d, nBits -= 8) {}\n\n  m = e & ((1 << (-nBits)) - 1)\n  e >>= (-nBits)\n  nBits += mLen\n  for (; nBits > 0; m = m * 256 + buffer[offset + i], i += d, nBits -= 8) {}\n\n  if (e === 0) {\n    e = 1 - eBias\n  } else if (e === eMax) {\n    return m ? NaN : ((s ? -1 : 1) * Infinity)\n  } else {\n    m = m + Math.pow(2, mLen)\n    e = e - eBias\n  }\n  return (s ? -1 : 1) * m * Math.pow(2, e - mLen)\n}\n\nexports.write = function (buffer, value, offset, isLE, mLen, nBytes) {\n  var e, m, c\n  var eLen = nBytes * 8 - mLen - 1\n  var eMax = (1 << eLen) - 1\n  var eBias = eMax >> 1\n  var rt = (mLen === 23 ? Math.pow(2, -24) - Math.pow(2, -77) : 0)\n  var i = isLE ? 0 : (nBytes - 1)\n  var d = isLE ? 1 : -1\n  var s = value < 0 || (value === 0 && 1 / value < 0) ? 1 : 0\n\n  value = Math.abs(value)\n\n  if (isNaN(value) || value === Infinity) {\n    m = isNaN(value) ? 1 : 0\n    e = eMax\n  } else {\n    e = Math.floor(Math.log(value) / Math.LN2)\n    if (value * (c = Math.pow(2, -e)) < 1) {\n      e--\n      c *= 2\n    }\n    if (e + eBias >= 1) {\n      value += rt / c\n    } else {\n      value += rt * Math.pow(2, 1 - eBias)\n    }\n    if (value * c >= 2) {\n      e++\n      c /= 2\n    }\n\n    if (e + eBias >= eMax) {\n      m = 0\n      e = eMax\n    } else if (e + eBias >= 1) {\n      m = (value * c - 1) * Math.pow(2, mLen)\n      e = e + eBias\n    } else {\n      m = value * Math.pow(2, eBias - 1) * Math.pow(2, mLen)\n      e = 0\n    }\n  }\n\n  for (; mLen >= 8; buffer[offset + i] = m & 0xff, i += d, m /= 256, mLen -= 8) {}\n\n  e = (e << mLen) | m\n  eLen += mLen\n  for (; eLen > 0; buffer[offset + i] = e & 0xff, i += d, e /= 256, eLen -= 8) {}\n\n  buffer[offset + i - d] |= s * 128\n}\n","// @flow\r\n\r\nconst FeatureIndex = require('../data/feature_index');\r\nconst {performSymbolLayout} = require('../symbol/symbol_layout');\r\nconst {CollisionBoxArray} = require('../data/array_types');\r\nconst DictionaryCoder = require('../util/dictionary_coder');\r\nconst SymbolBucket = require('../data/bucket/symbol_bucket');\r\nconst util = require('../util/util');\r\nconst assert = require('assert');\r\nconst {makeImageAtlas} = require('../render/image_atlas');\r\nconst {makeGlyphAtlas} = require('../render/glyph_atlas');\r\nconst EvaluationParameters = require('../style/evaluation_parameters');\r\nconst {OverscaledTileID} = require('./tile_id');\r\n\r\nimport type {Bucket} from '../data/bucket';\r\nimport type Actor from '../util/actor';\r\nimport type StyleLayer from '../style/style_layer';\r\nimport type StyleLayerIndex from '../style/style_layer_index';\r\nimport type {StyleImage} from '../style/style_image';\r\nimport type {StyleGlyph} from '../style/style_glyph';\r\nimport type {\r\n    WorkerTileParameters,\r\n    WorkerTileCallback,\r\n} from '../source/worker_source';\r\n\r\nclass WorkerTile {\r\n    tileID: OverscaledTileID;\r\n    uid: string;\r\n    zoom: number;\r\n    pixelRatio: number;\r\n    tileSize: number;\r\n    source: string;\r\n    overscaling: number;\r\n    showCollisionBoxes: boolean;\r\n\r\n    status: 'parsing' | 'done';\r\n    data: VectorTile;\r\n    collisionBoxArray: CollisionBoxArray;\r\n\r\n    abort: ?() => void;\r\n    reloadCallback: WorkerTileCallback;\r\n    vectorTile: VectorTile;\r\n\r\n    constructor(params: WorkerTileParameters) {\r\n        this.tileID = new OverscaledTileID(params.tileID.overscaledZ, params.tileID.wrap, params.tileID.canonical.z, params.tileID.canonical.x, params.tileID.canonical.y);\r\n        this.uid = params.uid;\r\n        this.zoom = params.zoom;\r\n        this.pixelRatio = params.pixelRatio;\r\n        this.tileSize = params.tileSize;\r\n        this.source = params.source;\r\n        this.overscaling = params.overscaling;\r\n        this.showCollisionBoxes = params.showCollisionBoxes;\r\n    }\r\n\r\n    parse(data: VectorTile, layerIndex: StyleLayerIndex, actor: Actor, callback: WorkerTileCallback) {\r\n        this.status = 'parsing';\r\n        this.data = data;\r\n\r\n        this.collisionBoxArray = new CollisionBoxArray();\r\n        const sourceLayerCoder = new DictionaryCoder(Object.keys(data.layers).sort());\r\n\r\n        const featureIndex = new FeatureIndex(this.tileID, this.overscaling);\r\n        featureIndex.bucketLayerIDs = [];\r\n\r\n        const buckets: {[string]: Bucket} = {};\r\n\r\n        const options = {\r\n            featureIndex: featureIndex,\r\n            iconDependencies: {},\r\n            glyphDependencies: {}\r\n        };\r\n\r\n        const layerFamilies = layerIndex.familiesBySource[this.source];\r\n        for (const sourceLayerId in layerFamilies) {\r\n            const sourceLayer = data.layers[sourceLayerId];\r\n            if (!sourceLayer) {\r\n                continue;\r\n            }\r\n\r\n            if (sourceLayer.version === 1) {\r\n                util.warnOnce(`Vector tile source \"${this.source}\" layer \"${sourceLayerId}\" ` +\r\n                    `does not use vector tile spec v2 and therefore may have some rendering errors.`);\r\n            }\r\n\r\n            const sourceLayerIndex = sourceLayerCoder.encode(sourceLayerId);\r\n            const features = [];\r\n            for (let index = 0; index < sourceLayer.length; index++) {\r\n                const feature = sourceLayer.feature(index);\r\n                features.push({ feature, index, sourceLayerIndex });\r\n            }\r\n\r\n            for (const family of layerFamilies[sourceLayerId]) {\r\n                const layer = family[0];\r\n\r\n                assert(layer.source === this.source);\r\n                if (layer.minzoom && this.zoom < Math.floor(layer.minzoom)) continue;\r\n                if (layer.maxzoom && this.zoom >= layer.maxzoom) continue;\r\n                if (layer.visibility === 'none') continue;\r\n\r\n                recalculateLayers(family, this.zoom);\r\n\r\n                const bucket = buckets[layer.id] = layer.createBucket({\r\n                    index: featureIndex.bucketLayerIDs.length,\r\n                    layers: family,\r\n                    zoom: this.zoom,\r\n                    pixelRatio: this.pixelRatio,\r\n                    overscaling: this.overscaling,\r\n                    collisionBoxArray: this.collisionBoxArray\r\n                });\r\n\r\n                bucket.populate(features, options);\r\n                featureIndex.bucketLayerIDs.push(family.map((l) => l.id));\r\n            }\r\n        }\r\n\r\n        let error: ?Error;\r\n        let glyphMap: ?{[string]: {[number]: ?StyleGlyph}};\r\n        let imageMap: ?{[string]: StyleImage};\r\n\r\n        const stacks = util.mapObject(options.glyphDependencies, (glyphs) => Object.keys(glyphs).map(Number));\r\n        if (Object.keys(stacks).length) {\r\n            actor.send('getGlyphs', {uid: this.uid, stacks}, (err, result) => {\r\n                if (!error) {\r\n                    error = err;\r\n                    glyphMap = result;\r\n                    maybePrepare.call(this);\r\n                }\r\n            });\r\n        } else {\r\n            glyphMap = {};\r\n        }\r\n\r\n        const icons = Object.keys(options.iconDependencies);\r\n        if (icons.length) {\r\n            actor.send('getImages', {icons}, (err, result) => {\r\n                if (!error) {\r\n                    error = err;\r\n                    imageMap = result;\r\n                    maybePrepare.call(this);\r\n                }\r\n            });\r\n        } else {\r\n            imageMap = {};\r\n        }\r\n\r\n        maybePrepare.call(this);\r\n\r\n        function maybePrepare() {\r\n            if (error) {\r\n                return callback(error);\r\n            } else if (glyphMap && imageMap) {\r\n                const glyphAtlas = makeGlyphAtlas(glyphMap);\r\n                const imageAtlas = makeImageAtlas(imageMap);\r\n\r\n                for (const key in buckets) {\r\n                    const bucket = buckets[key];\r\n                    if (bucket instanceof SymbolBucket) {\r\n                        recalculateLayers(bucket.layers, this.zoom);\r\n                        performSymbolLayout(bucket, glyphMap, glyphAtlas.positions, imageMap, imageAtlas.positions, this.showCollisionBoxes);\r\n                    }\r\n                }\r\n\r\n                this.status = 'done';\r\n\r\n                callback(null, {\r\n                    buckets: util.values(buckets).filter(b => !b.isEmpty()),\r\n                    featureIndex,\r\n                    collisionBoxArray: this.collisionBoxArray,\r\n                    glyphAtlasImage: glyphAtlas.image,\r\n                    iconAtlasImage: imageAtlas.image\r\n                });\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nfunction recalculateLayers(layers: $ReadOnlyArray<StyleLayer>, zoom: number) {\r\n    // Layers are shared and may have been used by a WorkerTile with a different zoom.\r\n    const parameters = new EvaluationParameters(zoom);\r\n    for (const layer of layers) {\r\n        layer.recalculate(parameters);\r\n    }\r\n}\r\n\r\nmodule.exports = WorkerTile;\r\n","// @flow\r\n\r\nconst Point = require('@mapbox/point-geometry');\r\nconst loadGeometry = require('./load_geometry');\r\nconst EXTENT = require('./extent');\r\nconst featureFilter = require('../style-spec/feature_filter');\r\nconst Grid = require('grid-index');\r\nconst DictionaryCoder = require('../util/dictionary_coder');\r\nconst vt = require('@mapbox/vector-tile');\r\nconst Protobuf = require('pbf');\r\nconst GeoJSONFeature = require('../util/vectortile_to_geojson');\r\nconst arraysIntersect = require('../util/util').arraysIntersect;\r\nconst {OverscaledTileID} = require('../source/tile_id');\r\nconst {register} = require('../util/web_worker_transfer');\r\n\r\nimport type CollisionIndex from '../symbol/collision_index';\r\nimport type StyleLayer from '../style/style_layer';\r\nimport type {FeatureFilter} from '../style-spec/feature_filter';\r\nimport type {CollisionBoxArray} from './array_types';\r\n\r\nconst {FeatureIndexArray} = require('./array_types');\r\n\r\ntype QueryParameters = {\r\n    scale: number,\r\n    bearing: number,\r\n    tileSize: number,\r\n    queryGeometry: Array<Array<Point>>,\r\n    additionalRadius: number,\r\n    params: {\r\n        filter: FilterSpecification,\r\n        layers: Array<string>,\r\n    },\r\n    collisionBoxArray: CollisionBoxArray,\r\n    sourceID: string,\r\n    bucketInstanceIds: { [number]: boolean },\r\n    collisionIndex: CollisionIndex\r\n}\r\n\r\nclass FeatureIndex {\r\n    tileID: OverscaledTileID;\r\n    overscaling: number;\r\n    x: number;\r\n    y: number;\r\n    z: number;\r\n    grid: Grid;\r\n    featureIndexArray: FeatureIndexArray;\r\n\r\n    rawTileData: ArrayBuffer;\r\n    bucketLayerIDs: Array<Array<string>>;\r\n\r\n    vtLayers: {[string]: VectorTileLayer};\r\n    sourceLayerCoder: DictionaryCoder;\r\n\r\n    collisionIndex: CollisionIndex;\r\n\r\n    constructor(tileID: OverscaledTileID,\r\n                overscaling: number,\r\n                grid?: Grid,\r\n                featureIndexArray?: FeatureIndexArray) {\r\n        this.tileID = tileID;\r\n        this.overscaling = overscaling;\r\n        this.x = tileID.canonical.x;\r\n        this.y = tileID.canonical.y;\r\n        this.z = tileID.canonical.z;\r\n        this.grid = grid || new Grid(EXTENT, 16, 0);\r\n        this.featureIndexArray = featureIndexArray || new FeatureIndexArray();\r\n    }\r\n\r\n    insert(feature: VectorTileFeature, geometry: Array<Array<Point>>, featureIndex: number, sourceLayerIndex: number, bucketIndex: number) {\r\n        const key = this.featureIndexArray.length;\r\n        this.featureIndexArray.emplaceBack(featureIndex, sourceLayerIndex, bucketIndex);\r\n\r\n        for (let r = 0; r < geometry.length; r++) {\r\n            const ring = geometry[r];\r\n\r\n            const bbox = [Infinity, Infinity, -Infinity, -Infinity];\r\n            for (let i = 0; i < ring.length; i++) {\r\n                const p = ring[i];\r\n                bbox[0] = Math.min(bbox[0], p.x);\r\n                bbox[1] = Math.min(bbox[1], p.y);\r\n                bbox[2] = Math.max(bbox[2], p.x);\r\n                bbox[3] = Math.max(bbox[3], p.y);\r\n            }\r\n\r\n            this.grid.insert(key, bbox[0], bbox[1], bbox[2], bbox[3]);\r\n        }\r\n    }\r\n\r\n    // Finds features in this tile at a particular position.\r\n    query(args: QueryParameters, styleLayers: {[string]: StyleLayer}) {\r\n        if (!this.vtLayers) {\r\n            this.vtLayers = new vt.VectorTile(new Protobuf(this.rawTileData)).layers;\r\n            this.sourceLayerCoder = new DictionaryCoder(this.vtLayers ? Object.keys(this.vtLayers).sort() : ['_geojsonTileLayer']);\r\n        }\r\n\r\n        const result = {};\r\n\r\n        const params = args.params || {},\r\n            pixelsToTileUnits = EXTENT / args.tileSize / args.scale,\r\n            filter = featureFilter(params.filter);\r\n\r\n        const queryGeometry = args.queryGeometry;\r\n        const additionalRadius = args.additionalRadius * pixelsToTileUnits;\r\n\r\n        let minX = Infinity;\r\n        let minY = Infinity;\r\n        let maxX = -Infinity;\r\n        let maxY = -Infinity;\r\n        for (let i = 0; i < queryGeometry.length; i++) {\r\n            const ring = queryGeometry[i];\r\n            for (let k = 0; k < ring.length; k++) {\r\n                const p = ring[k];\r\n                minX = Math.min(minX, p.x);\r\n                minY = Math.min(minY, p.y);\r\n                maxX = Math.max(maxX, p.x);\r\n                maxY = Math.max(maxY, p.y);\r\n            }\r\n        }\r\n\r\n        const matching = this.grid.query(minX - additionalRadius, minY - additionalRadius, maxX + additionalRadius, maxY + additionalRadius);\r\n        matching.sort(topDownFeatureComparator);\r\n        this.filterMatching(result, matching, this.featureIndexArray, queryGeometry, filter, params.layers, styleLayers, args.bearing, pixelsToTileUnits);\r\n\r\n        const matchingSymbols = args.collisionIndex ?\r\n            args.collisionIndex.queryRenderedSymbols(queryGeometry, this.tileID, EXTENT / args.tileSize, args.collisionBoxArray, args.sourceID, args.bucketInstanceIds) :\r\n            [];\r\n        matchingSymbols.sort();\r\n        this.filterMatching(result, matchingSymbols, args.collisionBoxArray, queryGeometry, filter, params.layers, styleLayers, args.bearing, pixelsToTileUnits);\r\n\r\n        return result;\r\n    }\r\n\r\n    filterMatching(\r\n        result: {[string]: Array<{ featureIndex: number, feature: GeoJSONFeature }>},\r\n        matching: Array<any>,\r\n        array: FeatureIndexArray | CollisionBoxArray,\r\n        queryGeometry: Array<Array<Point>>,\r\n        filter: FeatureFilter,\r\n        filterLayerIDs: Array<string>,\r\n        styleLayers: {[string]: StyleLayer},\r\n        bearing: number,\r\n        pixelsToTileUnits: number\r\n    ) {\r\n        let previousIndex;\r\n        for (let k = 0; k < matching.length; k++) {\r\n            const index = matching[k];\r\n\r\n            // don't check the same feature more than once\r\n            if (index === previousIndex) continue;\r\n            previousIndex = index;\r\n\r\n            const match = array.get(index);\r\n\r\n            const layerIDs = this.bucketLayerIDs[match.bucketIndex];\r\n            if (filterLayerIDs && !arraysIntersect(filterLayerIDs, layerIDs)) continue;\r\n\r\n            const sourceLayerName = this.sourceLayerCoder.decode(match.sourceLayerIndex);\r\n            const sourceLayer = this.vtLayers[sourceLayerName];\r\n            const feature = sourceLayer.feature(match.featureIndex);\r\n\r\n            if (!filter({zoom: this.tileID.overscaledZ}, feature)) continue;\r\n\r\n            let geometry = null;\r\n\r\n            for (let l = 0; l < layerIDs.length; l++) {\r\n                const layerID = layerIDs[l];\r\n\r\n                if (filterLayerIDs && filterLayerIDs.indexOf(layerID) < 0) {\r\n                    continue;\r\n                }\r\n\r\n                const styleLayer = styleLayers[layerID];\r\n                if (!styleLayer) continue;\r\n\r\n                if (styleLayer.type !== 'symbol') {\r\n                    // all symbols already match the style\r\n                    if (!geometry) {\r\n                        geometry = loadGeometry(feature);\r\n                    }\r\n                    if (!styleLayer.queryIntersectsFeature(queryGeometry, feature, geometry, this.z, bearing, pixelsToTileUnits)) {\r\n                        continue;\r\n                    }\r\n                }\r\n\r\n                const geojsonFeature = new GeoJSONFeature(feature, this.z, this.x, this.y);\r\n                (geojsonFeature: any).layer = styleLayer.serialize();\r\n                let layerResult = result[layerID];\r\n                if (layerResult === undefined) {\r\n                    layerResult = result[layerID] = [];\r\n                }\r\n                layerResult.push({ featureIndex: index, feature: geojsonFeature });\r\n            }\r\n        }\r\n    }\r\n\r\n    hasLayer(id: string) {\r\n        for (const layerIDs of this.bucketLayerIDs) {\r\n            for (const layerID of layerIDs) {\r\n                if (id === layerID) return true;\r\n            }\r\n        }\r\n\r\n        return false;\r\n    }\r\n}\r\n\r\nregister(\r\n    'FeatureIndex',\r\n    FeatureIndex,\r\n    { omit: ['rawTileData', 'sourceLayerCoder', 'collisionIndex'] }\r\n);\r\n\r\nmodule.exports = FeatureIndex;\r\n\r\nfunction topDownFeatureComparator(a, b) {\r\n    return b - a;\r\n}\r\n","// @flow\r\n\r\nclass Feature {\r\n    type: 'Feature';\r\n    _geometry: ?GeoJSONGeometry;\r\n    properties: {};\r\n    id: number | string | void;\r\n\r\n    _vectorTileFeature: VectorTileFeature;\r\n\r\n    constructor(vectorTileFeature: VectorTileFeature, z: number, x: number, y: number) {\r\n        this.type = 'Feature';\r\n\r\n        this._vectorTileFeature = vectorTileFeature;\r\n        (vectorTileFeature: any)._z = z;\r\n        (vectorTileFeature: any)._x = x;\r\n        (vectorTileFeature: any)._y = y;\r\n\r\n        this.properties = vectorTileFeature.properties;\r\n\r\n        if (vectorTileFeature.id != null) {\r\n            this.id = vectorTileFeature.id;\r\n        }\r\n    }\r\n\r\n    get geometry(): ?GeoJSONGeometry {\r\n        if (this._geometry === undefined) {\r\n            this._geometry = this._vectorTileFeature.toGeoJSON(\r\n                (this._vectorTileFeature: any)._x,\r\n                (this._vectorTileFeature: any)._y,\r\n                (this._vectorTileFeature: any)._z).geometry;\r\n        }\r\n        return this._geometry;\r\n    }\r\n\r\n    set geometry(g: ?GeoJSONGeometry) {\r\n        this._geometry = g;\r\n    }\r\n\r\n    toJSON() {\r\n        const json = {\r\n            geometry: this.geometry\r\n        };\r\n        for (const i in this) {\r\n            if (i === '_geometry' || i === '_vectorTileFeature') continue;\r\n            json[i] = (this: any)[i];\r\n        }\r\n        return json;\r\n    }\r\n}\r\n\r\nmodule.exports = Feature;\r\n","(function (global, factory) {\n\ttypeof exports === 'object' && typeof module !== 'undefined' ? factory(exports) :\n\ttypeof define === 'function' && define.amd ? define(['exports'], factory) :\n\t(factory((global.WhooTS = global.WhooTS || {})));\n}(this, (function (exports) {\n\n/**\n * getURL\n *\n * @param    {String}  baseUrl  Base url of the WMS server\n * @param    {String}  layer    Layer name\n * @param    {Number}  x        Tile coordinate x\n * @param    {Number}  y        Tile coordinate y\n * @param    {Number}  z        Tile zoom\n * @param    {Object}  [options]\n * @param    {String}  [options.format='image/png']\n * @param    {String}  [options.service='WMS']\n * @param    {String}  [options.version='1.1.1']\n * @param    {String}  [options.request='GetMap']\n * @param    {String}  [options.srs='EPSG:3857']\n * @param    {Number}  [options.width='256']\n * @param    {Number}  [options.height='256']\n * @returns  {String}  url\n * @example\n * var baseUrl = 'http://geodata.state.nj.us/imagerywms/Natural2015';\n * var layer = 'Natural2015';\n * var url = whoots.getURL(baseUrl, layer, 154308, 197167, 19);\n */\nfunction getURL(baseUrl, layer, x, y, z, options) {\n    options = options || {};\n\n    var url = baseUrl + '?' + [\n        'bbox='    + getTileBBox(x, y, z),\n        'format='  + (options.format || 'image/png'),\n        'service=' + (options.service || 'WMS'),\n        'version=' + (options.version || '1.1.1'),\n        'request=' + (options.request || 'GetMap'),\n        'srs='     + (options.srs || 'EPSG:3857'),\n        'width='   + (options.width || 256),\n        'height='  + (options.height || 256),\n        'layers='  + layer\n    ].join('&');\n\n    return url;\n}\n\n\n/**\n * getTileBBox\n *\n * @param    {Number}  x  Tile coordinate x\n * @param    {Number}  y  Tile coordinate y\n * @param    {Number}  z  Tile zoom\n * @returns  {String}  String of the bounding box\n */\nfunction getTileBBox(x, y, z) {\n    // for Google/OSM tile scheme we need to alter the y\n    y = (Math.pow(2, z) - y - 1);\n\n    var min = getMercCoords(x * 256, y * 256, z),\n        max = getMercCoords((x + 1) * 256, (y + 1) * 256, z);\n\n    return min[0] + ',' + min[1] + ',' + max[0] + ',' + max[1];\n}\n\n\n/**\n * getMercCoords\n *\n * @param    {Number}  x  Pixel coordinate x\n * @param    {Number}  y  Pixel coordinate y\n * @param    {Number}  z  Tile zoom\n * @returns  {Array}   [x, y]\n */\nfunction getMercCoords(x, y, z) {\n    var resolution = (2 * Math.PI * 6378137 / 256) / Math.pow(2, z),\n        merc_x = (x * resolution - 2 * Math.PI  * 6378137 / 2.0),\n        merc_y = (y * resolution - 2 * Math.PI  * 6378137 / 2.0);\n\n    return [merc_x, merc_y];\n}\n\nexports.getURL = getURL;\nexports.getTileBBox = getTileBBox;\nexports.getMercCoords = getMercCoords;\n\nObject.defineProperty(exports, '__esModule', { value: true });\n\n})));\n","// @flow\r\n\r\nconst Anchor = require('./anchor');\r\nconst getAnchors = require('./get_anchors');\r\nconst clipLine = require('./clip_line');\r\nconst OpacityState = require('./opacity_state');\r\nconst {shapeText, shapeIcon, WritingMode} = require('./shaping');\r\nconst {getGlyphQuads, getIconQuads} = require('./quads');\r\nconst CollisionFeature = require('./collision_feature');\r\nconst util = require('../util/util');\r\nconst scriptDetection = require('../util/script_detection');\r\nconst findPoleOfInaccessibility = require('../util/find_pole_of_inaccessibility');\r\nconst classifyRings = require('../util/classify_rings');\r\nconst EXTENT = require('../data/extent');\r\nconst SymbolBucket = require('../data/bucket/symbol_bucket');\r\nconst EvaluationParameters = require('../style/evaluation_parameters');\r\n\r\nimport type {Shaping, PositionedIcon} from './shaping';\r\nimport type {CollisionBoxArray} from '../data/array_types';\r\nimport type {SymbolFeature} from '../data/bucket/symbol_bucket';\r\nimport type {StyleImage} from '../style/style_image';\r\nimport type {StyleGlyph} from '../style/style_glyph';\r\nimport type SymbolStyleLayer from '../style/style_layer/symbol_style_layer';\r\nimport type {ImagePosition} from '../render/image_atlas';\r\nimport type {GlyphPosition} from '../render/glyph_atlas';\r\nimport type {PossiblyEvaluatedPropertyValue} from '../style/properties';\r\n\r\nconst Point = require('@mapbox/point-geometry');\r\n\r\nmodule.exports = {\r\n    performSymbolLayout\r\n};\r\n\r\n// The symbol layout process needs `text-size` evaluated at up to five different zoom levels, and\r\n// `icon-size` at up to three:\r\n//\r\n//   1. `text-size` at the zoom level of the bucket. Used to calculate a per-feature size for source `text-size`\r\n//       expressions, and to calculate the box dimensions for icon-text-fit.\r\n//   2. `icon-size` at the zoom level of the bucket. Used to calculate a per-feature size for source `icon-size`\r\n//       expressions.\r\n//   3. `text-size` and `icon-size` at the zoom level of the bucket, plus one. Used to calculate collision boxes.\r\n//   4. `text-size` at zoom level 18. Used for something line-symbol-placement-related.\r\n//   5.  For composite `*-size` expressions: two zoom levels of curve stops that \"cover\" the zoom level of the\r\n//       bucket. These go into a vertex buffer and are used by the shader to interpolate the size at render time.\r\n//\r\n// (1) and (2) are stored in `bucket.layers[0].layout`. The remainder are below.\r\n//\r\ntype Sizes = {\r\n    layoutTextSize: PossiblyEvaluatedPropertyValue<number>, // (3)\r\n    layoutIconSize: PossiblyEvaluatedPropertyValue<number>, // (3)\r\n    textMaxSize: PossiblyEvaluatedPropertyValue<number>,    // (4)\r\n    compositeTextSizes: [PossiblyEvaluatedPropertyValue<number>, PossiblyEvaluatedPropertyValue<number>], // (5)\r\n    compositeIconSizes: [PossiblyEvaluatedPropertyValue<number>, PossiblyEvaluatedPropertyValue<number>], // (5)\r\n};\r\n\r\nfunction performSymbolLayout(bucket: SymbolBucket,\r\n                             glyphMap: {[string]: {[number]: ?StyleGlyph}},\r\n                             glyphPositions: {[string]: {[number]: GlyphPosition}},\r\n                             imageMap: {[string]: StyleImage},\r\n                             imagePositions: {[string]: ImagePosition},\r\n                             showCollisionBoxes: boolean) {\r\n    bucket.createArrays();\r\n    bucket.symbolInstances = [];\r\n\r\n    const tileSize = 512 * bucket.overscaling;\r\n    bucket.tilePixelRatio = EXTENT / tileSize;\r\n    bucket.compareText = {};\r\n    bucket.iconsNeedLinear = false;\r\n\r\n    const layout = bucket.layers[0].layout;\r\n    const unevaluatedLayoutValues = bucket.layers[0]._unevaluatedLayout._values;\r\n\r\n    const sizes = {};\r\n\r\n    if (bucket.textSizeData.functionType === 'composite') {\r\n        const {min, max} = bucket.textSizeData.zoomRange;\r\n        sizes.compositeTextSizes = [\r\n            unevaluatedLayoutValues['text-size'].possiblyEvaluate(new EvaluationParameters(min)),\r\n            unevaluatedLayoutValues['text-size'].possiblyEvaluate(new EvaluationParameters(max))\r\n        ];\r\n    }\r\n\r\n    if (bucket.iconSizeData.functionType === 'composite') {\r\n        const {min, max} = bucket.iconSizeData.zoomRange;\r\n        sizes.compositeIconSizes = [\r\n            unevaluatedLayoutValues['icon-size'].possiblyEvaluate(new EvaluationParameters(min)),\r\n            unevaluatedLayoutValues['icon-size'].possiblyEvaluate(new EvaluationParameters(max))\r\n        ];\r\n    }\r\n\r\n    sizes.layoutTextSize = unevaluatedLayoutValues['text-size'].possiblyEvaluate(new EvaluationParameters(bucket.zoom + 1));\r\n    sizes.layoutIconSize = unevaluatedLayoutValues['icon-size'].possiblyEvaluate(new EvaluationParameters(bucket.zoom + 1));\r\n    sizes.textMaxSize = unevaluatedLayoutValues['text-size'].possiblyEvaluate(new EvaluationParameters(18));\r\n\r\n    const oneEm = 24;\r\n    const lineHeight = layout.get('text-line-height') * oneEm;\r\n    const textAlongLine = layout.get('text-rotation-alignment') === 'map' && layout.get('symbol-placement') === 'line';\r\n    const keepUpright = layout.get('text-keep-upright');\r\n\r\n\r\n    for (const feature of bucket.features) {\r\n        const fontstack = layout.get('text-font').evaluate(feature).join(',');\r\n        const glyphs = glyphMap[fontstack] || {};\r\n        const glyphPositionMap = glyphPositions[fontstack] || {};\r\n\r\n        const shapedTextOrientations = {};\r\n        const text = feature.text;\r\n        if (text) {\r\n            const allowsVerticalWritingMode = scriptDetection.allowsVerticalWritingMode(text);\r\n            const textOffset: [number, number] = (layout.get('text-offset').evaluate(feature).map((t)=> t * oneEm): any);\r\n            const spacing = layout.get('text-letter-spacing').evaluate(feature) * oneEm;\r\n            const spacingIfAllowed = scriptDetection.allowsLetterSpacing(text) ? spacing : 0;\r\n            const textAnchor = layout.get('text-anchor').evaluate(feature);\r\n            const textJustify = layout.get('text-justify').evaluate(feature);\r\n            const maxWidth = layout.get('symbol-placement') !== 'line' ?\r\n                layout.get('text-max-width').evaluate(feature) * oneEm :\r\n                0;\r\n\r\n            shapedTextOrientations.horizontal = shapeText(text, glyphs, maxWidth, lineHeight, textAnchor, textJustify, spacingIfAllowed, textOffset, oneEm, WritingMode.horizontal);\r\n            if (allowsVerticalWritingMode && textAlongLine && keepUpright) {\r\n                shapedTextOrientations.vertical = shapeText(text, glyphs, maxWidth, lineHeight, textAnchor, textJustify, spacingIfAllowed, textOffset, oneEm, WritingMode.vertical);\r\n            }\r\n        }\r\n\r\n        let shapedIcon;\r\n        if (feature.icon) {\r\n            const image = imageMap[feature.icon];\r\n            if (image) {\r\n                shapedIcon = shapeIcon(\r\n                    imagePositions[feature.icon],\r\n                    layout.get('icon-offset').evaluate(feature),\r\n                    layout.get('icon-anchor').evaluate(feature));\r\n                if (bucket.sdfIcons === undefined) {\r\n                    bucket.sdfIcons = image.sdf;\r\n                } else if (bucket.sdfIcons !== image.sdf) {\r\n                    util.warnOnce('Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer');\r\n                }\r\n                if (image.pixelRatio !== bucket.pixelRatio) {\r\n                    bucket.iconsNeedLinear = true;\r\n                } else if (layout.get('icon-rotate').constantOr(1) !== 0) {\r\n                    bucket.iconsNeedLinear = true;\r\n                }\r\n            }\r\n        }\r\n\r\n        if (shapedTextOrientations.horizontal || shapedIcon) {\r\n            addFeature(bucket, feature, shapedTextOrientations, shapedIcon, glyphPositionMap, sizes);\r\n        }\r\n    }\r\n\r\n    if (showCollisionBoxes) {\r\n        bucket.generateCollisionDebugBuffers();\r\n    }\r\n}\r\n\r\n\r\n/**\r\n * Given a feature and its shaped text and icon data, add a 'symbol\r\n * instance' for each _possible_ placement of the symbol feature.\r\n * (At render timePlaceSymbols#place() selects which of these instances to\r\n * show or hide based on collisions with symbols in other layers.)\r\n * @private\r\n */\r\nfunction addFeature(bucket: SymbolBucket,\r\n                    feature: SymbolFeature,\r\n                    shapedTextOrientations: any,\r\n                    shapedIcon: PositionedIcon | void,\r\n                    glyphPositionMap: {[number]: GlyphPosition},\r\n                    sizes: Sizes) {\r\n    const layoutTextSize = sizes.layoutTextSize.evaluate(feature);\r\n    const layoutIconSize = sizes.layoutIconSize.evaluate(feature);\r\n\r\n    // To reduce the number of labels that jump around when zooming we need\r\n    // to use a text-size value that is the same for all zoom levels.\r\n    // bucket calculates text-size at a high zoom level so that all tiles can\r\n    // use the same value when calculating anchor positions.\r\n    let textMaxSize = sizes.textMaxSize.evaluate(feature);\r\n    if (textMaxSize === undefined) {\r\n        textMaxSize = layoutTextSize;\r\n    }\r\n\r\n    const layout = bucket.layers[0].layout;\r\n    const textOffset = layout.get('text-offset').evaluate(feature);\r\n    const iconOffset = layout.get('icon-offset').evaluate(feature);\r\n\r\n    const glyphSize = 24,\r\n        fontScale = layoutTextSize / glyphSize,\r\n        textBoxScale = bucket.tilePixelRatio * fontScale,\r\n        textMaxBoxScale = bucket.tilePixelRatio * textMaxSize / glyphSize,\r\n        iconBoxScale = bucket.tilePixelRatio * layoutIconSize,\r\n        symbolMinDistance = bucket.tilePixelRatio * layout.get('symbol-spacing'),\r\n        textPadding = layout.get('text-padding') * bucket.tilePixelRatio,\r\n        iconPadding = layout.get('icon-padding') * bucket.tilePixelRatio,\r\n        textMaxAngle = layout.get('text-max-angle') / 180 * Math.PI,\r\n        textAlongLine = layout.get('text-rotation-alignment') === 'map' && layout.get('symbol-placement') === 'line',\r\n        iconAlongLine = layout.get('icon-rotation-alignment') === 'map' && layout.get('symbol-placement') === 'line',\r\n        symbolPlacement = layout.get('symbol-placement'),\r\n        textRepeatDistance = symbolMinDistance / 2;\r\n\r\n    const addSymbolAtAnchor = (line, anchor) => {\r\n        if (anchor.x < 0 || anchor.x >= EXTENT || anchor.y < 0 || anchor.y >= EXTENT) {\r\n            // Symbol layers are drawn across tile boundaries, We filter out symbols\r\n            // outside our tile boundaries (which may be included in vector tile buffers)\r\n            // to prevent double-drawing symbols.\r\n            return;\r\n        }\r\n\r\n        bucket.symbolInstances.push(addSymbol(bucket, anchor, line, shapedTextOrientations, shapedIcon, bucket.layers[0],\r\n            bucket.collisionBoxArray, feature.index, feature.sourceLayerIndex, bucket.index,\r\n            textBoxScale, textPadding, textAlongLine, textOffset,\r\n            iconBoxScale, iconPadding, iconAlongLine, iconOffset,\r\n            {zoom: bucket.zoom}, feature, glyphPositionMap, sizes));\r\n    };\r\n\r\n    if (symbolPlacement === 'line') {\r\n        for (const line of clipLine(feature.geometry, 0, 0, EXTENT, EXTENT)) {\r\n            const anchors = getAnchors(\r\n                line,\r\n                symbolMinDistance,\r\n                textMaxAngle,\r\n                shapedTextOrientations.vertical || shapedTextOrientations.horizontal,\r\n                shapedIcon,\r\n                glyphSize,\r\n                textMaxBoxScale,\r\n                bucket.overscaling,\r\n                EXTENT\r\n            );\r\n            for (const anchor of anchors) {\r\n                const shapedText = shapedTextOrientations.horizontal;\r\n                if (!shapedText || !anchorIsTooClose(bucket, shapedText.text, textRepeatDistance, anchor)) {\r\n                    addSymbolAtAnchor(line, anchor);\r\n                }\r\n            }\r\n        }\r\n    } else if (feature.type === 'Polygon') {\r\n        for (const polygon of classifyRings(feature.geometry, 0)) {\r\n            // 16 here represents 2 pixels\r\n            const poi = findPoleOfInaccessibility(polygon, 16);\r\n            addSymbolAtAnchor(polygon[0], new Anchor(poi.x, poi.y, 0));\r\n        }\r\n    } else if (feature.type === 'LineString') {\r\n        // https://github.com/mapbox/mapbox-gl-js/issues/3808\r\n        for (const line of feature.geometry) {\r\n            addSymbolAtAnchor(line, new Anchor(line[0].x, line[0].y, 0));\r\n        }\r\n    } else if (feature.type === 'Point') {\r\n        for (const points of feature.geometry) {\r\n            for (const point of points) {\r\n                addSymbolAtAnchor([point], new Anchor(point.x, point.y, 0));\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nfunction addTextVertices(bucket: SymbolBucket,\r\n                         anchor: Point,\r\n                         shapedText: Shaping,\r\n                         layer: SymbolStyleLayer,\r\n                         textAlongLine: boolean,\r\n                         globalProperties: Object,\r\n                         feature: SymbolFeature,\r\n                         textOffset: [number, number],\r\n                         lineArray: {lineStartIndex: number, lineLength: number},\r\n                         writingMode: number,\r\n                         placedTextSymbolIndices: Array<number>,\r\n                         glyphPositionMap: {[number]: GlyphPosition},\r\n                         sizes: Sizes) {\r\n    const glyphQuads = getGlyphQuads(anchor, shapedText,\r\n                            layer, textAlongLine, globalProperties, feature, glyphPositionMap);\r\n\r\n    const sizeData = bucket.textSizeData;\r\n    let textSizeData = null;\r\n\r\n    if (sizeData.functionType === 'source') {\r\n        textSizeData = [\r\n            10 * layer.layout.get('text-size').evaluate(feature)\r\n        ];\r\n    } else if (sizeData.functionType === 'composite') {\r\n        textSizeData = [\r\n            10 * sizes.compositeTextSizes[0].evaluate(feature),\r\n            10 * sizes.compositeTextSizes[1].evaluate(feature)\r\n        ];\r\n    }\r\n\r\n    bucket.addSymbols(\r\n        bucket.text,\r\n        glyphQuads,\r\n        textSizeData,\r\n        textOffset,\r\n        textAlongLine,\r\n        feature,\r\n        writingMode,\r\n        anchor,\r\n        lineArray.lineStartIndex,\r\n        lineArray.lineLength);\r\n\r\n    // The placedSymbolArray is used at render time in drawTileSymbols\r\n    // These indices allow access to the array at collision detection time\r\n    placedTextSymbolIndices.push(bucket.text.placedSymbolArray.length - 1);\r\n\r\n    return glyphQuads.length * 4;\r\n}\r\n\r\n\r\n/**\r\n * Add a single label & icon placement.\r\n *\r\n * @private\r\n */\r\nfunction addSymbol(bucket: SymbolBucket,\r\n                   anchor: Anchor,\r\n                   line: Array<Point>,\r\n                   shapedTextOrientations: any,\r\n                   shapedIcon: PositionedIcon | void,\r\n                   layer: SymbolStyleLayer,\r\n                   collisionBoxArray: CollisionBoxArray,\r\n                   featureIndex: number,\r\n                   sourceLayerIndex: number,\r\n                   bucketIndex: number,\r\n                   textBoxScale: number,\r\n                   textPadding: number,\r\n                   textAlongLine: boolean,\r\n                   textOffset: [number, number],\r\n                   iconBoxScale: number,\r\n                   iconPadding: number,\r\n                   iconAlongLine: boolean,\r\n                   iconOffset: [number, number],\r\n                   globalProperties: Object,\r\n                   feature: SymbolFeature,\r\n                   glyphPositionMap: {[number]: GlyphPosition},\r\n                   sizes: Sizes) {\r\n    const lineArray = bucket.addToLineVertexArray(anchor, line);\r\n\r\n    let textCollisionFeature, iconCollisionFeature;\r\n\r\n    let numIconVertices = 0;\r\n    let numGlyphVertices = 0;\r\n    let numVerticalGlyphVertices = 0;\r\n    const key = shapedTextOrientations.horizontal ? shapedTextOrientations.horizontal.text : '';\r\n    const placedTextSymbolIndices = [];\r\n    if (shapedTextOrientations.horizontal) {\r\n        // As a collision approximation, we can use either the vertical or the horizontal version of the feature\r\n        // We're counting on the two versions having similar dimensions\r\n        textCollisionFeature = new CollisionFeature(collisionBoxArray, line, anchor, featureIndex, sourceLayerIndex, bucketIndex, shapedTextOrientations.horizontal, textBoxScale, textPadding, textAlongLine, bucket.overscaling);\r\n        numGlyphVertices += addTextVertices(bucket, anchor, shapedTextOrientations.horizontal, layer, textAlongLine, globalProperties, feature, textOffset, lineArray, shapedTextOrientations.vertical ? WritingMode.horizontal : WritingMode.horizontalOnly, placedTextSymbolIndices, glyphPositionMap, sizes);\r\n\r\n        if (shapedTextOrientations.vertical) {\r\n            numVerticalGlyphVertices += addTextVertices(bucket, anchor, shapedTextOrientations.vertical, layer, textAlongLine, globalProperties, feature, textOffset, lineArray, WritingMode.vertical, placedTextSymbolIndices, glyphPositionMap, sizes);\r\n        }\r\n    }\r\n\r\n    const textBoxStartIndex = textCollisionFeature ? textCollisionFeature.boxStartIndex : bucket.collisionBoxArray.length;\r\n    const textBoxEndIndex = textCollisionFeature ? textCollisionFeature.boxEndIndex : bucket.collisionBoxArray.length;\r\n\r\n    if (shapedIcon) {\r\n        const iconQuads = getIconQuads(anchor, shapedIcon, layer,\r\n                            iconAlongLine, shapedTextOrientations.horizontal,\r\n                            globalProperties, feature);\r\n        iconCollisionFeature = new CollisionFeature(collisionBoxArray, line, anchor, featureIndex, sourceLayerIndex, bucketIndex, shapedIcon, iconBoxScale, iconPadding, /*align boxes to line*/false, bucket.overscaling);\r\n\r\n        numIconVertices = iconQuads.length * 4;\r\n\r\n        const sizeData = bucket.iconSizeData;\r\n        let iconSizeData = null;\r\n\r\n        if (sizeData.functionType === 'source') {\r\n            iconSizeData = [\r\n                10 * layer.layout.get('icon-size').evaluate(feature)\r\n            ];\r\n        } else if (sizeData.functionType === 'composite') {\r\n            iconSizeData = [\r\n                10 * sizes.compositeIconSizes[0].evaluate(feature),\r\n                10 * sizes.compositeIconSizes[1].evaluate(feature)\r\n            ];\r\n        }\r\n\r\n        bucket.addSymbols(\r\n            bucket.icon,\r\n            iconQuads,\r\n            iconSizeData,\r\n            iconOffset,\r\n            iconAlongLine,\r\n            feature,\r\n            false,\r\n            anchor,\r\n            lineArray.lineStartIndex,\r\n            lineArray.lineLength);\r\n    }\r\n\r\n    const iconBoxStartIndex = iconCollisionFeature ? iconCollisionFeature.boxStartIndex : bucket.collisionBoxArray.length;\r\n    const iconBoxEndIndex = iconCollisionFeature ? iconCollisionFeature.boxEndIndex : bucket.collisionBoxArray.length;\r\n\r\n    if (bucket.glyphOffsetArray.length >= SymbolBucket.MAX_GLYPHS) util.warnOnce(\"Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907\");\r\n\r\n    const textOpacityState = new OpacityState();\r\n    const iconOpacityState = new OpacityState();\r\n\r\n    return {\r\n        key,\r\n        textBoxStartIndex,\r\n        textBoxEndIndex,\r\n        iconBoxStartIndex,\r\n        iconBoxEndIndex,\r\n        textOffset,\r\n        iconOffset,\r\n        anchor,\r\n        line,\r\n        featureIndex,\r\n        feature,\r\n        numGlyphVertices,\r\n        numVerticalGlyphVertices,\r\n        numIconVertices,\r\n        textOpacityState,\r\n        iconOpacityState,\r\n        isDuplicate: false,\r\n        placedTextSymbolIndices,\r\n        crossTileID: 0\r\n    };\r\n}\r\n\r\nfunction anchorIsTooClose(bucket: any, text: string, repeatDistance: number, anchor: Point) {\r\n    const compareText = bucket.compareText;\r\n    if (!(text in compareText)) {\r\n        compareText[text] = [];\r\n    } else {\r\n        const otherAnchors = compareText[text];\r\n        for (let k = otherAnchors.length - 1; k >= 0; k--) {\r\n            if (anchor.dist(otherAnchors[k]) < repeatDistance) {\r\n                // If it's within repeatDistance of one anchor, stop looking\r\n                return true;\r\n            }\r\n        }\r\n    }\r\n    // If anchor is not within repeatDistance of any other anchor, add to array\r\n    compareText[text].push(anchor);\r\n    return false;\r\n}\r\n","// @flow\r\n\r\nconst interpolate = require('../style-spec/util/interpolate').number;\r\nconst Anchor = require('../symbol/anchor');\r\nconst checkMaxAngle = require('./check_max_angle');\r\n\r\nimport type Point from '@mapbox/point-geometry';\r\nimport type {Shaping, PositionedIcon} from './shaping';\r\n\r\nmodule.exports = getAnchors;\r\n\r\nfunction getAnchors(line: Array<Point>,\r\n                    spacing: number,\r\n                    maxAngle: number,\r\n                    shapedText: ?Shaping,\r\n                    shapedIcon: ?PositionedIcon,\r\n                    glyphSize: number,\r\n                    boxScale: number,\r\n                    overscaling: number,\r\n                    tileExtent: number) {\r\n\r\n    // Resample a line to get anchor points for labels and check that each\r\n    // potential label passes text-max-angle check and has enough froom to fit\r\n    // on the line.\r\n\r\n    const angleWindowSize = shapedText ?\r\n        3 / 5 * glyphSize * boxScale :\r\n        0;\r\n\r\n    const labelLength = Math.max(\r\n        shapedText ? shapedText.right - shapedText.left : 0,\r\n        shapedIcon ? shapedIcon.right - shapedIcon.left : 0);\r\n\r\n    // Is the line continued from outside the tile boundary?\r\n    const isLineContinued = line[0].x === 0 || line[0].x === tileExtent || line[0].y === 0 || line[0].y === tileExtent;\r\n\r\n    // Is the label long, relative to the spacing?\r\n    // If so, adjust the spacing so there is always a minimum space of `spacing / 4` between label edges.\r\n    if (spacing - labelLength * boxScale  < spacing / 4) {\r\n        spacing = labelLength * boxScale + spacing / 4;\r\n    }\r\n\r\n    // Offset the first anchor by:\r\n    // Either half the label length plus a fixed extra offset if the line is not continued\r\n    // Or half the spacing if the line is continued.\r\n\r\n    // For non-continued lines, add a bit of fixed extra offset to avoid collisions at T intersections.\r\n    const fixedExtraOffset = glyphSize * 2;\r\n\r\n    const offset = !isLineContinued ?\r\n        ((labelLength / 2 + fixedExtraOffset) * boxScale * overscaling) % spacing :\r\n        (spacing / 2 * overscaling) % spacing;\r\n\r\n    return resample(line, offset, spacing, angleWindowSize, maxAngle, labelLength * boxScale, isLineContinued, false, tileExtent);\r\n}\r\n\r\n\r\nfunction resample(line, offset, spacing, angleWindowSize, maxAngle, labelLength, isLineContinued, placeAtMiddle, tileExtent) {\r\n\r\n    const halfLabelLength = labelLength / 2;\r\n    let lineLength = 0;\r\n    for (let k = 0; k < line.length - 1; k++) {\r\n        lineLength += line[k].dist(line[k + 1]);\r\n    }\r\n\r\n    let distance = 0,\r\n        markedDistance = offset - spacing;\r\n\r\n    let anchors = [];\r\n\r\n    for (let i = 0; i < line.length - 1; i++) {\r\n\r\n        const a = line[i],\r\n            b = line[i + 1];\r\n\r\n        const segmentDist = a.dist(b),\r\n            angle = b.angleTo(a);\r\n\r\n        while (markedDistance + spacing < distance + segmentDist) {\r\n            markedDistance += spacing;\r\n\r\n            const t = (markedDistance - distance) / segmentDist,\r\n                x = interpolate(a.x, b.x, t),\r\n                y = interpolate(a.y, b.y, t);\r\n\r\n            // Check that the point is within the tile boundaries and that\r\n            // the label would fit before the beginning and end of the line\r\n            // if placed at this point.\r\n            if (x >= 0 && x < tileExtent && y >= 0 && y < tileExtent &&\r\n                    markedDistance - halfLabelLength >= 0 &&\r\n                    markedDistance + halfLabelLength <= lineLength) {\r\n                const anchor = new Anchor(x, y, angle, i);\r\n                anchor._round();\r\n\r\n                if (!angleWindowSize || checkMaxAngle(line, anchor, labelLength, angleWindowSize, maxAngle)) {\r\n                    anchors.push(anchor);\r\n                }\r\n            }\r\n        }\r\n\r\n        distance += segmentDist;\r\n    }\r\n\r\n    if (!placeAtMiddle && !anchors.length && !isLineContinued) {\r\n        // The first attempt at finding anchors at which labels can be placed failed.\r\n        // Try again, but this time just try placing one anchor at the middle of the line.\r\n        // This has the most effect for short lines in overscaled tiles, since the\r\n        // initial offset used in overscaled tiles is calculated to align labels with positions in\r\n        // parent tiles instead of placing the label as close to the beginning as possible.\r\n        anchors = resample(line, distance / 2, spacing, angleWindowSize, maxAngle, labelLength, isLineContinued, true, tileExtent);\r\n    }\r\n\r\n    return anchors;\r\n}\r\n","// @flow\r\n\r\nmodule.exports = checkMaxAngle;\r\n\r\nimport type Point from '@mapbox/point-geometry';\r\nimport type Anchor from './anchor';\r\n\r\n/**\r\n * Labels placed around really sharp angles aren't readable. Check if any\r\n * part of the potential label has a combined angle that is too big.\r\n *\r\n * @param line\r\n * @param anchor The point on the line around which the label is anchored.\r\n * @param labelLength The length of the label in geometry units.\r\n * @param windowSize The check fails if the combined angles within a part of the line that is `windowSize` long is too big.\r\n * @param maxAngle The maximum combined angle that any window along the label is allowed to have.\r\n *\r\n * @returns {boolean} whether the label should be placed\r\n * @private\r\n */\r\nfunction checkMaxAngle(line: Array<Point>, anchor: Anchor, labelLength: number, windowSize: number, maxAngle: number) {\r\n\r\n    // horizontal labels always pass\r\n    if (anchor.segment === undefined) return true;\r\n\r\n    let p = anchor;\r\n    let index = anchor.segment + 1;\r\n    let anchorDistance = 0;\r\n\r\n    // move backwards along the line to the first segment the label appears on\r\n    while (anchorDistance > -labelLength / 2) {\r\n        index--;\r\n\r\n        // there isn't enough room for the label after the beginning of the line\r\n        if (index < 0) return false;\r\n\r\n        anchorDistance -= line[index].dist(p);\r\n        p = line[index];\r\n    }\r\n\r\n    anchorDistance += line[index].dist(line[index + 1]);\r\n    index++;\r\n\r\n    // store recent corners and their total angle difference\r\n    const recentCorners = [];\r\n    let recentAngleDelta = 0;\r\n\r\n    // move forwards by the length of the label and check angles along the way\r\n    while (anchorDistance < labelLength / 2) {\r\n        const prev = line[index - 1];\r\n        const current = line[index];\r\n        const next = line[index + 1];\r\n\r\n        // there isn't enough room for the label before the end of the line\r\n        if (!next) return false;\r\n\r\n        let angleDelta = prev.angleTo(current) - current.angleTo(next);\r\n        // restrict angle to -pi..pi range\r\n        angleDelta = Math.abs(((angleDelta + 3 * Math.PI) % (Math.PI * 2)) - Math.PI);\r\n\r\n        recentCorners.push({\r\n            distance: anchorDistance,\r\n            angleDelta: angleDelta\r\n        });\r\n        recentAngleDelta += angleDelta;\r\n\r\n        // remove corners that are far enough away from the list of recent anchors\r\n        while (anchorDistance - recentCorners[0].distance > windowSize) {\r\n            recentAngleDelta -= recentCorners.shift().angleDelta;\r\n        }\r\n\r\n        // the sum of angles within the window area exceeds the maximum allowed value. check fails.\r\n        if (recentAngleDelta > maxAngle) return false;\r\n\r\n        index++;\r\n        anchorDistance += current.dist(next);\r\n    }\r\n\r\n    // no part of the line had an angle greater than the maximum allowed. check passes.\r\n    return true;\r\n}\r\n","// @flow\r\n\r\nconst Point = require('@mapbox/point-geometry');\r\n\r\nmodule.exports = clipLine;\r\n\r\n/**\r\n * Returns the part of a multiline that intersects with the provided rectangular box.\r\n *\r\n * @param lines\r\n * @param x1 the left edge of the box\r\n * @param y1 the top edge of the box\r\n * @param x2 the right edge of the box\r\n * @param y2 the bottom edge of the box\r\n * @returns lines\r\n * @private\r\n */\r\nfunction clipLine(lines: Array<Array<Point>>, x1: number, y1: number, x2: number, y2: number): Array<Array<Point>> {\r\n    const clippedLines = [];\r\n\r\n    for (let l = 0; l < lines.length; l++) {\r\n        const line = lines[l];\r\n        let clippedLine;\r\n\r\n        for (let i = 0; i < line.length - 1; i++) {\r\n            let p0 = line[i];\r\n            let p1 = line[i + 1];\r\n\r\n\r\n            if (p0.x < x1 && p1.x < x1) {\r\n                continue;\r\n            } else if (p0.x < x1) {\r\n                p0 = new Point(x1, p0.y + (p1.y - p0.y) * ((x1 - p0.x) / (p1.x - p0.x)))._round();\r\n            } else if (p1.x < x1) {\r\n                p1 = new Point(x1, p0.y + (p1.y - p0.y) * ((x1 - p0.x) / (p1.x - p0.x)))._round();\r\n            }\r\n\r\n            if (p0.y < y1 && p1.y < y1) {\r\n                continue;\r\n            } else if (p0.y < y1) {\r\n                p0 = new Point(p0.x + (p1.x - p0.x) * ((y1 - p0.y) / (p1.y - p0.y)), y1)._round();\r\n            } else if (p1.y < y1) {\r\n                p1 = new Point(p0.x + (p1.x - p0.x) * ((y1 - p0.y) / (p1.y - p0.y)), y1)._round();\r\n            }\r\n\r\n            if (p0.x >= x2 && p1.x >= x2) {\r\n                continue;\r\n            } else if (p0.x >= x2) {\r\n                p0 = new Point(x2, p0.y + (p1.y - p0.y) * ((x2 - p0.x) / (p1.x - p0.x)))._round();\r\n            } else if (p1.x >= x2) {\r\n                p1 = new Point(x2, p0.y + (p1.y - p0.y) * ((x2 - p0.x) / (p1.x - p0.x)))._round();\r\n            }\r\n\r\n            if (p0.y >= y2 && p1.y >= y2) {\r\n                continue;\r\n            } else if (p0.y >= y2) {\r\n                p0 = new Point(p0.x + (p1.x - p0.x) * ((y2 - p0.y) / (p1.y - p0.y)), y2)._round();\r\n            } else if (p1.y >= y2) {\r\n                p1 = new Point(p0.x + (p1.x - p0.x) * ((y2 - p0.y) / (p1.y - p0.y)), y2)._round();\r\n            }\r\n\r\n            if (!clippedLine || !p0.equals(clippedLine[clippedLine.length - 1])) {\r\n                clippedLine = [p0];\r\n                clippedLines.push(clippedLine);\r\n            }\r\n\r\n            clippedLine.push(p1);\r\n        }\r\n    }\r\n\r\n    return clippedLines;\r\n}\r\n","// @flow\r\n\r\nconst {register} = require('../util/web_worker_transfer');\r\n\r\nclass OpacityState {\r\n    opacity: number;\r\n    targetOpacity: number;\r\n    time: number\r\n\r\n    constructor() {\r\n        this.opacity = 0;\r\n        this.targetOpacity = 0;\r\n        this.time = 0;\r\n    }\r\n\r\n    clone() {\r\n        const clone = new OpacityState();\r\n        clone.opacity = this.opacity;\r\n        clone.targetOpacity = this.targetOpacity;\r\n        clone.time = this.time;\r\n        return clone;\r\n    }\r\n}\r\n\r\nregister('OpacityState', OpacityState);\r\n\r\nmodule.exports = OpacityState;\r\n","// @flow\r\n\r\nconst scriptDetection = require('../util/script_detection');\r\nconst verticalizePunctuation = require('../util/verticalize_punctuation');\r\nconst rtlTextPlugin = require('../source/rtl_text_plugin');\r\n\r\nimport type {StyleGlyph} from '../style/style_glyph';\r\nimport type {ImagePosition} from '../render/image_atlas';\r\n\r\nconst WritingMode = {\r\n    horizontal: 1,\r\n    vertical: 2,\r\n    horizontalOnly: 3\r\n};\r\n\r\nmodule.exports = {\r\n    shapeText,\r\n    shapeIcon,\r\n    WritingMode\r\n};\r\n\r\n// The position of a glyph relative to the text's anchor point.\r\nexport type PositionedGlyph = {\r\n    glyph: number,\r\n    x: number,\r\n    y: number,\r\n    vertical: boolean\r\n};\r\n\r\n// A collection of positioned glyphs and some metadata\r\nexport type Shaping = {\r\n    positionedGlyphs: Array<PositionedGlyph>,\r\n    top: number,\r\n    bottom: number,\r\n    left: number,\r\n    right: number,\r\n    writingMode: 1 | 2\r\n};\r\n\r\ntype SymbolAnchor = 'center' | 'left' | 'right' | 'top' | 'bottom' | 'top-left' | 'top-right' | 'bottom-left' | 'bottom-right';\r\ntype TextJustify = 'left' | 'center' | 'right';\r\n\r\nfunction breakLines(text: string, lineBreakPoints: Array<number>) {\r\n    const lines = [];\r\n    let start = 0;\r\n    for (const lineBreak of lineBreakPoints) {\r\n        lines.push(text.substring(start, lineBreak));\r\n        start = lineBreak;\r\n    }\r\n\r\n    if (start < text.length) {\r\n        lines.push(text.substring(start, text.length));\r\n    }\r\n    return lines;\r\n}\r\n\r\nfunction shapeText(text: string,\r\n                   glyphs: {[number]: ?StyleGlyph},\r\n                   maxWidth: number,\r\n                   lineHeight: number,\r\n                   textAnchor: SymbolAnchor,\r\n                   textJustify: TextJustify,\r\n                   spacing: number,\r\n                   translate: [number, number],\r\n                   verticalHeight: number,\r\n                   writingMode: 1 | 2): Shaping | false {\r\n    let logicalInput = text.trim();\r\n    if (writingMode === WritingMode.vertical) {\r\n        logicalInput = verticalizePunctuation(logicalInput);\r\n    }\r\n\r\n    const positionedGlyphs = [];\r\n    const shaping = {\r\n        positionedGlyphs,\r\n        text: logicalInput,\r\n        top: translate[1],\r\n        bottom: translate[1],\r\n        left: translate[0],\r\n        right: translate[0],\r\n        writingMode\r\n    };\r\n\r\n    let lines: Array<string>;\r\n\r\n    const {processBidirectionalText} = rtlTextPlugin;\r\n    if (processBidirectionalText) {\r\n        lines = processBidirectionalText(logicalInput, determineLineBreaks(logicalInput, spacing, maxWidth, glyphs));\r\n    } else {\r\n        lines = breakLines(logicalInput, determineLineBreaks(logicalInput, spacing, maxWidth, glyphs));\r\n    }\r\n\r\n    shapeLines(shaping, glyphs, lines, lineHeight, textAnchor, textJustify, writingMode, spacing, verticalHeight);\r\n\r\n    if (!positionedGlyphs.length)\r\n        return false;\r\n\r\n    return shaping;\r\n}\r\n\r\nconst whitespace: {[number]: boolean} = {\r\n    [0x09]: true, // tab\r\n    [0x0a]: true, // newline\r\n    [0x0b]: true, // vertical tab\r\n    [0x0c]: true, // form feed\r\n    [0x0d]: true, // carriage return\r\n    [0x20]: true, // space\r\n};\r\n\r\nconst breakable: {[number]: boolean} = {\r\n    [0x0a]:   true, // newline\r\n    [0x20]:   true, // space\r\n    [0x26]:   true, // ampersand\r\n    [0x28]:   true, // left parenthesis\r\n    [0x29]:   true, // right parenthesis\r\n    [0x2b]:   true, // plus sign\r\n    [0x2d]:   true, // hyphen-minus\r\n    [0x2f]:   true, // solidus\r\n    [0xad]:   true, // soft hyphen\r\n    [0xb7]:   true, // middle dot\r\n    [0x200b]: true, // zero-width space\r\n    [0x2010]: true, // hyphen\r\n    [0x2013]: true, // en dash\r\n    [0x2027]: true  // interpunct\r\n    // Many other characters may be reasonable breakpoints\r\n    // Consider \"neutral orientation\" characters at scriptDetection.charHasNeutralVerticalOrientation\r\n    // See https://github.com/mapbox/mapbox-gl-js/issues/3658\r\n};\r\n\r\nfunction determineAverageLineWidth(logicalInput: string,\r\n                                   spacing: number,\r\n                                   maxWidth: number,\r\n                                   glyphs: {[number]: ?StyleGlyph}) {\r\n    let totalWidth = 0;\r\n\r\n    for (let index = 0; index < logicalInput.length; index++) {\r\n        const glyph = glyphs[logicalInput.charCodeAt(index)];\r\n        if (!glyph)\r\n            continue;\r\n        totalWidth += glyph.metrics.advance + spacing;\r\n    }\r\n\r\n    const lineCount = Math.max(1, Math.ceil(totalWidth / maxWidth));\r\n    return totalWidth / lineCount;\r\n}\r\n\r\nfunction calculateBadness(lineWidth: number,\r\n                          targetWidth: number,\r\n                          penalty: number,\r\n                          isLastBreak: boolean) {\r\n    const raggedness = Math.pow(lineWidth - targetWidth, 2);\r\n    if (isLastBreak) {\r\n        // Favor finals lines shorter than average over longer than average\r\n        if (lineWidth < targetWidth) {\r\n            return raggedness / 2;\r\n        } else {\r\n            return raggedness * 2;\r\n        }\r\n    }\r\n\r\n    return raggedness + Math.abs(penalty) * penalty;\r\n}\r\n\r\nfunction calculatePenalty(codePoint: number, nextCodePoint: number) {\r\n    let penalty = 0;\r\n    // Force break on newline\r\n    if (codePoint === 0x0a) {\r\n        penalty -= 10000;\r\n    }\r\n    // Penalize open parenthesis at end of line\r\n    if (codePoint === 0x28 || codePoint === 0xff08) {\r\n        penalty += 50;\r\n    }\r\n\r\n    // Penalize close parenthesis at beginning of line\r\n    if (nextCodePoint === 0x29 || nextCodePoint === 0xff09) {\r\n        penalty += 50;\r\n    }\r\n    return penalty;\r\n}\r\n\r\ntype Break = {\r\n    index: number,\r\n    x: number,\r\n    priorBreak: ?Break,\r\n    badness: number\r\n};\r\n\r\nfunction evaluateBreak(breakIndex: number,\r\n                       breakX: number,\r\n                       targetWidth: number,\r\n                       potentialBreaks: Array<Break>,\r\n                       penalty: number,\r\n                       isLastBreak: boolean): Break {\r\n    // We could skip evaluating breaks where the line length (breakX - priorBreak.x) > maxWidth\r\n    //  ...but in fact we allow lines longer than maxWidth (if there's no break points)\r\n    //  ...and when targetWidth and maxWidth are close, strictly enforcing maxWidth can give\r\n    //     more lopsided results.\r\n\r\n    let bestPriorBreak: ?Break = null;\r\n    let bestBreakBadness = calculateBadness(breakX, targetWidth, penalty, isLastBreak);\r\n\r\n    for (const potentialBreak of potentialBreaks) {\r\n        const lineWidth = breakX - potentialBreak.x;\r\n        const breakBadness =\r\n            calculateBadness(lineWidth, targetWidth, penalty, isLastBreak) + potentialBreak.badness;\r\n        if (breakBadness <= bestBreakBadness) {\r\n            bestPriorBreak = potentialBreak;\r\n            bestBreakBadness = breakBadness;\r\n        }\r\n    }\r\n\r\n    return {\r\n        index: breakIndex,\r\n        x: breakX,\r\n        priorBreak: bestPriorBreak,\r\n        badness: bestBreakBadness\r\n    };\r\n}\r\n\r\nfunction leastBadBreaks(lastLineBreak: ?Break): Array<number> {\r\n    if (!lastLineBreak) {\r\n        return [];\r\n    }\r\n    return leastBadBreaks(lastLineBreak.priorBreak).concat(lastLineBreak.index);\r\n}\r\n\r\nfunction determineLineBreaks(logicalInput: string,\r\n                             spacing: number,\r\n                             maxWidth: number,\r\n                             glyphs: {[number]: ?StyleGlyph}): Array<number> {\r\n    if (!maxWidth)\r\n        return [];\r\n\r\n    if (!logicalInput)\r\n        return [];\r\n\r\n    const potentialLineBreaks = [];\r\n    const targetWidth = determineAverageLineWidth(logicalInput, spacing, maxWidth, glyphs);\r\n\r\n    let currentX = 0;\r\n\r\n    for (let i = 0; i < logicalInput.length; i++) {\r\n        const codePoint = logicalInput.charCodeAt(i);\r\n        const glyph = glyphs[codePoint];\r\n\r\n        if (glyph && !whitespace[codePoint])\r\n            currentX += glyph.metrics.advance + spacing;\r\n\r\n        // Ideographic characters, spaces, and word-breaking punctuation that often appear without\r\n        // surrounding spaces.\r\n        if ((i < logicalInput.length - 1) &&\r\n            (breakable[codePoint] ||\r\n                scriptDetection.charAllowsIdeographicBreaking(codePoint))) {\r\n\r\n            potentialLineBreaks.push(\r\n                evaluateBreak(\r\n                    i + 1,\r\n                    currentX,\r\n                    targetWidth,\r\n                    potentialLineBreaks,\r\n                    calculatePenalty(codePoint, logicalInput.charCodeAt(i + 1)),\r\n                    false));\r\n        }\r\n    }\r\n\r\n    return leastBadBreaks(\r\n        evaluateBreak(\r\n            logicalInput.length,\r\n            currentX,\r\n            targetWidth,\r\n            potentialLineBreaks,\r\n            0,\r\n            true));\r\n}\r\n\r\nfunction getAnchorAlignment(anchor: SymbolAnchor) {\r\n    let horizontalAlign = 0.5, verticalAlign = 0.5;\r\n\r\n    switch (anchor) {\r\n    case 'right':\r\n    case 'top-right':\r\n    case 'bottom-right':\r\n        horizontalAlign = 1;\r\n        break;\r\n    case 'left':\r\n    case 'top-left':\r\n    case 'bottom-left':\r\n        horizontalAlign = 0;\r\n        break;\r\n    }\r\n\r\n    switch (anchor) {\r\n    case 'bottom':\r\n    case 'bottom-right':\r\n    case 'bottom-left':\r\n        verticalAlign = 1;\r\n        break;\r\n    case 'top':\r\n    case 'top-right':\r\n    case 'top-left':\r\n        verticalAlign = 0;\r\n        break;\r\n    }\r\n\r\n    return { horizontalAlign, verticalAlign };\r\n}\r\n\r\nfunction shapeLines(shaping: Shaping,\r\n                    glyphs: {[number]: ?StyleGlyph},\r\n                    lines: Array<string>,\r\n                    lineHeight: number,\r\n                    textAnchor: SymbolAnchor,\r\n                    textJustify: TextJustify,\r\n                    writingMode: 1 | 2,\r\n                    spacing: number,\r\n                    verticalHeight: number) {\r\n    // the y offset *should* be part of the font metadata\r\n    const yOffset = -17;\r\n\r\n    let x = 0;\r\n    let y = yOffset;\r\n\r\n    let maxLineLength = 0;\r\n    const positionedGlyphs = shaping.positionedGlyphs;\r\n\r\n    const justify =\r\n        textJustify === 'right' ? 1 :\r\n        textJustify === 'left' ? 0 : 0.5;\r\n\r\n    for (let line of lines) {\r\n        line = line.trim();\r\n\r\n        if (!line.length) {\r\n            y += lineHeight; // Still need a line feed after empty line\r\n            continue;\r\n        }\r\n\r\n        const lineStartIndex = positionedGlyphs.length;\r\n        for (let i = 0; i < line.length; i++) {\r\n            const codePoint = line.charCodeAt(i);\r\n            const glyph = glyphs[codePoint];\r\n\r\n            if (!glyph) continue;\r\n\r\n            if (!scriptDetection.charHasUprightVerticalOrientation(codePoint) || writingMode === WritingMode.horizontal) {\r\n                positionedGlyphs.push({glyph: codePoint, x, y, vertical: false});\r\n                x += glyph.metrics.advance + spacing;\r\n            } else {\r\n                positionedGlyphs.push({glyph: codePoint, x, y: 0, vertical: true});\r\n                x += verticalHeight + spacing;\r\n            }\r\n        }\r\n\r\n        // Only justify if we placed at least one glyph\r\n        if (positionedGlyphs.length !== lineStartIndex) {\r\n            const lineLength = x - spacing;\r\n            maxLineLength = Math.max(lineLength, maxLineLength);\r\n\r\n            justifyLine(positionedGlyphs, glyphs, lineStartIndex, positionedGlyphs.length - 1, justify);\r\n        }\r\n\r\n        x = 0;\r\n        y += lineHeight;\r\n    }\r\n\r\n    const {horizontalAlign, verticalAlign} = getAnchorAlignment(textAnchor);\r\n    align(positionedGlyphs, justify, horizontalAlign, verticalAlign, maxLineLength, lineHeight, lines.length);\r\n\r\n    // Calculate the bounding box\r\n    const height = lines.length * lineHeight;\r\n\r\n    shaping.top += -verticalAlign * height;\r\n    shaping.bottom = shaping.top + height;\r\n    shaping.left += -horizontalAlign * maxLineLength;\r\n    shaping.right = shaping.left + maxLineLength;\r\n}\r\n\r\n// justify right = 1, left = 0, center = 0.5\r\nfunction justifyLine(positionedGlyphs: Array<PositionedGlyph>,\r\n                     glyphs: {[number]: ?StyleGlyph},\r\n                     start: number,\r\n                     end: number,\r\n                     justify: 1 | 0 | 0.5) {\r\n    if (!justify)\r\n        return;\r\n\r\n    const glyph = glyphs[positionedGlyphs[end].glyph];\r\n    if (glyph) {\r\n        const lastAdvance = glyph.metrics.advance;\r\n        const lineIndent = (positionedGlyphs[end].x + lastAdvance) * justify;\r\n\r\n        for (let j = start; j <= end; j++) {\r\n            positionedGlyphs[j].x -= lineIndent;\r\n        }\r\n    }\r\n}\r\n\r\nfunction align(positionedGlyphs: Array<PositionedGlyph>,\r\n               justify: number,\r\n               horizontalAlign: number,\r\n               verticalAlign: number,\r\n               maxLineLength: number,\r\n               lineHeight: number,\r\n               lineCount: number) {\r\n    const shiftX = (justify - horizontalAlign) * maxLineLength;\r\n    const shiftY = (-verticalAlign * lineCount + 0.5) * lineHeight;\r\n\r\n    for (let j = 0; j < positionedGlyphs.length; j++) {\r\n        positionedGlyphs[j].x += shiftX;\r\n        positionedGlyphs[j].y += shiftY;\r\n    }\r\n}\r\n\r\nexport type PositionedIcon = {\r\n    image: ImagePosition,\r\n    top: number,\r\n    bottom: number,\r\n    left: number,\r\n    right: number\r\n};\r\n\r\nfunction shapeIcon(image: ImagePosition, iconOffset: [number, number], iconAnchor: SymbolAnchor): PositionedIcon {\r\n    const {horizontalAlign, verticalAlign} = getAnchorAlignment(iconAnchor);\r\n    const dx = iconOffset[0];\r\n    const dy = iconOffset[1];\r\n    const x1 = dx - image.displaySize[0] * horizontalAlign;\r\n    const x2 = x1 + image.displaySize[0];\r\n    const y1 = dy - image.displaySize[1] * verticalAlign;\r\n    const y2 = y1 + image.displaySize[1];\r\n    return {image, top: y1, bottom: y2, left: x1, right: x2};\r\n}\r\n","// @flow\r\n\r\nconst Point = require('@mapbox/point-geometry');\r\nconst {GLYPH_PBF_BORDER} = require('../style/parse_glyph_pbf');\r\n\r\nimport type Anchor from './anchor';\r\nimport type {PositionedIcon, Shaping} from './shaping';\r\nimport type SymbolStyleLayer from '../style/style_layer/symbol_style_layer';\r\nimport type {Feature} from '../style-spec/expression';\r\nimport type {GlyphPosition} from '../render/glyph_atlas';\r\n\r\nmodule.exports = {\r\n    getIconQuads,\r\n    getGlyphQuads\r\n};\r\n\r\n/**\r\n * A textured quad for rendering a single icon or glyph.\r\n *\r\n * The zoom range the glyph can be shown is defined by minScale and maxScale.\r\n *\r\n * @param tl The offset of the top left corner from the anchor.\r\n * @param tr The offset of the top right corner from the anchor.\r\n * @param bl The offset of the bottom left corner from the anchor.\r\n * @param br The offset of the bottom right corner from the anchor.\r\n * @param tex The texture coordinates.\r\n *\r\n * @private\r\n */\r\nexport type SymbolQuad = {\r\n    tl: Point,\r\n    tr: Point,\r\n    bl: Point,\r\n    br: Point,\r\n    tex: {\r\n        x: number,\r\n        y: number,\r\n        w: number,\r\n        h: number\r\n    },\r\n    writingMode: any | void,\r\n    glyphOffset: [number, number]\r\n};\r\n\r\n/**\r\n * Create the quads used for rendering an icon.\r\n * @private\r\n */\r\nfunction getIconQuads(anchor: Anchor,\r\n                      shapedIcon: PositionedIcon,\r\n                      layer: SymbolStyleLayer,\r\n                      alongLine: boolean,\r\n                      shapedText: Shaping,\r\n                      globalProperties: Object,\r\n                      feature: Feature): Array<SymbolQuad> {\r\n    const image = shapedIcon.image;\r\n    const layout = layer.layout;\r\n\r\n    // If you have a 10px icon that isn't perfectly aligned to the pixel grid it will cover 11 actual\r\n    // pixels. The quad needs to be padded to account for this, otherwise they'll look slightly clipped\r\n    // on one edge in some cases.\r\n    const border = 1;\r\n\r\n    const top = shapedIcon.top - border / image.pixelRatio;\r\n    const left = shapedIcon.left - border / image.pixelRatio;\r\n    const bottom = shapedIcon.bottom + border / image.pixelRatio;\r\n    const right = shapedIcon.right + border / image.pixelRatio;\r\n    let tl, tr, br, bl;\r\n\r\n    // text-fit mode\r\n    if (layout.get('icon-text-fit') !== 'none' && shapedText) {\r\n        const iconWidth = (right - left),\r\n            iconHeight = (bottom - top),\r\n            size = layout.get('text-size').evaluate(feature) / 24,\r\n            textLeft = shapedText.left * size,\r\n            textRight = shapedText.right * size,\r\n            textTop = shapedText.top * size,\r\n            textBottom = shapedText.bottom * size,\r\n            textWidth = textRight - textLeft,\r\n            textHeight = textBottom - textTop,\r\n            padT = layout.get('icon-text-fit-padding')[0],\r\n            padR = layout.get('icon-text-fit-padding')[1],\r\n            padB = layout.get('icon-text-fit-padding')[2],\r\n            padL = layout.get('icon-text-fit-padding')[3],\r\n            offsetY = layout.get('icon-text-fit') === 'width' ? (textHeight - iconHeight) * 0.5 : 0,\r\n            offsetX = layout.get('icon-text-fit') === 'height' ? (textWidth - iconWidth) * 0.5 : 0,\r\n            width = layout.get('icon-text-fit') === 'width' || layout.get('icon-text-fit') === 'both' ? textWidth : iconWidth,\r\n            height = layout.get('icon-text-fit') === 'height' || layout.get('icon-text-fit') === 'both' ? textHeight : iconHeight;\r\n        tl = new Point(textLeft + offsetX - padL,         textTop + offsetY - padT);\r\n        tr = new Point(textLeft + offsetX + padR + width, textTop + offsetY - padT);\r\n        br = new Point(textLeft + offsetX + padR + width, textTop + offsetY + padB + height);\r\n        bl = new Point(textLeft + offsetX - padL,         textTop + offsetY + padB + height);\r\n    // Normal icon size mode\r\n    } else {\r\n        tl = new Point(left, top);\r\n        tr = new Point(right, top);\r\n        br = new Point(right, bottom);\r\n        bl = new Point(left, bottom);\r\n    }\r\n\r\n    const angle = layer.layout.get('icon-rotate').evaluate(feature) * Math.PI / 180;\r\n\r\n    if (angle) {\r\n        const sin = Math.sin(angle),\r\n            cos = Math.cos(angle),\r\n            matrix = [cos, -sin, sin, cos];\r\n\r\n        tl._matMult(matrix);\r\n        tr._matMult(matrix);\r\n        bl._matMult(matrix);\r\n        br._matMult(matrix);\r\n    }\r\n\r\n    // Icon quad is padded, so texture coordinates also need to be padded.\r\n    const textureRect = {\r\n        x: image.textureRect.x - border,\r\n        y: image.textureRect.y - border,\r\n        w: image.textureRect.w + border * 2,\r\n        h: image.textureRect.h + border * 2\r\n    };\r\n\r\n    return [{tl, tr, bl, br, tex: textureRect, writingMode: undefined, glyphOffset: [0, 0]}];\r\n}\r\n\r\n/**\r\n * Create the quads used for rendering a text label.\r\n * @private\r\n */\r\nfunction getGlyphQuads(anchor: Anchor,\r\n                       shaping: Shaping,\r\n                       layer: SymbolStyleLayer,\r\n                       alongLine: boolean,\r\n                       globalProperties: Object,\r\n                       feature: Feature,\r\n                       positions: {[number]: GlyphPosition}): Array<SymbolQuad> {\r\n\r\n    const oneEm = 24;\r\n    const textRotate = layer.layout.get('text-rotate').evaluate(feature) * Math.PI / 180;\r\n    const textOffset = layer.layout.get('text-offset').evaluate(feature).map((t)=> t * oneEm);\r\n\r\n    const positionedGlyphs = shaping.positionedGlyphs;\r\n    const quads = [];\r\n\r\n\r\n    for (let k = 0; k < positionedGlyphs.length; k++) {\r\n        const positionedGlyph = positionedGlyphs[k];\r\n        const glyph = positions[positionedGlyph.glyph];\r\n        if (!glyph) continue;\r\n\r\n        const rect = glyph.rect;\r\n        if (!rect) continue;\r\n\r\n        // The rects have an addditional buffer that is not included in their size.\r\n        const glyphPadding = 1.0;\r\n        const rectBuffer = GLYPH_PBF_BORDER + glyphPadding;\r\n\r\n        const halfAdvance = glyph.metrics.advance / 2;\r\n\r\n        const glyphOffset = alongLine ?\r\n            [positionedGlyph.x + halfAdvance, positionedGlyph.y] :\r\n            [0, 0];\r\n\r\n        const builtInOffset = alongLine ?\r\n            [0, 0] :\r\n            [positionedGlyph.x + halfAdvance + textOffset[0], positionedGlyph.y + textOffset[1]];\r\n\r\n\r\n        const x1 = glyph.metrics.left - rectBuffer - halfAdvance + builtInOffset[0];\r\n        const y1 = -glyph.metrics.top - rectBuffer + builtInOffset[1];\r\n        const x2 = x1 + rect.w;\r\n        const y2 = y1 + rect.h;\r\n\r\n        const tl = new Point(x1, y1);\r\n        const tr = new Point(x2, y1);\r\n        const bl  = new Point(x1, y2);\r\n        const br = new Point(x2, y2);\r\n\r\n        if (alongLine && positionedGlyph.vertical) {\r\n            // Vertical-supporting glyphs are laid out in 24x24 point boxes (1 square em)\r\n            // In horizontal orientation, the y values for glyphs are below the midline\r\n            // and we use a \"yOffset\" of -17 to pull them up to the middle.\r\n            // By rotating counter-clockwise around the point at the center of the left\r\n            // edge of a 24x24 layout box centered below the midline, we align the center\r\n            // of the glyphs with the horizontal midline, so the yOffset is no longer\r\n            // necessary, but we also pull the glyph to the left along the x axis\r\n            const center = new Point(-halfAdvance, halfAdvance);\r\n            const verticalRotation = -Math.PI / 2;\r\n            const xOffsetCorrection = new Point(5, 0);\r\n            tl._rotateAround(verticalRotation, center)._add(xOffsetCorrection);\r\n            tr._rotateAround(verticalRotation, center)._add(xOffsetCorrection);\r\n            bl._rotateAround(verticalRotation, center)._add(xOffsetCorrection);\r\n            br._rotateAround(verticalRotation, center)._add(xOffsetCorrection);\r\n        }\r\n\r\n        if (textRotate) {\r\n            const sin = Math.sin(textRotate),\r\n                cos = Math.cos(textRotate),\r\n                matrix = [cos, -sin, sin, cos];\r\n\r\n            tl._matMult(matrix);\r\n            tr._matMult(matrix);\r\n            bl._matMult(matrix);\r\n            br._matMult(matrix);\r\n        }\r\n\r\n        quads.push({tl, tr, bl, br, tex: rect, writingMode: shaping.writingMode, glyphOffset});\r\n    }\r\n\r\n    return quads;\r\n}\r\n","// @flow\r\n\r\nconst {AlphaImage} = require('../util/image');\r\nconst Protobuf = require('pbf');\r\nconst border = 3;\r\n\r\nimport type {StyleGlyph} from './style_glyph';\r\n\r\nfunction readFontstacks(tag: number, glyphs: Array<StyleGlyph>, pbf: Protobuf) {\r\n    if (tag === 1) {\r\n        pbf.readMessage(readFontstack, glyphs);\r\n    }\r\n}\r\n\r\nfunction readFontstack(tag: number, glyphs: Array<StyleGlyph>, pbf: Protobuf) {\r\n    if (tag === 3) {\r\n        const {id, bitmap, width, height, left, top, advance} = pbf.readMessage(readGlyph, {});\r\n        glyphs.push({\r\n            id,\r\n            bitmap: new AlphaImage({\r\n                width: width + 2 * border,\r\n                height: height + 2 * border\r\n            }, bitmap),\r\n            metrics: {width, height, left, top, advance}\r\n        });\r\n    }\r\n}\r\n\r\nfunction readGlyph(tag: number, glyph: Object, pbf: Protobuf) {\r\n    if (tag === 1) glyph.id = pbf.readVarint();\r\n    else if (tag === 2) glyph.bitmap = pbf.readBytes();\r\n    else if (tag === 3) glyph.width = pbf.readVarint();\r\n    else if (tag === 4) glyph.height = pbf.readVarint();\r\n    else if (tag === 5) glyph.left = pbf.readSVarint();\r\n    else if (tag === 6) glyph.top = pbf.readSVarint();\r\n    else if (tag === 7) glyph.advance = pbf.readVarint();\r\n}\r\n\r\nmodule.exports = function (data: ArrayBuffer | Uint8Array): Array<StyleGlyph> {\r\n    return new Protobuf(data).readFields(readFontstacks, []);\r\n};\r\n\r\nmodule.exports.GLYPH_PBF_BORDER = border;\r\n","// @flow\r\n\r\nimport type {CollisionBoxArray} from '../data/array_types';\r\nimport type Point from '@mapbox/point-geometry';\r\nimport type Anchor from './anchor';\r\n\r\n/**\r\n * A CollisionFeature represents the area of the tile covered by a single label.\r\n * It is used with CollisionIndex to check if the label overlaps with any\r\n * previous labels. A CollisionFeature is mostly just a set of CollisionBox\r\n * objects.\r\n *\r\n * @private\r\n */\r\nclass CollisionFeature {\r\n    boxStartIndex: number;\r\n    boxEndIndex: number;\r\n\r\n    /**\r\n     * Create a CollisionFeature, adding its collision box data to the given collisionBoxArray in the process.\r\n     *\r\n     * @param line The geometry the label is placed on.\r\n     * @param anchor The point along the line around which the label is anchored.\r\n     * @param shaped The text or icon shaping results.\r\n     * @param boxScale A magic number used to convert from glyph metrics units to geometry units.\r\n     * @param padding The amount of padding to add around the label edges.\r\n     * @param alignLine Whether the label is aligned with the line or the viewport.\r\n     */\r\n    constructor(collisionBoxArray: CollisionBoxArray,\r\n                line: Array<Point>,\r\n                anchor: Anchor,\r\n                featureIndex: number,\r\n                sourceLayerIndex: number,\r\n                bucketIndex: number,\r\n                shaped: Object,\r\n                boxScale: number,\r\n                padding: number,\r\n                alignLine: boolean,\r\n                overscaling: number) {\r\n        const y1 = shaped.top * boxScale - padding;\r\n        const y2 = shaped.bottom * boxScale + padding;\r\n        const x1 = shaped.left * boxScale - padding;\r\n        const x2 = shaped.right * boxScale + padding;\r\n\r\n        this.boxStartIndex = collisionBoxArray.length;\r\n\r\n        if (alignLine) {\r\n\r\n            let height = y2 - y1;\r\n            const length = x2 - x1;\r\n\r\n            if (height > 0) {\r\n                // set minimum box height to avoid very many small labels\r\n                height = Math.max(10 * boxScale, height);\r\n\r\n                this._addLineCollisionCircles(collisionBoxArray, line, anchor, (anchor.segment: any), length, height, featureIndex, sourceLayerIndex, bucketIndex, overscaling);\r\n            }\r\n\r\n        } else {\r\n            collisionBoxArray.emplaceBack(anchor.x, anchor.y, x1, y1, x2, y2, featureIndex, sourceLayerIndex, bucketIndex,\r\n                0, 0);\r\n        }\r\n\r\n        this.boxEndIndex = collisionBoxArray.length;\r\n    }\r\n\r\n    /**\r\n     * Create a set of CollisionBox objects for a line.\r\n     *\r\n     * @param labelLength The length of the label in geometry units.\r\n     * @param anchor The point along the line around which the label is anchored.\r\n     * @param boxSize The size of the collision boxes that will be created.\r\n     * @private\r\n     */\r\n    _addLineCollisionCircles(collisionBoxArray: CollisionBoxArray,\r\n                           line: Array<Point>,\r\n                           anchor: Anchor,\r\n                           segment: number,\r\n                           labelLength: number,\r\n                           boxSize: number,\r\n                           featureIndex: number,\r\n                           sourceLayerIndex: number,\r\n                           bucketIndex: number,\r\n                           overscaling: number) {\r\n        const step = boxSize / 2;\r\n        const nBoxes = Math.floor(labelLength / step);\r\n        // We calculate line collision circles out to 300% of what would normally be our\r\n        // max size, to allow collision detection to work on labels that expand as\r\n        // they move into the distance\r\n        // Vertically oriented labels in the distant field can extend past this padding\r\n        // This is a noticeable problem in overscaled tiles where the pitch 0-based\r\n        // symbol spacing will put labels very close together in a pitched map.\r\n        // To reduce the cost of adding extra collision circles, we slowly increase\r\n        // them for overscaled tiles.\r\n        const overscalingPaddingFactor = 1 + .4 * Math.log(overscaling) / Math.LN2;\r\n        const nPitchPaddingBoxes = Math.floor(nBoxes * overscalingPaddingFactor / 2);\r\n\r\n        // offset the center of the first box by half a box so that the edge of the\r\n        // box is at the edge of the label.\r\n        const firstBoxOffset = -boxSize / 2;\r\n\r\n        let p = anchor;\r\n        let index = segment + 1;\r\n        let anchorDistance = firstBoxOffset;\r\n        const labelStartDistance = -labelLength / 2;\r\n        const paddingStartDistance = labelStartDistance - labelLength / 4;\r\n        // move backwards along the line to the first segment the label appears on\r\n        do {\r\n            index--;\r\n\r\n            if (index < 0) {\r\n                if (anchorDistance > labelStartDistance) {\r\n                    // there isn't enough room for the label after the beginning of the line\r\n                    // checkMaxAngle should have already caught this\r\n                    return;\r\n                } else {\r\n                    // The line doesn't extend far enough back for all of our padding,\r\n                    // but we got far enough to show the label under most conditions.\r\n                    index = 0;\r\n                    break;\r\n                }\r\n            } else {\r\n                anchorDistance -= line[index].dist(p);\r\n                p = line[index];\r\n            }\r\n        } while (anchorDistance > paddingStartDistance);\r\n\r\n        let segmentLength = line[index].dist(line[index + 1]);\r\n\r\n        for (let i = -nPitchPaddingBoxes; i < nBoxes + nPitchPaddingBoxes; i++) {\r\n\r\n            // the distance the box will be from the anchor\r\n            const boxOffset = i * step;\r\n            let boxDistanceToAnchor = labelStartDistance + boxOffset;\r\n\r\n            // make the distance between pitch padding boxes bigger\r\n            if (boxOffset < 0) boxDistanceToAnchor += boxOffset;\r\n            if (boxOffset > labelLength) boxDistanceToAnchor += boxOffset - labelLength;\r\n\r\n            if (boxDistanceToAnchor < anchorDistance) {\r\n                // The line doesn't extend far enough back for this box, skip it\r\n                // (This could allow for line collisions on distant tiles)\r\n                continue;\r\n            }\r\n\r\n            // the box is not on the current segment. Move to the next segment.\r\n            while (anchorDistance + segmentLength < boxDistanceToAnchor) {\r\n                anchorDistance += segmentLength;\r\n                index++;\r\n\r\n                // There isn't enough room before the end of the line.\r\n                if (index + 1 >= line.length) {\r\n                    return;\r\n                }\r\n\r\n                segmentLength = line[index].dist(line[index + 1]);\r\n            }\r\n\r\n            // the distance the box will be from the beginning of the segment\r\n            const segmentBoxDistance = boxDistanceToAnchor - anchorDistance;\r\n\r\n            const p0 = line[index];\r\n            const p1 = line[index + 1];\r\n            const boxAnchorPoint = p1.sub(p0)._unit()._mult(segmentBoxDistance)._add(p0)._round();\r\n\r\n            // If the box is within boxSize of the anchor, force the box to be used\r\n            // (so even 0-width labels use at least one box)\r\n            // Otherwise, the .8 multiplication gives us a little bit of conservative\r\n            // padding in choosing which boxes to use (see CollisionIndex#placedCollisionCircles)\r\n            const paddedAnchorDistance = Math.abs(boxDistanceToAnchor - firstBoxOffset) < step ?\r\n                0 :\r\n                (boxDistanceToAnchor - firstBoxOffset) * 0.8;\r\n\r\n            collisionBoxArray.emplaceBack(boxAnchorPoint.x, boxAnchorPoint.y,\r\n                -boxSize / 2, -boxSize / 2, boxSize / 2, boxSize / 2,\r\n                featureIndex, sourceLayerIndex, bucketIndex,\r\n                boxSize / 2, paddedAnchorDistance);\r\n        }\r\n    }\r\n}\r\n\r\nmodule.exports = CollisionFeature;\r\n","// @flow\r\n\r\nconst Queue = require('tinyqueue');\r\nconst Point = require('@mapbox/point-geometry');\r\nconst distToSegmentSquared = require('./intersection_tests').distToSegmentSquared;\r\n\r\n/**\r\n * Finds an approximation of a polygon's Pole Of Inaccessibiliy https://en.wikipedia.org/wiki/Pole_of_inaccessibility\r\n * This is a copy of http://github.com/mapbox/polylabel adapted to use Points\r\n *\r\n * @param polygonRings first item in array is the outer ring followed optionally by the list of holes, should be an element of the result of util/classify_rings\r\n * @param precision Specified in input coordinate units. If 0 returns after first run, if > 0 repeatedly narrows the search space until the radius of the area searched for the best pole is less than precision\r\n * @param debug Print some statistics to the console during execution\r\n * @returns Pole of Inaccessibiliy.\r\n * @private\r\n */\r\nmodule.exports = function (polygonRings: Array<Array<Point>>, precision?: number = 1, debug?: boolean = false): Point {\r\n    // find the bounding box of the outer ring\r\n    let minX = Infinity, minY = Infinity, maxX = -Infinity, maxY = -Infinity;\r\n    const outerRing = polygonRings[0];\r\n    for (let i = 0; i < outerRing.length; i++) {\r\n        const p = outerRing[i];\r\n        if (!i || p.x < minX) minX = p.x;\r\n        if (!i || p.y < minY) minY = p.y;\r\n        if (!i || p.x > maxX) maxX = p.x;\r\n        if (!i || p.y > maxY) maxY = p.y;\r\n    }\r\n\r\n    const width = maxX - minX;\r\n    const height = maxY - minY;\r\n    const cellSize = Math.min(width, height);\r\n    let h = cellSize / 2;\r\n\r\n    // a priority queue of cells in order of their \"potential\" (max distance to polygon)\r\n    const cellQueue = new Queue(null, compareMax);\r\n\r\n    if (cellSize === 0) return new Point(minX, minY);\r\n\r\n    // cover polygon with initial cells\r\n    for (let x = minX; x < maxX; x += cellSize) {\r\n        for (let y = minY; y < maxY; y += cellSize) {\r\n            cellQueue.push(new Cell(x + h, y + h, h, polygonRings));\r\n        }\r\n    }\r\n\r\n    // take centroid as the first best guess\r\n    let bestCell = getCentroidCell(polygonRings);\r\n    let numProbes = cellQueue.length;\r\n\r\n    while (cellQueue.length) {\r\n        // pick the most promising cell from the queue\r\n        const cell = cellQueue.pop();\r\n\r\n        // update the best cell if we found a better one\r\n        if (cell.d > bestCell.d || !bestCell.d) {\r\n            bestCell = cell;\r\n            if (debug) console.log('found best %d after %d probes', Math.round(1e4 * cell.d) / 1e4, numProbes);\r\n        }\r\n\r\n        // do not drill down further if there's no chance of a better solution\r\n        if (cell.max - bestCell.d <= precision) continue;\r\n\r\n        // split the cell into four cells\r\n        h = cell.h / 2;\r\n        cellQueue.push(new Cell(cell.p.x - h, cell.p.y - h, h, polygonRings));\r\n        cellQueue.push(new Cell(cell.p.x + h, cell.p.y - h, h, polygonRings));\r\n        cellQueue.push(new Cell(cell.p.x - h, cell.p.y + h, h, polygonRings));\r\n        cellQueue.push(new Cell(cell.p.x + h, cell.p.y + h, h, polygonRings));\r\n        numProbes += 4;\r\n    }\r\n\r\n    if (debug) {\r\n        console.log(`num probes: ${numProbes}`);\r\n        console.log(`best distance: ${bestCell.d}`);\r\n    }\r\n\r\n    return bestCell.p;\r\n};\r\n\r\nfunction compareMax(a, b) {\r\n    return b.max - a.max;\r\n}\r\n\r\nfunction Cell(x, y, h, polygon) {\r\n    this.p = new Point(x, y);\r\n    this.h = h; // half the cell size\r\n    this.d = pointToPolygonDist(this.p, polygon); // distance from cell center to polygon\r\n    this.max = this.d + this.h * Math.SQRT2; // max distance to polygon within a cell\r\n}\r\n\r\n// signed distance from point to polygon outline (negative if point is outside)\r\nfunction pointToPolygonDist(p, polygon) {\r\n    let inside = false;\r\n    let minDistSq = Infinity;\r\n\r\n    for (let k = 0; k < polygon.length; k++) {\r\n        const ring = polygon[k];\r\n\r\n        for (let i = 0, len = ring.length, j = len - 1; i < len; j = i++) {\r\n            const a = ring[i];\r\n            const b = ring[j];\r\n\r\n            if ((a.y > p.y !== b.y > p.y) &&\r\n                (p.x < (b.x - a.x) * (p.y - a.y) / (b.y - a.y) + a.x)) inside = !inside;\r\n\r\n            minDistSq = Math.min(minDistSq, distToSegmentSquared(p, a, b));\r\n        }\r\n    }\r\n\r\n    return (inside ? 1 : -1) * Math.sqrt(minDistSq);\r\n}\r\n\r\n// get polygon centroid\r\nfunction getCentroidCell(polygon) {\r\n    let area = 0;\r\n    let x = 0;\r\n    let y = 0;\r\n    const points = polygon[0];\r\n    for (let i = 0, len = points.length, j = len - 1; i < len; j = i++) {\r\n        const a = points[i];\r\n        const b = points[j];\r\n        const f = a.x * b.y - b.x * a.y;\r\n        x += (a.x + b.x) * f;\r\n        y += (a.y + b.y) * f;\r\n        area += f * 3;\r\n    }\r\n    return new Cell(x / area, y / area, 0, polygon);\r\n}\r\n","'use strict';\n\nmodule.exports = TinyQueue;\n\nfunction TinyQueue(data, compare) {\n    if (!(this instanceof TinyQueue)) return new TinyQueue(data, compare);\n\n    this.data = data || [];\n    this.length = this.data.length;\n    this.compare = compare || defaultCompare;\n\n    if (this.length > 0) {\n        for (var i = (this.length >> 1); i >= 0; i--) this._down(i);\n    }\n}\n\nfunction defaultCompare(a, b) {\n    return a < b ? -1 : a > b ? 1 : 0;\n}\n\nTinyQueue.prototype = {\n\n    push: function (item) {\n        this.data.push(item);\n        this.length++;\n        this._up(this.length - 1);\n    },\n\n    pop: function () {\n        if (this.length === 0) return undefined;\n        var top = this.data[0];\n        this.length--;\n        if (this.length > 0) {\n            this.data[0] = this.data[this.length];\n            this._down(0);\n        }\n        this.data.pop();\n        return top;\n    },\n\n    peek: function () {\n        return this.data[0];\n    },\n\n    _up: function (pos) {\n        var data = this.data;\n        var compare = this.compare;\n        var item = data[pos];\n\n        while (pos > 0) {\n            var parent = (pos - 1) >> 1;\n            var current = data[parent];\n            if (compare(item, current) >= 0) break;\n            data[pos] = current;\n            pos = parent;\n        }\n\n        data[pos] = item;\n    },\n\n    _down: function (pos) {\n        var data = this.data;\n        var compare = this.compare;\n        var len = this.length;\n        var halfLen = len >> 1;\n        var item = data[pos];\n\n        while (pos < halfLen) {\n            var left = (pos << 1) + 1;\n            var right = left + 1;\n            var best = data[left];\n\n            if (right < len && compare(data[right], best) < 0) {\n                left = right;\n                best = data[right];\n            }\n            if (compare(best, item) >= 0) break;\n\n            data[pos] = best;\n            pos = left;\n        }\n\n        data[pos] = item;\n    }\n};\n","// @flow\r\n\r\nconst ShelfPack = require('@mapbox/shelf-pack');\r\nconst {RGBAImage} = require('../util/image');\r\n\r\nimport type {StyleImage} from '../style/style_image';\r\n\r\nconst padding = 1;\r\n\r\ntype Rect = {\r\n    x: number,\r\n    y: number,\r\n    w: number,\r\n    h: number\r\n};\r\n\r\nexport type ImagePosition = {\r\n    pixelRatio: number,\r\n    textureRect: Rect,\r\n    tl: [number, number],\r\n    br: [number, number],\r\n    displaySize: [number, number]\r\n};\r\n\r\n// This wants to be a class, but is sent to workers, so must be a plain JSON blob.\r\nfunction imagePosition(rect: Rect, {pixelRatio}: StyleImage): ImagePosition {\r\n    const textureRect = {\r\n        x: rect.x + padding,\r\n        y: rect.y + padding,\r\n        w: rect.w - padding * 2,\r\n        h: rect.h - padding * 2\r\n    };\r\n    return {\r\n        pixelRatio,\r\n        textureRect,\r\n\r\n        // Redundant calculated members.\r\n        tl: [\r\n            textureRect.x,\r\n            textureRect.y\r\n        ],\r\n        br: [\r\n            textureRect.x + textureRect.w,\r\n            textureRect.y + textureRect.h\r\n        ],\r\n        displaySize: [\r\n            textureRect.w / pixelRatio,\r\n            textureRect.h / pixelRatio\r\n        ]\r\n    };\r\n}\r\n\r\nexport type ImageAtlas = {\r\n    image: RGBAImage,\r\n    positions: {[string]: ImagePosition}\r\n};\r\n\r\nfunction makeImageAtlas(images: {[string]: StyleImage}): ImageAtlas {\r\n    const image = new RGBAImage({width: 0, height: 0});\r\n    const positions = {};\r\n\r\n    const pack = new ShelfPack(0, 0, {autoResize: true});\r\n\r\n    for (const id in images) {\r\n        const src = images[id];\r\n\r\n        const bin = pack.packOne(\r\n            src.data.width + 2 * padding,\r\n            src.data.height + 2 * padding);\r\n\r\n        image.resize({\r\n            width: pack.w,\r\n            height: pack.h\r\n        });\r\n\r\n        RGBAImage.copy(\r\n            src.data,\r\n            image,\r\n            { x: 0, y: 0 },\r\n            {\r\n                x: bin.x + padding,\r\n                y: bin.y + padding\r\n            },\r\n            src.data);\r\n\r\n        positions[id] = imagePosition(bin, src);\r\n    }\r\n\r\n    pack.shrink();\r\n    image.resize({\r\n        width: pack.w,\r\n        height: pack.h\r\n    });\r\n\r\n    return {image, positions};\r\n}\r\n\r\nmodule.exports = {\r\n    imagePosition,\r\n    makeImageAtlas\r\n};\r\n","// @flow\r\n\r\nconst ShelfPack = require('@mapbox/shelf-pack');\r\nconst {AlphaImage} = require('../util/image');\r\n\r\nimport type {GlyphMetrics, StyleGlyph} from '../style/style_glyph';\r\n\r\nconst padding = 1;\r\n\r\ntype Rect = {\r\n    x: number,\r\n    y: number,\r\n    w: number,\r\n    h: number\r\n};\r\n\r\nexport type GlyphPosition = {\r\n    rect: Rect,\r\n    metrics: GlyphMetrics\r\n};\r\n\r\nexport type GlyphAtlas = {\r\n    image: AlphaImage,\r\n    positions: {[string]: {[number]: GlyphPosition}}\r\n};\r\n\r\nfunction makeGlyphAtlas(stacks: {[string]: {[number]: ?StyleGlyph}}): GlyphAtlas {\r\n    const image = new AlphaImage({width: 0, height: 0});\r\n    const positions = {};\r\n\r\n    const pack = new ShelfPack(0, 0, {autoResize: true});\r\n\r\n    for (const stack in stacks) {\r\n        const glyphs = stacks[stack];\r\n        const stackPositions = positions[stack] = {};\r\n\r\n        for (const id in glyphs) {\r\n            const src = glyphs[+id];\r\n            if (src && src.bitmap.width !== 0 && src.bitmap.height !== 0) {\r\n                const bin = pack.packOne(\r\n                    src.bitmap.width + 2 * padding,\r\n                    src.bitmap.height + 2 * padding);\r\n\r\n                image.resize({\r\n                    width: pack.w,\r\n                    height: pack.h\r\n                });\r\n\r\n                AlphaImage.copy(\r\n                    src.bitmap,\r\n                    image,\r\n                    { x: 0, y: 0 },\r\n                    {\r\n                        x: bin.x + padding,\r\n                        y: bin.y + padding\r\n                    },\r\n                    src.bitmap);\r\n\r\n                stackPositions[id] = { rect: bin, metrics: src.metrics };\r\n            }\r\n        }\r\n    }\r\n\r\n    pack.shrink();\r\n    image.resize({\r\n        width: pack.w,\r\n        height: pack.h\r\n    });\r\n\r\n    return {image, positions};\r\n}\r\n\r\nmodule.exports = {\r\n    makeGlyphAtlas\r\n};\r\n","// @flow\r\n\r\nconst {DEMData} = require('../data/dem_data');\r\n\r\nimport type Actor from '../util/actor';\r\nimport type {\r\n    WorkerDEMTileParameters,\r\n    WorkerDEMTileCallback,\r\n    TileParameters\r\n} from './worker_source';\r\n\r\n\r\nclass RasterDEMTileWorkerSource {\r\n    actor: Actor;\r\n    loading: {[string]: {[string]: DEMData}};\r\n    loaded: {[string]: {[string]: DEMData}};\r\n\r\n    constructor() {\r\n        this.loading = {};\r\n        this.loaded = {};\r\n    }\r\n\r\n    loadTile(params: WorkerDEMTileParameters, callback: WorkerDEMTileCallback) {\r\n        const source = params.source,\r\n            uid = params.uid;\r\n\r\n        if (!this.loading[source])\r\n            this.loading[source] = {};\r\n\r\n        const dem = new DEMData(uid);\r\n        this.loading[source][uid] = dem;\r\n        dem.loadFromImage(params.rawImageData);\r\n        delete this.loading[source][uid];\r\n\r\n        this.loaded[source] = this.loaded[source] || {};\r\n        this.loaded[source][uid] = dem;\r\n        callback(null, dem);\r\n    }\r\n\r\n    removeTile(params: TileParameters) {\r\n        const loaded = this.loaded[params.source],\r\n            uid = params.uid;\r\n        if (loaded && loaded[uid]) {\r\n            delete loaded[uid];\r\n        }\r\n    }\r\n}\r\n\r\nmodule.exports = RasterDEMTileWorkerSource;\r\n","// @flow\r\nconst {RGBAImage} = require('../util/image');\r\nconst util = require('../util/util');\r\nconst {register} = require('../util/web_worker_transfer');\r\n\r\nclass Level {\r\n    dim: number;\r\n    border: number;\r\n    stride: number;\r\n    data: Int32Array;\r\n\r\n    constructor(dim: number, border: number, data: ?Int32Array) {\r\n        if (dim <= 0) throw new RangeError('Level must have positive dimension');\r\n        this.dim = dim;\r\n        this.border = border;\r\n        this.stride = this.dim + 2 * this.border;\r\n        this.data = data || new Int32Array((this.dim + 2 * this.border) * (this.dim + 2 * this.border));\r\n    }\r\n\r\n    set(x: number, y: number, value: number) {\r\n        this.data[this._idx(x, y)] = value + 65536;\r\n    }\r\n\r\n    get(x: number, y: number) {\r\n        return this.data[this._idx(x, y)] - 65536;\r\n    }\r\n\r\n    _idx(x: number, y: number) {\r\n        if (x < -this.border || x >= this.dim + this.border ||  y < -this.border || y >= this.dim + this.border) throw new RangeError('out of range source coordinates for DEM data');\r\n        return (y + this.border) * this.stride + (x + this.border);\r\n    }\r\n}\r\n\r\nregister('Level', Level);\r\n\r\n// DEMData is a data structure for decoding, backfilling, and storing elevation data for processing in the hillshade shaders\r\n// data can be populated either from a pngraw image tile or from serliazed data sent back from a worker. When data is initially\r\n// loaded from a image tile, we decode the pixel values using the mapbox terrain-rgb tileset decoding formula, but we store the\r\n// elevation data in a Level as an Int32 value. we add 65536 (2^16) to eliminate negative values and enable the use of\r\n// integer overflow when creating the texture used in the hillshadePrepare step.\r\n\r\n// DEMData also handles the backfilling of data from a tile's neighboring tiles. This is necessary because we use a pixel's 8\r\n// surrounding pixel values to compute the slope at that pixel, and we cannot accurately calculate the slope at pixels on a\r\n// tile's edge without backfilling from neighboring tiles.\r\n\r\nclass DEMData {\r\n    uid: string;\r\n    scale: number;\r\n    level: Level;\r\n    loaded: boolean;\r\n\r\n    constructor(uid: string, scale: ?number, data: ?Level) {\r\n        this.uid = uid;\r\n        this.scale = scale || 1;\r\n        // if no data is provided, use a temporary empty level to satisfy flow\r\n        this.level = data || new Level(256, 512);\r\n        this.loaded = !!data;\r\n    }\r\n\r\n    loadFromImage(data: RGBAImage) {\r\n        if (data.height !== data.width) throw new RangeError('DEM tiles must be square');\r\n\r\n        // Build level 0\r\n        const level = this.level = new Level(data.width, data.width / 2);\r\n        const pixels = data.data;\r\n\r\n        // unpack\r\n        for (let y = 0; y < level.dim; y++) {\r\n            for (let x = 0; x < level.dim; x++) {\r\n                const i = y * level.dim + x;\r\n                const j = i * 4;\r\n                // decoding per https://blog.mapbox.com/global-elevation-data-6689f1d0ba65\r\n                level.set(x, y, this.scale * ((pixels[j] * 256 * 256 + pixels[j + 1] * 256.0 + pixels[j + 2]) / 10.0 - 10000.0));\r\n            }\r\n        }\r\n\r\n        // in order to avoid flashing seams between tiles, here we are initially populating a 1px border of pixels around the image\r\n        // with the data of the nearest pixel from the image. this data is eventually replaced when the tile's neighboring\r\n        // tiles are loaded and the accurate data can be backfilled using DEMData#backfillBorder\r\n        for (let x = 0; x < level.dim; x++) {\r\n            // left vertical border\r\n            level.set(-1, x, level.get(0, x));\r\n            // right vertical border\r\n            level.set(level.dim, x, level.get(level.dim - 1, x));\r\n            // left horizontal border\r\n            level.set(x, -1, level.get(x, 0));\r\n            // right horizontal border\r\n            level.set(x, level.dim, level.get(x, level.dim - 1));\r\n        }\r\n        // corners\r\n        level.set(-1, -1, level.get(0, 0));\r\n        level.set(level.dim, -1, level.get(level.dim - 1, 0));\r\n        level.set(-1, level.dim, level.get(0, level.dim - 1));\r\n        level.set(level.dim, level.dim, level.get(level.dim - 1, level.dim - 1));\r\n        this.loaded = true;\r\n    }\r\n\r\n    getPixels() {\r\n        return new RGBAImage({width: this.level.dim + 2 * this.level.border, height: this.level.dim + 2 * this.level.border}, new Uint8Array(this.level.data.buffer));\r\n    }\r\n\r\n    backfillBorder(borderTile: DEMData, dx: number, dy: number) {\r\n        const t = this.level;\r\n        const o = borderTile.level;\r\n\r\n        if (t.dim !== o.dim) throw new Error('level mismatch (dem dimension)');\r\n\r\n        let _xMin = dx * t.dim,\r\n            _xMax = dx * t.dim + t.dim,\r\n            _yMin = dy * t.dim,\r\n            _yMax = dy * t.dim + t.dim;\r\n\r\n        switch (dx) {\r\n        case -1:\r\n            _xMin = _xMax - 1;\r\n            break;\r\n        case 1:\r\n            _xMax = _xMin + 1;\r\n            break;\r\n        }\r\n\r\n        switch (dy) {\r\n        case -1:\r\n            _yMin = _yMax - 1;\r\n            break;\r\n        case 1:\r\n            _yMax = _yMin + 1;\r\n            break;\r\n        }\r\n\r\n        const xMin = util.clamp(_xMin, -t.border, t.dim + t.border);\r\n        const xMax = util.clamp(_xMax, -t.border, t.dim + t.border);\r\n        const yMin = util.clamp(_yMin, -t.border, t.dim + t.border);\r\n        const yMax = util.clamp(_yMax, -t.border, t.dim + t.border);\r\n\r\n        const ox = -dx * t.dim;\r\n        const oy = -dy * t.dim;\r\n        for (let y = yMin; y < yMax; y++) {\r\n            for (let x = xMin; x < xMax; x++) {\r\n                t.set(x, y, o.get(x + ox, y + oy));\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nregister('DEMData', DEMData);\r\nmodule.exports = {DEMData, Level};\r\n\r\n","// @flow\r\n\r\nconst ajax = require('../util/ajax');\r\nconst rewind = require('geojson-rewind');\r\nconst GeoJSONWrapper = require('./geojson_wrapper');\r\nconst vtpbf = require('vt-pbf');\r\nconst supercluster = require('supercluster');\r\nconst geojsonvt = require('geojson-vt');\r\n\r\nconst VectorTileWorkerSource = require('./vector_tile_worker_source');\r\n\r\nimport type {\r\n    WorkerTileParameters,\r\n    WorkerTileCallback,\r\n} from '../source/worker_source';\r\n\r\nimport type Actor from '../util/actor';\r\nimport type StyleLayerIndex from '../style/style_layer_index';\r\n\r\nimport type {LoadVectorDataCallback} from './vector_tile_worker_source';\r\nimport type {RequestParameters} from '../util/ajax';\r\nimport type { Callback } from '../types/callback';\r\n\r\nexport type GeoJSON = Object;\r\n\r\nexport type LoadGeoJSONParameters = {\r\n    request?: RequestParameters,\r\n    data?: string,\r\n    source: string,\r\n    superclusterOptions?: Object,\r\n    geojsonVtOptions?: Object\r\n};\r\n\r\nexport type LoadGeoJSON = (params: LoadGeoJSONParameters, callback: Callback<mixed>) => void;\r\n\r\nexport interface GeoJSONIndex {\r\n}\r\n\r\nfunction loadGeoJSONTile(params: WorkerTileParameters, callback: LoadVectorDataCallback) {\r\n    const source = params.source,\r\n        canonical = params.tileID.canonical;\r\n\r\n    if (!this._geoJSONIndexes[source]) {\r\n        return callback(null, null);  // we couldn't load the file\r\n    }\r\n\r\n    const geoJSONTile = this._geoJSONIndexes[source].getTile(canonical.z, canonical.x, canonical.y);\r\n    if (!geoJSONTile) {\r\n        return callback(null, null); // nothing in the given tile\r\n    }\r\n\r\n    const geojsonWrapper = new GeoJSONWrapper(geoJSONTile.features);\r\n\r\n    // Encode the geojson-vt tile into binary vector tile form form.  This\r\n    // is a convenience that allows `FeatureIndex` to operate the same way\r\n    // across `VectorTileSource` and `GeoJSONSource` data.\r\n    let pbf = vtpbf(geojsonWrapper);\r\n    if (pbf.byteOffset !== 0 || pbf.byteLength !== pbf.buffer.byteLength) {\r\n        // Compatibility with node Buffer (https://github.com/mapbox/pbf/issues/35)\r\n        pbf = new Uint8Array(pbf);\r\n    }\r\n\r\n    callback(null, {\r\n        vectorTile: geojsonWrapper,\r\n        rawData: pbf.buffer\r\n    });\r\n}\r\n\r\n/**\r\n * The {@link WorkerSource} implementation that supports {@link GeoJSONSource}.\r\n * This class is designed to be easily reused to support custom source types\r\n * for data formats that can be parsed/converted into an in-memory GeoJSON\r\n * representation.  To do so, create it with\r\n * `new GeoJSONWorkerSource(actor, layerIndex, customLoadGeoJSONFunction)`.\r\n * For a full example, see [mapbox-gl-topojson](https://github.com/developmentseed/mapbox-gl-topojson).\r\n *\r\n * @private\r\n */\r\nclass GeoJSONWorkerSource extends VectorTileWorkerSource {\r\n    _geoJSONIndexes: { [string]: GeoJSONIndex };\r\n    loadGeoJSON: LoadGeoJSON;\r\n\r\n    /**\r\n     * @param [loadGeoJSON] Optional method for custom loading/parsing of\r\n     * GeoJSON based on parameters passed from the main-thread Source.\r\n     * See {@link GeoJSONWorkerSource#loadGeoJSON}.\r\n     */\r\n    constructor(actor: Actor, layerIndex: StyleLayerIndex, loadGeoJSON: ?LoadGeoJSON) {\r\n        super(actor, layerIndex, loadGeoJSONTile);\r\n        if (loadGeoJSON) {\r\n            this.loadGeoJSON = loadGeoJSON;\r\n        }\r\n        // object mapping source ids to geojson-vt-like tile indexes\r\n        this._geoJSONIndexes = {};\r\n    }\r\n\r\n    /**\r\n     * Fetches (if appropriate), parses, and index geojson data into tiles. This\r\n     * preparatory method must be called before {@link GeoJSONWorkerSource#loadTile}\r\n     * can correctly serve up tiles.\r\n     *\r\n     * Defers to {@link GeoJSONWorkerSource#loadGeoJSON} for the fetching/parsing,\r\n     * expecting `callback(error, data)` to be called with either an error or a\r\n     * parsed GeoJSON object.\r\n     * @param params\r\n     * @param params.source The id of the source.\r\n     * @param callback\r\n     */\r\n    loadData(params: LoadGeoJSONParameters, callback: Callback<void>) {\r\n        this.loadGeoJSON(params, (err, data) => {\r\n            if (err || !data) {\r\n                return callback(err);\r\n            } else if (typeof data !== 'object') {\r\n                return callback(new Error(\"Input data is not a valid GeoJSON object.\"));\r\n            } else {\r\n                rewind(data, true);\r\n\r\n                try {\r\n                    this._geoJSONIndexes[params.source] = params.cluster ?\r\n                        supercluster(params.superclusterOptions).load(data.features) :\r\n                        geojsonvt(data, params.geojsonVtOptions);\r\n                } catch (err) {\r\n                    return callback(err);\r\n                }\r\n\r\n                this.loaded[params.source] = {};\r\n                callback(null);\r\n            }\r\n        });\r\n    }\r\n\r\n    /**\r\n    * Implements {@link WorkerSource#reloadTile}.\r\n    *\r\n    * If the tile is loaded, uses the implementation in VectorTileWorkerSource.\r\n    * Otherwise, such as after a setData() call, we load the tile fresh.\r\n    *\r\n    * @param params\r\n    * @param params.source The id of the source for which we're loading this tile.\r\n    * @param params.uid The UID for this tile.\r\n    */\r\n    reloadTile(params: WorkerTileParameters, callback: WorkerTileCallback) {\r\n        const loaded = this.loaded[params.source],\r\n            uid = params.uid;\r\n\r\n        if (loaded && loaded[uid]) {\r\n            return super.reloadTile(params, callback);\r\n        } else {\r\n            return this.loadTile(params, callback);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Fetch and parse GeoJSON according to the given params.  Calls `callback`\r\n     * with `(err, data)`, where `data` is a parsed GeoJSON object.\r\n     *\r\n     * GeoJSON is loaded and parsed from `params.url` if it exists, or else\r\n     * expected as a literal (string or object) `params.data`.\r\n     *\r\n     * @param params\r\n     * @param [params.url] A URL to the remote GeoJSON data.\r\n     * @param [params.data] Literal GeoJSON data. Must be provided if `params.url` is not.\r\n     */\r\n    loadGeoJSON(params: LoadGeoJSONParameters, callback: Callback<mixed>) {\r\n        // Because of same origin issues, urls must either include an explicit\r\n        // origin or absolute path.\r\n        // ie: /foo/bar.json or http://example.com/bar.json\r\n        // but not ../foo/bar.json\r\n        if (params.request) {\r\n            ajax.getJSON(params.request, callback);\r\n        } else if (typeof params.data === 'string') {\r\n            try {\r\n                return callback(null, JSON.parse(params.data));\r\n            } catch (e) {\r\n                return callback(new Error(\"Input data is not a valid GeoJSON object.\"));\r\n            }\r\n        } else {\r\n            return callback(new Error(\"Input data is not a valid GeoJSON object.\"));\r\n        }\r\n    }\r\n\r\n    removeSource(params: {source: string}, callback: Callback<mixed>) {\r\n        if (this._geoJSONIndexes[params.source]) {\r\n            delete this._geoJSONIndexes[params.source];\r\n        }\r\n        callback();\r\n    }\r\n}\r\n\r\nmodule.exports = GeoJSONWorkerSource;\r\n","var geojsonArea = require('@mapbox/geojson-area');\n\nmodule.exports = rewind;\n\nfunction rewind(gj, outer) {\n    switch ((gj && gj.type) || null) {\n        case 'FeatureCollection':\n            gj.features = gj.features.map(curryOuter(rewind, outer));\n            return gj;\n        case 'Feature':\n            gj.geometry = rewind(gj.geometry, outer);\n            return gj;\n        case 'Polygon':\n        case 'MultiPolygon':\n            return correct(gj, outer);\n        default:\n            return gj;\n    }\n}\n\nfunction curryOuter(a, b) {\n    return function(_) { return a(_, b); };\n}\n\nfunction correct(_, outer) {\n    if (_.type === 'Polygon') {\n        _.coordinates = correctRings(_.coordinates, outer);\n    } else if (_.type === 'MultiPolygon') {\n        _.coordinates = _.coordinates.map(curryOuter(correctRings, outer));\n    }\n    return _;\n}\n\nfunction correctRings(_, outer) {\n    outer = !!outer;\n    _[0] = wind(_[0], outer);\n    for (var i = 1; i < _.length; i++) {\n        _[i] = wind(_[i], !outer);\n    }\n    return _;\n}\n\nfunction wind(_, dir) {\n    return cw(_) === dir ? _ : _.reverse();\n}\n\nfunction cw(_) {\n    return geojsonArea.ring(_) >= 0;\n}\n","var wgs84 = require('wgs84');\n\nmodule.exports.geometry = geometry;\nmodule.exports.ring = ringArea;\n\nfunction geometry(_) {\n    var area = 0, i;\n    switch (_.type) {\n        case 'Polygon':\n            return polygonArea(_.coordinates);\n        case 'MultiPolygon':\n            for (i = 0; i < _.coordinates.length; i++) {\n                area += polygonArea(_.coordinates[i]);\n            }\n            return area;\n        case 'Point':\n        case 'MultiPoint':\n        case 'LineString':\n        case 'MultiLineString':\n            return 0;\n        case 'GeometryCollection':\n            for (i = 0; i < _.geometries.length; i++) {\n                area += geometry(_.geometries[i]);\n            }\n            return area;\n    }\n}\n\nfunction polygonArea(coords) {\n    var area = 0;\n    if (coords && coords.length > 0) {\n        area += Math.abs(ringArea(coords[0]));\n        for (var i = 1; i < coords.length; i++) {\n            area -= Math.abs(ringArea(coords[i]));\n        }\n    }\n    return area;\n}\n\n/**\n * Calculate the approximate area of the polygon were it projected onto\n *     the earth.  Note that this area will be positive if ring is oriented\n *     clockwise, otherwise it will be negative.\n *\n * Reference:\n * Robert. G. Chamberlain and William H. Duquette, \"Some Algorithms for\n *     Polygons on a Sphere\", JPL Publication 07-03, Jet Propulsion\n *     Laboratory, Pasadena, CA, June 2007 http://trs-new.jpl.nasa.gov/dspace/handle/2014/40409\n *\n * Returns:\n * {float} The approximate signed geodesic area of the polygon in square\n *     meters.\n */\n\nfunction ringArea(coords) {\n    var p1, p2, p3, lowerIndex, middleIndex, upperIndex, i,\n    area = 0,\n    coordsLength = coords.length;\n\n    if (coordsLength > 2) {\n        for (i = 0; i < coordsLength; i++) {\n            if (i === coordsLength - 2) {// i = N-2\n                lowerIndex = coordsLength - 2;\n                middleIndex = coordsLength -1;\n                upperIndex = 0;\n            } else if (i === coordsLength - 1) {// i = N-1\n                lowerIndex = coordsLength - 1;\n                middleIndex = 0;\n                upperIndex = 1;\n            } else { // i = 0 to N-3\n                lowerIndex = i;\n                middleIndex = i+1;\n                upperIndex = i+2;\n            }\n            p1 = coords[lowerIndex];\n            p2 = coords[middleIndex];\n            p3 = coords[upperIndex];\n            area += ( rad(p3[0]) - rad(p1[0]) ) * Math.sin( rad(p2[1]));\n        }\n\n        area = area * wgs84.RADIUS * wgs84.RADIUS / 2;\n    }\n\n    return area;\n}\n\nfunction rad(_) {\n    return _ * Math.PI / 180;\n}","module.exports.RADIUS = 6378137;\nmodule.exports.FLATTENING = 1/298.257223563;\nmodule.exports.POLAR_RADIUS = 6356752.3142;\n","// @flow\r\n\r\nconst Point = require('@mapbox/point-geometry');\r\nconst toGeoJSON = require('@mapbox/vector-tile').VectorTileFeature.prototype.toGeoJSON;\r\nconst EXTENT = require('../data/extent');\r\n\r\n// The feature type used by geojson-vt and supercluster. Should be extracted to\r\n// global type and used in module definitions for those two modules.\r\ntype Feature = {\r\n    type: 1,\r\n    id: mixed,\r\n    tags: {[string]: string | number | boolean},\r\n    geometry: Array<[number, number]>,\r\n} | {\r\n    type: 2 | 3,\r\n    id: mixed,\r\n    tags: {[string]: string | number | boolean},\r\n    geometry: Array<Array<[number, number]>>,\r\n}\r\n\r\nclass FeatureWrapper implements VectorTileFeature {\r\n    _feature: Feature;\r\n\r\n    extent: number;\r\n    type: 1 | 2 | 3;\r\n    id: number;\r\n    properties: {[string]: string | number | boolean};\r\n\r\n    constructor(feature: Feature) {\r\n        this._feature = feature;\r\n\r\n        this.extent = EXTENT;\r\n        this.type = feature.type;\r\n        this.properties = feature.tags;\r\n\r\n        // If the feature has a top-level `id` property, copy it over, but only\r\n        // if it can be coerced to an integer, because this wrapper is used for\r\n        // serializing geojson feature data into vector tile PBF data, and the\r\n        // vector tile spec only supports integer values for feature ids --\r\n        // allowing non-integer values here results in a non-compliant PBF\r\n        // that causes an exception when it is parsed with vector-tile-js\r\n        if ('id' in feature && !isNaN(feature.id)) {\r\n            this.id = parseInt(feature.id, 10);\r\n        }\r\n    }\r\n\r\n    loadGeometry() {\r\n        if (this._feature.type === 1) {\r\n            const geometry = [];\r\n            for (const point of this._feature.geometry) {\r\n                geometry.push([new Point(point[0], point[1])]);\r\n            }\r\n            return geometry;\r\n        } else {\r\n            const geometry = [];\r\n            for (const ring of this._feature.geometry) {\r\n                const newRing = [];\r\n                for (const point of ring) {\r\n                    newRing.push(new Point(point[0], point[1]));\r\n                }\r\n                geometry.push(newRing);\r\n            }\r\n            return geometry;\r\n        }\r\n    }\r\n\r\n    toGeoJSON(x: number, y: number, z: number) {\r\n        return toGeoJSON.call(this, x, y, z);\r\n    }\r\n}\r\n\r\nclass GeoJSONWrapper implements VectorTile, VectorTileLayer {\r\n    layers: {[string]: VectorTileLayer};\r\n    name: string;\r\n    extent: number;\r\n    length: number;\r\n    _features: Array<Feature>;\r\n\r\n    constructor(features: Array<Feature>) {\r\n        this.layers = { '_geojsonTileLayer': this };\r\n        this.name = '_geojsonTileLayer';\r\n        this.extent = EXTENT;\r\n        this.length = features.length;\r\n        this._features = features;\r\n    }\r\n\r\n    feature(i: number): VectorTileFeature {\r\n        return new FeatureWrapper(this._features[i]);\r\n    }\r\n}\r\n\r\nmodule.exports = GeoJSONWrapper;\r\n","var Pbf = require('pbf')\nvar GeoJSONWrapper = require('./lib/geojson_wrapper')\n\nmodule.exports = fromVectorTileJs\nmodule.exports.fromVectorTileJs = fromVectorTileJs\nmodule.exports.fromGeojsonVt = fromGeojsonVt\nmodule.exports.GeoJSONWrapper = GeoJSONWrapper\n\n/**\n * Serialize a vector-tile-js-created tile to pbf\n *\n * @param {Object} tile\n * @return {Buffer} uncompressed, pbf-serialized tile data\n */\nfunction fromVectorTileJs (tile) {\n  var out = new Pbf()\n  writeTile(tile, out)\n  return out.finish()\n}\n\n/**\n * Serialized a geojson-vt-created tile to pbf.\n *\n * @param {Object} layers - An object mapping layer names to geojson-vt-created vector tile objects\n * @return {Buffer} uncompressed, pbf-serialized tile data\n */\nfunction fromGeojsonVt (layers) {\n  var l = {}\n  for (var k in layers) {\n    l[k] = new GeoJSONWrapper(layers[k].features)\n    l[k].name = k\n  }\n  return fromVectorTileJs({layers: l})\n}\n\nfunction writeTile (tile, pbf) {\n  for (var key in tile.layers) {\n    pbf.writeMessage(3, writeLayer, tile.layers[key])\n  }\n}\n\nfunction writeLayer (layer, pbf) {\n  pbf.writeVarintField(15, layer.version || 1)\n  pbf.writeStringField(1, layer.name || '')\n  pbf.writeVarintField(5, layer.extent || 4096)\n\n  var i\n  var context = {\n    keys: [],\n    values: [],\n    keycache: {},\n    valuecache: {}\n  }\n\n  for (i = 0; i < layer.length; i++) {\n    context.feature = layer.feature(i)\n    pbf.writeMessage(2, writeFeature, context)\n  }\n\n  var keys = context.keys\n  for (i = 0; i < keys.length; i++) {\n    pbf.writeStringField(3, keys[i])\n  }\n\n  var values = context.values\n  for (i = 0; i < values.length; i++) {\n    pbf.writeMessage(4, writeValue, values[i])\n  }\n}\n\nfunction writeFeature (context, pbf) {\n  var feature = context.feature\n\n  if (feature.id !== undefined) {\n    pbf.writeVarintField(1, feature.id)\n  }\n\n  pbf.writeMessage(2, writeProperties, context)\n  pbf.writeVarintField(3, feature.type)\n  pbf.writeMessage(4, writeGeometry, feature)\n}\n\nfunction writeProperties (context, pbf) {\n  var feature = context.feature\n  var keys = context.keys\n  var values = context.values\n  var keycache = context.keycache\n  var valuecache = context.valuecache\n\n  for (var key in feature.properties) {\n    var keyIndex = keycache[key]\n    if (typeof keyIndex === 'undefined') {\n      keys.push(key)\n      keyIndex = keys.length - 1\n      keycache[key] = keyIndex\n    }\n    pbf.writeVarint(keyIndex)\n\n    var value = feature.properties[key]\n    var type = typeof value\n    if (type !== 'string' && type !== 'boolean' && type !== 'number') {\n      value = JSON.stringify(value)\n    }\n    var valueKey = type + ':' + value\n    var valueIndex = valuecache[valueKey]\n    if (typeof valueIndex === 'undefined') {\n      values.push(value)\n      valueIndex = values.length - 1\n      valuecache[valueKey] = valueIndex\n    }\n    pbf.writeVarint(valueIndex)\n  }\n}\n\nfunction command (cmd, length) {\n  return (length << 3) + (cmd & 0x7)\n}\n\nfunction zigzag (num) {\n  return (num << 1) ^ (num >> 31)\n}\n\nfunction writeGeometry (feature, pbf) {\n  var geometry = feature.loadGeometry()\n  var type = feature.type\n  var x = 0\n  var y = 0\n  var rings = geometry.length\n  for (var r = 0; r < rings; r++) {\n    var ring = geometry[r]\n    var count = 1\n    if (type === 1) {\n      count = ring.length\n    }\n    pbf.writeVarint(command(1, count)) // moveto\n    for (var i = 0; i < ring.length; i++) {\n      if (i === 1 && type !== 1) {\n        pbf.writeVarint(command(2, ring.length - 1)) // lineto\n      }\n      var dx = ring[i].x - x\n      var dy = ring[i].y - y\n      pbf.writeVarint(zigzag(dx))\n      pbf.writeVarint(zigzag(dy))\n      x += dx\n      y += dy\n    }\n  }\n}\n\nfunction writeValue (value, pbf) {\n  var type = typeof value\n  if (type === 'string') {\n    pbf.writeStringField(1, value)\n  } else if (type === 'boolean') {\n    pbf.writeBooleanField(7, value)\n  } else if (type === 'number') {\n    if (value % 1 !== 0) {\n      pbf.writeDoubleField(3, value)\n    } else if (value < 0) {\n      pbf.writeSVarintField(6, value)\n    } else {\n      pbf.writeVarintField(5, value)\n    }\n  }\n}\n","'use strict'\n\nvar Point = require('@mapbox/point-geometry')\nvar VectorTileFeature = require('@mapbox/vector-tile').VectorTileFeature\n\nmodule.exports = GeoJSONWrapper\n\n// conform to vectortile api\nfunction GeoJSONWrapper (features) {\n  this.features = features\n  this.length = features.length\n}\n\nGeoJSONWrapper.prototype.feature = function (i) {\n  return new FeatureWrapper(this.features[i])\n}\n\nfunction FeatureWrapper (feature) {\n  this.id = typeof feature.id === 'number' ? feature.id : undefined\n  this.type = feature.type\n  this.rawGeometry = feature.type === 1 ? [feature.geometry] : feature.geometry\n  this.properties = feature.tags\n  this.extent = 4096\n}\n\nFeatureWrapper.prototype.loadGeometry = function () {\n  var rings = this.rawGeometry\n  this.geometry = []\n\n  for (var i = 0; i < rings.length; i++) {\n    var ring = rings[i]\n    var newRing = []\n    for (var j = 0; j < ring.length; j++) {\n      newRing.push(new Point(ring[j][0], ring[j][1]))\n    }\n    this.geometry.push(newRing)\n  }\n  return this.geometry\n}\n\nFeatureWrapper.prototype.bbox = function () {\n  if (!this.geometry) this.loadGeometry()\n\n  var rings = this.geometry\n  var x1 = Infinity\n  var x2 = -Infinity\n  var y1 = Infinity\n  var y2 = -Infinity\n\n  for (var i = 0; i < rings.length; i++) {\n    var ring = rings[i]\n\n    for (var j = 0; j < ring.length; j++) {\n      var coord = ring[j]\n\n      x1 = Math.min(x1, coord.x)\n      x2 = Math.max(x2, coord.x)\n      y1 = Math.min(y1, coord.y)\n      y2 = Math.max(y2, coord.y)\n    }\n  }\n\n  return [x1, y1, x2, y2]\n}\n\nFeatureWrapper.prototype.toGeoJSON = VectorTileFeature.prototype.toGeoJSON\n","'use strict';\n\nvar kdbush = require('kdbush');\n\nmodule.exports = supercluster;\n\nfunction supercluster(options) {\n    return new SuperCluster(options);\n}\n\nfunction SuperCluster(options) {\n    this.options = extend(Object.create(this.options), options);\n    this.trees = new Array(this.options.maxZoom + 1);\n}\n\nSuperCluster.prototype = {\n    options: {\n        minZoom: 0,   // min zoom to generate clusters on\n        maxZoom: 16,  // max zoom level to cluster the points on\n        radius: 40,   // cluster radius in pixels\n        extent: 512,  // tile extent (radius is calculated relative to it)\n        nodeSize: 64, // size of the KD-tree leaf node, affects performance\n        log: false,   // whether to log timing info\n\n        // a reduce function for calculating custom cluster properties\n        reduce: null, // function (accumulated, props) { accumulated.sum += props.sum; }\n\n        // initial properties of a cluster (before running the reducer)\n        initial: function () { return {}; }, // function () { return {sum: 0}; },\n\n        // properties to use for individual points when running the reducer\n        map: function (props) { return props; } // function (props) { return {sum: props.my_value}; },\n    },\n\n    load: function (points) {\n        var log = this.options.log;\n\n        if (log) console.time('total time');\n\n        var timerId = 'prepare ' + points.length + ' points';\n        if (log) console.time(timerId);\n\n        this.points = points;\n\n        // generate a cluster object for each point\n        var clusters = points.map(createPointCluster);\n        if (log) console.timeEnd(timerId);\n\n        // cluster points on max zoom, then cluster the results on previous zoom, etc.;\n        // results in a cluster hierarchy across zoom levels\n        for (var z = this.options.maxZoom; z >= this.options.minZoom; z--) {\n            var now = +Date.now();\n\n            // index input points into a KD-tree\n            this.trees[z + 1] = kdbush(clusters, getX, getY, this.options.nodeSize, Float32Array);\n\n            clusters = this._cluster(clusters, z); // create a new set of clusters for the zoom\n\n            if (log) console.log('z%d: %d clusters in %dms', z, clusters.length, +Date.now() - now);\n        }\n\n        // index top-level clusters\n        this.trees[this.options.minZoom] = kdbush(clusters, getX, getY, this.options.nodeSize, Float32Array);\n\n        if (log) console.timeEnd('total time');\n\n        return this;\n    },\n\n    getClusters: function (bbox, zoom) {\n        var tree = this.trees[this._limitZoom(zoom)];\n        var ids = tree.range(lngX(bbox[0]), latY(bbox[3]), lngX(bbox[2]), latY(bbox[1]));\n        var clusters = [];\n        for (var i = 0; i < ids.length; i++) {\n            var c = tree.points[ids[i]];\n            clusters.push(c.numPoints ? getClusterJSON(c) : this.points[c.id]);\n        }\n        return clusters;\n    },\n\n    getChildren: function (clusterId, clusterZoom) {\n        var origin = this.trees[clusterZoom + 1].points[clusterId];\n        var r = this.options.radius / (this.options.extent * Math.pow(2, clusterZoom));\n        var points = this.trees[clusterZoom + 1].within(origin.x, origin.y, r);\n        var children = [];\n        for (var i = 0; i < points.length; i++) {\n            var c = this.trees[clusterZoom + 1].points[points[i]];\n            if (c.parentId === clusterId) {\n                children.push(c.numPoints ? getClusterJSON(c) : this.points[c.id]);\n            }\n        }\n        return children;\n    },\n\n    getLeaves: function (clusterId, clusterZoom, limit, offset) {\n        limit = limit || 10;\n        offset = offset || 0;\n\n        var leaves = [];\n        this._appendLeaves(leaves, clusterId, clusterZoom, limit, offset, 0);\n\n        return leaves;\n    },\n\n    getTile: function (z, x, y) {\n        var tree = this.trees[this._limitZoom(z)];\n        var z2 = Math.pow(2, z);\n        var extent = this.options.extent;\n        var r = this.options.radius;\n        var p = r / extent;\n        var top = (y - p) / z2;\n        var bottom = (y + 1 + p) / z2;\n\n        var tile = {\n            features: []\n        };\n\n        this._addTileFeatures(\n            tree.range((x - p) / z2, top, (x + 1 + p) / z2, bottom),\n            tree.points, x, y, z2, tile);\n\n        if (x === 0) {\n            this._addTileFeatures(\n                tree.range(1 - p / z2, top, 1, bottom),\n                tree.points, z2, y, z2, tile);\n        }\n        if (x === z2 - 1) {\n            this._addTileFeatures(\n                tree.range(0, top, p / z2, bottom),\n                tree.points, -1, y, z2, tile);\n        }\n\n        return tile.features.length ? tile : null;\n    },\n\n    getClusterExpansionZoom: function (clusterId, clusterZoom) {\n        while (clusterZoom < this.options.maxZoom) {\n            var children = this.getChildren(clusterId, clusterZoom);\n            clusterZoom++;\n            if (children.length !== 1) break;\n            clusterId = children[0].properties.cluster_id;\n        }\n        return clusterZoom;\n    },\n\n    _appendLeaves: function (result, clusterId, clusterZoom, limit, offset, skipped) {\n        var children = this.getChildren(clusterId, clusterZoom);\n\n        for (var i = 0; i < children.length; i++) {\n            var props = children[i].properties;\n\n            if (props.cluster) {\n                if (skipped + props.point_count <= offset) {\n                    // skip the whole cluster\n                    skipped += props.point_count;\n                } else {\n                    // enter the cluster\n                    skipped = this._appendLeaves(\n                        result, props.cluster_id, clusterZoom + 1, limit, offset, skipped);\n                    // exit the cluster\n                }\n            } else if (skipped < offset) {\n                // skip a single point\n                skipped++;\n            } else {\n                // add a single point\n                result.push(children[i]);\n            }\n            if (result.length === limit) break;\n        }\n\n        return skipped;\n    },\n\n    _addTileFeatures: function (ids, points, x, y, z2, tile) {\n        for (var i = 0; i < ids.length; i++) {\n            var c = points[ids[i]];\n            tile.features.push({\n                type: 1,\n                geometry: [[\n                    Math.round(this.options.extent * (c.x * z2 - x)),\n                    Math.round(this.options.extent * (c.y * z2 - y))\n                ]],\n                tags: c.numPoints ? getClusterProperties(c) : this.points[c.id].properties\n            });\n        }\n    },\n\n    _limitZoom: function (z) {\n        return Math.max(this.options.minZoom, Math.min(z, this.options.maxZoom + 1));\n    },\n\n    _cluster: function (points, zoom) {\n        var clusters = [];\n        var r = this.options.radius / (this.options.extent * Math.pow(2, zoom));\n\n        // loop through each point\n        for (var i = 0; i < points.length; i++) {\n            var p = points[i];\n            // if we've already visited the point at this zoom level, skip it\n            if (p.zoom <= zoom) continue;\n            p.zoom = zoom;\n\n            // find all nearby points\n            var tree = this.trees[zoom + 1];\n            var neighborIds = tree.within(p.x, p.y, r);\n\n            var numPoints = p.numPoints || 1;\n            var wx = p.x * numPoints;\n            var wy = p.y * numPoints;\n\n            var clusterProperties = null;\n\n            if (this.options.reduce) {\n                clusterProperties = this.options.initial();\n                this._accumulate(clusterProperties, p);\n            }\n\n            for (var j = 0; j < neighborIds.length; j++) {\n                var b = tree.points[neighborIds[j]];\n                // filter out neighbors that are too far or already processed\n                if (zoom < b.zoom) {\n                    var numPoints2 = b.numPoints || 1;\n                    b.zoom = zoom; // save the zoom (so it doesn't get processed twice)\n                    wx += b.x * numPoints2; // accumulate coordinates for calculating weighted center\n                    wy += b.y * numPoints2;\n                    numPoints += numPoints2;\n                    b.parentId = i;\n\n                    if (this.options.reduce) {\n                        this._accumulate(clusterProperties, b);\n                    }\n                }\n            }\n\n            if (numPoints === 1) {\n                clusters.push(p);\n            } else {\n                p.parentId = i;\n                clusters.push(createCluster(wx / numPoints, wy / numPoints, numPoints, i, clusterProperties));\n            }\n        }\n\n        return clusters;\n    },\n\n    _accumulate: function (clusterProperties, point) {\n        var properties = point.numPoints ?\n            point.properties :\n            this.options.map(this.points[point.id].properties);\n\n        this.options.reduce(clusterProperties, properties);\n    }\n};\n\nfunction createCluster(x, y, numPoints, id, properties) {\n    return {\n        x: x, // weighted cluster center\n        y: y,\n        zoom: Infinity, // the last zoom the cluster was processed at\n        id: id, // index of the first child of the cluster in the zoom level tree\n        properties: properties,\n        parentId: -1, // parent cluster id\n        numPoints: numPoints\n    };\n}\n\nfunction createPointCluster(p, id) {\n    var coords = p.geometry.coordinates;\n    return {\n        x: lngX(coords[0]), // projected point coordinates\n        y: latY(coords[1]),\n        zoom: Infinity, // the last zoom the point was processed at\n        id: id, // index of the source feature in the original input array\n        parentId: -1 // parent cluster id\n    };\n}\n\nfunction getClusterJSON(cluster) {\n    return {\n        type: 'Feature',\n        properties: getClusterProperties(cluster),\n        geometry: {\n            type: 'Point',\n            coordinates: [xLng(cluster.x), yLat(cluster.y)]\n        }\n    };\n}\n\nfunction getClusterProperties(cluster) {\n    var count = cluster.numPoints;\n    var abbrev = count >= 10000 ? Math.round(count / 1000) + 'k' :\n                 count >= 1000 ? (Math.round(count / 100) / 10) + 'k' : count;\n    return extend(extend({}, cluster.properties), {\n        cluster: true,\n        cluster_id: cluster.id,\n        point_count: count,\n        point_count_abbreviated: abbrev\n    });\n}\n\n// longitude/latitude to spherical mercator in [0..1] range\nfunction lngX(lng) {\n    return lng / 360 + 0.5;\n}\nfunction latY(lat) {\n    var sin = Math.sin(lat * Math.PI / 180),\n        y = (0.5 - 0.25 * Math.log((1 + sin) / (1 - sin)) / Math.PI);\n    return y < 0 ? 0 :\n           y > 1 ? 1 : y;\n}\n\n// spherical mercator to longitude/latitude\nfunction xLng(x) {\n    return (x - 0.5) * 360;\n}\nfunction yLat(y) {\n    var y2 = (180 - y * 360) * Math.PI / 180;\n    return 360 * Math.atan(Math.exp(y2)) / Math.PI - 90;\n}\n\nfunction extend(dest, src) {\n    for (var id in src) dest[id] = src[id];\n    return dest;\n}\n\nfunction getX(p) {\n    return p.x;\n}\nfunction getY(p) {\n    return p.y;\n}\n","'use strict';\n\nvar sort = require('./sort');\nvar range = require('./range');\nvar within = require('./within');\n\nmodule.exports = kdbush;\n\nfunction kdbush(points, getX, getY, nodeSize, ArrayType) {\n    return new KDBush(points, getX, getY, nodeSize, ArrayType);\n}\n\nfunction KDBush(points, getX, getY, nodeSize, ArrayType) {\n    getX = getX || defaultGetX;\n    getY = getY || defaultGetY;\n    ArrayType = ArrayType || Array;\n\n    this.nodeSize = nodeSize || 64;\n    this.points = points;\n\n    this.ids = new ArrayType(points.length);\n    this.coords = new ArrayType(points.length * 2);\n\n    for (var i = 0; i < points.length; i++) {\n        this.ids[i] = i;\n        this.coords[2 * i] = getX(points[i]);\n        this.coords[2 * i + 1] = getY(points[i]);\n    }\n\n    sort(this.ids, this.coords, this.nodeSize, 0, this.ids.length - 1, 0);\n}\n\nKDBush.prototype = {\n    range: function (minX, minY, maxX, maxY) {\n        return range(this.ids, this.coords, minX, minY, maxX, maxY, this.nodeSize);\n    },\n\n    within: function (x, y, r) {\n        return within(this.ids, this.coords, x, y, r, this.nodeSize);\n    }\n};\n\nfunction defaultGetX(p) { return p[0]; }\nfunction defaultGetY(p) { return p[1]; }\n","'use strict';\n\nmodule.exports = sortKD;\n\nfunction sortKD(ids, coords, nodeSize, left, right, depth) {\n    if (right - left <= nodeSize) return;\n\n    var m = Math.floor((left + right) / 2);\n\n    select(ids, coords, m, left, right, depth % 2);\n\n    sortKD(ids, coords, nodeSize, left, m - 1, depth + 1);\n    sortKD(ids, coords, nodeSize, m + 1, right, depth + 1);\n}\n\nfunction select(ids, coords, k, left, right, inc) {\n\n    while (right > left) {\n        if (right - left > 600) {\n            var n = right - left + 1;\n            var m = k - left + 1;\n            var z = Math.log(n);\n            var s = 0.5 * Math.exp(2 * z / 3);\n            var sd = 0.5 * Math.sqrt(z * s * (n - s) / n) * (m - n / 2 < 0 ? -1 : 1);\n            var newLeft = Math.max(left, Math.floor(k - m * s / n + sd));\n            var newRight = Math.min(right, Math.floor(k + (n - m) * s / n + sd));\n            select(ids, coords, k, newLeft, newRight, inc);\n        }\n\n        var t = coords[2 * k + inc];\n        var i = left;\n        var j = right;\n\n        swapItem(ids, coords, left, k);\n        if (coords[2 * right + inc] > t) swapItem(ids, coords, left, right);\n\n        while (i < j) {\n            swapItem(ids, coords, i, j);\n            i++;\n            j--;\n            while (coords[2 * i + inc] < t) i++;\n            while (coords[2 * j + inc] > t) j--;\n        }\n\n        if (coords[2 * left + inc] === t) swapItem(ids, coords, left, j);\n        else {\n            j++;\n            swapItem(ids, coords, j, right);\n        }\n\n        if (j <= k) left = j + 1;\n        if (k <= j) right = j - 1;\n    }\n}\n\nfunction swapItem(ids, coords, i, j) {\n    swap(ids, i, j);\n    swap(coords, 2 * i, 2 * j);\n    swap(coords, 2 * i + 1, 2 * j + 1);\n}\n\nfunction swap(arr, i, j) {\n    var tmp = arr[i];\n    arr[i] = arr[j];\n    arr[j] = tmp;\n}\n","'use strict';\n\nmodule.exports = range;\n\nfunction range(ids, coords, minX, minY, maxX, maxY, nodeSize) {\n    var stack = [0, ids.length - 1, 0];\n    var result = [];\n    var x, y;\n\n    while (stack.length) {\n        var axis = stack.pop();\n        var right = stack.pop();\n        var left = stack.pop();\n\n        if (right - left <= nodeSize) {\n            for (var i = left; i <= right; i++) {\n                x = coords[2 * i];\n                y = coords[2 * i + 1];\n                if (x >= minX && x <= maxX && y >= minY && y <= maxY) result.push(ids[i]);\n            }\n            continue;\n        }\n\n        var m = Math.floor((left + right) / 2);\n\n        x = coords[2 * m];\n        y = coords[2 * m + 1];\n\n        if (x >= minX && x <= maxX && y >= minY && y <= maxY) result.push(ids[m]);\n\n        var nextAxis = (axis + 1) % 2;\n\n        if (axis === 0 ? minX <= x : minY <= y) {\n            stack.push(left);\n            stack.push(m - 1);\n            stack.push(nextAxis);\n        }\n        if (axis === 0 ? maxX >= x : maxY >= y) {\n            stack.push(m + 1);\n            stack.push(right);\n            stack.push(nextAxis);\n        }\n    }\n\n    return result;\n}\n","'use strict';\n\nmodule.exports = within;\n\nfunction within(ids, coords, qx, qy, r, nodeSize) {\n    var stack = [0, ids.length - 1, 0];\n    var result = [];\n    var r2 = r * r;\n\n    while (stack.length) {\n        var axis = stack.pop();\n        var right = stack.pop();\n        var left = stack.pop();\n\n        if (right - left <= nodeSize) {\n            for (var i = left; i <= right; i++) {\n                if (sqDist(coords[2 * i], coords[2 * i + 1], qx, qy) <= r2) result.push(ids[i]);\n            }\n            continue;\n        }\n\n        var m = Math.floor((left + right) / 2);\n\n        var x = coords[2 * m];\n        var y = coords[2 * m + 1];\n\n        if (sqDist(x, y, qx, qy) <= r2) result.push(ids[m]);\n\n        var nextAxis = (axis + 1) % 2;\n\n        if (axis === 0 ? qx - r <= x : qy - r <= y) {\n            stack.push(left);\n            stack.push(m - 1);\n            stack.push(nextAxis);\n        }\n        if (axis === 0 ? qx + r >= x : qy + r >= y) {\n            stack.push(m + 1);\n            stack.push(right);\n            stack.push(nextAxis);\n        }\n    }\n\n    return result;\n}\n\nfunction sqDist(ax, ay, bx, by) {\n    var dx = ax - bx;\n    var dy = ay - by;\n    return dx * dx + dy * dy;\n}\n","'use strict';\n\nmodule.exports = geojsonvt;\n\nvar convert = require('./convert'),     // GeoJSON conversion and preprocessing\n    transform = require('./transform'), // coordinate transformation\n    clip = require('./clip'),           // stripe clipping algorithm\n    wrap = require('./wrap'),           // date line processing\n    createTile = require('./tile');     // final simplified tile generation\n\n\nfunction geojsonvt(data, options) {\n    return new GeoJSONVT(data, options);\n}\n\nfunction GeoJSONVT(data, options) {\n    options = this.options = extend(Object.create(this.options), options);\n\n    var debug = options.debug;\n\n    if (debug) console.time('preprocess data');\n\n    if (options.maxZoom < 0 || options.maxZoom > 24) throw new Error('maxZoom should be in the 0-24 range');\n\n    var z2 = 1 << options.maxZoom, // 2^z\n        features = convert(data, options.tolerance / (z2 * options.extent));\n\n    this.tiles = {};\n    this.tileCoords = [];\n\n    if (debug) {\n        console.timeEnd('preprocess data');\n        console.log('index: maxZoom: %d, maxPoints: %d', options.indexMaxZoom, options.indexMaxPoints);\n        console.time('generate tiles');\n        this.stats = {};\n        this.total = 0;\n    }\n\n    features = wrap(features, options.buffer / options.extent);\n\n    // start slicing from the top tile down\n    if (features.length) this.splitTile(features, 0, 0, 0);\n\n    if (debug) {\n        if (features.length) console.log('features: %d, points: %d', this.tiles[0].numFeatures, this.tiles[0].numPoints);\n        console.timeEnd('generate tiles');\n        console.log('tiles generated:', this.total, JSON.stringify(this.stats));\n    }\n}\n\nGeoJSONVT.prototype.options = {\n    maxZoom: 14,            // max zoom to preserve detail on\n    indexMaxZoom: 5,        // max zoom in the tile index\n    indexMaxPoints: 100000, // max number of points per tile in the tile index\n    tolerance: 3,           // simplification tolerance (higher means simpler)\n    extent: 4096,           // tile extent\n    buffer: 64,             // tile buffer on each side\n    debug: 0                // logging level (0, 1 or 2)\n};\n\nGeoJSONVT.prototype.splitTile = function (features, z, x, y, cz, cx, cy) {\n\n    var stack = [features, z, x, y],\n        options = this.options,\n        debug = options.debug;\n\n    // avoid recursion by using a processing queue\n    while (stack.length) {\n        y = stack.pop();\n        x = stack.pop();\n        z = stack.pop();\n        features = stack.pop();\n\n        var z2 = 1 << z,\n            id = toID(z, x, y),\n            tile = this.tiles[id],\n            tileTolerance = z === options.maxZoom ? 0 : options.tolerance / (z2 * options.extent);\n\n        if (!tile) {\n            if (debug > 1) console.time('creation');\n\n            tile = this.tiles[id] = createTile(features, z2, x, y, tileTolerance, z === options.maxZoom);\n            this.tileCoords.push({z: z, x: x, y: y});\n\n            if (debug) {\n                if (debug > 1) {\n                    console.log('tile z%d-%d-%d (features: %d, points: %d, simplified: %d)',\n                        z, x, y, tile.numFeatures, tile.numPoints, tile.numSimplified);\n                    console.timeEnd('creation');\n                }\n                var key = 'z' + z;\n                this.stats[key] = (this.stats[key] || 0) + 1;\n                this.total++;\n            }\n        }\n\n        // save reference to original geometry in tile so that we can drill down later if we stop now\n        tile.source = features;\n\n        // if it's the first-pass tiling\n        if (!cz) {\n            // stop tiling if we reached max zoom, or if the tile is too simple\n            if (z === options.indexMaxZoom || tile.numPoints <= options.indexMaxPoints) continue;\n\n        // if a drilldown to a specific tile\n        } else {\n            // stop tiling if we reached base zoom or our target tile zoom\n            if (z === options.maxZoom || z === cz) continue;\n\n            // stop tiling if it's not an ancestor of the target tile\n            var m = 1 << (cz - z);\n            if (x !== Math.floor(cx / m) || y !== Math.floor(cy / m)) continue;\n        }\n\n        // if we slice further down, no need to keep source geometry\n        tile.source = null;\n\n        if (features.length === 0) continue;\n\n        if (debug > 1) console.time('clipping');\n\n        // values we'll use for clipping\n        var k1 = 0.5 * options.buffer / options.extent,\n            k2 = 0.5 - k1,\n            k3 = 0.5 + k1,\n            k4 = 1 + k1,\n            tl, bl, tr, br, left, right;\n\n        tl = bl = tr = br = null;\n\n        left  = clip(features, z2, x - k1, x + k3, 0, tile.minX, tile.maxX);\n        right = clip(features, z2, x + k2, x + k4, 0, tile.minX, tile.maxX);\n        features = null;\n\n        if (left) {\n            tl = clip(left, z2, y - k1, y + k3, 1, tile.minY, tile.maxY);\n            bl = clip(left, z2, y + k2, y + k4, 1, tile.minY, tile.maxY);\n            left = null;\n        }\n\n        if (right) {\n            tr = clip(right, z2, y - k1, y + k3, 1, tile.minY, tile.maxY);\n            br = clip(right, z2, y + k2, y + k4, 1, tile.minY, tile.maxY);\n            right = null;\n        }\n\n        if (debug > 1) console.timeEnd('clipping');\n\n        stack.push(tl || [], z + 1, x * 2,     y * 2);\n        stack.push(bl || [], z + 1, x * 2,     y * 2 + 1);\n        stack.push(tr || [], z + 1, x * 2 + 1, y * 2);\n        stack.push(br || [], z + 1, x * 2 + 1, y * 2 + 1);\n    }\n};\n\nGeoJSONVT.prototype.getTile = function (z, x, y) {\n    var options = this.options,\n        extent = options.extent,\n        debug = options.debug;\n\n    if (z < 0 || z > 24) return null;\n\n    var z2 = 1 << z;\n    x = ((x % z2) + z2) % z2; // wrap tile x coordinate\n\n    var id = toID(z, x, y);\n    if (this.tiles[id]) return transform.tile(this.tiles[id], extent);\n\n    if (debug > 1) console.log('drilling down to z%d-%d-%d', z, x, y);\n\n    var z0 = z,\n        x0 = x,\n        y0 = y,\n        parent;\n\n    while (!parent && z0 > 0) {\n        z0--;\n        x0 = Math.floor(x0 / 2);\n        y0 = Math.floor(y0 / 2);\n        parent = this.tiles[toID(z0, x0, y0)];\n    }\n\n    if (!parent || !parent.source) return null;\n\n    // if we found a parent tile containing the original geometry, we can drill down from it\n    if (debug > 1) console.log('found parent tile z%d-%d-%d', z0, x0, y0);\n\n    if (debug > 1) console.time('drilling down');\n    this.splitTile(parent.source, z0, x0, y0, z, x, y);\n    if (debug > 1) console.timeEnd('drilling down');\n\n    return this.tiles[id] ? transform.tile(this.tiles[id], extent) : null;\n};\n\nfunction toID(z, x, y) {\n    return (((1 << z) * y + x) * 32) + z;\n}\n\nfunction extend(dest, src) {\n    for (var i in src) dest[i] = src[i];\n    return dest;\n}\n","'use strict';\n\nmodule.exports = convert;\n\nvar simplify = require('./simplify');\nvar createFeature = require('./feature');\n\n// converts GeoJSON feature into an intermediate projected JSON vector format with simplification data\n\nfunction convert(data, tolerance) {\n    var features = [];\n\n    if (data.type === 'FeatureCollection') {\n        for (var i = 0; i < data.features.length; i++) {\n            convertFeature(features, data.features[i], tolerance);\n        }\n\n    } else if (data.type === 'Feature') {\n        convertFeature(features, data, tolerance);\n\n    } else {\n        // single geometry or a geometry collection\n        convertFeature(features, {geometry: data}, tolerance);\n    }\n\n    return features;\n}\n\nfunction convertFeature(features, geojson, tolerance) {\n    if (!geojson.geometry) return;\n\n    var coords = geojson.geometry.coordinates;\n    var type = geojson.geometry.type;\n    var tol = tolerance * tolerance;\n    var geometry = [];\n\n    if (type === 'Point') {\n        convertPoint(coords, geometry);\n\n    } else if (type === 'MultiPoint') {\n        for (var i = 0; i < coords.length; i++) {\n            convertPoint(coords[i], geometry);\n        }\n\n    } else if (type === 'LineString') {\n        convertLine(coords, geometry, tol, false);\n\n    } else if (type === 'MultiLineString') {\n        convertLines(coords, geometry, tol, false);\n\n    } else if (type === 'Polygon') {\n        convertLines(coords, geometry, tol, true);\n\n    } else if (type === 'MultiPolygon') {\n        for (i = 0; i < coords.length; i++) {\n            var polygon = [];\n            convertLines(coords[i], polygon, tol, true);\n            geometry.push(polygon);\n        }\n    } else if (type === 'GeometryCollection') {\n        for (i = 0; i < geojson.geometry.geometries.length; i++) {\n            convertFeature(features, {\n                geometry: geojson.geometry.geometries[i],\n                properties: geojson.properties\n            }, tolerance);\n        }\n        return;\n    } else {\n        throw new Error('Input data is not a valid GeoJSON object.');\n    }\n\n    features.push(createFeature(geojson.id, type, geometry, geojson.properties));\n}\n\nfunction convertPoint(coords, out) {\n    out.push(projectX(coords[0]));\n    out.push(projectY(coords[1]));\n    out.push(0);\n}\n\nfunction convertLine(ring, out, tol, isPolygon) {\n    var x0, y0;\n    var size = 0;\n\n    for (var j = 0; j < ring.length; j++) {\n        var x = projectX(ring[j][0]);\n        var y = projectY(ring[j][1]);\n\n        out.push(x);\n        out.push(y);\n        out.push(0);\n\n        if (j > 0) {\n            if (isPolygon) {\n                size += (x0 * y - x * y0) / 2; // area\n            } else {\n                size += Math.sqrt(Math.pow(x - x0, 2) + Math.pow(y - y0, 2)); // length\n            }\n        }\n        x0 = x;\n        y0 = y;\n    }\n\n    var last = out.length - 3;\n    out[2] = 1;\n    simplify(out, 0, last, tol);\n    out[last + 2] = 1;\n\n    out.size = Math.abs(size);\n}\n\nfunction convertLines(rings, out, tol, isPolygon) {\n    for (var i = 0; i < rings.length; i++) {\n        var geom = [];\n        convertLine(rings[i], geom, tol, isPolygon);\n        out.push(geom);\n    }\n}\n\nfunction projectX(x) {\n    return x / 360 + 0.5;\n}\n\nfunction projectY(y) {\n    var sin = Math.sin(y * Math.PI / 180);\n    var y2 = 0.5 - 0.25 * Math.log((1 + sin) / (1 - sin)) / Math.PI;\n    return y2 < 0 ? 0 : y2 > 1 ? 1 : y2;\n}\n","'use strict';\n\nmodule.exports = simplify;\n\n// calculate simplification data using optimized Douglas-Peucker algorithm\n\nfunction simplify(coords, first, last, sqTolerance) {\n    var maxSqDist = sqTolerance;\n    var index;\n\n    var ax = coords[first];\n    var ay = coords[first + 1];\n    var bx = coords[last];\n    var by = coords[last + 1];\n\n    for (var i = first + 3; i < last; i += 3) {\n        var d = getSqSegDist(coords[i], coords[i + 1], ax, ay, bx, by);\n        if (d > maxSqDist) {\n            index = i;\n            maxSqDist = d;\n        }\n    }\n\n    if (maxSqDist > sqTolerance) {\n        if (index - first > 3) simplify(coords, first, index, sqTolerance);\n        coords[index + 2] = maxSqDist;\n        if (last - index > 3) simplify(coords, index, last, sqTolerance);\n    }\n}\n\n// square distance from a point to a segment\nfunction getSqSegDist(px, py, x, y, bx, by) {\n\n    var dx = bx - x;\n    var dy = by - y;\n\n    if (dx !== 0 || dy !== 0) {\n\n        var t = ((px - x) * dx + (py - y) * dy) / (dx * dx + dy * dy);\n\n        if (t > 1) {\n            x = bx;\n            y = by;\n\n        } else if (t > 0) {\n            x += dx * t;\n            y += dy * t;\n        }\n    }\n\n    dx = px - x;\n    dy = py - y;\n\n    return dx * dx + dy * dy;\n}\n","'use strict';\n\nexports.tile = transformTile;\nexports.point = transformPoint;\n\n// Transforms the coordinates of each feature in the given tile from\n// mercator-projected space into (extent x extent) tile space.\nfunction transformTile(tile, extent) {\n    if (tile.transformed) return tile;\n\n    var z2 = tile.z2,\n        tx = tile.x,\n        ty = tile.y,\n        i, j, k;\n\n    for (i = 0; i < tile.features.length; i++) {\n        var feature = tile.features[i],\n            geom = feature.geometry,\n            type = feature.type;\n\n        feature.geometry = [];\n\n        if (type === 1) {\n            for (j = 0; j < geom.length; j += 2) {\n                feature.geometry.push(transformPoint(geom[j], geom[j + 1], extent, z2, tx, ty));\n            }\n        } else {\n            for (j = 0; j < geom.length; j++) {\n                var ring = [];\n                for (k = 0; k < geom[j].length; k += 2) {\n                    ring.push(transformPoint(geom[j][k], geom[j][k + 1], extent, z2, tx, ty));\n                }\n                feature.geometry.push(ring);\n            }\n        }\n    }\n\n    tile.transformed = true;\n\n    return tile;\n}\n\nfunction transformPoint(x, y, extent, z2, tx, ty) {\n    return [\n        Math.round(extent * (x * z2 - tx)),\n        Math.round(extent * (y * z2 - ty))];\n}\n","'use strict';\n\nvar clip = require('./clip');\nvar createFeature = require('./feature');\n\nmodule.exports = wrap;\n\nfunction wrap(features, buffer) {\n    var merged = features,\n        left  = clip(features, 1, -1 - buffer, buffer,     0, -1, 2), // left world copy\n        right = clip(features, 1,  1 - buffer, 2 + buffer, 0, -1, 2); // right world copy\n\n    if (left || right) {\n        merged = clip(features, 1, -buffer, 1 + buffer, 0, -1, 2) || []; // center world copy\n\n        if (left) merged = shiftFeatureCoords(left, 1).concat(merged); // merge left into center\n        if (right) merged = merged.concat(shiftFeatureCoords(right, -1)); // merge right into center\n    }\n\n    return merged;\n}\n\nfunction shiftFeatureCoords(features, offset) {\n    var newFeatures = [];\n\n    for (var i = 0; i < features.length; i++) {\n        var feature = features[i],\n            type = feature.type;\n\n        var newGeometry;\n\n        if (type === 'Point' || type === 'MultiPoint' || type === 'LineString') {\n            newGeometry = shiftCoords(feature.geometry, offset);\n\n        } else if (type === 'MultiLineString' || type === 'Polygon') {\n            newGeometry = [];\n            for (var j = 0; j < feature.geometry.length; j++) {\n                newGeometry.push(shiftCoords(feature.geometry[j], offset));\n            }\n        } else if (type === 'MultiPolygon') {\n            newGeometry = [];\n            for (j = 0; j < feature.geometry.length; j++) {\n                var newPolygon = [];\n                for (var k = 0; k < feature.geometry[j].length; k++) {\n                    newPolygon.push(shiftCoords(feature.geometry[j][k], offset));\n                }\n                newGeometry.push(newPolygon);\n            }\n        }\n\n        newFeatures.push(createFeature(feature.id, type, newGeometry, feature.tags));\n    }\n\n    return newFeatures;\n}\n\nfunction shiftCoords(points, offset) {\n    var newPoints = [];\n    newPoints.size = points.size;\n\n    for (var i = 0; i < points.length; i += 3) {\n        newPoints.push(points[i] + offset, points[i + 1], points[i + 2]);\n    }\n    return newPoints;\n}\n","'use strict';\n\nmodule.exports = createTile;\n\nfunction createTile(features, z2, tx, ty, tolerance, noSimplify) {\n    var tile = {\n        features: [],\n        numPoints: 0,\n        numSimplified: 0,\n        numFeatures: 0,\n        source: null,\n        x: tx,\n        y: ty,\n        z2: z2,\n        transformed: false,\n        minX: 2,\n        minY: 1,\n        maxX: -1,\n        maxY: 0\n    };\n    for (var i = 0; i < features.length; i++) {\n        tile.numFeatures++;\n        addFeature(tile, features[i], tolerance, noSimplify);\n\n        var minX = features[i].minX;\n        var minY = features[i].minY;\n        var maxX = features[i].maxX;\n        var maxY = features[i].maxY;\n\n        if (minX < tile.minX) tile.minX = minX;\n        if (minY < tile.minY) tile.minY = minY;\n        if (maxX > tile.maxX) tile.maxX = maxX;\n        if (maxY > tile.maxY) tile.maxY = maxY;\n    }\n    return tile;\n}\n\nfunction addFeature(tile, feature, tolerance, noSimplify) {\n\n    var geom = feature.geometry,\n        type = feature.type,\n        simplified = [];\n\n    if (type === 'Point' || type === 'MultiPoint') {\n        for (var i = 0; i < geom.length; i += 3) {\n            simplified.push(geom[i]);\n            simplified.push(geom[i + 1]);\n            tile.numPoints++;\n            tile.numSimplified++;\n        }\n\n    } else if (type === 'LineString') {\n        addLine(simplified, geom, tile, tolerance, noSimplify, false, false);\n\n    } else if (type === 'MultiLineString' || type === 'Polygon') {\n        for (i = 0; i < geom.length; i++) {\n            addLine(simplified, geom[i], tile, tolerance, noSimplify, type === 'Polygon', i === 0);\n        }\n\n    } else if (type === 'MultiPolygon') {\n\n        for (var k = 0; k < geom.length; k++) {\n            var polygon = geom[k];\n            for (i = 0; i < polygon.length; i++) {\n                addLine(simplified, polygon[i], tile, tolerance, noSimplify, true, i === 0);\n            }\n        }\n    }\n\n    if (simplified.length) {\n        var tileFeature = {\n            geometry: simplified,\n            type: type === 'Polygon' || type === 'MultiPolygon' ? 3 :\n                type === 'LineString' || type === 'MultiLineString' ? 2 : 1,\n            tags: feature.tags || null\n        };\n        if (feature.id !== null) {\n            tileFeature.id = feature.id;\n        }\n        tile.features.push(tileFeature);\n    }\n}\n\nfunction addLine(result, geom, tile, tolerance, noSimplify, isPolygon, isOuter) {\n    var sqTolerance = tolerance * tolerance;\n\n    if (!noSimplify && (geom.size < (isPolygon ? sqTolerance : tolerance))) {\n        tile.numPoints += geom.length / 3;\n        return;\n    }\n\n    var ring = [];\n\n    for (var i = 0; i < geom.length; i += 3) {\n        if (noSimplify || geom[i + 2] > sqTolerance) {\n            tile.numSimplified++;\n            ring.push(geom[i]);\n            ring.push(geom[i + 1]);\n        }\n        tile.numPoints++;\n    }\n\n    if (isPolygon) rewind(ring, isOuter);\n\n    result.push(ring);\n}\n\nfunction rewind(ring, clockwise) {\n    var area = 0;\n    for (var i = 0, len = ring.length, j = len - 2; i < len; j = i, i += 2) {\n        area += (ring[i] - ring[j]) * (ring[i + 1] + ring[j + 1]);\n    }\n    if (area > 0 === clockwise) {\n        for (i = 0, len = ring.length; i < len / 2; i += 2) {\n            var x = ring[i];\n            var y = ring[i + 1];\n            ring[i] = ring[len - 2 - i];\n            ring[i + 1] = ring[len - 1 - i];\n            ring[len - 2 - i] = x;\n            ring[len - 1 - i] = y;\n        }\n    }\n}\n"],"sourceRoot":""}